
<!-- saved from url=(0100)http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

<title>Spring Framework Reference Documentation</title><link rel="stylesheet" type="text/css" href="./Spring Framework Reference Documentation_files/A.manual-singlepage.css.pagespeed.cf.ORoRI8gvCf.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="d5e1"></a>Spring Framework Reference Documentation</h1></div><div><div class="authorgroup"><h2>Authors</h2>
<span class="author"><span class="firstname">Rod</span> <span class="surname">Johnson</span></span>
, <span class="author"><span class="firstname">Juergen</span> <span class="surname">Hoeller</span></span>
, <span class="author"><span class="firstname">Keith</span> <span class="surname">Donald</span></span>
, <span class="author"><span class="firstname">Colin</span> <span class="surname">Sampaleanu</span></span>
, <span class="author"><span class="firstname">Rob</span> <span class="surname">Harrop</span></span>
, <span class="author"><span class="firstname">Thomas</span> <span class="surname">Risberg</span></span>
, <span class="author"><span class="firstname">Alef</span> <span class="surname">Arendsen</span></span>
, <span class="author"><span class="firstname">Darren</span> <span class="surname">Davison</span></span>
, <span class="author"><span class="firstname">Dmitriy</span> <span class="surname">Kopylenko</span></span>
, <span class="author"><span class="firstname">Mark</span> <span class="surname">Pollack</span></span>
, <span class="author"><span class="firstname">Thierry</span> <span class="surname">Templier</span></span>
, <span class="author"><span class="firstname">Erwin</span> <span class="surname">Vervaet</span></span>
, <span class="author"><span class="firstname">Portia</span> <span class="surname">Tung</span></span>
, <span class="author"><span class="firstname">Ben</span> <span class="surname">Hale</span></span>
, <span class="author"><span class="firstname">Adrian</span> <span class="surname">Colyer</span></span>
, <span class="author"><span class="firstname">John</span> <span class="surname">Lewis</span></span>
, <span class="author"><span class="firstname">Costin</span> <span class="surname">Leau</span></span>
, <span class="author"><span class="firstname">Mark</span> <span class="surname">Fisher</span></span>
, <span class="author"><span class="firstname">Sam</span> <span class="surname">Brannen</span></span>
, <span class="author"><span class="firstname">Ramnivas</span> <span class="surname">Laddad</span></span>
, <span class="author"><span class="firstname">Arjen</span> <span class="surname">Poutsma</span></span>
, <span class="author"><span class="firstname">Chris</span> <span class="surname">Beams</span></span>
, <span class="author"><span class="firstname">Tareq</span> <span class="surname">Abedrabbo</span></span>
, <span class="author"><span class="firstname">Andy</span> <span class="surname">Clement</span></span>
, <span class="author"><span class="firstname">Dave</span> <span class="surname">Syer</span></span>
, <span class="author"><span class="firstname">Oliver</span> <span class="surname">Gierke</span></span>
, <span class="author"><span class="firstname">Rossen</span> <span class="surname">Stoyanchev</span></span>
, <span class="author"><span class="firstname">Phillip</span> <span class="surname">Webb</span></span>
, <span class="author"><span class="firstname">Rob</span> <span class="surname">Winch</span></span>
, <span class="author"><span class="firstname">Brian</span> <span class="surname">Clozel</span></span>
, <span class="author"><span class="firstname">Stephane</span> <span class="surname">Nicoll</span></span>
, <span class="author"><span class="firstname">Sebastien</span> <span class="surname">Deleuze</span></span>
</div></div><div><p class="releaseinfo">4.3.8.RELEASE</p></div><div><p class="copyright">Copyright © 2004-2016 </p></div><div><div class="legalnotice"><a name="d5e138" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e138"></a>
<p>Copies of this document may be made for your own use and for distribution to
others, provided that you do not charge any fee for such copies and further provided
that each copy contains this Copyright Notice, whether distributed in print or
electronically.</p>
</div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="part"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-introduction">I. Overview of Spring Framework</a></span></dt><dd><dl><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-getting-started-with-spring">1. Getting Started with Spring</a></span></dt><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview">2. Introduction to the Spring Framework</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-dependency-injection">2.1. Dependency Injection and Inversion of Control</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-modules">2.2. Framework Modules</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-core-container">2.2.1. Core Container</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-aop-instrumentation">2.2.2. AOP and Instrumentation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-messaging">2.2.3. Messaging</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-data-access">2.2.4. Data Access/Integration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-web">2.2.5. Web</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-testing">2.2.6. Test</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-usagescenarios">2.3. Usage scenarios</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dependency-management">2.3.1. Dependency Management and Naming Conventions</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-spring-dependencies">Spring Dependencies and Depending on Spring</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-maven-dependency-management">Maven Dependency Management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-maven-bom">Maven "Bill Of Materials" Dependency</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-gradle-dependency-management">Gradle Dependency Management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-ivy-dependency-management">Ivy Dependency Management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-distribution-zip">Distribution Zip Files</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging">2.3.2. Logging</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging-log4j">Using Log4j 1.2 or 2.x</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-avoiding-commons-logging">Avoiding Commons Logging</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging-slf4j">Using SLF4J with Log4j or Logback</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging-jul">Using JUL (java.util.logging)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging-websphere">Commons Logging on WebSphere</a></span></dt></dl></dd></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-whats-new">II. What’s New in Spring Framework 4.x</a></span></dt><dd><dl><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#new-in-4.0">3. New Features and Enhancements in Spring Framework 4.0</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_improved_getting_started_experience">3.1. Improved Getting Started Experience</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_removed_deprecated_packages_and_methods">3.2. Removed Deprecated Packages and Methods</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_java_8_as_well_as_6_and_7">3.3. Java 8 (as well as 6 and 7)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_java_ee_6_and_7">3.4. Java EE 6 and 7</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_groovy_bean_definition_dsl">3.5. Groovy Bean Definition DSL</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_core_container_improvements">3.6. Core Container Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_general_web_improvements">3.7. General Web Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_websocket_sockjs_and_stomp_messaging">3.8. WebSocket, SockJS, and STOMP Messaging</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testing_improvements">3.9. Testing Improvements</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#new-in-4.1">4. New Features and Enhancements in Spring Framework 4.1</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_jms_improvements">4.1. JMS Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_caching_improvements">4.2. Caching Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_web_improvements">4.3. Web Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_websocket_messaging_improvements">4.4. WebSocket Messaging Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testing_improvements_2">4.5. Testing Improvements</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#new-in-4.2">5. New Features and Enhancements in Spring Framework 4.2</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_core_container_improvements_2">5.1. Core Container Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_data_access_improvements">5.2. Data Access Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_jms_improvements_2">5.3. JMS Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_web_improvements_2">5.4. Web Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_websocket_messaging_improvements_2">5.5. WebSocket Messaging Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testing_improvements_3">5.6. Testing Improvements</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#new-in-4.3">6. New Features and Enhancements in Spring Framework 4.3</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_core_container_improvements_3">6.1. Core Container Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_data_access_improvements_2">6.2. Data Access Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_caching_improvements_2">6.3. Caching Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_jms_improvements_3">6.4. JMS Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_web_improvements_3">6.5. Web Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_websocket_messaging_improvements_3">6.6. WebSocket Messaging Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testing_improvements_4">6.7. Testing Improvements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_support_for_new_library_and_server_generations">6.8. Support for new library and server generations</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-core">III. Core Technologies</a></span></dt><dd><dl><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans">7. The IoC container</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-introduction">7.1. Introduction to the Spring IoC container and beans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-basics">7.2. Container overview</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-metadata">7.2.1. Configuration metadata</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-instantiation">7.2.2. Instantiating a container</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-xml-import">Composing XML-based configuration metadata</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#groovy-bean-definition-dsl">The Groovy Bean Definition DSL</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-client">7.2.3. Using the container</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition">7.3. Bean overview</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanname">7.3.1. Naming beans</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanname-alias">Aliasing a bean outside the bean definition</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class">7.3.2. Instantiating beans</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-ctor">Instantiation with a constructor</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-static-factory-method">Instantiation with a static factory method</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-instance-factory-method">Instantiation using an instance factory method</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-dependencies">7.4. Dependencies</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-collaborators">7.4.1. Dependency Injection</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-constructor-injection">Constructor-based dependency injection</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-setter-injection">Setter-based dependency injection</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-dependency-resolution">Dependency resolution process</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-some-examples">Examples of dependency injection</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-properties-detailed">7.4.2. Dependencies and configuration in detail</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-value-element">Straight values (primitives, Strings, and so on)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-ref-element">References to other beans (collaborators)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-inner-beans">Inner beans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-collection-elements">Collections</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-null-element">Null and empty string values</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-p-namespace">XML shortcut with the p-namespace</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-c-namespace">XML shortcut with the c-namespace</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-compound-property-names">Compound property names</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-dependson">7.4.3. Using depends-on</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lazy-init">7.4.4. Lazy-initialized beans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire">7.4.5. Autowiring collaborators</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-exceptions">Limitations and disadvantages of autowiring</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire-candidate">Excluding a bean from autowiring</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-method-injection">7.4.6. Method injection</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lookup-method-injection">Lookup method injection</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-arbitrary-method-replacement">Arbitrary method replacement</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes">7.5. Bean scopes</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton">7.5.1. The singleton scope</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-prototype">7.5.2. The prototype scope</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-sing-prot-interaction">7.5.3. Singleton beans with prototype-bean dependencies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other">7.5.4. Request, session, global session, application, and WebSocket scopes</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-web-configuration">Initial web configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-request">Request scope</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-session">Session scope</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-global-session">Global session scope</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-application">Application scope</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection">Scoped beans as dependencies</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom">7.5.5. Custom scopes</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom-creating">Creating a custom scope</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom-using">Using a custom scope</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-nature">7.6. Customizing the nature of a bean</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle">7.6.1. Lifecycle callbacks</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean">Initialization callbacks</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean">Destruction callbacks</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-default-init-destroy-methods">Default initialization and destroy methods</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-combined-effects">Combining lifecycle mechanisms</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-processor">Startup and shutdown callbacks</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-shutdown">Shutting down the Spring IoC container gracefully in non-web applications</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-aware">7.6.2. ApplicationContextAware and BeanNameAware</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aware-list">7.6.3. Other Aware interfaces</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-child-bean-definitions">7.7. Bean definition inheritance</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension">7.8. Container Extension Points</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp">7.8.1. Customizing beans using a BeanPostProcessor</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp-examples-hw">Example: Hello World, BeanPostProcessor-style</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp-examples-rabpp">Example: The RequiredAnnotationBeanPostProcessor</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-factory-postprocessors">7.8.2. Customizing configuration metadata with a BeanFactoryPostProcessor</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-placeholderconfigurer">Example: the Class name substitution PropertyPlaceholderConfigurer</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-overrideconfigurer">Example: the PropertyOverrideConfigurer</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-factorybean">7.8.3. Customizing instantiation logic with a FactoryBean</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-annotation-config">7.9. Annotation-based container configuration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-required-annotation">7.9.1. @Required</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation">7.9.2. @Autowired</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation-primary">7.9.3. Fine-tuning annotation-based autowiring with @Primary</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation-qualifiers">7.9.4. Fine-tuning annotation-based autowiring with qualifiers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-generics-as-qualifiers">7.9.5. Using generics as autowiring qualifiers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-custom-autowire-configurer">7.9.6. CustomAutowireConfigurer</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-resource-annotation">7.9.7. @Resource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations">7.9.8. @PostConstruct and @PreDestroy</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-classpath-scanning">7.10. Classpath scanning and managed components</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-stereotype-annotations">7.10.1. @Component and further stereotype annotations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-meta-annotations">7.10.2. Meta-annotations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-autodetection">7.10.3. Automatically detecting classes and registering bean definitions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-filters">7.10.4. Using filters to customize scanning</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factorybeans-annotations">7.10.5. Defining bean metadata within components</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-name-generator">7.10.6. Naming autodetected components</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-scope-resolver">7.10.7. Providing a scope for autodetected components</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-qualifiers">7.10.8. Providing qualifier metadata with annotations</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-standard-annotations">7.11. Using JSR 330 Standard Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-inject-named">7.11.1. Dependency Injection with @Inject and @Named</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-named">7.11.2. @Named and @ManagedBean: standard equivalents to the @Component annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-standard-annotations-limitations">7.11.3. Limitations of JSR-330 standard annotations</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java">7.12. Java-based container configuration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-basic-concepts">7.12.1. Basic concepts: @Bean and @Configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container">7.12.2. Instantiating the Spring container using AnnotationConfigApplicationContext</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container-contstructor">Simple construction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container-register">Building the container programmatically using register(Class&lt;?&gt;…&#8203;)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container-scan">Enabling component scanning with scan(String…&#8203;)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container-web">Support for web applications with AnnotationConfigWebApplicationContext</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-bean-annotation">7.12.3. Using the @Bean annotation</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-declaring-a-bean">Declaring a bean</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-dependencies">Bean dependencies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-lifecycle-callbacks">Receiving lifecycle callbacks</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-specifying-bean-scope">Specifying bean scope</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-customizing-bean-naming">Customizing bean naming</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-bean-aliasing">Bean aliasing</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-bean-description">Bean description</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-configuration-annotation">7.12.4. Using the @Configuration annotation</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-injecting-dependencies">Injecting inter-bean dependencies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-method-injection">Lookup method injection</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-further-information-java-config">Further information about how Java-based configuration works internally</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-composing-configuration-classes">7.12.5. Composing Java-based configurations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-using-import">Using the @Import annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-conditional">Conditionally include @Configuration classes or @Bean methods</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-combining">Combining Java and XML configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-environment">7.13. Environment abstraction</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles">7.13.1. Bean definition profiles</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles-java">@Profile</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles-xml">XML bean definition profiles</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles-enable">Activating a profile</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles-default">Default profile</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-property-source-abstraction">7.13.2. PropertySource abstraction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__propertysource">7.13.3. @PropertySource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_placeholder_resolution_in_statements">7.13.4. Placeholder resolution in statements</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-load-time-weaver">7.14. Registering a LoadTimeWeaver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-introduction">7.15. Additional Capabilities of the ApplicationContext</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-messagesource">7.15.1. Internationalization using MessageSource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events">7.15.2. Standard and Custom Events</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-annotation">Annotation-based Event Listeners</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-async">Asynchronous Listeners</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-order">Ordering Listeners</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-generics">Generic Events</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-resources">7.15.3. Convenient access to low-level resources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-create">7.15.4. Convenient ApplicationContext instantiation for web applications</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-deploy-rar">7.15.5. Deploying a Spring ApplicationContext as a Java EE RAR file</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanfactory">7.16. The BeanFactory</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-introduction-ctx-vs-beanfactory">7.16.1. BeanFactory or ApplicationContext?</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-servicelocator">7.16.2. Glue code and the evil singleton</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources">8. Resources</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-introduction">8.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-resource">8.2. The Resource interface</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations">8.3. Built-in Resource implementations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-urlresource">8.3.1. UrlResource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-classpathresource">8.3.2. ClassPathResource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-filesystemresource">8.3.3. FileSystemResource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-servletcontextresource">8.3.4. ServletContextResource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-inputstreamresource">8.3.5. InputStreamResource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-bytearrayresource">8.3.6. ByteArrayResource</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-resourceloader">8.4. The ResourceLoader</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-resourceloaderaware">8.5. The ResourceLoaderAware interface</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-as-dependencies">8.6. Resources as dependencies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx">8.7. Application contexts and Resource paths</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx-construction">8.7.1. Constructing application contexts</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx-classpathxml">Constructing ClassPathXmlApplicationContext instances - shortcuts</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx-wildcards-in-resource-paths">8.7.2. Wildcards in application context constructor resource paths</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx-ant-patterns-in-paths">Ant-style Patterns</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-classpath-wildcards">The Classpath*: portability classpath*: prefix</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-wildcards-in-path-other-stuff">Other notes relating to wildcards</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-filesystemresource-caveats">8.7.3. FileSystemResource caveats</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation">9. Validation, Data Binding, and Type Conversion</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-introduction">9.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validator">9.2. Validation using Spring’s Validator interface</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-conversion">9.3. Resolving codes to error messages</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans">9.4. Bean manipulation and the BeanWrapper</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conventions">9.4.1. Setting and getting basic and nested properties</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conversion">9.4.2. Built-in PropertyEditor implementations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conversion-customeditor-registration">Registering additional custom PropertyEditors</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert">9.5. Spring Type Conversion</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-Converter-API">9.5.1. Converter SPI</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-ConverterFactory-SPI">9.5.2. ConverterFactory</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-GenericConverter-SPI">9.5.3. GenericConverter</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-ConditionalGenericConverter-SPI">ConditionalGenericConverter</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-ConversionService-API">9.5.4. ConversionService API</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-Spring-config">9.5.5. Configuring a ConversionService</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-programmatic-usage">9.5.6. Using a ConversionService programmatically</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format">9.6. Spring Field Formatting</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-Formatter-SPI">9.6.1. Formatter SPI</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-CustomFormatAnnotations">9.6.2. Annotation-driven Formatting</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-annotations-api">Format Annotation API</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-FormatterRegistry-SPI">9.6.3. FormatterRegistry SPI</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-FormatterRegistrar-SPI">9.6.4. FormatterRegistrar SPI</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-configuring-formatting-mvc">9.6.5. Configuring Formatting in Spring MVC</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-configuring-formatting-globaldatetimeformat">9.7. Configuring a global date &amp; time format</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation">9.8. Spring Validation</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-overview">9.8.1. Overview of the JSR-303 Bean Validation API</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring">9.8.2. Configuring a Bean Validation Provider</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring-inject">Injecting a Validator</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring-constraints">Configuring Custom Constraints</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring-method">Spring-driven Method Validation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring-other">Additional Configuration Options</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-binder">9.8.3. Configuring a DataBinder</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-mvc">9.8.4. Spring MVC 3 Validation</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions">10. Spring Expression Language (SpEL)</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-intro">10.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-features">10.2. Feature Overview</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-evaluation">10.3. Expression Evaluation using Spring’s Expression Interface</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-evaluation-context">10.3.1. The EvaluationContext interface</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-type-conversion">Type Conversion</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-parser-configuration">10.3.2. Parser configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-spel-compilation">10.3.3. SpEL compilation</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-compiler-configuration">Compiler configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-compiler-limitations">Compiler limitations</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-beandef">10.4. Expression support for defining bean definitions</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-beandef-xml-based">10.4.1. XML based configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-beandef-annotation-based">10.4.2. Annotation-based configuration</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-language-ref">10.5. Language Reference</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-ref-literal">10.5.1. Literal expressions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-properties-arrays">10.5.2. Properties, Arrays, Lists, Maps, Indexers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-inline-lists">10.5.3. Inline lists</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-inline-maps">10.5.4. Inline Maps</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-array-construction">10.5.5. Array construction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-methods">10.5.6. Methods</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operators">10.5.7. Operators</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operators-relational">Relational operators</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operators-logical">Logical operators</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operators-mathematical">Mathematical operators</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-assignment">10.5.8. Assignment</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-types">10.5.9. Types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-constructors">10.5.10. Constructors</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-ref-variables">10.5.11. Variables</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-this-root">The #this and #root variables</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-ref-functions">10.5.12. Functions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-bean-references">10.5.13. Bean references</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operator-ternary">10.5.14. Ternary Operator (If-Then-Else)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operator-elvis">10.5.15. The Elvis Operator</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operator-safe-navigation">10.5.16. Safe Navigation operator</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-collection-selection">10.5.17. Collection Selection</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-collection-projection">10.5.18. Collection Projection</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-templating">10.5.19. Expression templating</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-example-classes">10.6. Classes used in the examples</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop">11. Aspect Oriented Programming with Spring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction">11.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction-defn">11.1.1. AOP concepts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction-spring-defn">11.1.2. Spring AOP capabilities and goals</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction-proxies">11.1.3. AOP Proxies</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj">11.2. @AspectJ support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aspectj-support">11.2.1. Enabling @AspectJ Support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-enable-aspectj-java">Enabling @AspectJ Support with Java configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-enable-aspectj-xml">Enabling @AspectJ Support with XML configuration</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-at-aspectj">11.2.2. Declaring an aspect</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pointcuts">11.2.3. Declaring a pointcut</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pointcuts-designators">Supported Pointcut Designators</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pointcuts-combining">Combining pointcut expressions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-common-pointcuts">Sharing common pointcut definitions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pointcuts-examples">Examples</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#writing-good-pointcuts">Writing good pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice">11.2.4. Declaring advice</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice-before">Before advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice-after-returning">After returning advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice-after-throwing">After throwing advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice-after-finally">After (finally) advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-around-advice">Around advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params">Advice parameters</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-ordering">Advice ordering</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introductions">11.2.5. Introductions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-instantiation-models">11.2.6. Aspect instantiation models</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-example">11.2.7. Example</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema">11.3. Schema-based AOP support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-declaring-an-aspect">11.3.1. Declaring an aspect</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-pointcuts">11.3.2. Declaring a pointcut</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice">11.3.3. Declaring advice</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-before">Before advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-after-returning">After returning advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-after-throwing">After throwing advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-after-finally">After (finally) advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-around">Around advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-params">Advice parameters</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ordering">Advice ordering</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-introductions">11.3.4. Introductions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-instatiation-models">11.3.5. Aspect instantiation models</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advisors">11.3.6. Advisors</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-example">11.3.7. Example</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-choosing">11.4. Choosing which AOP declaration style to use</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-spring-or-aspectj">11.4.1. Spring AOP or full AspectJ?</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-or-xml">11.4.2. @AspectJ or XML for Spring AOP?</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-mixing-styles">11.5. Mixing aspect types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-proxying">11.6. Proxying mechanisms</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-understanding-aop-proxies">11.6.1. Understanding AOP proxies</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aspectj-programmatic">11.7. Programmatic creation of @AspectJ Proxies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-using-aspectj">11.8. Using AspectJ with Spring applications</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-atconfigurable">11.8.1. Using AspectJ to dependency inject domain objects with Spring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-configurable-testing">Unit testing @Configurable objects</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-configurable-container">Working with multiple application contexts</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ajlib-other">11.8.2. Other Spring aspects for AspectJ</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-configure">11.8.3. Configuring AspectJ aspects using Spring IoC</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw">11.8.4. Load-time weaving with AspectJ in the Spring Framework</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-first-example">A first example</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-the-aspects">Aspects</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-aop_dot_xml">'META-INF/aop.xml'</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-libraries">Required libraries (JARS)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-spring">Spring configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-environments">Environment-specific configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-resources">11.9. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api">12. Spring AOP APIs</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-introduction">12.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts">12.2. Pointcut API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-concepts">12.2.1. Concepts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcut-ops">12.2.2. Operations on pointcuts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-aspectj">12.2.3. AspectJ expression pointcuts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-impls">12.2.4. Convenience pointcut implementations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-static">Static pointcuts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-dynamic">Dynamic pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-superclasses">12.2.5. Pointcut superclasses</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-custom">12.2.6. Custom pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice">12.3. Advice API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-lifecycle">12.3.1. Advice lifecycles</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-types">12.3.2. Advice types in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-around">Interception around advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-before">Before advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-throws">Throws advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-after-returning">After Returning advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-introduction">Introduction advice</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advisor">12.4. Advisor API in Spring</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb">12.5. Using the ProxyFactoryBean to create AOP proxies</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-1">12.5.1. Basics</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-2">12.5.2. JavaBean properties</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-proxy-types">12.5.3. JDK- and CGLIB-based proxies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-proxying-intf">12.5.4. Proxying interfaces</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-proxying-class">12.5.5. Proxying classes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-global-advisors">12.5.6. Using 'global' advisors</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-concise-proxy">12.6. Concise proxy definitions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-prog">12.7. Creating AOP proxies programmatically with the ProxyFactory</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advised">12.8. Manipulating advised objects</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-autoproxy">12.9. Using the "auto-proxy" facility</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-autoproxy-choices">12.9.1. Autoproxy bean definitions</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-autoproxy">BeanNameAutoProxyCreator</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-autoproxy-default">DefaultAdvisorAutoProxyCreator</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-autoproxy-abstract">AbstractAdvisorAutoProxyCreator</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-autoproxy-metadata">12.9.2. Using metadata-driven auto-proxying</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-targetsource">12.10. Using TargetSources</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ts-swap">12.10.1. Hot swappable target sources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ts-pool">12.10.2. Pooling target sources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ts-prototype">12.10.3. Prototype target sources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ts-threadlocal">12.10.4. ThreadLocal target sources</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-extensibility">12.11. Defining new Advice types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-resources">12.12. Further resources</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing">IV. Testing</a></span></dt><dd><dl><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-introduction">13. Introduction to Spring Testing</a></span></dt><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing">14. Unit Testing</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects">14.1. Mock Objects</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-env">14.1.1. Environment</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-jndi">14.1.2. JNDI</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-servlet">14.1.3. Servlet API</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-portlet">14.1.4. Portlet API</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing-support-classes">14.2. Unit Testing support Classes</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing-utilities">14.2.1. General testing utilities</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing-spring-mvc">14.2.2. Spring MVC</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing">15. Integration Testing</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-overview">15.1. Overview</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-goals">15.2. Goals of Integration Testing</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-ctx-management">15.2.1. Context management and caching</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-fixture-di">15.2.2. Dependency Injection of test fixtures</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-tx">15.2.3. Transaction management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-support-classes">15.2.4. Support classes for integration testing</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-support-jdbc">15.3. JDBC Testing Support</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations">15.4. Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-spring">15.4.1. Spring Testing Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__bootstrapwith">@BootstrapWith</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__contextconfiguration">@ContextConfiguration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__webappconfiguration">@WebAppConfiguration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__contexthierarchy">@ContextHierarchy</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__activeprofiles">@ActiveProfiles</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__testpropertysource">@TestPropertySource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__dirtiescontext">@DirtiesContext</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__testexecutionlisteners">@TestExecutionListeners</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__commit">@Commit</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__rollback">@Rollback</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__beforetransaction">@BeforeTransaction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__aftertransaction">@AfterTransaction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__sql">@Sql</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__sqlconfig">@SqlConfig</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__sqlgroup">@SqlGroup</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-standard">15.4.2. Standard Annotation Support</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-junit">15.4.3. Spring JUnit 4 Testing Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__ifprofilevalue">@IfProfileValue</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__profilevaluesourceconfiguration">@ProfileValueSourceConfiguration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__timed">@Timed</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__repeat">@Repeat</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-meta">15.4.4. Meta-Annotation Support for Testing</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-framework">15.5. Spring TestContext Framework</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-key-abstractions">15.5.1. Key abstractions</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testcontext">TestContext</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testcontextmanager">TestContextManager</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testexecutionlistener">TestExecutionListener</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_context_loaders">Context Loaders</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-bootstrapping">15.5.2. Bootstrapping the TestContext framework</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config">15.5.3. TestExecutionListener configuration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-registering-tels">Registering custom TestExecutionListeners</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-automatic-discovery">Automatic discovery of default TestExecutionListeners</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-ordering">Ordering TestExecutionListeners</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-merging">Merging TestExecutionListeners</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management">15.5.4. Context management</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-xml">Context configuration with XML resources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-groovy">Context configuration with Groovy scripts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-javaconfig">Context configuration with annotated classes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-mixed-config">Mixing XML, Groovy scripts, and annotated classes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-initializers">Context configuration with context initializers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-inheritance">Context configuration inheritance</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-env-profiles">Context configuration with environment profiles</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-property-sources">Context configuration with test property sources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-web">Loading a WebApplicationContext</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-caching">Context caching</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-ctx-hierarchies">Context hierarchies</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-fixture-di">15.5.5. Dependency injection of test fixtures</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-web-scoped-beans">15.5.6. Testing request and session scoped beans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx">15.5.7. Transaction management</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-test-managed-transactions">Test-managed transactions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-enabling-transactions">Enabling and disabling transactions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-rollback-and-commit-behavior">Transaction rollback and commit behavior</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-programmatic-tx-mgt">Programmatic transaction management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-before-and-after-tx">Executing code outside of a transaction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-mgr-config">Configuring a transaction manager</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-annotation-demo">Demonstration of all transaction-related annotations</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql">15.5.8. Executing SQL scripts</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql-programmatically">Executing SQL scripts programmatically</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql-declaratively">Executing SQL scripts declaratively with @Sql</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes">15.5.9. TestContext Framework support classes</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-junit4-runner">Spring JUnit 4 Runner</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-junit4-rules">Spring JUnit 4 Rules</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-junit4">JUnit 4 support classes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-testng">TestNG support classes</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-framework">15.6. Spring MVC Test Framework</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server">15.6.1. Server-Side Tests</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-static-imports">Static Imports</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-setup-options">Setup Options</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-performing-requests">Performing Requests</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-defining-expectations">Defining Expectations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-filters">Filter Registrations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-vs-end-to-end-integration-tests">Differences between Out-of-Container and End-to-End Integration Tests</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-resources">Further Server-Side Test Examples</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit">15.6.2. HtmlUnit Integration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-why">Why HtmlUnit Integration?</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah">MockMvc and HtmlUnit</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver">MockMvc and WebDriver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-geb">MockMvc and Geb</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-client">15.6.3. Client-Side REST Tests</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-client-static-imports">Static Imports</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-client-resources">Further Examples of Client-side REST Tests</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-examples-petclinic">15.7. PetClinic Example</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-resources">16. Further Resources</a></span></dt></dl></dd><dt><span class="part"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-data-tier">V. Data Access</a></span></dt><dd><dl><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction">17. Transaction Management</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-intro">17.1. Introduction to Spring Framework transaction management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-motivation">17.2. Advantages of the Spring Framework’s transaction support model</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-global">17.2.1. Global transactions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-local">17.2.2. Local transactions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-programming-model">17.2.3. Spring Framework’s consistent programming model</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-strategies">17.3. Understanding the Spring Framework transaction abstraction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-resource-synchronization">17.4. Synchronizing resources with transactions</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-resource-synchronization-high">17.4.1. High-level synchronization approach</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-resource-synchronization-low">17.4.2. Low-level synchronization approach</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-resource-synchronization-tadsp">17.4.3. TransactionAwareDataSourceProxy</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative">17.5. Declarative transaction management</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-decl-explained">17.5.1. Understanding the Spring Framework’s declarative transaction implementation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-first-example">17.5.2. Example of declarative transaction implementation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-rolling-back">17.5.3. Rolling back a declarative transaction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-diff-tx">17.5.4. Configuring different transactional semantics for different beans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-txadvice-settings">17.5.5. &lt;tx:advice/&gt; settings</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-annotations">17.5.6. Using @Transactional</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-attransactional-settings">@Transactional settings</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-multiple-tx-mgrs-with-attransactional">Multiple Transaction Managers with @Transactional</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-custom-attributes">Custom shortcut annotations</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation">17.5.7. Transaction propagation</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation-required">Required</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation-requires_new">RequiresNew</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation-nested">Nested</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-applying-more-than-just-tx-advice">17.5.8. Advising transactional operations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-aspectj">17.5.9. Using @Transactional with AspectJ</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-programmatic">17.6. Programmatic transaction management</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-prog-template">17.6.1. Using the TransactionTemplate</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-prog-template-settings">Specifying transaction settings</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-programmatic-ptm">17.6.2. Using the PlatformTransactionManager</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-decl-vs-prog">17.7. Choosing between programmatic and declarative transaction management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-event">17.8. Transaction bound event</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-application-server-integration">17.9. Application server-specific integration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-application-server-integration-websphere">17.9.1. IBM WebSphere</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-application-server-integration-weblogic">17.9.2. Oracle WebLogic Server</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-solutions-to-common-problems">17.10. Solutions to common problems</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-solutions-to-common-problems-wrong-ptm">17.10.1. Use of the wrong transaction manager for a specific DataSource</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-resources">17.11. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dao">18. DAO support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dao-introduction">18.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dao-exceptions">18.2. Consistent exception hierarchy</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dao-annotations">18.3. Annotations used for configuring DAO or Repository classes</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc">19. Data access with JDBC</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-introduction">19.1. Introduction to Spring Framework JDBC</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-choose-style">19.1.1. Choosing an approach for JDBC database access</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-packages">19.1.2. Package hierarchy</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-core">19.2. Using the JDBC core classes to control basic JDBC processing and error handling</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate">19.2.1. JdbcTemplate</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate-examples">Examples of JdbcTemplate class usage</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate-idioms">JdbcTemplate best practices</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-NamedParameterJdbcTemplate">19.2.2. NamedParameterJdbcTemplate</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-SQLExceptionTranslator">19.2.3. SQLExceptionTranslator</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-statements-executing">19.2.4. Executing statements</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-statements-querying">19.2.5. Running queries</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-updates">19.2.6. Updating the database</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-auto-genereted-keys">19.2.7. Retrieving auto-generated keys</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-connections">19.3. Controlling database connections</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-datasource">19.3.1. DataSource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-DataSourceUtils">19.3.2. DataSourceUtils</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-SmartDataSource">19.3.3. SmartDataSource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-AbstractDataSource">19.3.4. AbstractDataSource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-SingleConnectionDataSource">19.3.5. SingleConnectionDataSource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-DriverManagerDataSource">19.3.6. DriverManagerDataSource</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-TransactionAwareDataSourceProxy">19.3.7. TransactionAwareDataSourceProxy</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-DataSourceTransactionManager">19.3.8. DataSourceTransactionManager</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-NativeJdbcExtractor">19.3.9. NativeJdbcExtractor</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-advanced-jdbc">19.4. JDBC batch operations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-batch-classic">19.4.1. Basic batch operations with the JdbcTemplate</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-batch-list">19.4.2. Batch operations with a List of objects</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-batch-multi">19.4.3. Batch operations with multiple batches</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc">19.5. Simplifying JDBC operations with the SimpleJdbc classes</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc-insert-1">19.5.1. Inserting data using SimpleJdbcInsert</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc-insert-2">19.5.2. Retrieving auto-generated keys using SimpleJdbcInsert</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc-insert-3">19.5.3. Specifying columns for a SimpleJdbcInsert</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc-parameters">19.5.4. Using SqlParameterSource to provide parameter values</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc-call-1">19.5.5. Calling a stored procedure with SimpleJdbcCall</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc-call-2">19.5.6. Explicitly declaring parameters to use for a SimpleJdbcCall</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-params">19.5.7. How to define SqlParameters</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc-call-3">19.5.8. Calling a stored function using SimpleJdbcCall</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc-call-4">19.5.9. Returning ResultSet/REF Cursor from a SimpleJdbcCall</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-object">19.6. Modeling JDBC operations as Java objects</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-SqlQuery">19.6.1. SqlQuery</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-MappingSqlQuery">19.6.2. MappingSqlQuery</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-SqlUpdate">19.6.3. SqlUpdate</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-StoredProcedure">19.6.4. StoredProcedure</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-parameter-handling">19.7. Common problems with parameter and data value handling</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-type-information">19.7.1. Providing SQL type information for parameters</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-lob">19.7.2. Handling BLOB and CLOB objects</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-in-clause">19.7.3. Passing in lists of values for IN clause</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-complex-types">19.7.4. Handling complex types for stored procedure calls</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-support">19.8. Embedded database support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-why-embedded-database">19.8.1. Why use an embedded database?</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-xml">19.8.2. Creating an embedded database using Spring XML</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-java">19.8.3. Creating an embedded database programmatically</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-types">19.8.4. Selecting the embedded database type</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-using-HSQL">Using HSQL</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-using-H2">Using H2</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-using-Derby">Using Derby</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-dao-testing">19.8.5. Testing data access logic with an embedded database</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-unique-names">19.8.6. Generating unique names for embedded databases</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-extension">19.8.7. Extending the embedded database support</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-initializing-datasource">19.9. Initializing a DataSource</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-initializing-datasource-xml">19.9.1. Initializing a database using Spring XML</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-client-component-initialization">Initialization of other components that depend on the database</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm">20. Object Relational Mapping (ORM) Data Access</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-introduction">20.1. Introduction to ORM with Spring</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-general">20.2. General ORM integration considerations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-resource-mngmnt">20.2.1. Resource and transaction management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-exception-translation">20.2.2. Exception translation</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate">20.3. Hibernate</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-session-factory-setup">20.3.1. SessionFactory setup in a Spring container</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate-straight">20.3.2. Implementing DAOs based on plain Hibernate API</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate-tx-declarative">20.3.3. Declarative transaction demarcation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate-tx-programmatic">20.3.4. Programmatic transaction demarcation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate-tx-strategies">20.3.5. Transaction management strategies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate-resources">20.3.6. Comparing container-managed and locally defined resources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate-invalid-jdbc-access-error">20.3.7. Spurious application server warnings with Hibernate</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jdo">20.4. JDO</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jdo-setup">20.4.1. PersistenceManagerFactory setup</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jdo-daos-straight">20.4.2. Implementing DAOs based on the plain JDO API</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jdo-tx">20.4.3. Transaction management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jdo-dialect">20.4.4. JdoDialect</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa">20.5. JPA</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa-setup">20.5.1. Three options for JPA setup in a Spring environment</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa-setup-lemfb">LocalEntityManagerFactoryBean</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa-setup-jndi">Obtaining an EntityManagerFactory from JNDI</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa-setup-lcemfb">LocalContainerEntityManagerFactoryBean</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa-multiple">Dealing with multiple persistence units</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa-dao">20.5.2. Implementing DAOs based on JPA: EntityManagerFactory and EntityManager</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa-tx">20.5.3. Spring-driven JPA transactions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa-dialect">20.5.4. JpaDialect and JpaVendorAdapter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa-jta">20.5.5. Setting up JPA with JTA transaction management</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm">21. Marshalling XML using O/X Mappers</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-introduction">21.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_ease_of_configuration">21.1.1. Ease of configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_consistent_interfaces">21.1.2. Consistent Interfaces</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_consistent_exception_hierarchy">21.1.3. Consistent Exception Hierarchy</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-marshaller-unmarshaller">21.2. Marshaller and Unmarshaller</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-marshaller">21.2.1. Marshaller</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-unmarshaller">21.2.2. Unmarshaller</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-xmlmappingexception">21.2.3. XmlMappingException</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-usage">21.3. Using Marshaller and Unmarshaller</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-schema-based-config">21.4. XML Schema-based Configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-jaxb">21.5. JAXB</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-jaxb2">21.5.1. Jaxb2Marshaller</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-jaxb2-xsd">XML Schema-based Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-castor">21.6. Castor</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-castor-marshaller">21.6.1. CastorMarshaller</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-castor-mapping">21.6.2. Mapping</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-castor-xsd">XML Schema-based Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-xmlbeans">21.7. XMLBeans</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-xmlbeans-marshaller">21.7.1. XmlBeansMarshaller</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-xmlbeans-xsd">XML Schema-based Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-jibx">21.8. JiBX</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-jibx-marshaller">21.8.1. JibxMarshaller</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-jibx-xsd">XML Schema-based Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-xstream">21.9. XStream</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm-xstream-marshaller">21.9.1. XStreamMarshaller</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-web">VI. The Web</a></span></dt><dd><dl><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc">22. Web MVC framework</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-introduction">22.1. Introduction to Spring Web MVC framework</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-features">22.1.1. Features of Spring Web MVC</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-introduction-pluggability">22.1.2. Pluggability of other MVC implementations</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-servlet">22.2. The DispatcherServlet</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-servlet-special-bean-types">22.2.1. Special Bean Types In the WebApplicationContext</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-servlet-config">22.2.2. Default DispatcherServlet Configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-servlet-sequence">22.2.3. DispatcherServlet Processing Sequence</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-controller">22.3. Implementing Controllers</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-controller">22.3.1. Defining a controller with @Controller</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping">22.3.2. Mapping Requests With @RequestMapping</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-composed">Composed @RequestMapping Variants</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-proxying">@Controller and AOP Proxying</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-31-vs-30">New Support Classes for @RequestMapping methods in Spring MVC 3.1</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-uri-templates">URI Template Patterns</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-uri-templates-regex">URI Template Patterns with Regular Expressions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-patterns">Path Patterns</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-pattern-comparison">Path Pattern Comparison</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-placeholders">Path Patterns with Placeholders</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-suffix-pattern-match">Suffix Pattern Matching</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-rfd">Suffix Pattern Matching and RFD</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-matrix-variables">Matrix Variables</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-consumes">Consumable Media Types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-produces">Producible Media Types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-params-and-headers">Request Parameters and Header Values</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-head-options">HTTP HEAD and HTTP OPTIONS</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-methods">22.3.3. Defining @RequestMapping handler methods</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-arguments">Supported method argument types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-return-types">Supported method return types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestparam">Binding request parameters to method parameters with @RequestParam</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestbody">Mapping the request body with the @RequestBody annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-responsebody">Mapping the response body with the @ResponseBody annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-restcontroller">Creating REST Controllers with the @RestController annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-httpentity">Using HttpEntity</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-modelattrib-methods">Using @ModelAttribute on a method</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-modelattrib-method-args">Using @ModelAttribute on a method argument</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-sessionattrib">Using @SessionAttributes to store model attributes in the HTTP session between requests</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-sessionattrib-global">Using @SessionAttribute to access pre-existing global session attributes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestattrib">Using @RequestAttribute to access request attributes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-form-urlencoded-data">Working with "application/x-www-form-urlencoded" data</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-cookievalue">Mapping cookie values with the @CookieValue annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestheader">Mapping request header attributes with the @RequestHeader annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-typeconversion">Method Parameters And Type Conversion</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-webdatabinder">Customizing WebDataBinder initialization</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-controller-advice">Advising controllers with @ControllerAdvice and @RestControllerAdvice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-jsonview">Jackson Serialization View Support</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-jsonp">Jackson JSONP Support</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-async">22.3.4. Asynchronous Request Processing</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-async-exceptions">Exception Handling for Async Requests</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-async-interception">Intercepting Async Requests</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-async-http-streaming">HTTP Streaming</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-async-sse">HTTP Streaming With Server-Sent Events</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-async-output-stream">HTTP Streaming Directly To The OutputStream</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-async-configuration">Configuring Asynchronous Request Processing</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-tests">22.3.5. Testing Controllers</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-handlermapping">22.4. Handler mappings</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-handlermapping-interceptor">22.4.1. Intercepting requests with a HandlerInterceptor</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-viewresolver">22.5. Resolving views</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-viewresolver-resolver">22.5.1. Resolving views with the ViewResolver interface</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-viewresolver-chaining">22.5.2. Chaining ViewResolvers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-redirecting">22.5.3. Redirecting to Views</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-redirecting-redirect-view">RedirectView</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-redirecting-redirect-prefix">The redirect: prefix</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-redirecting-forward-prefix">The forward: prefix</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-multiple-representations">22.5.4. ContentNegotiatingViewResolver</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-flash-attributes">22.6. Using flash attributes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-uri-building">22.7. Building URIs</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-links-to-controllers">22.7.1. Building URIs to Controllers and methods</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-links-to-controllers-from-views">22.7.2. Building URIs to Controllers and methods from views</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-localeresolver">22.8. Using locales</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-timezone">22.8.1. Obtaining Time Zone Information</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-localeresolver-acceptheader">22.8.2. AcceptHeaderLocaleResolver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-localeresolver-cookie">22.8.3. CookieLocaleResolver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-localeresolver-session">22.8.4. SessionLocaleResolver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-localeresolver-interceptor">22.8.5. LocaleChangeInterceptor</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-themeresolver">22.9. Using themes</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-themeresolver-introduction">22.9.1. Overview of themes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-themeresolver-defining">22.9.2. Defining themes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-themeresolver-resolving">22.9.3. Theme resolvers</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-multipart">22.10. Spring’s multipart (file upload) support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-multipart-introduction">22.10.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-multipart-resolver-commons">22.10.2. Using a MultipartResolver with <span class="emphasis"><em>Commons FileUpload</em></span></a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-multipart-resolver-standard">22.10.3. Using a MultipartResolver with <span class="emphasis"><em>Servlet 3.0</em></span></a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-multipart-forms">22.10.4. Handling a file upload in a form</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-multipart-forms-non-browsers">22.10.5. Handling a file upload request from programmatic clients</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-exceptionhandlers">22.11. Handling exceptions</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-exceptionhandlers-resolver">22.11.1. HandlerExceptionResolver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-exceptionhandler">22.11.2. @ExceptionHandler</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-rest-spring-mvc-exceptions">22.11.3. Handling Standard Spring MVC Exceptions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-annotated-exceptions">22.11.4. Annotating Business Exceptions With @ResponseStatus</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-customer-servlet-container-error-page">22.11.5. Customizing the Default Servlet Container Error Page</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-web-security">22.12. Web Security</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-coc">22.13. Convention over configuration support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-coc-ccnhm">22.13.1. The Controller ControllerClassNameHandlerMapping</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-coc-modelmap">22.13.2. The Model ModelMap (ModelAndView)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-coc-r2vnt">22.13.3. The View - RequestToViewNameTranslator</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-caching">22.14. HTTP caching support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-caching-cachecontrol">22.14.1. Cache-Control HTTP header</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-caching-static-resources">22.14.2. HTTP caching support for static resources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-caching-etag-lastmodified">22.14.3. Support for the Cache-Control, ETag and Last-Modified response headers in Controllers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-httpcaching-shallowetag">22.14.4. Shallow ETag support</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-container-config">22.15. Code-based Servlet container initialization</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config">22.16. Configuring Spring MVC</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-enable">22.16.1. Enabling the MVC Java Config or the MVC XML Namespace</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-customize">22.16.2. Customizing the Provided Configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-conversion">22.16.3. Conversion and Formatting</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-validation">22.16.4. Validation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-interceptors">22.16.5. Interceptors</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-content-negotiation">22.16.6. Content Negotiation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-view-controller">22.16.7. View Controllers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-view-resolvers">22.16.8. View Resolvers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-static-resources">22.16.9. Serving of Resources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-default-servlet-handler">22.16.10. Falling Back On the "Default" Servlet To Serve Resources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-path-matching">22.16.11. Path Matching</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-message-converters">22.16.12. Message Converters</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-advanced-java">22.16.13. Advanced Customizations with MVC Java Config</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-advanced-xml">22.16.14. Advanced Customizations with the MVC Namespace</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view">23. View technologies</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-introduction">23.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-thymeleaf">23.2. Thymeleaf</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-groovymarkup">23.3. Groovy Markup Templates</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-groovymarkup-configuration">23.3.1. Configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-groovymarkup-example">23.3.2. Example</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-velocity">23.4. Velocity &amp; FreeMarker</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-velocity-dependencies">23.4.1. Dependencies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-velocity-contextconfig">23.4.2. Context configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-velocity-createtemplates">23.4.3. Creating templates</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-velocity-advancedconfig">23.4.4. Advanced configuration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-velocity-example-velocityproperties">velocity.properties</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#views-freemarker">FreeMarker</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-velocity-forms">23.4.5. Bind support and form handling</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-bind-macros">The bind macros</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-simple-binding">Simple binding</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#views-form-macros">Form input generation macros</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#views-form-macros-html-escaping">HTML escaping and XHTML compliance</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp">23.5. JSP &amp; JSTL</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-resolver">23.5.1. View resolvers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-jstl">23.5.2. 'Plain-old' JSPs versus JSTL</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-tags">23.5.3. Additional tags facilitating development</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib">23.5.4. Using Spring’s form tag library</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-configuration">Configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-formtag">The form tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-inputtag">The input tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-checkboxtag">The checkbox tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-checkboxestag">The checkboxes tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-radiobuttontag">The radiobutton tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-radiobuttonstag">The radiobuttons tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-passwordtag">The password tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-selecttag">The select tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-optiontag">The option tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-optionstag">The options tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-textareatag">The textarea tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-hiddeninputtag">The hidden tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-errorstag">The errors tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-method-conversion">HTTP Method Conversion</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-html5">HTML5 Tags</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-script">23.6. Script templates</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-script-dependencies">23.6.1. Dependencies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-script-integrate">23.6.2. How to integrate script based templating</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-xml-marshalling">23.7. XML Marshalling View</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-tiles">23.8. Tiles</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-tiles-dependencies">23.8.1. Dependencies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-tiles-integrate">23.8.2. How to integrate Tiles</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-tiles-url">UrlBasedViewResolver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-tiles-resource">ResourceBundleViewResolver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-tiles-preparer">SimpleSpringPreparerFactory and SpringBeanPreparerFactory</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-xslt">23.9. XSLT</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-xslt-firstwords">23.9.1. My First Words</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-xslt-beandefs">Bean definitions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-xslt-controllercode">Standard MVC controller code</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-xslt-transforming">Document transformation</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-document">23.10. Document views (PDF/Excel)</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-document-intro">23.10.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-document-config">23.10.2. Configuration and setup</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-document-configviews">Document view definitions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-document-configcontroller">Controller code</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-document-configsubclasses">Subclassing for Excel views</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-document-configsubclasspdf">Subclassing for PDF views</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports">23.11. JasperReports</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-dependencies">23.11.1. Dependencies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-configuration">23.11.2. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-configuration-resolver">Configuring the ViewResolver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-configuration-views">Configuring the Views</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-configuration-report-files">About Report Files</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-configuration-multiformat-view">Using JasperReportsMultiFormatView</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-model">23.11.3. Populating the ModelAndView</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-subreports">23.11.4. Working with Sub-Reports</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-subreports-config-reports">Configuring Sub-Report Files</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-subreports-config-datasources">Configuring Sub-Report Data Sources</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-jasper-reports-exporter-parameters">23.11.5. Configuring Exporter Parameters</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-feeds">23.12. Feed Views</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-json-mapping">23.13. JSON Mapping View</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#view-xml-mapping">23.14. XML Mapping View</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#web-integration">24. Integrating with other web frameworks</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#intro">24.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#web-integration-common">24.2. Common configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jsf">24.3. JavaServer Faces 1.2</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jsf-springbeanfaceselresolver">24.3.1. SpringBeanFacesELResolver (JSF 1.2+)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jsf-facescontextutils">24.3.2. FacesContextUtils</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#struts">24.4. Apache Struts 2.x</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tapestry">24.5. Tapestry 5.x</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#web-integration-resources">24.6. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet">25. Portlet MVC Framework</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-introduction">25.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-introduction-controller">25.1.1. Controllers - The C in MVC</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-introduction-view">25.1.2. Views - The V in MVC</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-introduction-scope">25.1.3. Web-scoped beans</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-dispatcher">25.2. The DispatcherPortlet</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-viewservlet">25.3. The ViewRendererServlet</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-controller">25.4. Controllers</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-controller-abstractcontroller">25.4.1. AbstractController and PortletContentGenerator</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-controller-simple">25.4.2. Other simple controllers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-controller-command">25.4.3. Command Controllers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-controller-wrapping">25.4.4. PortletWrappingController</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-handlermapping">25.5. Handler mappings</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-handlermapping-portletmode">25.5.1. PortletModeHandlerMapping</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-handlermapping-parameter">25.5.2. ParameterHandlerMapping</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-handlermapping-portletmodeparameter">25.5.3. PortletModeParameterHandlerMapping</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-handlermapping-interceptor">25.5.4. Adding HandlerInterceptors</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-handlermapping-interceptoradapter">25.5.5. HandlerInterceptorAdapter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-handlermapping-parameterinterceptor">25.5.6. ParameterMappingInterceptor</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-viewresolver">25.6. Views and resolving them</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-multipart">25.7. Multipart (file upload) support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-multipart-resolver">25.7.1. Using the PortletMultipartResolver</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-multipart-forms">25.7.2. Handling a file upload in a form</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-exceptionresolver">25.8. Handling exceptions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-annotation">25.9. Annotation-based controller configuration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-setup">25.9.1. Setting up the dispatcher for annotation support</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-controller">25.9.2. Defining a controller with @Controller</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-requestmapping">25.9.3. Mapping requests with @RequestMapping</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-requestmapping-arguments">25.9.4. Supported handler method arguments</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-requestparam">25.9.5. Binding request parameters to method parameters with @RequestParam</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-modelattrib">25.9.6. Providing a link to data from the model with @ModelAttribute</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-sessionattrib">25.9.7. Specifying attributes to store in a Session with @SessionAttributes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-webdatabinder">25.9.8. Customizing WebDataBinder initialization</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-initbinder">Customizing data binding with @InitBinder</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-ann-webbindinginitializer">Configuring a custom WebBindingInitializer</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet-deployment">25.10. Portlet application deployment</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket">26. WebSocket Support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-intro">26.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-into-fallback-options">26.1.1. WebSocket Fallback Options</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-intro-architecture">26.1.2. A Messaging Architecture</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-intro-sub-protocol">26.1.3. Sub-Protocol Support in WebSocket</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-intro-when-to-use">26.1.4. Should I Use WebSocket?</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-server">26.2. WebSocket API</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-server-handler">26.2.1. Create and Configure a WebSocketHandler</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-server-handshake">26.2.2. Customizing the WebSocket Handshake</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-server-decorators">26.2.3. WebSocketHandler Decoration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-server-deployment">26.2.4. Deployment Considerations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-server-runtime-configuration">26.2.5. Configuring the WebSocket Engine</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-server-allowed-origins">26.2.6. Configuring allowed origins</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-fallback">26.3. SockJS Fallback Options</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-fallback-sockjs-overview">26.3.1. Overview of SockJS</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-fallback-sockjs-enable">26.3.2. Enable SockJS</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-fallback-xhr-vs-iframe">26.3.3. HTTP Streaming in IE 8, 9: Ajax/XHR vs IFrame</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-fallback-sockjs-heartbeat">26.3.4. Heartbeat Messages</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-fallback-sockjs-servlet3-async">26.3.5. Servlet 3 Async Requests</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-fallback-cors">26.3.6. CORS Headers for SockJS</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-fallback-sockjs-client">26.3.7. SockJS Client</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp">26.4. STOMP Over WebSocket Messaging Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-overview">26.4.1. Overview of STOMP</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-enable">26.4.2. Enable STOMP over WebSocket</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-message-flow">26.4.3. Flow of Messages</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-handle-annotations">26.4.4. Annotation Message Handling</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-handle-send">26.4.5. Sending Messages</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-handle-simple-broker">26.4.6. Simple Broker</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-handle-broker-relay">26.4.7. Full-Featured Broker</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-handle-broker-relay-configure">26.4.8. Connections To Full-Featured Broker</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-destination-separator">26.4.9. Using Dot as Separator in @MessageMapping Destinations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-authentication">26.4.10. Authentication</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-authentication-token-based">26.4.11. Token-based Authentication</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-user-destination">26.4.12. User Destinations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-appplication-context-events">26.4.13. Listening To ApplicationContext Events and Intercepting Messages</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-client">26.4.14. STOMP Client</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-websocket-scope">26.4.15. WebSocket Scope</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-configuration-performance">26.4.16. Configuration and Performance</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-stats">26.4.17. Runtime Monitoring</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-testing">26.4.18. Testing Annotated Controller Methods</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cors">27. CORS Support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_introduction">27.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_controller_method_cors_configuration">27.2. Controller method CORS configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_global_cors_configuration">27.3. Global CORS configuration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_javaconfig">27.3.1. JavaConfig</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_xml_namespace">27.3.2. XML namespace</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_advanced_customization">27.4. Advanced Customization</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_filter_based_cors_support">27.5. Filter based CORS support</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-integration">VII. Integration</a></span></dt><dd><dl><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting">28. Remoting and web services using Spring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-introduction">28.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-rmi">28.2. Exposing services using RMI</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-rmi-server">28.2.1. Exporting the service using the RmiServiceExporter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-rmi-client">28.2.2. Linking in the service at the client</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-caucho-protocols">28.3. Using Hessian or Burlap to remotely call services via HTTP</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-caucho-protocols-hessian">28.3.1. Wiring up the DispatcherServlet for Hessian and co.</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-caucho-protocols-hessian-server">28.3.2. Exposing your beans by using the HessianServiceExporter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-caucho-protocols-hessian-client">28.3.3. Linking in the service on the client</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-caucho-protocols-burlap">28.3.4. Using Burlap</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-caucho-protocols-security">28.3.5. Applying HTTP basic authentication to a service exposed through Hessian or Burlap</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-httpinvoker">28.4. Exposing services using HTTP invokers</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-httpinvoker-server">28.4.1. Exposing the service object</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-httpinvoker-client">28.4.2. Linking in the service at the client</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-web-services">28.5. Web services</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-web-services-jaxws-export-servlet">28.5.1. Exposing servlet-based web services using JAX-WS</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-web-services-jaxws-export-standalone">28.5.2. Exporting standalone web services using JAX-WS</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-web-services-jaxws-export-ri">28.5.3. Exporting web services using the JAX-WS RI’s Spring support</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-web-services-jaxws-access">28.5.4. Accessing web services using JAX-WS</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-jms">28.6. JMS</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-jms-server">28.6.1. Server-side configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-jms-client">28.6.2. Client-side configuration</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-amqp">28.7. AMQP</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-autodection-remote-interfaces">28.8. Auto-detection is not implemented for remote interfaces</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#remoting-considerations">28.9. Considerations when choosing a technology</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-client-access">28.10. Accessing RESTful services on the Client</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-resttemplate">28.10.1. RestTemplate</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-resttemplate-uri">Working with the URI</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-template-headers">Dealing with request and response headers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-template-jsonview">Jackson JSON Views support</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-message-conversion">28.10.2. HTTP Message Conversion</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-string-converter">StringHttpMessageConverter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-form-converter">FormHttpMessageConverter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-byte-converter">ByteArrayHttpMessageConverter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-marhsalling-converter">MarshallingHttpMessageConverter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-mapping-json-converter">MappingJackson2HttpMessageConverter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-mapping-xml-converter">MappingJackson2XmlHttpMessageConverter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-source-converter">SourceHttpMessageConverter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-buffered-image-converter">BufferedImageHttpMessageConverter</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-async-resttemplate">28.10.3. Async RestTemplate</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb">29. Enterprise JavaBeans (EJB) integration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb-introduction">29.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb-access">29.2. Accessing EJBs</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb-access-concepts">29.2.1. Concepts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb-access-local">29.2.2. Accessing local SLSBs</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb-access-remote">29.2.3. Accessing remote SLSBs</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb-access-ejb2-ejb3">29.2.4. Accessing EJB 2.x SLSBs versus EJB 3 SLSBs</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb-implementation">29.3. Using Spring’s EJB implementation support classes</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb-implementation-ejb3">29.3.1. EJB 3 injection interceptor</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms">30. JMS (Java Message Service)</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-introduction">30.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-using">30.2. Using Spring JMS</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-jmstemplate">30.2.1. JmsTemplate</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-connections">30.2.2. Connections</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-caching-resources">Caching Messaging Resources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-connection-factory">SingleConnectionFactory</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-connection-factory-caching">CachingConnectionFactory</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-destinations">30.2.3. Destination Management</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-mdp">30.2.4. Message Listener Containers</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-mdp-simple">SimpleMessageListenerContainer</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-mdp-default">DefaultMessageListenerContainer</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-tx">30.2.5. Transaction management</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-sending">30.3. Sending a Message</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-msg-conversion">30.3.1. Using Message Converters</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-callbacks">30.3.2. SessionCallback and ProducerCallback</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-receiving">30.4. Receiving a message</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-receiving-sync">30.4.1. Synchronous Reception</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-asynchronousMessageReception">30.4.2. Asynchronous Reception - Message-Driven POJOs</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-receiving-async-session-aware-message-listener">30.4.3. the SessionAwareMessageListener interface</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-receiving-async-message-listener-adapter">30.4.4. the MessageListenerAdapter</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-tx-participation">30.4.5. Processing messages within transactions</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-jca-message-endpoint-manager">30.5. Support for JCA Message Endpoints</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-annotated">30.6. Annotation-driven listener endpoints</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-annotated-support">30.6.1. Enable listener endpoint annotations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-annotated-programmatic-registration">30.6.2. Programmatic endpoints registration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-annotated-method-signature">30.6.3. Annotated endpoint method signature</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-annotated-response">30.6.4. Response management</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-namespace">30.7. JMS namespace support</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx">31. JMX</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-introduction">31.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-exporting">31.2. Exporting your beans to JMX</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-exporting-mbeanserver">31.2.1. Creating an MBeanServer</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-mbean-server">31.2.2. Reusing an existing MBeanServer</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-exporting-lazy">31.2.3. Lazy-initialized MBeans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-exporting-auto">31.2.4. Automatic registration of MBeans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-exporting-registration-behavior">31.2.5. Controlling the registration behavior</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-interface">31.3. Controlling the management interface of your beans</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-interface-assembler">31.3.1. the MBeanInfoAssembler Interface</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-interface-metadata">31.3.2. Using Source-Level Metadata (Java annotations)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-interface-metadata-types">31.3.3. Source-Level Metadata Types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-interface-autodetect">31.3.4. the AutodetectCapableMBeanInfoAssembler interface</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-interface-java">31.3.5. Defining management interfaces using Java interfaces</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-interface-methodnames">31.3.6. Using MethodNameBasedMBeanInfoAssembler</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-naming">31.4. Controlling the ObjectNames for your beans</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-naming-properties">31.4.1. Reading ObjectNames from Properties</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-naming-metadata">31.4.2. Using the MetadataNamingStrategy</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-context-mbeanexport">31.4.3. Configuring annotation based MBean export</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-jsr160">31.5. JSR-160 Connectors</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-jsr160-server">31.5.1. Server-side Connectors</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-jsr160-client">31.5.2. Client-side Connectors</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-jsr160-protocols">31.5.3. JMX over Burlap/Hessian/SOAP</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-proxy">31.6. Accessing MBeans via Proxies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-notifications">31.7. Notifications</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-notifications-listeners">31.7.1. Registering Listeners for Notifications</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-notifications-publishing">31.7.2. Publishing Notifications</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-resources">31.8. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci">32. JCA CCI</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-introduction">32.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-config">32.2. Configuring CCI</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-config-connector">32.2.1. Connector configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-config-connectionfactory">32.2.2. ConnectionFactory configuration in Spring</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-config-cci-connections">32.2.3. Configuring CCI connections</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-config-single-connection">32.2.4. Using a single CCI connection</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-using">32.3. Using Spring’s CCI access support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-record-creator">32.3.1. Record conversion</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-using-template">32.3.2. the CciTemplate</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-using-dao">32.3.3. DAO support</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#automatic-output-generation">32.3.4. Automatic output record generation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#template-summary">32.3.5. Summary</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-straight">32.3.6. Using a CCI Connection and Interaction directly</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-template-example">32.3.7. Example for CciTemplate usage</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-object">32.4. Modeling CCI access as operation objects</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-object-mapping-record">32.4.1. MappingRecordOperation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-object-mapping-comm-area">32.4.2. MappingCommAreaOperation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-automatic-record-gen">32.4.3. Automatic output record generation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-object-summary">32.4.4. Summary</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-objects-mappring-record-example">32.4.5. Example for MappingRecordOperation usage</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-objects-mapping-comm-area-example">32.4.6. Example for MappingCommAreaOperation usage</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci-tx">32.5. Transactions</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail">33. Email</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-introduction">33.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-usage">33.2. Usage</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-usage-simple">33.2.1. Basic MailSender and SimpleMailMessage usage</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-usage-mime">33.2.2. Using the JavaMailSender and the MimeMessagePreparator</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-javamail-mime">33.3. Using the JavaMail MimeMessageHelper</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-javamail-mime-attachments">33.3.1. Sending attachments and inline resources</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-javamail-mime-attachments-attachment">Attachments</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-javamail-mime-attachments-inline">Inline resources</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-templates">33.3.2. Creating email content using a templating library</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mail-templates-example">A Velocity-based example</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling">34. Task Execution and Scheduling</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-introduction">34.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-task-executor">34.2. The Spring TaskExecutor abstraction</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-task-executor-types">34.2.1. TaskExecutor types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-task-executor-usage">34.2.2. Using a TaskExecutor</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-task-scheduler">34.3. The Spring TaskScheduler abstraction</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-trigger-interface">34.3.1. the Trigger interface</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-trigger-implementations">34.3.2. Trigger implementations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-task-scheduler-implementations">34.3.3. TaskScheduler implementations</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-annotation-support">34.4. Annotation Support for Scheduling and Asynchronous Execution</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-enable-annotation-support">34.4.1. Enable scheduling annotations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-annotation-support-scheduled">34.4.2. The @Scheduled annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-annotation-support-async">34.4.3. The @Async annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-annotation-support-qualification">34.4.4. Executor qualification with @Async</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-annotation-support-exception">34.4.5. Exception management with @Async</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-task-namespace">34.5. The task namespace</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-task-namespace-scheduler">34.5.1. The 'scheduler' element</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-task-namespace-executor">34.5.2. The 'executor' element</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-task-namespace-scheduled-tasks">34.5.3. The 'scheduled-tasks' element</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-quartz">34.6. Using the Quartz Scheduler</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-quartz-jobdetail">34.6.1. Using the JobDetailFactoryBean</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-quartz-method-invoking-job">34.6.2. Using the MethodInvokingJobDetailFactoryBean</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-quartz-cron">34.6.3. Wiring up jobs using triggers and the SchedulerFactoryBean</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language">35. Dynamic language support</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-introduction">35.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-a-first-example">35.2. A first example</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-beans">35.3. Defining beans that are backed by dynamic languages</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-beans-concepts">35.3.1. Common concepts</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-beans-concepts-xml-language-element">The &lt;lang:language/&gt; element</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-refreshable-beans">Refreshable beans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-beans-inline">Inline dynamic language source files</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-beans-ctor-injection">Understanding Constructor Injection in the context of dynamic-language-backed beans</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-beans-jruby">35.3.2. JRuby beans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-beans-groovy">35.3.3. Groovy beans</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-beans-groovy-customizer">Customizing Groovy objects via a callback</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-beans-bsh">35.3.4. BeanShell beans</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-scenarios">35.4. Scenarios</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-scenarios-controllers">35.4.1. Scripted Spring MVC Controllers</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-scenarios-validators">35.4.2. Scripted Validators</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-final-notes">35.5. Bits and bobs</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-final-notes-aop">35.5.1. AOP - advising scripted beans</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-final-notes-scopes">35.5.2. Scoping</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language-resources">35.6. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache">36. Cache Abstraction</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-introduction">36.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-strategies">36.2. Understanding the cache abstraction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations">36.3. Declarative annotation-based caching</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-cacheable">36.3.1. @Cacheable annotation</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-cacheable-default-key">Default Key Generation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-cacheable-key">Custom Key Generation Declaration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-cacheable-default-cache-resolver">Default Cache Resolution</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-cacheable-cache-resolver">Custom cache resolution</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-cacheable-synchronized">Synchronized caching</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-cacheable-condition">Conditional caching</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-spel-context">Available caching SpEL evaluation context</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-put">36.3.2. @CachePut annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-evict">36.3.3. @CacheEvict annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-caching">36.3.4. @Caching annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-config">36.3.5. @CacheConfig annotation</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotation-enable">36.3.6. Enable caching annotations</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotation-stereotype">36.3.7. Using custom annotations</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-jsr-107">36.4. JCache (JSR-107) annotations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-jsr-107-summary">36.4.1. Features summary</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_enabling_jsr_107_support">36.4.2. Enabling JSR-107 support</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-declarative-xml">36.5. Declarative XML-based caching</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-store-configuration">36.6. Configuring the cache storage</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-store-configuration-jdk">36.6.1. JDK ConcurrentMap-based Cache</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-store-configuration-ehcache">36.6.2. Ehcache-based Cache</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-store-configuration-caffeine">36.6.3. Caffeine Cache</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-store-configuration-guava">36.6.4. Guava Cache</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-store-configuration-gemfire">36.6.5. GemFire-based Cache</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-store-configuration-jsr107">36.6.6. JSR-107 Cache</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-store-configuration-noop">36.6.7. Dealing with caches without a backing store</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-plug">36.7. Plugging-in different back-end caches</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-specific-config">36.8. How can I set the TTL/TTI/Eviction policy/XXX feature?</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-appendices">VIII. Appendices</a></span></dt><dd><dl><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#migration-4.x">37. Migrating to Spring Framework 4.x</a></span></dt><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#annotation-programming-model">38. Spring Annotation Programming Model</a></span></dt><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-spring">39. Classic Spring Usage</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-spring-orm">39.1. Classic ORM usage</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-spring-hibernate">39.1.1. Hibernate</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate-template">The HibernateTemplate</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate-daos">Implementing Spring-based DAOs without callbacks</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-spring-jms">39.2. JMS Usage</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-spring-jms-template">39.2.1. JmsTemplate</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-spring-aysnc-messages">39.2.2. Asynchronous Message Reception</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-spring-jms-connections">39.2.3. Connections</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-spring-jms-tx-management">39.2.4. Transaction Management</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-spring">40. Classic Spring AOP Usage</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-pointcuts">40.1. Pointcut API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-concepts">40.1.1. Concepts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-pointcut-ops">40.1.2. Operations on pointcuts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-pointcuts-aspectj">40.1.3. AspectJ expression pointcuts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-pointcuts-impls">40.1.4. Convenience pointcut implementations</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-pointcuts-static">Static pointcuts</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-pointcuts-dynamic">Dynamic pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-pointcuts-superclasses">40.1.5. Pointcut superclasses</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-pointcuts-custom">40.1.6. Custom pointcuts</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advice">40.2. Advice API in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advice-lifecycle">40.2.1. Advice lifecycles</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advice-types">40.2.2. Advice types in Spring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advice-around">Interception around advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advice-before">Before advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advice-throws">Throws advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advice-after-returning">After Returning advice</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advice-introduction">Introduction advice</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advisor">40.3. Advisor API in Spring</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-pfb">40.4. Using the ProxyFactoryBean to create AOP proxies</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-pfb-1">40.4.1. Basics</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-pfb-2">40.4.2. JavaBean properties</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-pfb-proxy-types">40.4.3. JDK- and CGLIB-based proxies</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-proxying-intf">40.4.4. Proxying interfaces</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-proxying-class">40.4.5. Proxying classes</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-global-advisors">40.4.6. Using 'global' advisors</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-concise-proxy">40.5. Concise proxy definitions</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-prog">40.6. Creating AOP proxies programmatically with the ProxyFactory</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-advised">40.7. Manipulating advised objects</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-autoproxy">40.8. Using the "autoproxy" facility</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-autoproxy-choices">40.8.1. Autoproxy bean definitions</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-autoproxy">BeanNameAutoProxyCreator</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-autoproxy-default">DefaultAdvisorAutoProxyCreator</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-autoproxy-abstract">AbstractAdvisorAutoProxyCreator</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-autoproxy-metadata">40.8.2. Using metadata-driven auto-proxying</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-targetsource">40.9. Using TargetSources</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-ts-swap">40.9.1. Hot swappable target sources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-ts-pool">40.9.2. Pooling target sources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-ts-prototype">40.9.3. Prototype target sources</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-ts-threadlocal">40.9.4. ThreadLocal target sources</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-extensibility">40.10. Defining new Advice types</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#classic-aop-api-resources">40.11. Further resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-configuration">41. XML Schema-based configuration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-introduction">41.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body">41.2. XML Schema-based configuration</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-referencing">41.2.1. Referencing the schemas</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-util">41.2.2. the util schema</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-util-constant">&lt;util:constant/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-util-property-path">&lt;util:property-path/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-util-properties">&lt;util:properties/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-util-list">&lt;util:list/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-util-map">&lt;util:map/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-util-set">&lt;util:set/&gt;</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jee">41.2.3. the jee schema</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jee-jndi-lookup">&lt;jee:jndi-lookup/&gt; (simple)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jee-jndi-lookup-environment-single">&lt;jee:jndi-lookup/&gt; (with single JNDI environment setting)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jee-jndi-lookup-evironment-multiple">&lt;jee:jndi-lookup/&gt; (with multiple JNDI environment settings)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jee-jndi-lookup-complex">&lt;jee:jndi-lookup/&gt; (complex)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jee-local-slsb">&lt;jee:local-slsb/&gt; (simple)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jee-local-slsb-complex">&lt;jee:local-slsb/&gt; (complex)</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jee-remote-slsb">&lt;jee:remote-slsb/&gt;</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-lang">41.2.4. the lang schema</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jms">41.2.5. the jms schema</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-tx">41.2.6. the tx (transaction) schema</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-aop">41.2.7. the aop schema</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-context">41.2.8. the context schema</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-context-pphc">&lt;property-placeholder/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-context-ac">&lt;annotation-config/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-context-component-scan">&lt;component-scan/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-context-ltw">&lt;load-time-weaver/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-context-sc">&lt;spring-configured/&gt;</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-context-mbe">&lt;mbean-export/&gt;</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-tool">41.2.9. the tool schema</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jdbc">41.2.10. the jdbc schema</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-cache">41.2.11. the cache schema</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-beans">41.2.12. the beans schema</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xml-custom">42. Extensible XML authoring</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-introduction">42.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-schema">42.2. Authoring the schema</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-namespacehandler">42.3. Coding a NamespaceHandler</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-parser">42.4. BeanDefinitionParser</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-registration">42.5. Registering the handler and the schema</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-registration-spring-handlers">42.5.1. 'META-INF/spring.handlers'</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-registration-spring-schemas">42.5.2. 'META-INF/spring.schemas'</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-using">42.6. Using a custom extension in your Spring XML configuration</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-meat">42.7. Meatier examples</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-custom-nested">42.7.1. Nesting custom tags within custom tags</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-custom-just-attributes">42.7.2. Custom attributes on 'normal' elements</a></span></dt></dl></dd><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#extensible-xml-resources">42.8. Further Resources</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-tld">43. spring JSP Tag Library</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld-intro">43.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.argument">43.2. The argument tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.bind">43.3. The bind tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.escapeBody">43.4. The escapeBody tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.eval">43.5. The eval tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.hasBindErrors">43.6. The hasBindErrors tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.htmlEscape">43.7. The htmlEscape tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.message">43.8. The message tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.nestedPath">43.9. The nestedPath tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.param">43.10. The param tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.theme">43.11. The theme tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.transform">43.12. The transform tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring.tld.url">43.13. The url tag</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form-tld">44. spring-form JSP Tag Library</a></span></dt><dd><dl><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld-intro">44.1. Introduction</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.button">44.2. The button tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.checkbox">44.3. The checkbox tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.checkboxes">44.4. The checkboxes tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.errors">44.5. The errors tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.form">44.6. The form tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.hidden">44.7. The hidden tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.input">44.8. The input tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.label">44.9. The label tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.option">44.10. The option tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.options">44.11. The options tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.password">44.12. The password tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.radiobutton">44.13. The radiobutton tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.radiobuttons">44.14. The radiobuttons tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.select">44.15. The select tag</a></span></dt><dt><span class="section"><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-form.tld.textarea">44.16. The textarea tag</a></span></dt></dl></dd></dl></dd></dl></div>
<div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="spring-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-introduction"></a>Part&nbsp;I.&nbsp;Overview of Spring Framework</h1></div></div></div>
<div class="partintro"><div></div>
<p>The Spring Framework is a lightweight solution and a potential one-stop-shop for
building your enterprise-ready applications. However, Spring is modular, allowing you to
use only those parts that you need, without having to bring in the rest. You can use the
IoC container, with any web framework on top, but you can also use only the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate" title="20.3 Hibernate">Hibernate integration code</a> or the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-introduction" title="19.1 Introduction to Spring Framework JDBC">JDBC abstraction
layer</a>. The Spring Framework supports declarative transaction management, remote access
to your logic through RMI or web services, and various options for persisting your data.
It offers a full-featured <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-introduction" title="22.1 Introduction to Spring Web MVC framework">MVC framework</a>, and enables you to
integrate <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction" title="11.1 Introduction">AOP</a> transparently into your software.</p>
<p>Spring is designed to be non-intrusive, meaning that your domain logic code generally
has no dependencies on the framework itself. In your integration layer (such as the data
access layer), some dependencies on the data access technology and the Spring libraries
will exist. However, it should be easy to isolate these dependencies from the rest of
your code base.</p>
<p>This document is a reference guide to Spring Framework features. If you have any
requests, comments, or questions on this document, please post them on the
<a class="ulink" href="https://groups.google.com/forum/#!forum/spring-framework-contrib" target="_top">user mailing
list</a>. Questions on the Framework itself should be asked on StackOverflow
(see <a class="ulink" href="https://spring.io/questions" target="_top">https://spring.io/questions</a>).</p>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview-getting-started-with-spring" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-getting-started-with-spring"></a>1.&nbsp;Getting Started with Spring</h2></div></div></div>
<p>This reference guide provides detailed information about the Spring Framework.
It provides comprehensive documentation for all features, as well as some background
about the underlying concepts (such as <span class="emphasis"><em>"Dependency Injection"</em></span>) that Spring has
embraced.</p>
<p>If you are just getting started with Spring, you may want to begin using the Spring Framework
by creating a <a class="ulink" href="http://projects.spring.io/spring-boot/" target="_top">Spring Boot</a> based application.
Spring Boot provides a quick (and opinionated) way to create a production-ready Spring based
application. It is based on the Spring Framework, favors convention over configuration, and is
designed to get you up and running as quickly as possible.</p>
<p>You can use <a class="ulink" href="http://start.spring.io/" target="_top">start.spring.io</a> to generate a basic project or follow
one of the <a class="ulink" href="https://spring.io/guides" target="_top">"Getting Started" guides</a> like the
<a class="ulink" href="https://spring.io/guides/gs/rest-service/" target="_top">Getting Started Building a RESTful Web Service</a>
one. As well as being easier to digest, these guides are very <span class="emphasis"><em>task focused</em></span>, and most of
them are based on Spring Boot. They also cover other projects from the Spring portfolio
that you might want to consider when solving a particular problem.</p>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="overview" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview"></a>2.&nbsp;Introduction to the Spring Framework</h2></div></div></div>
<p>The Spring Framework is a Java platform that provides comprehensive infrastructure support
for developing Java applications. Spring handles the infrastructure so you can focus on
your application.</p>
<p>Spring enables you to build applications from "plain old Java objects" (POJOs) and to
apply enterprise services non-invasively to POJOs. This capability applies to the Java
SE programming model and to full and partial Java EE.</p>
<p>Examples of how you, as an application developer, can benefit from the Spring platform:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Make a Java method execute in a database transaction without having to deal with
transaction APIs.
</li><li class="listitem">
Make a local Java method an HTTP endpoint without having to deal with the Servlet API.
</li><li class="listitem">
Make a local Java method a message handler without having to deal with the JMS API.
</li><li class="listitem">
Make a local Java method a management operation without having to deal with the JMX API.
</li></ul></div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="overview-dependency-injection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-dependency-injection"></a>2.1&nbsp;Dependency Injection and Inversion of Control</h2></div></div></div>
<p>A Java application&#8201;—&#8201;a loose term that runs the gamut from constrained, embedded
applications to n-tier, server-side enterprise applications&#8201;—&#8201;typically consists of
objects that collaborate to form the application proper. Thus the objects in an
application have <span class="emphasis"><em>dependencies</em></span> on each other.</p>
<p>Although the Java platform provides a wealth of application development functionality,
it lacks the means to organize the basic building blocks into a coherent whole, leaving
that task to architects and developers. Although you can use design patterns such
as <span class="emphasis"><em>Factory</em></span>, <span class="emphasis"><em>Abstract Factory</em></span>, <span class="emphasis"><em>Builder</em></span>, <span class="emphasis"><em>Decorator</em></span>, and <span class="emphasis"><em>Service Locator</em></span>
to compose the various classes and object instances that make up an application,
these patterns are simply that: best practices given a name, with a description
of what the pattern does, where to apply it, the problems it addresses, and so forth.
Patterns are formalized best practices that <span class="emphasis"><em>you must implement yourself</em></span> in your
application.</p>
<p>The Spring Framework <span class="emphasis"><em>Inversion of Control</em></span> (IoC) component addresses this concern by
providing a formalized means of composing disparate components into a fully working
application ready for use. The Spring Framework codifies formalized design patterns as
first-class objects that you can integrate into your own application(s). Numerous
organizations and institutions use the Spring Framework in this manner to engineer
robust, <span class="emphasis"><em>maintainable</em></span> applications.</p>
<div class="sidebar"><a name="background-ioc" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#background-ioc"></a><div class="titlepage"><div><div><p class="title"><b>Background</b></p></div></div></div>
<p>"<span class="emphasis"><em>The question is, what aspect of control are [they] inverting?</em></span>" Martin Fowler posed
this question about Inversion of Control (IoC)
<a class="ulink" href="http://martinfowler.com/articles/injection.html" target="_top">on his site</a> in 2004. Fowler suggested
renaming the principle to make it more self-explanatory and came up with <span class="emphasis"><em>Dependency
Injection</em></span>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="overview-modules" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-modules"></a>2.2&nbsp;Framework Modules</h2></div></div></div>
<p>The Spring Framework consists of features organized into about 20 modules. These modules
are grouped into Core Container, Data Access/Integration, Web, AOP (Aspect Oriented
Programming), Instrumentation, Messaging, and Test, as shown in the following diagram.</p>
<div class="figure"><a name="d5e200" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e200"></a><p class="title"><b>Figure&nbsp;2.1.&nbsp;Overview of the Spring Framework</b></p><div class="figure-contents">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/spring-overview.png.pagespeed.ce.XVe1noRCMt.png" alt="spring overview"></div>
</div></div><br class="figure-break">
<p>The following sections list the available modules for each feature along with their
artifact names and the topics they cover. Artifact names correlate to <span class="emphasis"><em>artifact IDs</em></span> used
in <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dependency-management" title="2.3.1 Dependency Management and Naming Conventions">Dependency Management tools</a>.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overview-core-container" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-core-container"></a>2.2.1&nbsp;Core Container</h3></div></div></div>
<p>The <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-introduction" title="7.1 Introduction to the Spring IoC container and beans"><span class="emphasis"><em>Core Container</em></span></a> consists of the <code class="literal">spring-core</code>,
<code class="literal">spring-beans</code>, <code class="literal">spring-context</code>, <code class="literal">spring-context-support</code>, and <code class="literal">spring-expression</code>
(Spring Expression Language) modules.</p>
<p>The <code class="literal">spring-core</code> and <code class="literal">spring-beans</code> modules <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-introduction" title="7.1 Introduction to the Spring IoC container and beans">provide the fundamental
parts of the framework</a>, including the IoC and Dependency Injection features. The
<code class="literal">BeanFactory</code> is a sophisticated implementation of the factory pattern. It removes the
need for programmatic singletons and allows you to decouple the configuration and
specification of dependencies from your actual program logic.</p>
<p>The <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-introduction" title="7.15 Additional Capabilities of the ApplicationContext"><span class="emphasis"><em>Context</em></span></a> (<code class="literal">spring-context</code>) module builds on the solid
base provided by the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-introduction" title="7.1 Introduction to the Spring IoC container and beans"><span class="emphasis"><em>Core and Beans</em></span></a> modules: it is a means to
access objects in a framework-style manner that is similar to a JNDI registry. The
Context module inherits its features from the Beans module and adds support for
internationalization (using, for example, resource bundles), event propagation, resource
loading, and the transparent creation of contexts by, for example, a Servlet container.
The Context module also supports Java EE features such as EJB, JMX, and basic remoting.
The <code class="literal">ApplicationContext</code> interface is the focal point of the Context module.
<code class="literal">spring-context-support</code> provides support for integrating common third-party libraries
into a Spring application context for caching (EhCache, Guava, JCache), mailing
(JavaMail), scheduling (CommonJ, Quartz) and template engines (FreeMarker, JasperReports,
Velocity).</p>
<p>The <code class="literal">spring-expression</code> module provides a powerful <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions" title="10. Spring Expression Language (SpEL)"><span class="emphasis"><em>Expression
Language</em></span></a> for querying and manipulating an object graph at runtime. It is an extension
of the unified expression language (unified EL) as specified in the JSP 2.1
specification. The language supports setting and getting property values, property
assignment, method invocation, accessing the content of arrays, collections and indexers,
logical and arithmetic operators, named variables, and retrieval of objects by name from
Spring’s IoC container. It also supports list projection and selection as well as common
list aggregations.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overview-aop-instrumentation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-aop-instrumentation"></a>2.2.2&nbsp;AOP and Instrumentation</h3></div></div></div>
<p>The <code class="literal">spring-aop</code> module provides an <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction" title="11.1 Introduction"><span class="emphasis"><em>AOP</em></span></a> Alliance-compliant
aspect-oriented programming implementation allowing you to define, for example,
method interceptors and pointcuts to cleanly decouple code that implements functionality
that should be separated. Using source-level metadata functionality, you can also
incorporate behavioral information into your code, in a manner similar to that of .NET
attributes.</p>
<p>The separate <code class="literal">spring-aspects</code> module provides integration with AspectJ.</p>
<p>The <code class="literal">spring-instrument</code> module provides class instrumentation support and classloader
implementations to be used in certain application servers. The <code class="literal">spring-instrument-tomcat</code>
module contains Spring’s instrumentation agent for Tomcat.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overview-messaging" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-messaging"></a>2.2.3&nbsp;Messaging</h3></div></div></div>
<p>Spring Framework 4 includes a <code class="literal">spring-messaging</code> module with key abstractions from the
<span class="emphasis"><em>Spring Integration</em></span> project such as <code class="literal">Message</code>, <code class="literal">MessageChannel</code>, <code class="literal">MessageHandler</code>, and
others to serve as a foundation for messaging-based applications. The module also
includes a set of annotations for mapping messages to methods, similar to the Spring MVC
annotation based programming model.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overview-data-access" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-data-access"></a>2.2.4&nbsp;Data Access/Integration</h3></div></div></div>
<p>The <span class="emphasis"><em>Data Access/Integration</em></span> layer consists of the JDBC, ORM, OXM, JMS, and
Transaction modules.</p>
<p>The <code class="literal">spring-jdbc</code> module provides a <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-introduction" title="19.1 Introduction to Spring Framework JDBC">JDBC</a>-abstraction layer that
removes the need to do tedious JDBC coding and parsing of database-vendor specific error
codes.</p>
<p>The <code class="literal">spring-tx</code> module supports <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction" title="17. Transaction Management">programmatic and declarative transaction</a>
management for classes that implement special interfaces and for <span class="emphasis"><em>all your POJOs (Plain
Old Java Objects)</em></span>.</p>
<p>The <code class="literal">spring-orm</code> module provides integration layers for popular
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-introduction" title="20.1 Introduction to ORM with Spring">object-relational mapping</a> APIs, including <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa" title="20.5 JPA">JPA</a>,
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jdo" title="20.4 JDO">JDO</a>, and <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-hibernate" title="20.3 Hibernate">Hibernate</a>. Using the <code class="literal">spring-orm</code> module you can
use all of these O/R-mapping frameworks in combination with all of the other features
Spring offers, such as the simple declarative transaction management feature mentioned
previously.</p>
<p>The <code class="literal">spring-oxm</code> module provides an abstraction layer that supports <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm" title="21. Marshalling XML using O/X Mappers">Object/XML
mapping</a> implementations such as JAXB, Castor, XMLBeans, JiBX and XStream.</p>
<p>The <code class="literal">spring-jms</code> module (<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms" title="30. JMS (Java Message Service)">Java Messaging Service</a>) contains features for producing and
consuming messages. Since Spring Framework 4.1, it provides integration with the
<code class="literal">spring-messaging</code> module.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overview-web" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-web"></a>2.2.5&nbsp;Web</h3></div></div></div>
<p>The <span class="emphasis"><em>Web</em></span> layer consists of the <code class="literal">spring-web</code>, <code class="literal">spring-webmvc</code>, <code class="literal">spring-websocket</code>, and
<code class="literal">spring-webmvc-portlet</code> modules.</p>
<p>The <code class="literal">spring-web</code> module provides basic web-oriented integration features such as
multipart file upload functionality and the initialization of the IoC container using
Servlet listeners and a web-oriented application context. It also contains an HTTP client
and the web-related parts of Spring’s remoting support.</p>
<p>The <code class="literal">spring-webmvc</code> module (also known as the <span class="emphasis"><em>Web-Servlet</em></span> module) contains Spring’s
model-view-controller (<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-introduction" title="22.1 Introduction to Spring Web MVC framework"><span class="emphasis"><em>MVC</em></span></a>) and REST Web Services implementation
for web applications. Spring’s MVC framework provides a clean separation between domain
model code and web forms and integrates with all of the other features of the Spring
Framework.</p>
<p>The <code class="literal">spring-webmvc-portlet</code> module (also known as the <span class="emphasis"><em>Web-Portlet</em></span> module) provides
the MVC implementation to be used in a Portlet environment and mirrors the functionality
of the Servlet-based <code class="literal">spring-webmvc</code> module.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overview-testing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-testing"></a>2.2.6&nbsp;Test</h3></div></div></div>
<p>The <code class="literal">spring-test</code> module supports the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing" title="14. Unit Testing">unit testing</a> and
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing" title="15. Integration Testing">integration testing</a> of Spring components with JUnit or TestNG. It
provides consistent <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management" title="15.5.4 Context management">loading</a> of Spring
<code class="literal">ApplicationContext</code>s and <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-caching" title="Context caching">caching</a> of those
contexts. It also provides <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects" title="14.1 Mock Objects">mock objects</a> that you can use to test your
code in isolation.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="overview-usagescenarios" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-usagescenarios"></a>2.3&nbsp;Usage scenarios</h2></div></div></div>
<p>The building blocks described previously make Spring a logical choice in many scenarios,
from embedded applications that run on resource-constrained devices to full-fledged
enterprise applications that use Spring’s transaction management functionality and web
framework integration.</p>
<div class="figure"><a name="d5e313" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e313"></a><p class="title"><b>Figure&nbsp;2.2.&nbsp;Typical full-fledged Spring web application</b></p><div class="figure-contents">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/overview-full.png.pagespeed.ce.sC26wirtWB.png" alt="overview full"></div>
</div></div><br class="figure-break">
<p>Spring’s <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative" title="17.5 Declarative transaction management">declarative transaction management features</a> make
the web application fully transactional, just as it would be if you used EJB
container-managed transactions. All your custom business logic can be implemented with
simple POJOs and managed by Spring’s IoC container. Additional services include support
for sending email and validation that is independent of the web layer, which lets you
choose where to execute validation rules. Spring’s ORM support is integrated with JPA,
Hibernate and JDO; for example, when using Hibernate, you can continue to use
your existing mapping files and standard Hibernate <code class="literal">SessionFactory</code> configuration. Form
controllers seamlessly integrate the web-layer with the domain model, removing the need
for <code class="literal">ActionForms</code> or other classes that transform HTTP parameters to values for your
domain model.</p>
<div class="figure"><a name="d5e324" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e324"></a><p class="title"><b>Figure&nbsp;2.3.&nbsp;Spring middle-tier using a third-party web framework</b></p><div class="figure-contents">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/overview-thirdparty-web.png.pagespeed.ce.1lJso2G8WP.png" alt="overview thirdparty web"></div>
</div></div><br class="figure-break">
<p>Sometimes circumstances do not allow you to completely switch to a different framework.
The Spring Framework does <span class="emphasis"><em>not</em></span> force you to use everything within it; it is not an
<span class="emphasis"><em>all-or-nothing</em></span> solution. Existing front-ends built with Struts, Tapestry, JSF
or other UI frameworks can be integrated with a Spring-based middle-tier, which allows
you to use Spring transaction features. You simply need to wire up your business logic
using an <code class="literal">ApplicationContext</code> and use a <code class="literal">WebApplicationContext</code> to integrate your web
layer.</p>
<div class="figure"><a name="d5e336" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e336"></a><p class="title"><b>Figure&nbsp;2.4.&nbsp;Remoting usage scenario</b></p><div class="figure-contents">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/overview-remoting.png.pagespeed.ce.HIMsJb_Xya.png" alt="overview remoting"></div>
</div></div><br class="figure-break">
<p>When you need to access existing code through web services, you can use Spring’s
<code class="literal">Hessian-</code>, <code class="literal">Burlap-</code>, <code class="literal">Rmi-</code> or <code class="literal">JaxRpcProxyFactory</code> classes. Enabling remote access to
existing applications is not difficult.</p>
<div class="figure"><a name="d5e348" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e348"></a><p class="title"><b>Figure&nbsp;2.5.&nbsp;EJBs - Wrapping existing POJOs</b></p><div class="figure-contents">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/overview-ejb.png.pagespeed.ce.VN88UiKUhA.png" alt="overview ejb"></div>
</div></div><br class="figure-break">
<p>The Spring Framework also provides an <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ejb" title="29. Enterprise JavaBeans (EJB) integration">access and abstraction layer</a> for
Enterprise JavaBeans, enabling you to reuse your existing POJOs and wrap them in
stateless session beans for use in scalable, fail-safe web applications that might need
declarative security.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="dependency-management" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dependency-management"></a>2.3.1&nbsp;Dependency Management and Naming Conventions</h3></div></div></div>
<p>Dependency management and dependency injection are different things. To get those nice
features of Spring into your application (like dependency injection) you need to
assemble all the libraries needed (jar files) and get them onto your classpath at
runtime, and possibly at compile time. These dependencies are not virtual components
that are injected, but physical resources in a file system (typically). The process of
dependency management involves locating those resources, storing them and adding them to
classpaths. Dependencies can be direct (e.g. my application depends on Spring at
runtime), or indirect (e.g. my application depends on <code class="literal">commons-dbcp</code> which depends on
<code class="literal">commons-pool</code>). The indirect dependencies are also known as "transitive" and it is
those dependencies that are hardest to identify and manage.</p>
<p>If you are going to use Spring you need to get a copy of the jar libraries that comprise
the pieces of Spring that you need. To make this easier Spring is packaged as a set of
modules that separate the dependencies as much as possible, so for example if you don’t
want to write a web application you don’t need the spring-web modules. To refer to
Spring library modules in this guide we use a shorthand naming convention <code class="literal">spring-*</code> or
<code class="literal">spring-*.jar,</code> where <code class="literal">*</code> represents the short name for the module
(e.g. <code class="literal">spring-core</code>, <code class="literal">spring-webmvc</code>, <code class="literal">spring-jms</code>, etc.). The actual jar file name that
you use is normally the module name concatenated with the version number
(e.g. <span class="emphasis"><em>spring-core-4.3.8.RELEASE.jar</em></span>).</p>
<p>Each release of the Spring Framework will publish artifacts to the following places:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Maven Central, which is the default repository that Maven queries, and does not
require any special configuration to use. Many of the common libraries that Spring
depends on also are available from Maven Central and a large section of the Spring
community uses Maven for dependency management, so this is convenient for them. The
names of the jars here are in the form <code class="literal">spring-*-&lt;version&gt;.jar</code> and the Maven groupId
is <code class="literal">org.springframework</code>.
</li><li class="listitem">
In a public Maven repository hosted specifically for Spring. In addition to the final
GA releases, this repository also hosts development snapshots and milestones. The jar
file names are in the same form as Maven Central, so this is a useful place to get
development versions of Spring to use with other libraries deployed in Maven Central.
This repository also contains a bundle distribution zip file that contains all Spring
jars bundled together for easy download.
</li></ul></div>
<p>So the first thing you need to decide is how to manage your dependencies: we generally
recommend the use of an automated system like Maven, Gradle or Ivy, but you can also do
it manually by downloading all the jars yourself.</p>
<p>Below you will find the list of Spring artifacts. For a more complete description of
each module, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-modules" title="2.2 Framework Modules">Section&nbsp;2.2, “Framework Modules”</a>.</p>
<div class="table"><a name="d5e381" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e381"></a><p class="title"><b>Table&nbsp;2.1.&nbsp;Spring Framework Artifacts</b></p><div class="table-contents">
<table summary="Spring Framework Artifacts" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">GroupId</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">ArtifactId</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-aop</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Proxy-based AOP support</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-aspects</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>AspectJ based aspects</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-beans</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Beans support, including Groovy</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-context</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Application context runtime, including scheduling and remoting abstractions</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-context-support</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Support classes for integrating common third-party libraries into a Spring application context</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-core</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Core utilities, used by many other Spring modules</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-expression</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Spring Expression Language (SpEL)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-instrument</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Instrumentation agent for JVM bootstrapping</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-instrument-tomcat</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Instrumentation agent for Tomcat</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-jdbc</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>JDBC support package, including DataSource setup and JDBC access support</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-jms</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>JMS support package, including helper classes to send/receive JMS messages</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-messaging</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Support for messaging architectures and protocols</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-orm</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Object/Relational Mapping, including JPA and Hibernate support</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-oxm</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Object/XML Mapping</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-test</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Support for unit testing and integration testing Spring components</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-tx</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Transaction infrastructure, including DAO support and JCA integration</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-web</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Foundational web support, including web client and web-based remoting</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-webmvc</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>HTTP-based Model-View-Controller and REST endpoints for Servlet stacks</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>spring-webmvc-portlet</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>MVC implementation to be used in a Portlet environment</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>org.springframework</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>spring-websocket</p></td><td style="" align="left" valign="top"><p>WebSocket and SockJS infrastructure, including STOMP messaging support</p></td></tr></tbody></table>
</div></div><br class="table-break">
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-spring-dependencies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-spring-dependencies"></a>Spring Dependencies and Depending on Spring</h4></div></div></div>
<p>Although Spring provides integration and support for a huge range of enterprise and
other external tools, it intentionally keeps its mandatory dependencies to an absolute
minimum: you shouldn’t have to locate and download (even automatically) a large number
of jar libraries in order to use Spring for simple use cases. For basic dependency
injection there is only one mandatory external dependency, and that is for logging (see
below for a more detailed description of logging options).</p>
<p>Next we outline the basic steps needed to configure an application that depends on
Spring, first with Maven and then with Gradle and finally using Ivy. In all cases, if
anything is unclear, refer to the documentation of your dependency management system, or
look at some sample code - Spring itself uses Gradle to manage dependencies when it is
building, and our samples mostly use Gradle or Maven.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-maven-dependency-management" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-maven-dependency-management"></a>Maven Dependency Management</h4></div></div></div>
<p>If you are using <a class="ulink" href="https://maven.apache.org/" target="_top">Maven</a> for dependency management you don’t even
need to supply the logging dependency explicitly. For example, to create an application
context and use dependency injection to configure an application, your Maven dependencies
will look like this:</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependencies&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.springframework<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>spring-context<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>4.3.8.RELEASE<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;scope&gt;</span>runtime<span class="hl-tag">&lt;/scope&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
<span class="hl-tag">&lt;/dependencies&gt;</span></pre>
<p>That’s it. Note the scope can be declared as runtime if you don’t need to compile
against Spring APIs, which is typically the case for basic dependency injection use
cases.</p>
<p>The example above works with the Maven Central repository. To use the Spring Maven
repository (e.g. for milestones or developer snapshots), you need to specify the
repository location in your Maven configuration. For full releases:</p>
<pre class="programlisting"><span class="hl-tag">&lt;repositories&gt;</span>
    <span class="hl-tag">&lt;repository&gt;</span>
        <span class="hl-tag">&lt;id&gt;</span>io.spring.repo.maven.release<span class="hl-tag">&lt;/id&gt;</span>
        <span class="hl-tag">&lt;url&gt;</span>http://repo.spring.io/release/<span class="hl-tag">&lt;/url&gt;</span>
        <span class="hl-tag">&lt;snapshots&gt;</span><span class="hl-tag">&lt;enabled&gt;</span>false<span class="hl-tag">&lt;/enabled&gt;</span><span class="hl-tag">&lt;/snapshots&gt;</span>
    <span class="hl-tag">&lt;/repository&gt;</span>
<span class="hl-tag">&lt;/repositories&gt;</span></pre>
<p>For milestones:</p>
<pre class="programlisting"><span class="hl-tag">&lt;repositories&gt;</span>
    <span class="hl-tag">&lt;repository&gt;</span>
        <span class="hl-tag">&lt;id&gt;</span>io.spring.repo.maven.milestone<span class="hl-tag">&lt;/id&gt;</span>
        <span class="hl-tag">&lt;url&gt;</span>http://repo.spring.io/milestone/<span class="hl-tag">&lt;/url&gt;</span>
        <span class="hl-tag">&lt;snapshots&gt;</span><span class="hl-tag">&lt;enabled&gt;</span>false<span class="hl-tag">&lt;/enabled&gt;</span><span class="hl-tag">&lt;/snapshots&gt;</span>
    <span class="hl-tag">&lt;/repository&gt;</span>
<span class="hl-tag">&lt;/repositories&gt;</span></pre>
<p>And for snapshots:</p>
<pre class="programlisting"><span class="hl-tag">&lt;repositories&gt;</span>
    <span class="hl-tag">&lt;repository&gt;</span>
        <span class="hl-tag">&lt;id&gt;</span>io.spring.repo.maven.snapshot<span class="hl-tag">&lt;/id&gt;</span>
        <span class="hl-tag">&lt;url&gt;</span>http://repo.spring.io/snapshot/<span class="hl-tag">&lt;/url&gt;</span>
        <span class="hl-tag">&lt;snapshots&gt;</span><span class="hl-tag">&lt;enabled&gt;</span>true<span class="hl-tag">&lt;/enabled&gt;</span><span class="hl-tag">&lt;/snapshots&gt;</span>
    <span class="hl-tag">&lt;/repository&gt;</span>
<span class="hl-tag">&lt;/repositories&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-maven-bom" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-maven-bom"></a>Maven "Bill Of Materials" Dependency</h4></div></div></div>
<p>It is possible to accidentally mix different versions of Spring JARs when using Maven.
For example, you may find that a third-party library, or another Spring project,
pulls in a transitive dependency to an older release. If you forget to explicitly declare
a direct dependency yourself, all sorts of unexpected issues can arise.</p>
<p>To overcome such problems Maven supports the concept of a "bill of materials" (BOM)
dependency. You can import the <code class="literal">spring-framework-bom</code> in your <code class="literal">dependencyManagement</code>
section to ensure that all spring dependencies (both direct and transitive) are at
the same version.</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependencyManagement&gt;</span>
    <span class="hl-tag">&lt;dependencies&gt;</span>
        <span class="hl-tag">&lt;dependency&gt;</span>
            <span class="hl-tag">&lt;groupId&gt;</span>org.springframework<span class="hl-tag">&lt;/groupId&gt;</span>
            <span class="hl-tag">&lt;artifactId&gt;</span>spring-framework-bom<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;version&gt;</span>4.3.8.RELEASE<span class="hl-tag">&lt;/version&gt;</span>
            <span class="hl-tag">&lt;type&gt;</span>pom<span class="hl-tag">&lt;/type&gt;</span>
            <span class="hl-tag">&lt;scope&gt;</span>import<span class="hl-tag">&lt;/scope&gt;</span>
        <span class="hl-tag">&lt;/dependency&gt;</span>
    <span class="hl-tag">&lt;/dependencies&gt;</span>
<span class="hl-tag">&lt;/dependencyManagement&gt;</span></pre>
<p>An added benefit of using the BOM is that you no longer need to specify the <code class="literal">&lt;version&gt;</code>
attribute when depending on Spring Framework artifacts:</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependencies&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.springframework<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>spring-context<span class="hl-tag">&lt;/artifactId&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.springframework<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>spring-web<span class="hl-tag">&lt;/artifactId&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
<span class="hl-tag">&lt;dependencies&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-gradle-dependency-management" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-gradle-dependency-management"></a>Gradle Dependency Management</h4></div></div></div>
<p>To use the Spring repository with the <a class="ulink" href="http://www.gradle.org/" target="_top">Gradle</a> build system,
include the appropriate URL in the <code class="literal">repositories</code> section:</p>
<pre class="programlisting">repositories {
    mavenCentral()
    <span class="hl-comment">// and optionally...</span>
    maven { url <span class="hl-string">"http://repo.spring.io/release"</span> }
}</pre>
<p>You can change the <code class="literal">repositories</code> URL from <code class="literal">/release</code> to <code class="literal">/milestone</code> or <code class="literal">/snapshot</code> as
appropriate. Once a repository has been configured, you can declare dependencies in the
usual Gradle way:</p>
<pre class="programlisting">dependencies {
    compile(<span class="hl-string">"org.springframework:spring-context:4.3.8.RELEASE"</span>)
    testCompile(<span class="hl-string">"org.springframework:spring-test:4.3.8.RELEASE"</span>)
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-ivy-dependency-management" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-ivy-dependency-management"></a>Ivy Dependency Management</h4></div></div></div>
<p>If you prefer to use <a class="ulink" href="https://ant.apache.org/ivy" target="_top">Ivy</a> to manage dependencies then there
are similar configuration options.</p>
<p>To configure Ivy to point to the Spring repository add the following resolver to your
<code class="literal">ivysettings.xml</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;resolvers&gt;</span>
    <span class="hl-tag">&lt;ibiblio</span> <span class="hl-attribute">name</span>=<span class="hl-value">"io.spring.repo.maven.release"</span>
            <span class="hl-attribute">m2compatible</span>=<span class="hl-value">"true"</span>
            <span class="hl-attribute">root</span>=<span class="hl-value">"http://repo.spring.io/release/"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/resolvers&gt;</span></pre>
<p>You can change the <code class="literal">root</code> URL from <code class="literal">/release/</code> to <code class="literal">/milestone/</code> or <code class="literal">/snapshot/</code> as
appropriate.</p>
<p>Once configured, you can add dependencies in the usual way. For example (in <code class="literal">ivy.xml</code>):</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependency</span> <span class="hl-attribute">org</span>=<span class="hl-value">"org.springframework"</span>
    <span class="hl-attribute">name</span>=<span class="hl-value">"spring-core"</span> <span class="hl-attribute">rev</span>=<span class="hl-value">"4.3.8.RELEASE"</span> <span class="hl-attribute">conf</span>=<span class="hl-value">"compile-&gt;runtime"</span><span class="hl-tag">/&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-distribution-zip" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-distribution-zip"></a>Distribution Zip Files</h4></div></div></div>
<p>Although using a build system that supports dependency management is the recommended
way to obtain the Spring Framework, it is still possible to download a distribution
zip file.</p>
<p>Distribution zips are published to the Spring Maven Repository (this is just for our
convenience, you don’t need Maven or any other build system in order to download them).</p>
<p>To download a distribution zip open a web browser to
<a class="ulink" href="http://repo.spring.io/release/org/springframework/spring" target="_top">http://repo.spring.io/release/org/springframework/spring</a> and select the appropriate
subfolder for the version that you want. Distribution files end <code class="literal">-dist.zip</code>, for example
spring-framework-{spring-version}-RELEASE-dist.zip. Distributions are also published
for <a class="ulink" href="http://repo.spring.io/milestone/org/springframework/spring" target="_top">milestones</a> and
<a class="ulink" href="http://repo.spring.io/snapshot/org/springframework/spring" target="_top">snapshots</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="overview-logging" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging"></a>2.3.2&nbsp;Logging</h3></div></div></div>
<p>Logging is a very important dependency for Spring because <span class="emphasis"><em>a)</em></span> it is the only mandatory
external dependency, <span class="emphasis"><em>b)</em></span> everyone likes to see some output from the tools they are
using, and <span class="emphasis"><em>c)</em></span> Spring integrates with lots of other tools all of which have also made
a choice of logging dependency. One of the goals of an application developer is often to
have unified logging configured in a central place for the whole application, including
all external components. This is more difficult than it might have been since there are so
many choices of logging framework.</p>
<p>The mandatory logging dependency in Spring is the Jakarta Commons Logging API (JCL). We
compile against JCL and we also make JCL <code class="literal">Log</code> objects visible for classes that extend
the Spring Framework. It’s important to users that all versions of Spring use the same
logging library: migration is easy because backwards compatibility is preserved even
with applications that extend Spring. The way we do this is to make one of the modules
in Spring depend explicitly on <code class="literal">commons-logging</code> (the canonical implementation of JCL),
and then make all the other modules depend on that at compile time. If you are using
Maven for example, and wondering where you picked up the dependency on <code class="literal">commons-logging</code>,
then it is from Spring and specifically from the central module called <code class="literal">spring-core</code>.</p>
<p>The nice thing about <code class="literal">commons-logging</code> is that you don’t need anything else to make your
application work. It has a runtime discovery algorithm that looks for other logging
frameworks in well known places on the classpath and uses one that it thinks is
appropriate (or you can tell it which one if you need to). If nothing else is available
you get pretty nice looking logs just from the JDK (java.util.logging or JUL for short).
You should find that your Spring application works and logs happily to the console out
of the box in most situations, and that’s important.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-logging-log4j" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging-log4j"></a>Using Log4j 1.2 or 2.x</h4></div></div></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Log4j 1.2 is EOL in the meantime. Also, Log4j 2.3 is the last Java 6 compatible
release, with newer Log4j 2.x releases requiring Java 7+.</p>
</td></tr></tbody></table></div>
<p>Many people use <a class="ulink" href="https://logging.apache.org/log4j" target="_top">Log4j</a> as a logging framework for
configuration and management purposes. It is efficient and well-established, and in
fact it is what we use at runtime when we build Spring. Spring also provides some
utilities for configuring and initializing Log4j, so it has an optional compile-time
dependency on Log4j in some modules.</p>
<p>To make Log4j 1.2 work with the default JCL dependency (<code class="literal">commons-logging</code>) all you
need to do is put Log4j on the classpath, and provide it with a configuration file
(<code class="literal">log4j.properties</code> or <code class="literal">log4j.xml</code> in the root of the classpath). So for Maven users
this is your dependency declaration:</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependencies&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.springframework<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>spring-core<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>4.3.8.RELEASE<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>log4j<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>log4j<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>1.2.17<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
<span class="hl-tag">&lt;/dependencies&gt;</span></pre>
<p>And here’s a sample log4j.properties for logging to the console:</p>
<pre class="literallayout">log4j.rootCategory=INFO, stdout

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d{ABSOLUTE} %5p %t %c{2}:%L - %m%n

log4j.category.org.springframework.beans.factory=DEBUG</pre>
<p>To use Log4j 2.x with JCL, all you need to do is put Log4j on the classpath and
provide it with a configuration file (<code class="literal">log4j2.xml</code>, <code class="literal">log4j2.properties</code>, or other
<a class="ulink" href="https://logging.apache.org/log4j/2.x/manual/configuration.html" target="_top">supported configuration
formats</a>). For Maven users, the minimal dependencies needed are:</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependencies&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>log4j-core<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>2.6.2<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>log4j-jcl<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>2.6.2<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
<span class="hl-tag">&lt;/dependencies&gt;</span></pre>
<p>If you also wish to enable SLF4J to delegate to Log4j, e.g. for other libraries
which use SLF4J by default, the following dependency is also needed:</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependencies&gt;</span>
  <span class="hl-tag">&lt;dependency&gt;</span>
    <span class="hl-tag">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="hl-tag">&lt;/groupId&gt;</span>
    <span class="hl-tag">&lt;artifactId&gt;</span>log4j-slf4j-impl<span class="hl-tag">&lt;/artifactId&gt;</span>
    <span class="hl-tag">&lt;version&gt;</span>2.6.2<span class="hl-tag">&lt;/version&gt;</span>
  <span class="hl-tag">&lt;/dependency&gt;</span>
<span class="hl-tag">&lt;/dependencies&gt;</span></pre>
<p>Here is an example <code class="literal">log4j2.xml</code> for logging to the console:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;Configuration</span> <span class="hl-attribute">status</span>=<span class="hl-value">"WARN"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;Appenders&gt;</span>
    <span class="hl-tag">&lt;Console</span> <span class="hl-attribute">name</span>=<span class="hl-value">"Console"</span> <span class="hl-attribute">target</span>=<span class="hl-value">"SYSTEM_OUT"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;PatternLayout</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/Console&gt;</span>
  <span class="hl-tag">&lt;/Appenders&gt;</span>
  <span class="hl-tag">&lt;Loggers&gt;</span>
    <span class="hl-tag">&lt;Logger</span> <span class="hl-attribute">name</span>=<span class="hl-value">"org.springframework.beans.factory"</span> <span class="hl-attribute">level</span>=<span class="hl-value">"DEBUG"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;Root</span> <span class="hl-attribute">level</span>=<span class="hl-value">"error"</span><span class="hl-tag">&gt;</span>
      <span class="hl-tag">&lt;AppenderRef</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"Console"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/Root&gt;</span>
  <span class="hl-tag">&lt;/Loggers&gt;</span>
<span class="hl-tag">&lt;/Configuration&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-avoiding-commons-logging" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-avoiding-commons-logging"></a>Avoiding Commons Logging</h4></div></div></div>
<p>Unfortunately, the runtime discovery algorithm in the standard <code class="literal">commons-logging</code> API,
while convenient for the end-user, can be problematic. If you’d like to avoid JCL’s
standard lookup, there are basically two ways to switch it off:</p>
<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Exclude the dependency from the <code class="literal">spring-core</code> module (as it is the only module that
explicitly depends on <code class="literal">commons-logging</code>)
</li><li class="listitem">
Depend on a special <code class="literal">commons-logging</code> dependency that replaces the library with
an empty jar (more details can be found in the
<a class="ulink" href="http://slf4j.org/faq.html#excludingJCL" target="_top">SLF4J FAQ</a>)
</li></ol></div>
<p>To exclude commons-logging, add the following to your <code class="literal">dependencyManagement</code> section:</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependencies&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.springframework<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>spring-core<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>4.3.8.RELEASE<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;exclusions&gt;</span>
            <span class="hl-tag">&lt;exclusion&gt;</span>
                <span class="hl-tag">&lt;groupId&gt;</span>commons-logging<span class="hl-tag">&lt;/groupId&gt;</span>
                <span class="hl-tag">&lt;artifactId&gt;</span>commons-logging<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;/exclusion&gt;</span>
        <span class="hl-tag">&lt;/exclusions&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
<span class="hl-tag">&lt;/dependencies&gt;</span></pre>
<p>Now this application is currently broken because there is no implementation of the JCL
API on the classpath, so to fix it a new one has to be provided. In the next section we
show you how to provide an alternative implementation of JCL using SLF4J.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-logging-slf4j" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging-slf4j"></a>Using SLF4J with Log4j or Logback</h4></div></div></div>
<p>The Simple Logging Facade for Java (<a class="ulink" href="http://www.slf4j.org/" target="_top">SLF4J</a>) is a popular API
used by other libraries commonly used with Spring. It is typically used with
<a class="ulink" href="https://logback.qos.ch/" target="_top">Logback</a> which is a native implementation of the SLF4J API.</p>
<p>SLF4J provides bindings to many common logging frameworks, including Log4j, and it also
does the reverse: bridges between other logging frameworks and itself. So to use SLF4J
with Spring you need to replace the <code class="literal">commons-logging</code> dependency with the SLF4J-JCL
bridge. Once you have done that then logging calls from within Spring will be translated
into logging calls to the SLF4J API, so if other libraries in your application use that
API, then you have a single place to configure and manage logging.</p>
<p>A common choice might be to bridge Spring to SLF4J, and then provide explicit binding
from SLF4J to Log4j. You need to supply several dependencies (and exclude the existing
<code class="literal">commons-logging</code>): the JCL bridge, the SLF4j binding to Log4j, and the Log4j provider
itself. In Maven you would do that like this</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependencies&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.springframework<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>spring-core<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>4.3.8.RELEASE<span class="hl-tag">&lt;/version&gt;</span>
        <span class="hl-tag">&lt;exclusions&gt;</span>
            <span class="hl-tag">&lt;exclusion&gt;</span>
                <span class="hl-tag">&lt;groupId&gt;</span>commons-logging<span class="hl-tag">&lt;/groupId&gt;</span>
                <span class="hl-tag">&lt;artifactId&gt;</span>commons-logging<span class="hl-tag">&lt;/artifactId&gt;</span>
            <span class="hl-tag">&lt;/exclusion&gt;</span>
        <span class="hl-tag">&lt;/exclusions&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.slf4j<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>1.7.21<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.slf4j<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>slf4j-log4j12<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>1.7.21<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>log4j<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>log4j<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>1.2.17<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
<span class="hl-tag">&lt;/dependencies&gt;</span></pre>
<p>A more common choice amongst SLF4J users, which uses fewer steps and generates fewer
dependencies, is to bind directly to <a class="ulink" href="http://logback.qos.ch/" target="_top">Logback</a>. This removes the
extra binding step because Logback implements SLF4J directly, so you only need to depend
on just two libraries, namely <code class="literal">jcl-over-slf4j</code> and <code class="literal">logback</code>):</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependencies&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>org.slf4j<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>1.7.21<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
    <span class="hl-tag">&lt;dependency&gt;</span>
        <span class="hl-tag">&lt;groupId&gt;</span>ch.qos.logback<span class="hl-tag">&lt;/groupId&gt;</span>
        <span class="hl-tag">&lt;artifactId&gt;</span>logback-classic<span class="hl-tag">&lt;/artifactId&gt;</span>
        <span class="hl-tag">&lt;version&gt;</span>1.1.7<span class="hl-tag">&lt;/version&gt;</span>
    <span class="hl-tag">&lt;/dependency&gt;</span>
<span class="hl-tag">&lt;/dependencies&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-logging-jul" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging-jul"></a>Using JUL (java.util.logging)</h4></div></div></div>
<p>Commons Logging will delegate to <code class="literal">java.util.logging</code> by default, provided that no
Log4j is detected on the classpath. So there is no special dependency to set up:
just use Spring with no external dependency for log output to <code class="literal">java.util.logging</code>,
either in a standalone application (with a custom or default JUL setup at the JDK
level) or with an application server’s log system (and its system-wide JUL setup).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="overview-logging-websphere" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-logging-websphere"></a>Commons Logging on WebSphere</h4></div></div></div>
<p>Spring applications may run on a container that itself provides an implementation of
JCL, e.g. IBM’s WebSphere Application Server (WAS). This does not cause issues per se
but leads to two different scenarios that need to be understood:</p>
<p>In a "parent first" ClassLoader delegation model (the default on WAS), applications
will always pick up the server-provided version of Commons Logging, delegating to the
WAS logging subsystem (which is actually based on JUL). An application-provided variant
of JCL, whether standard Commons Logging or the JCL-over-SLF4J bridge, will effectively
be ignored, along with any locally included log provider.</p>
<p>With a "parent last" delegation model (the default in a regular Servlet container but
an explicit configuration option on WAS), an application-provided Commons Logging
variant will be picked up, enabling you to set up a locally included log provider,
e.g. Log4j or Logback, within your application. In case of no local log provider,
regular Commons Logging will delegate to JUL by default, effectively logging to
WebSphere’s logging subsystem like in the "parent first" scenario.</p>
<p>All in all, we recommend deploying Spring applications in the "parent last" model
since it naturally allows for local providers as well as the server’s log subsystem.</p>
</div>
</div>
</div>
</div>
</div>
<div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="spring-whats-new" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-whats-new"></a>Part&nbsp;II.&nbsp;What’s New in Spring Framework 4.x</h1></div></div></div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="new-in-4.0" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#new-in-4.0"></a>3.&nbsp;New Features and Enhancements in Spring Framework 4.0</h2></div></div></div>
<p>The Spring Framework was first released in 2004; since then there have been significant
major revisions: Spring 2.0 provided XML namespaces and AspectJ support; Spring 2.5
embraced annotation-driven configuration; Spring 3.0 introduced a strong Java 5+ foundation
across the framework codebase, and features such as the Java-based <code class="literal">@Configuration</code> model.</p>
<p>Version 4.0 is the latest major release of the Spring Framework and the first to fully
support Java 8 features. You can still use Spring with older versions of Java, however,
the minimum requirement has now been raised to Java SE 6. We have also taken the
opportunity of a major release to remove many deprecated classes and methods.</p>
<p>A <a class="ulink" href="https://github.com/spring-projects/spring-framework/wiki/Migrating-from-earlier-versions-of-the-spring-framework" target="_top">migration guide for upgrading to Spring 4.0</a>
is available on the <a class="ulink" href="https://github.com/spring-projects/spring-framework/wiki" target="_top">Spring Framework GitHub Wiki</a>.</p>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_improved_getting_started_experience" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_improved_getting_started_experience"></a>3.1&nbsp;Improved Getting Started Experience</h2></div></div></div>
<p>The new <a class="ulink" href="https://spring.io/" target="_top">spring.io</a> website provides a whole series of
<a class="ulink" href="https://spring.io/guides" target="_top">"Getting Started"</a> guides to help you learn Spring. You
can read more about the guides in the <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-getting-started-with-spring" title="1. Getting Started with Spring">Chapter&nbsp;1, <i>Getting Started with Spring</i></a> section
in this document. The new website also provides a comprehensive overview of the many
additional projects that are released under the Spring umbrella.</p>
<p>If you are a Maven user you may also be interested in the helpful
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#overview-maven-bom" title="Maven &quot;Bill Of Materials&quot; Dependency">bill of materials</a> POM file that is now published with each Spring
Framework release.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_removed_deprecated_packages_and_methods" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_removed_deprecated_packages_and_methods"></a>3.2&nbsp;Removed Deprecated Packages and Methods</h2></div></div></div>
<p>All deprecated packages, and many deprecated classes and methods have been removed with
version 4.0. If you are upgrading from a previous release of Spring, you should ensure
that you have fixed any deprecated calls that you were making to outdated APIs.</p>
<p>For a complete set of changes, check out the
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/3.2.4.RELEASE_to_4.0.0.RELEASE/" target="_top">API
Differences Report</a>.</p>
<p>Note that optional third-party dependencies have been raised to a 2010/2011 minimum
(i.e. Spring 4 generally only supports versions released in late 2010 or later now):
notably, Hibernate 3.6+, EhCache 2.1+, Quartz 1.8+, Groovy 1.8+, and Joda-Time 2.0+.
As an exception to the rule, Spring 4 requires the recent Hibernate Validator 4.3+,
and support for Jackson has been focused on 2.0+ now (with Jackson 1.8/1.9 support
retained for the time being where Spring 3.2 had it; now just in deprecated form).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_java_8_as_well_as_6_and_7" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_java_8_as_well_as_6_and_7"></a>3.3&nbsp;Java 8 (as well as 6 and 7)</h2></div></div></div>
<p>Spring Framework 4.0 provides support for several Java 8 features. You can make use of
<span class="emphasis"><em>lambda expressions</em></span> and <span class="emphasis"><em>method references</em></span> with Spring’s callback interfaces. There
is first-class support for <code class="literal">java.time</code> (<a class="ulink" href="https://jcp.org/en/jsr/detail?id=310" target="_top">JSR-310</a>),
and several existing annotations have been retrofitted as <code class="literal">@Repeatable</code>. You can also
use Java 8’s parameter name discovery (based on the <code class="literal">-parameters</code> compiler flag) as an
alternative to compiling your code with debug information enabled.</p>
<p>Spring remains compatible with older versions of Java and the JDK: concretely, Java SE 6
(specifically, a minimum level equivalent to JDK 6 update 18, as released in January 2010)
and above are still fully supported. However, for newly started development projects
based on Spring 4, we recommend the use of Java 7 or 8.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_java_ee_6_and_7" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_java_ee_6_and_7"></a>3.4&nbsp;Java EE 6 and 7</h2></div></div></div>
<p>Java EE version 6 or above is now considered the baseline for Spring Framework 4, with
the JPA 2.0 and Servlet 3.0 specifications being of particular relevance. In order to
remain compatible with Google App Engine and older application servers, it is possible
to deploy a Spring 4 application into a Servlet 2.5 environment. However, Servlet 3.0+
is strongly recommended and a prerequisite in Spring’s test and mock packages for test
setups in development environments.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If you are a WebSphere 7 user, be sure to install the JPA 2.0 feature pack. On
WebLogic 10.3.4 or higher, install the JPA 2.0 patch that comes with it. This turns
both of those server generations into Spring 4 compatible deployment environments.</p>
</td></tr></tbody></table></div>
<p>On a more forward-looking note, Spring Framework 4.0 supports the Java EE 7 level of
applicable specifications now: in particular, JMS 2.0, JTA 1.2, JPA 2.1, Bean Validation
1.1, and JSR-236 Concurrency Utilities. As usual, this support focuses on individual
use of those specifications, e.g. on Tomcat or in standalone environments. However,
it works equally well when a Spring application is deployed to a Java EE 7 server.</p>
<p>Note that Hibernate 4.3 is a JPA 2.1 provider and therefore only supported as of
Spring Framework 4.0. The same applies to Hibernate Validator 5.0 as a Bean Validation
1.1 provider. Neither of the two are officially supported with Spring Framework 3.2.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_groovy_bean_definition_dsl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_groovy_bean_definition_dsl"></a>3.5&nbsp;Groovy Bean Definition DSL</h2></div></div></div>
<p>Beginning with Spring Framework 4.0, it is possible to define external bean configuration
using a Groovy DSL. This is similar in concept to using XML bean definitions but allows
for a more concise syntax. Using Groovy also allows you to easily embed bean definitions
directly in your bootstrap code. For example:</p>
<pre class="programlisting">def reader = <span class="hl-keyword">new</span> GroovyBeanDefinitionReader(myApplicationContext)
reader.beans {
    dataSource(BasicDataSource) {
        driverClassName = <span class="hl-string">"org.hsqldb.jdbcDriver"</span>
        url = <span class="hl-string">"jdbc:hsqldb:mem:grailsDB"</span>
        username = <span class="hl-string">"sa"</span>
        password = <span class="hl-string">""</span>
        settings = [mynew:<span class="hl-string">"setting"</span>]
    }
    sessionFactory(SessionFactory) {
        dataSource = dataSource
    }
    myService(MyService) {
        nestedBean = { AnotherBean bean -&gt;
            dataSource = dataSource
        }
    }
}</pre>
<p>For more information consult the <code class="literal">GroovyBeanDefinitionReader</code>
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/beans/factory/groovy/GroovyBeanDefinitionReader.html" target="_top">javadocs</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_core_container_improvements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_core_container_improvements"></a>3.6&nbsp;Core Container Improvements</h2></div></div></div>
<p>There have been several general improvements to the core container:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Spring now treats <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-generics-as-qualifiers" title="7.9.5 Using generics as autowiring qualifiers"><span class="emphasis"><em>generic types</em></span> as a form of
<span class="emphasis"><em>qualifier</em></span></a> when injecting Beans. For example, if you are using a Spring Data
<code class="literal">Repository</code> you can now easily inject a specific implementation:
<code class="literal">@Autowired Repository&lt;Customer&gt; customerRepository</code>.
</li><li class="listitem">
If you use Spring’s meta-annotation support, you can now develop custom annotations that
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-meta-annotations" title="7.10.2 Meta-annotations">expose specific attributes from the source annotation</a>.
</li><li class="listitem">
Beans can now be <span class="emphasis"><em>ordered</em></span> when they are <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation" title="7.9.2 @Autowired">autowired into
lists and arrays</a>. Both the <code class="literal">@Order</code> annotation and <code class="literal">Ordered</code> interface are
supported.
</li><li class="listitem">
The <code class="literal">@Lazy</code> annotation can now be used on injection points, as well as on <code class="literal">@Bean</code>
definitions.
</li><li class="listitem">
The <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-bean-description" title="Bean description"><code class="literal">@Description</code> annotation has been introduced</a> for
developers using Java-based configuration.
</li><li class="listitem">
A generalized model for <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-conditional" title="Conditionally include @Configuration classes or @Bean methods">conditionally filtering beans</a> has
been added via the <code class="literal">@Conditional</code> annotation. This is similar to <code class="literal">@Profile</code> support but
allows for user-defined strategies to be developed programmatically.
</li><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-proxy-types" title="12.5.3 JDK- and CGLIB-based proxies">CGLIB-based proxy classes</a> no longer require a default
constructor. Support is provided via the <a class="ulink" href="https://code.google.com/p/objenesis/" target="_top">objenesis</a>
library which is repackaged <span class="emphasis"><em>inline</em></span> and distributed as part of the Spring Framework.
With this strategy, no constructor at all is being invoked for proxy instances anymore.
</li><li class="listitem">
There is managed time zone support across the framework now, e.g. on <code class="literal">LocaleContext</code>.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_general_web_improvements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_general_web_improvements"></a>3.7&nbsp;General Web Improvements</h2></div></div></div>
<p>Deployment to Servlet 2.5 servers remains an option, but Spring Framework 4.0 is now
focused primarily on Servlet 3.0+ environments. If you are using the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-framework" title="15.6 Spring MVC Test Framework">Spring MVC Test Framework</a> you
will need to ensure that a Servlet 3.0 compatible JAR is in your <span class="emphasis"><em>test classpath</em></span>.</p>
<p>In addition to the WebSocket support mentioned later, the following general improvements
have been made to Spring’s Web modules:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
You can use the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-restcontroller" title="Creating REST Controllers with the @RestController annotation">new <code class="literal">@RestController</code> annotation</a> with Spring
MVC applications, removing the need to add <code class="literal">@ResponseBody</code> to each of your
<code class="literal">@RequestMapping</code> methods.
</li><li class="listitem">
The <code class="literal">AsyncRestTemplate</code> class has been added, <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#rest-async-resttemplate" title="28.10.3 Async RestTemplate">allowing
non-blocking asynchronous support</a> when developing REST clients.
</li><li class="listitem">
Spring now offers <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-timezone" title="22.8.1 Obtaining Time Zone Information">comprehensive timezone support</a> when developing
Spring MVC applications.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_websocket_sockjs_and_stomp_messaging" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_websocket_sockjs_and_stomp_messaging"></a>3.8&nbsp;WebSocket, SockJS, and STOMP Messaging</h2></div></div></div>
<p>A new <code class="literal">spring-websocket</code> module provides comprehensive support for WebSocket-based,
two-way communication between client and server in web applications. It is compatible with
<a class="ulink" href="https://jcp.org/en/jsr/detail?id=356" target="_top">JSR-356</a>, the Java WebSocket API, and in addition
provides SockJS-based fallback options (i.e. WebSocket emulation) for use in browsers
that don’t yet support the WebSocket protocol (e.g. Internet Explorer &lt; 10).</p>
<p>A new <code class="literal">spring-messaging</code> module adds support for STOMP as the WebSocket sub-protocol
to use in applications along with an annotation programming model for routing and
processing STOMP messages from WebSocket clients. As a result an <code class="literal">@Controller</code>
can now contain both <code class="literal">@RequestMapping</code> and <code class="literal">@MessageMapping</code> methods for handling
HTTP requests and messages from WebSocket-connected clients. The new <code class="literal">spring-messaging</code>
module also contains key abstractions formerly from the
<a class="ulink" href="http://projects.spring.io/spring-integration/" target="_top">Spring Integration</a> project such as
<code class="literal">Message</code>, <code class="literal">MessageChannel</code>, <code class="literal">MessageHandler</code>, and others to serve as a foundation
for messaging-based applications.</p>
<p>For further details, including a more thorough introduction, see the <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket" title="26. WebSocket Support">Chapter&nbsp;26, <i>WebSocket Support</i></a> section.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_testing_improvements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testing_improvements"></a>3.9&nbsp;Testing Improvements</h2></div></div></div>
<p>In addition to pruning of deprecated code within the <code class="literal">spring-test</code> module, Spring
Framework 4.0 introduces several new features for use in unit and integration testing.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Almost all annotations in the <code class="literal">spring-test</code> module (e.g., <code class="literal">@ContextConfiguration</code>,
<code class="literal">@WebAppConfiguration</code>, <code class="literal">@ContextHierarchy</code>, <code class="literal">@ActiveProfiles</code>, etc.) can now be used
as <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-meta" title="15.4.4 Meta-Annotation Support for Testing">meta-annotations</a> to create custom
<span class="emphasis"><em>composed annotations</em></span> and reduce configuration duplication across a test suite.
</li><li class="listitem">
Active bean definition profiles can now be resolved programmatically, simply by
implementing a custom <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-env-profiles-ActiveProfilesResolver"><code class="literal">ActiveProfilesResolver</code></a>
and registering it via the <code class="literal">resolver</code> attribute of <code class="literal">@ActiveProfiles</code>.
</li><li class="listitem">
A new <code class="literal">SocketUtils</code> class has been introduced in the <code class="literal">spring-core</code> module
which enables you to scan for free TCP and UDP server ports on localhost. This
functionality is not specific to testing but can prove very useful when writing
integration tests that require the use of sockets, for example tests that start
an in-memory SMTP server, FTP server, Servlet container, etc.
</li><li class="listitem">
As of Spring 4.0, the set of mocks in the <code class="literal">org.springframework.mock.web</code> package is
now based on the Servlet 3.0 API. Furthermore, several of the Servlet API mocks
(e.g., <code class="literal">MockHttpServletRequest</code>, <code class="literal">MockServletContext</code>, etc.) have been updated with
minor enhancements and improved configurability.
</li></ul></div>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="new-in-4.1" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#new-in-4.1"></a>4.&nbsp;New Features and Enhancements in Spring Framework 4.1</h2></div></div></div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_jms_improvements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_jms_improvements"></a>4.1&nbsp;JMS Improvements</h2></div></div></div>
<p>Spring 4.1 introduces a much simpler infrastructure <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-annotated" title="30.6 Annotation-driven listener endpoints">to register JMS
listener endpoints</a> by annotating bean methods with
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/jms/annotation/JmsListener.html" target="_top"><code class="literal">@JmsListener</code></a>.
The XML namespace has been enhanced to support this new style (<code class="literal">jms:annotation-driven</code>),
and it is also possible to fully configure the infrastructure using Java config
(<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/jms/annotation/EnableJms.html" target="_top"><code class="literal">@EnableJms</code></a>,
<code class="literal">JmsListenerContainerFactory</code>). It is also possible to register listener endpoints
programmatically using
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/jms/annotation/JmsListenerConfigurer.html" target="_top"><code class="literal">JmsListenerConfigurer</code></a>.</p>
<p>Spring 4.1 also aligns its JMS support to allow you to benefit from the <code class="literal">spring-messaging</code>
abstraction introduced in 4.0, that is:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Message listener endpoints can have a more flexible signature and benefit from
standard messaging annotations such as <code class="literal">@Payload</code>, <code class="literal">@Header</code>, <code class="literal">@Headers</code>, and <code class="literal">@SendTo</code>. It
is also possible to use a standard <code class="literal">Message</code> in lieu of <code class="literal">javax.jms.Message</code> as method
argument.
</li><li class="listitem">
A new <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/jms/core/JmsMessageOperations.html" target="_top"><code class="literal">JmsMessageOperations</code></a>
interface is available and permits <code class="literal">JmsTemplate</code> like operations using the <code class="literal">Message</code>
abstraction.
</li></ul></div>
<p>Finally, Spring 4.1 provides additional miscellaneous improvements:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Synchronous request-reply operations support in <code class="literal">JmsTemplate</code>
</li><li class="listitem">
Listener priority can be specified per <code class="literal">&lt;jms:listener/&gt;</code> element
</li><li class="listitem">
Recovery options for the message listener container are configurable using a
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/util/backoff/BackOff.html" target="_top"><code class="literal">BackOff</code></a> implementation
</li><li class="listitem">
JMS 2.0 shared consumers are supported
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_caching_improvements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_caching_improvements"></a>4.2&nbsp;Caching Improvements</h2></div></div></div>
<p>Spring 4.1 supports <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-jsr-107" title="36.4 JCache (JSR-107) annotations">JCache (JSR-107) annotations</a> using Spring’s
existing cache configuration and infrastructure abstraction; no changes are required
to use the standard annotations.</p>
<p>Spring 4.1 also improves its own caching abstraction significantly:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Caches can be resolved at runtime using a
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-cacheable-cache-resolver" title="Custom cache resolution"><code class="literal">CacheResolver</code></a>. As a result the
<code class="literal">value</code> argument defining the cache name(s) to use is no longer mandatory.
</li><li class="listitem">
More operation-level customizations: cache resolver, cache manager, key
generator
</li><li class="listitem">
A new <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-config" title="36.3.5 @CacheConfig annotation"><code class="literal">@CacheConfig</code> class-level annotation</a> allows
common settings to be shared at the class level <span class="strong"><strong>without</strong></span> enabling any cache operation.
</li><li class="listitem">
Better exception handling of cached methods using <code class="literal">CacheErrorHandler</code>
</li></ul></div>
<p>Spring 4.1 also has a breaking change in the <code class="literal">Cache</code> interface as a new <code class="literal">putIfAbsent</code>
method has been added.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_web_improvements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_web_improvements"></a>4.3&nbsp;Web Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The existing support for resource handling based on the <code class="literal">ResourceHttpRequestHandler</code>
has been expanded with new abstractions <code class="literal">ResourceResolver</code>, <code class="literal">ResourceTransformer</code>,
and <code class="literal">ResourceUrlProvider</code>. A number of built-in implementations provide support
for versioned resource URLs (for effective HTTP caching), locating gzipped resources,
generating an HTML 5 AppCache manifests, and more. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-static-resources" title="22.16.9 Serving of Resources">Section&nbsp;22.16.9, “Serving of Resources”</a>.
</li><li class="listitem">
JDK 1.8’s <code class="literal">java.util.Optional</code> is now supported for <code class="literal">@RequestParam</code>, <code class="literal">@RequestHeader</code>,
and <code class="literal">@MatrixVariable</code> controller method arguments.
</li><li class="listitem">
<code class="literal">ListenableFuture</code> is supported as a return value alternative to <code class="literal">DeferredResult</code>
where an underlying service (or perhaps a call to <code class="literal">AsyncRestTemplate</code>) already
returns <code class="literal">ListenableFuture</code>.
</li><li class="listitem">
<code class="literal">@ModelAttribute</code> methods are now invoked in an order that respects inter-dependencies.
See <a class="ulink" href="https://jira.spring.io/browse/SPR-6299" target="_top">SPR-6299</a>.
</li><li class="listitem">
Jackson’s <code class="literal">@JsonView</code> is supported directly on <code class="literal">@ResponseBody</code> and <code class="literal">ResponseEntity</code>
controller methods for serializing different amounts of detail for the same POJO (e.g.
summary vs. detail page). This is also supported with View-based rendering by
adding the serialization view type as a model attribute under a special key.
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-jsonview" title="Jackson Serialization View Support">the section called “Jackson Serialization View Support”</a> for details.
</li><li class="listitem">
JSONP is now supported with Jackson. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-jsonp" title="Jackson JSONP Support">the section called “Jackson JSONP Support”</a>.
</li><li class="listitem">
A new lifecycle option is available for intercepting <code class="literal">@ResponseBody</code> and <code class="literal">ResponseEntity</code>
methods just after the controller method returns and before the response is written.
To take advantage declare an <code class="literal">@ControllerAdvice</code> bean that implements <code class="literal">ResponseBodyAdvice</code>.
The built-in support for <code class="literal">@JsonView</code> and JSONP take advantage of this.
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-handlermapping-interceptor" title="22.4.1 Intercepting requests with a HandlerInterceptor">Section&nbsp;22.4.1, “Intercepting requests with a HandlerInterceptor”</a>.
</li><li class="listitem">
<p class="simpara">There are three new <code class="literal">HttpMessageConverter</code> options:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
Gson&#8201;—&#8201;lighter footprint than Jackson; has already been in use in Spring Android.
</li><li class="listitem">
Google Protocol Buffers&#8201;—&#8201;efficient and effective as an inter-service communication
data protocol within an enterprise but can also be exposed as JSON and XML for browsers.
</li><li class="listitem">
Jackson based XML serialization is now supported through the
<a class="ulink" href="https://github.com/FasterXML/jackson-dataformat-xml" target="_top">jackson-dataformat-xml</a> extension.
When using <code class="literal">@EnableWebMvc</code> or <code class="literal">&lt;mvc:annotation-driven/&gt;</code>, this is used by default
instead of JAXB2 if <code class="literal">jackson-dataformat-xml</code> is in the classpath.
</li></ul></div>
</li><li class="listitem">
Views such as JSPs can now build links to controllers by referring to controller mappings
by name. A default name is assigned to every <code class="literal">@RequestMapping</code>. For example <code class="literal">FooController</code>
with method <code class="literal">handleFoo</code> is named "FC#handleFoo". The naming strategy is pluggable.
It is also possible to name an <code class="literal">@RequestMapping</code> explicitly through its name attribute.
A new <code class="literal">mvcUrl</code> function in the Spring JSP tag library makes this easy to use in JSP pages.
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-links-to-controllers-from-views" title="22.7.2 Building URIs to Controllers and methods from views">Section&nbsp;22.7.2, “Building URIs to Controllers and methods from views”</a>.
</li><li class="listitem">
<code class="literal">ResponseEntity</code> provides a builder-style API to guide controller methods
towards the preparation of server-side responses, e.g. <code class="literal">ResponseEntity.ok()</code>.
</li><li class="listitem">
<code class="literal">RequestEntity</code> is a new type that provides a builder-style API to guide client-side REST
code towards the preparation of HTTP requests.
</li><li class="listitem">
<p class="simpara">MVC Java config and XML namespace:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
View resolvers can now be configured including support for content
negotiation, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-view-resolvers" title="22.16.8 View Resolvers">Section&nbsp;22.16.8, “View Resolvers”</a>.
</li><li class="listitem">
View controllers now have built-in support for redirects and for setting the response
status. An application can use this to configure redirect URLs, render 404 responses
with a view, send "no content" responses, etc.
Some use cases are
<a class="ulink" href="https://jira.spring.io/browse/SPR-11543?focusedCommentId=100308&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-100308" target="_top">listed here</a>.
</li><li class="listitem">
Path matching customizations are frequently used and now built-in.
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-path-matching" title="22.16.11 Path Matching">Section&nbsp;22.16.11, “Path Matching”</a>.
</li></ul></div>
</li><li class="listitem">
<a class="ulink" href="http://groovy-lang.org/docs/groovy-2.3.6/html/documentation/markup-template-engine.html" target="_top">Groovy markup template</a>
support (based on Groovy 2.3). See the <code class="literal">GroovyMarkupConfigurer</code> and respecitve
<code class="literal">ViewResolver</code> and `View' implementations.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_websocket_messaging_improvements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_websocket_messaging_improvements"></a>4.4&nbsp;WebSocket Messaging Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
SockJS (Java) client-side support. See <code class="literal">SockJsClient</code> and classes in same package.
</li><li class="listitem">
New application context events <code class="literal">SessionSubscribeEvent</code> and <code class="literal">SessionUnsubscribeEvent</code> published
when STOMP clients subscribe and unsubscribe.
</li><li class="listitem">
New "websocket" scope. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-websocket-scope" title="26.4.15 WebSocket Scope">Section&nbsp;26.4.15, “WebSocket Scope”</a>.
</li><li class="listitem">
<code class="literal">@SendToUser</code> can target only a single session and does not require an authenticated user.
</li><li class="listitem">
<code class="literal">@MessageMapping</code> methods can use dot "." instead of slash "/" as path separator.
See <a class="ulink" href="https://jira.spring.io/browse/SPR-11660" target="_top">SPR-11660</a>.
</li><li class="listitem">
STOMP/WebSocket monitoring info collected and logged. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-stats" title="26.4.17 Runtime Monitoring">Section&nbsp;26.4.17, “Runtime Monitoring”</a>.
</li><li class="listitem">
Significantly optimized and improved logging that should remain very readable
and compact even at DEBUG level.
</li><li class="listitem">
Optimized message creation including support for temporary message mutability
and avoiding automatic message id and timestamp creation. See Javadoc of
<code class="literal">MessageHeaderAccessor</code>.
</li><li class="listitem">
Close STOMP/WebSocket connections that have no activity within 60 seconds after the
WebSocket session is established. See <a class="ulink" href="https://jira.spring.io/browse/SPR-11884" target="_top">SPR-11884</a>.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_testing_improvements_2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testing_improvements_2"></a>4.5&nbsp;Testing Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p class="simpara">Groovy scripts can now be used to configure the <code class="literal">ApplicationContext</code> loaded for
integration tests in the TestContext framework.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-groovy" title="Context configuration with Groovy scripts">the section called “Context configuration with Groovy scripts”</a> for details.
</li></ul></div>
</li><li class="listitem">
<p class="simpara">Test-managed transactions can now be programmatically started and ended within
transactional test methods via the new <code class="literal">TestTransaction</code> API.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-programmatic-tx-mgt" title="Programmatic transaction management">the section called “Programmatic transaction management”</a> for details.
</li></ul></div>
</li><li class="listitem">
<p class="simpara">SQL script execution can now be configured declaratively via the new <code class="literal">@Sql</code> and
<code class="literal">@SqlConfig</code> annotations on a per-class or per-method basis.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql" title="15.5.8 Executing SQL scripts">Section&nbsp;15.5.8, “Executing SQL scripts”</a> for details.
</li></ul></div>
</li><li class="listitem">
<p class="simpara">Test property sources which automatically override system and application property
sources can be configured via the new <code class="literal">@TestPropertySource</code> annotation.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-property-sources" title="Context configuration with test property sources">the section called “Context configuration with test property sources”</a> for details.
</li></ul></div>
</li><li class="listitem">
<p class="simpara">Default <code class="literal">TestExecutionListener</code>s can now be automatically discovered.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-automatic-discovery" title="Automatic discovery of default TestExecutionListeners">the section called “Automatic discovery of default TestExecutionListeners”</a> for details.
</li></ul></div>
</li><li class="listitem">
<p class="simpara">Custom <code class="literal">TestExecutionListener</code>s can now be automatically merged with the default
listeners.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-merging" title="Merging TestExecutionListeners">the section called “Merging TestExecutionListeners”</a> for details.
</li></ul></div>
</li><li class="listitem">
<p class="simpara">The documentation for transactional testing support in the TestContext framework has
been improved with more thorough explanations and additional examples.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx" title="15.5.7 Transaction management">Section&nbsp;15.5.7, “Transaction management”</a> for details.
</li></ul></div>
</li><li class="listitem">
Various improvements to <code class="literal">MockServletContext</code>, <code class="literal">MockHttpServletRequest</code>, and other
Servlet API mocks.
</li><li class="listitem">
<code class="literal">AssertThrows</code> has been refactored to support <code class="literal">Throwable</code> instead of <code class="literal">Exception</code>.
</li><li class="listitem">
In Spring MVC Test, JSON responses can be asserted with <a class="ulink" href="https://github.com/skyscreamer/JSONassert" target="_top">JSON Assert</a>
as an extra option to using JSONPath much like it has been possible to do for XML with
XMLUnit.
</li><li class="listitem">
<code class="literal">MockMvcBuilder</code> <span class="emphasis"><em>recipes</em></span> can now be created with the help of <code class="literal">MockMvcConfigurer</code>. This
was added to make it easy to apply Spring Security setup but can be used to encapsulate
common setup for any 3rd party framework or within a project.
</li><li class="listitem">
<code class="literal">MockRestServiceServer</code> now supports the <code class="literal">AsyncRestTemplate</code> for client-side testing.
</li></ul></div>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="new-in-4.2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#new-in-4.2"></a>5.&nbsp;New Features and Enhancements in Spring Framework 4.2</h2></div></div></div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_core_container_improvements_2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_core_container_improvements_2"></a>5.1&nbsp;Core Container Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Annotations such as <code class="literal">@Bean</code> get detected and processed on Java 8 default methods as well,
allowing for composing a configuration class from interfaces with default <code class="literal">@Bean</code> methods.
</li><li class="listitem">
Configuration classes may declare <code class="literal">@Import</code> with regular component classes now, allowing
for a mix of imported configuration classes and component classes.
</li><li class="listitem">
Configuration classes may declare an <code class="literal">@Order</code> value, getting processed in a corresponding
order (e.g. for overriding beans by name) even when detected through classpath scanning.
</li><li class="listitem">
<code class="literal">@Resource</code> injection points support an <code class="literal">@Lazy</code> declaration, analogous to <code class="literal">@Autowired</code>,
receiving a lazy-initializing proxy for the requested target bean.
</li><li class="listitem">
<p class="simpara">The application event infrastructure now offers an <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-annotation" title="Annotation-based Event Listeners">annotation-based model</a> as well as the ability to publish any arbitrary event.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
Any public method in a managed bean can be annotated with <code class="literal">@EventListener</code> to consume events.
</li><li class="listitem">
<code class="literal">@TransactionalEventListener</code> provides transaction-bound event support.
</li></ul></div>
</li><li class="listitem">
<p class="simpara">Spring Framework 4.2 introduces first-class support for declaring and
looking up aliases for annotation attributes. The new <code class="literal">@AliasFor</code>
annotation can be used to declare a pair of aliased attributes within
a single annotation or to declare an alias from one attribute in a
custom composed annotation to an attribute in a meta-annotation.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
The following annotations have been retrofitted with <code class="literal">@AliasFor</code> support
in order to provide meaningful aliases for their <code class="literal">value</code> attributes:
<code class="literal">@Cacheable</code>, <code class="literal">@CacheEvict</code>, <code class="literal">@CachePut</code>, <code class="literal">@ComponentScan</code>,
<code class="literal">@ComponentScan.Filter</code>, <code class="literal">@ImportResource</code>, <code class="literal">@Scope</code>, <code class="literal">@ManagedResource</code>,
<code class="literal">@Header</code>, <code class="literal">@Payload</code>, <code class="literal">@SendToUser</code>, <code class="literal">@ActiveProfiles</code>,
<code class="literal">@ContextConfiguration</code>, <code class="literal">@Sql</code>, <code class="literal">@TestExecutionListeners</code>,
<code class="literal">@TestPropertySource</code>, <code class="literal">@Transactional</code>, <code class="literal">@ControllerAdvice</code>,
<code class="literal">@CookieValue</code>, <code class="literal">@CrossOrigin</code>, <code class="literal">@MatrixVariable</code>, <code class="literal">@RequestHeader</code>,
<code class="literal">@RequestMapping</code>, <code class="literal">@RequestParam</code>, <code class="literal">@RequestPart</code>, <code class="literal">@ResponseStatus</code>,
<code class="literal">@SessionAttributes</code>, <code class="literal">@ActionMapping</code>, <code class="literal">@RenderMapping</code>,
<code class="literal">@EventListener</code>, <code class="literal">@TransactionalEventListener</code>.
</li><li class="listitem">
<p class="simpara">For example, <code class="literal">@ContextConfiguration</code> from the <code class="literal">spring-test</code> module
is now declared as follows:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> ContextConfiguration {

    <em><span class="hl-annotation" style="color: gray">@AliasFor("locations")</span></em>
    String[] value() <span class="hl-keyword">default</span> {};

    <em><span class="hl-annotation" style="color: gray">@AliasFor("value")</span></em>
    String[] locations() <span class="hl-keyword">default</span> {};

    <span class="hl-comment">// ...</span>
}</pre>
</li><li class="listitem">
Similarly, <span class="emphasis"><em>composed annotations</em></span> that override attributes from
meta-annotations can now use <code class="literal">@AliasFor</code> for fine-grained control
over exactly which attributes are overridden within an annotation
hierarchy. In fact, it is now possible to declare an alias for the
<code class="literal">value</code> attribute of a meta-annotation.
</li><li class="listitem">
<p class="simpara">For example, one can now develop a composed annotation with a custom
attribute override as follows.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> MyTestConfig {

    <em><span class="hl-annotation" style="color: gray">@AliasFor(annotation = ContextConfiguration.class, attribute = "value")</span></em>
    String[] xmlFiles();

    <span class="hl-comment">// ...</span>
}</pre>
</li><li class="listitem">
See <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#annotation-programming-model" title="38. Spring Annotation Programming Model">Spring Annotation Programming Model</a>.
</li></ul></div>
</li><li class="listitem">
Numerous improvements to Spring’s search algorithms used for finding
meta-annotations. For example, locally declared <span class="emphasis"><em>composed annotations</em></span>
are now favored over inherited annotations.
</li><li class="listitem">
<span class="emphasis"><em>Composed annotations</em></span> that override attributes from meta-annotations
can now be discovered on interfaces and on abstract, bridge, &amp; interface
methods as well as on classes, standard methods, constructors, and
fields.
</li><li class="listitem">
Maps representing annotation attributes (and <code class="literal">AnnotationAttributes</code> instances)
can be <span class="emphasis"><em>synthesized</em></span> (i.e., converted) into an annotation.
</li><li class="listitem">
The features of field-based data binding (<code class="literal">DirectFieldAccessor</code>) have been aligned with the current
property-based data binding (<code class="literal">BeanWrapper</code>). In particular, field-based binding now supports
navigation for Collections, Arrays, and Maps.
</li><li class="listitem">
<code class="literal">DefaultConversionService</code> now provides out-of-the-box converters for <code class="literal">Stream</code>, <code class="literal">Charset</code>,
<code class="literal">Currency</code>, and <code class="literal">TimeZone</code>. Such converters can be added individually to any arbitrary
<code class="literal">ConversionService</code> as well.
</li><li class="listitem">
<code class="literal">DefaultFormattingConversionService</code> comes with out-of-the-box support for the value types
in JSR-354 Money &amp; Currency (if the 'javax.money' API is present on the classpath): namely,
<code class="literal">MonetaryAmount</code> and <code class="literal">CurrencyUnit</code>. This includes support for applying <code class="literal">@NumberFormat</code>.
</li><li class="listitem">
<code class="literal">@NumberFormat</code> can now be used as a meta-annotation.
</li><li class="listitem">
<code class="literal">JavaMailSenderImpl</code> has a new <code class="literal">testConnection()</code> method for checking connectivity to the server.
</li><li class="listitem">
<code class="literal">ScheduledTaskRegistrar</code> exposes scheduled tasks.
</li><li class="listitem">
Apache <code class="literal">commons-pool2</code> is now supported for a pooling AOP <code class="literal">CommonsPool2TargetSource</code>.
</li><li class="listitem">
Introduced <code class="literal">StandardScriptFactory</code> as a JSR-223 based mechanism for scripted beans,
exposed through the <code class="literal">lang:std</code> element in XML. Supports e.g. JavaScript and JRuby.
(Note: JRubyScriptFactory and <code class="literal">lang:jruby</code> are deprecated now, in favor of using JSR-223.)
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_data_access_improvements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_data_access_improvements"></a>5.2&nbsp;Data Access Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">javax.transaction.Transactional</code> is now supported via AspectJ.
</li><li class="listitem">
<code class="literal">SimpleJdbcCallOperations</code> now supports named binding.
</li><li class="listitem">
Full support for Hibernate ORM 5.0: as a JPA provider (automatically adapted) as well as
through its native API (covered by the new <code class="literal">org.springframework.orm.hibernate5</code> package).
</li><li class="listitem">
Embedded databases can now be automatically assigned unique names, and
<code class="literal">&lt;jdbc:embedded-database&gt;</code> supports a new <code class="literal">database-name</code> attribute.
See "Testing Improvements" below for further details.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_jms_improvements_2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_jms_improvements_2"></a>5.3&nbsp;JMS Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The <code class="literal">autoStartup</code> attribute can be controlled via <code class="literal">JmsListenerContainerFactory</code>.
</li><li class="listitem">
The type of the reply <code class="literal">Destination</code> can now be configured per listener container.
</li><li class="listitem">
The value of the <code class="literal">@SendTo</code> annotation can now use a SpEL expression.
</li><li class="listitem">
The response destination can be <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-annotated-response" title="30.6.4 Response management">computed at runtime using <code class="literal">JmsResponse</code></a>
</li><li class="listitem">
<code class="literal">@JmsListener</code> is now a repeatable annotation to declare several JMS containers on the same
method (use the newly introduced <code class="literal">@JmsListeners</code> if you’re not using Java8 yet).
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_web_improvements_2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_web_improvements_2"></a>5.4&nbsp;Web Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
HTTP Streaming and Server-Sent Events support, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-async-http-streaming" title="HTTP Streaming">the section called “HTTP Streaming”</a>.
</li><li class="listitem">
Built-in support for CORS including global (MVC Java config and XML namespace) and
local (e.g. <code class="literal">@CrossOrigin</code>) configuration. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cors" title="27. CORS Support">Chapter&nbsp;27, <i>CORS Support</i></a> for details.
</li><li class="listitem">
<p class="simpara">HTTP caching updates:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
new <code class="literal">CacheControl</code> builder; plugged into <code class="literal">ResponseEntity</code>, <code class="literal">WebContentGenerator</code>,
<code class="literal">ResourceHttpRequestHandler</code>.
</li><li class="listitem">
improved ETag/Last-Modified support in <code class="literal">WebRequest</code>.
</li></ul></div>
</li><li class="listitem">
Custom mapping annotations, using <code class="literal">@RequestMapping</code> as a meta-annotation.
</li><li class="listitem">
Public methods in <code class="literal">AbstractHandlerMethodMapping</code> to register and unregister request
mappings at runtime.
</li><li class="listitem">
Protected <code class="literal">createDispatcherServlet</code> method in <code class="literal">AbstractDispatcherServletInitializer</code> to
further customize the <code class="literal">DispatcherServlet</code> instance to use.
</li><li class="listitem">
<code class="literal">HandlerMethod</code> as a method argument on <code class="literal">@ExceptionHandler</code> methods, especially
handy in <code class="literal">@ControllerAdvice</code> components.
</li><li class="listitem">
<code class="literal">java.util.concurrent.CompletableFuture</code> as an <code class="literal">@Controller</code> method return value type.
</li><li class="listitem">
Byte-range request support in <code class="literal">HttpHeaders</code> and for serving static resources.
</li><li class="listitem">
<code class="literal">@ResponseStatus</code> detected on nested exceptions.
</li><li class="listitem">
<p class="simpara"><code class="literal">UriTemplateHandler</code> extension point in the <code class="literal">RestTemplate</code>.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
<code class="literal">DefaultUriTemplateHandler</code> exposes <code class="literal">baseUrl</code> property and path segment encoding options.
</li><li class="listitem">
the extension point can also be used to plug in any URI template library.
</li></ul></div>
</li><li class="listitem">
<a class="ulink" href="https://square.github.io/okhttp/" target="_top">OkHTTP</a> integration with the <code class="literal">RestTemplate</code>.
</li><li class="listitem">
Custom <code class="literal">baseUrl</code> alternative for methods in <code class="literal">MvcUriComponentsBuilder</code>.
</li><li class="listitem">
Serialization/deserialization exception messages are now logged at WARN level.
</li><li class="listitem">
Default JSON prefix has been changed from "{} &amp;&amp; " to the safer ")]}', " one.
</li><li class="listitem">
New <code class="literal">RequestBodyAdvice</code> extension point and built-in implementation to support Jackson’s
<code class="literal">@JsonView</code> on <code class="literal">@RequestBody</code> method arguments.
</li><li class="listitem">
When using GSON or Jackson 2.6+, the handler method return type is used to improve
serialization of parameterized types like <code class="literal">List&lt;Foo&gt;</code>.
</li><li class="listitem">
Introduced <code class="literal">ScriptTemplateView</code> as a JSR-223 based mechanism for scripted web views,
with a focus on JavaScript view templating on Nashorn (JDK 8).
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_websocket_messaging_improvements_2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_websocket_messaging_improvements_2"></a>5.5&nbsp;WebSocket Messaging Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p class="simpara">Expose presence information about connected users and subscriptions:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
new <code class="literal">SimpUserRegistry</code> exposed as a bean named "userRegistry".
</li><li class="listitem">
sharing of presence information across cluster of servers (see broker relay config options).
</li></ul></div>
</li><li class="listitem">
Resolve user destinations across cluster of servers (see broker relay config options).
</li><li class="listitem">
<code class="literal">StompSubProtocolErrorHandler</code> extension point to customize and control STOMP ERROR frames to clients.
</li><li class="listitem">
Global <code class="literal">@MessageExceptionHandler</code> methods via <code class="literal">@ControllerAdvice</code> components.
</li><li class="listitem">
Heart-beats and a SpEL expression 'selector' header for subscriptions with <code class="literal">SimpleBrokerMessageHandler</code>.
</li><li class="listitem">
STOMP client for use over TCP and WebSocket; see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-client" title="26.4.14 STOMP Client">Section&nbsp;26.4.14, “STOMP Client”</a>.
</li><li class="listitem">
<code class="literal">@SendTo</code> and <code class="literal">@SendToUser</code> can contain destination variable placeholders.
</li><li class="listitem">
Jackson’s <code class="literal">@JsonView</code> supported for return values on <code class="literal">@MessageMapping</code> and <code class="literal">@SubscribeMapping</code> methods.
</li><li class="listitem">
<code class="literal">ListenableFuture</code> and <code class="literal">CompletableFuture</code> as return value types from
<code class="literal">@MessageMapping</code> and <code class="literal">@SubscribeMapping</code> methods.
</li><li class="listitem">
<code class="literal">MarshallingMessageConverter</code> for XML payloads.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_testing_improvements_3" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testing_improvements_3"></a>5.6&nbsp;Testing Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p class="simpara">JUnit-based integration tests can now be executed with JUnit rules instead of the
<code class="literal">SpringJUnit4ClassRunner</code>. This allows Spring-based integration tests to be run with
alternative runners like JUnit’s <code class="literal">Parameterized</code> or third-party runners such as the
<code class="literal">MockitoJUnitRunner</code>.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-junit4-rules" title="Spring JUnit 4 Rules">the section called “Spring JUnit 4 Rules”</a> for details.
</li></ul></div>
</li><li class="listitem">
<p class="simpara">The Spring MVC Test framework now provides first-class support for HtmlUnit,
including integration with Selenium’s WebDriver, allowing for page-based
web application testing without the need to deploy to a Servlet container.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit" title="15.6.2 HtmlUnit Integration">Section&nbsp;15.6.2, “HtmlUnit Integration”</a> for details.
</li></ul></div>
</li><li class="listitem">
<p class="simpara"><code class="literal">AopTestUtils</code> is a new testing utility that allows developers to
obtain a reference to the underlying target object hidden behind one
or more Spring proxies.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing-utilities" title="14.2.1 General testing utilities">Section&nbsp;14.2.1, “General testing utilities”</a> for details.
</li></ul></div>
</li><li class="listitem">
<code class="literal">ReflectionTestUtils</code> now supports setting and getting <code class="literal">static</code> fields,
including constants.
</li><li class="listitem">
The original ordering of bean definition profiles declared via
<code class="literal">@ActiveProfiles</code> is now retained in order to support use cases such
as Spring Boot’s <code class="literal">ConfigFileApplicationListener</code> which loads
configuration files based on the names of active profiles.
</li><li class="listitem">
<code class="literal">@DirtiesContext</code> supports new <code class="literal">BEFORE_METHOD</code>, <code class="literal">BEFORE_CLASS</code>, and
<code class="literal">BEFORE_EACH_TEST_METHOD</code> modes for closing the <code class="literal">ApplicationContext</code>
<span class="emphasis"><em>before</em></span> a test&#8201;—&#8201;for example, if some rogue (i.e., yet to be
determined) test within a large test suite has corrupted the original
configuration for the <code class="literal">ApplicationContext</code>.
</li><li class="listitem">
<code class="literal">@Commit</code> is a new annotation that may be used as a direct replacement for
<code class="literal">@Rollback(false)</code>.
</li><li class="listitem">
<p class="simpara"><code class="literal">@Rollback</code> may now be used to configure class-level <span class="emphasis"><em>default rollback</em></span> semantics.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
Consequently, <code class="literal">@TransactionConfiguration</code> is now deprecated and will be removed in a
subsequent release.
</li></ul></div>
</li><li class="listitem">
<code class="literal">@Sql</code> now supports execution of <span class="emphasis"><em>inlined SQL statements</em></span> via a new
<code class="literal">statements</code> attribute.
</li><li class="listitem">
The <code class="literal">ContextCache</code> that is used for caching <code class="literal">ApplicationContext</code>s
between tests is now a public API with a default implementation that
can be replaced for custom caching needs.
</li><li class="listitem">
<code class="literal">DefaultTestContext</code>, <code class="literal">DefaultBootstrapContext</code>, and
<code class="literal">DefaultCacheAwareContextLoaderDelegate</code> are now public classes in the
<code class="literal">support</code> subpackage, allowing for custom extensions.
</li><li class="listitem">
<code class="literal">TestContextBootstrapper</code>s are now responsible for building the
<code class="literal">TestContext</code>.
</li><li class="listitem">
In the Spring MVC Test framework, <code class="literal">MvcResult</code> details can now be logged
at <code class="literal">DEBUG</code> level or written to a custom <code class="literal">OutputStream</code> or <code class="literal">Writer</code>. See
the new <code class="literal">log()</code>, <code class="literal">print(OutputStream)</code>, and <code class="literal">print(Writer)</code> methods in
<code class="literal">MockMvcResultHandlers</code> for details.
</li><li class="listitem">
The JDBC XML namespace supports a new <code class="literal">database-name</code> attribute in
<code class="literal">&lt;jdbc:embedded-database&gt;</code>, allowing developers to set unique names
for embedded databases –- for example, via a SpEL expression or a
property placeholder that is influenced by the current active bean
definition profiles.
</li><li class="listitem">
<p class="simpara">Embedded databases can now be automatically assigned a unique name,
allowing common test database configuration to be reused in different
<code class="literal">ApplicationContext</code>s within a test suite.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-unique-names" title="19.8.6 Generating unique names for embedded databases">Section&nbsp;19.8.6, “Generating unique names for embedded databases”</a> for details.
</li></ul></div>
</li><li class="listitem">
<code class="literal">MockHttpServletRequest</code> and <code class="literal">MockHttpServletResponse</code> now provide better
support for date header formatting via the <code class="literal">getDateHeader</code> and <code class="literal">setDateHeader</code>
methods.
</li></ul></div>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="new-in-4.3" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#new-in-4.3"></a>6.&nbsp;New Features and Enhancements in Spring Framework 4.3</h2></div></div></div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_core_container_improvements_3" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_core_container_improvements_3"></a>6.1&nbsp;Core Container Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Core container exceptions provide richer metadata to evaluate programmatically.
</li><li class="listitem">
Java 8 default methods get detected as bean property getters/setters.
</li><li class="listitem">
Lazy candidate beans are not being created in case of injecting a primary bean.
</li><li class="listitem">
It is no longer necessary to specify the <code class="literal">@Autowired</code> annotation if the target
bean only defines one constructor.
</li><li class="listitem">
<code class="literal">@Configuration</code> classes support constructor injection.
</li><li class="listitem">
Any SpEL expression used to specify the <code class="literal">condition</code> of an <code class="literal">@EventListener</code> can
now refer to beans (e.g. <code class="literal">@beanName.method()</code>).
</li><li class="listitem">
<span class="emphasis"><em>Composed annotations</em></span> can now override array attributes in meta-annotations
with a single element of the component type of the array. For example, the
<code class="literal">String[] path</code> attribute of <code class="literal">@RequestMapping</code> can be overridden with
<code class="literal">String path</code> in a composed annotation.
</li><li class="listitem">
<code class="literal">@PersistenceContext</code>/<code class="literal">@PersistenceUnit</code> selects a primary <code class="literal">EntityManagerFactory</code>
bean if declared as such.
</li><li class="listitem">
<code class="literal">@Scheduled</code> and <code class="literal">@Schedules</code> may now be used as <span class="emphasis"><em>meta-annotations</em></span> to create
custom <span class="emphasis"><em>composed annotations</em></span> with attribute overrides.
</li><li class="listitem">
<code class="literal">@Scheduled</code> is properly supported on beans of any scope.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_data_access_improvements_2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_data_access_improvements_2"></a>6.2&nbsp;Data Access Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">jdbc:initialize-database</code> and <code class="literal">jdbc:embedded-database</code> support a configurable
separator to be applied to each script.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_caching_improvements_2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_caching_improvements_2"></a>6.3&nbsp;Caching Improvements</h2></div></div></div>
<p>Spring 4.3 allows concurrent calls on a given key to be synchronized so that the
value is only computed once. This is an opt-in feature that should be enabled via
the new <code class="literal">sync</code> attribute on <code class="literal">@Cacheable</code>. This features introduces a breaking
change in the <code class="literal">Cache</code> interface as a <code class="literal">get(Object key, Callable&lt;T&gt; valueLoader)</code>
method has been added.</p>
<p>Spring 4.3 also improves the caching abstraction as follows:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
SpEL expressions in caches-related annotations can now refer to beans (i.e.
<code class="literal">@beanName.method()</code>).
</li><li class="listitem">
<code class="literal">ConcurrentMapCacheManager</code> and <code class="literal">ConcurrentMapCache</code> now support the serialization
of cache entries via a new <code class="literal">storeByValue</code> attribute.
</li><li class="listitem">
<code class="literal">@Cacheable</code>, <code class="literal">@CacheEvict</code>, <code class="literal">@CachePut</code>, and <code class="literal">@Caching</code> may now be used as
<span class="emphasis"><em>meta-annotations</em></span> to create custom <span class="emphasis"><em>composed annotations</em></span> with attribute overrides.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_jms_improvements_3" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_jms_improvements_3"></a>6.4&nbsp;JMS Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">@SendTo</code> can now be specified at the class level to share a common reply destination.
</li><li class="listitem">
<code class="literal">@JmsListener</code> and <code class="literal">@JmsListeners</code> may now be used as <span class="emphasis"><em>meta-annotations</em></span> to create
custom <span class="emphasis"><em>composed annotations</em></span> with attribute overrides.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_web_improvements_3" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_web_improvements_3"></a>6.5&nbsp;Web Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Built-in support for <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-head-options" title="HTTP HEAD and HTTP OPTIONS">HTTP HEAD and HTTP OPTIONS</a>.
</li><li class="listitem">
<p class="simpara">New <code class="literal">@GetMapping</code>, <code class="literal">@PostMapping</code>, <code class="literal">@PutMapping</code>, <code class="literal">@DeleteMapping</code>, and <code class="literal">@PatchMapping</code>
<span class="emphasis"><em>composed annotations</em></span> for <code class="literal">@RequestMapping</code>.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-composed" title="Composed @RequestMapping Variants">Composed @RequestMapping Variants</a> for details.
</li></ul></div>
</li><li class="listitem">
<p class="simpara">New <code class="literal">@RequestScope</code>, <code class="literal">@SessionScope</code>, and <code class="literal">@ApplicationScope</code> <span class="emphasis"><em>composed annotations</em></span>
for web scopes.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
See <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-request" title="Request scope">Request scope</a>,
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-session" title="Session scope">Session scope</a>, and
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-application" title="Application scope">Application scope</a> for details.
</li></ul></div>
</li><li class="listitem">
New <code class="literal">@RestControllerAdvice</code> annotation with combined <code class="literal">@ControllerAdvice</code> with <code class="literal">@ResponseBody</code> semantics.
</li><li class="listitem">
<code class="literal">@ResponseStatus</code> is now supported at the class level and inherited by all methods.
</li><li class="listitem">
New <code class="literal">@SessionAttribute</code> annotation for access to session attributes (see <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-sessionattrib-global" title="Using @SessionAttribute to access pre-existing global session attributes">example</a>).
</li><li class="listitem">
New <code class="literal">@RequestAttribute</code> annotation for access to request attributes (see <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-requestattrib" title="Using @RequestAttribute to access request attributes">example</a>).
</li><li class="listitem">
<code class="literal">@ModelAttribute</code> allows preventing data binding via <code class="literal">binding=false</code> attribute (see <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-ann-modelattrib-method-args" title="Using @ModelAttribute on a method argument">reference</a>).
</li><li class="listitem">
<code class="literal">@PathVariable</code> may be declared as optional (for use on <code class="literal">@ModelAttribute</code> methods).
</li><li class="listitem">
Consistent exposure of Errors and custom Throwables to MVC exception handlers.
</li><li class="listitem">
Consistent charset handling in HTTP message converters, including a UTF-8 default for multipart text content.
</li><li class="listitem">
Static resource handling uses the configured <code class="literal">ContentNegotiationManager</code> for media type determination.
</li><li class="listitem">
<code class="literal">RestTemplate</code> and <code class="literal">AsyncRestTemplate</code> support strict URI variable encoding via <code class="literal">DefaultUriTemplateHandler</code>.
</li><li class="listitem">
<code class="literal">AsyncRestTemplate</code> supports request interception.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_websocket_messaging_improvements_3" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_websocket_messaging_improvements_3"></a>6.6&nbsp;WebSocket Messaging Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">@SendTo</code> and <code class="literal">@SendToUser</code> can now be specified at class-level to share a common destination.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_testing_improvements_4" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testing_improvements_4"></a>6.7&nbsp;Testing Improvements</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The JUnit support in the <span class="emphasis"><em>Spring TestContext Framework</em></span> now requires JUnit 4.12 or higher.
</li><li class="listitem">
New <code class="literal">SpringRunner</code> <span class="emphasis"><em>alias</em></span> for the <code class="literal">SpringJUnit4ClassRunner</code>.
</li><li class="listitem">
Test related annotations may now be declared on interfaces&#8201;—&#8201;for example, for use with
<span class="emphasis"><em>test interfaces</em></span> that make use of Java 8 based interface default methods.
</li><li class="listitem">
An empty declaration of <code class="literal">@ContextConfiguration</code> can now be completely omitted if default
XML files, Groovy scripts, or <code class="literal">@Configuration</code> classes are detected.
</li><li class="listitem">
<code class="literal">@Transactional</code> test methods are no longer required to be <code class="literal">public</code> (e.g., in TestNG and JUnit 5).
</li><li class="listitem">
<code class="literal">@BeforeTransaction</code> and <code class="literal">@AfterTransaction</code> methods are no longer required to be <code class="literal">public</code>
and may now be declared on Java 8 based interface default methods.
</li><li class="listitem">
The <code class="literal">ApplicationContext</code> cache in the <span class="emphasis"><em>Spring TestContext Framework</em></span> is now bounded with a
default maximum size of 32 and a <span class="emphasis"><em>least recently used</em></span> eviction policy. The maximum size
can be configured by setting a JVM system property or Spring property called
<code class="literal">spring.test.context.cache.maxSize</code>.
</li><li class="listitem">
New <code class="literal">ContextCustomizer</code> API for customizing a test <code class="literal">ApplicationContext</code> <span class="emphasis"><em>after</em></span> bean
definitions have been loaded into the context but <span class="emphasis"><em>before</em></span> the context has been refreshed.
Customizers can be registered globally by third parties, foregoing the need to implement a
custom <code class="literal">ContextLoader</code>.
</li><li class="listitem">
<code class="literal">@Sql</code> and <code class="literal">@SqlGroup</code> may now be used as <span class="emphasis"><em>meta-annotations</em></span> to create custom <span class="emphasis"><em>composed
annotations</em></span> with attribute overrides.
</li><li class="listitem">
<code class="literal">ReflectionTestUtils</code> now automatically unwraps proxies when setting or getting a field.
</li><li class="listitem">
Server-side Spring MVC Test supports expectations on response headers with multiple values.
</li><li class="listitem">
Server-side Spring MVC Test parses form data request content and populates request parameters.
</li><li class="listitem">
Server-side Spring MVC Test supports mock-like assertions for invoked handler methods.
</li><li class="listitem">
Client-side REST test support allows indicating how many times a request is expected and
whether the order of declaration for expectations should be ignored (see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-client" title="15.6.3 Client-Side REST Tests">Section&nbsp;15.6.3, “Client-Side REST Tests”</a>).
</li><li class="listitem">
Client-side REST Test supports expectations for form data in the request body.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_support_for_new_library_and_server_generations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_support_for_new_library_and_server_generations"></a>6.8&nbsp;Support for new library and server generations</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Hibernate ORM 5.2 (still supporting 4.2/4.3 and 5.0/5.1 as well, with 3.6 deprecated now)
</li><li class="listitem">
Hibernate Validator 5.3 (minimum remains at 4.3)
</li><li class="listitem">
Jackson 2.8 (minimum raised to Jackson 2.6+ as of Spring 4.3)
</li><li class="listitem">
OkHttp 3.x (still supporting OkHttp 2.x side by side)
</li><li class="listitem">
Tomcat 8.5 as well as 9.0 milestones
</li><li class="listitem">
Netty 4.1
</li><li class="listitem">
Undertow 1.4
</li><li class="listitem">
WildFly 10.1
</li></ul></div>
<p>Furthermore, Spring Framework 4.3 embeds the updated ASM 5.1, CGLIB 3.2.4, and Objenesis 2.4
in <code class="literal">spring-core.jar</code>.</p>
</div>
</div>
</div>
<div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="spring-core" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-core"></a>Part&nbsp;III.&nbsp;Core Technologies</h1></div></div></div>
<div class="partintro"><div></div>
<p>This part of the reference documentation covers all of those technologies that are
absolutely integral to the Spring Framework.</p>
<p>Foremost amongst these is the Spring Framework’s Inversion of Control (IoC) container. A
thorough treatment of the Spring Framework’s IoC container is closely followed by
comprehensive coverage of Spring’s Aspect-Oriented Programming (AOP) technologies. The
Spring Framework has its own AOP framework, which is conceptually easy to understand,
and which successfully addresses the 80% sweet spot of AOP requirements in Java
enterprise programming.</p>
<p>Coverage of Spring’s integration with AspectJ (currently the richest - in terms of
features - and certainly most mature AOP implementation in the Java enterprise space) is
also provided.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans" title="7. The IoC container">Chapter&nbsp;7, <i>The IoC container</i></a>
</li><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources" title="8. Resources">Chapter&nbsp;8, <i>Resources</i></a>
</li><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation" title="9. Validation, Data Binding, and Type Conversion">Chapter&nbsp;9, <i>Validation, Data Binding, and Type Conversion</i></a>
</li><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions" title="10. Spring Expression Language (SpEL)">Chapter&nbsp;10, <i>Spring Expression Language (SpEL)</i></a>
</li><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop" title="11. Aspect Oriented Programming with Spring">Chapter&nbsp;11, <i>Aspect Oriented Programming with Spring</i></a>
</li><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api" title="12. Spring AOP APIs">Chapter&nbsp;12, <i>Spring AOP APIs</i></a>
</li></ul></div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="beans" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans"></a>7.&nbsp;The IoC container</h2></div></div></div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-introduction"></a>7.1&nbsp;Introduction to the Spring IoC container and beans</h2></div></div></div>
<p>This chapter covers the Spring Framework implementation of the Inversion of Control
(IoC) <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ftn.d5e1761" class="footnote" name="d5e1761"><sup class="footnote">[1]</sup></a> principle. IoC
is also known as <span class="emphasis"><em>dependency injection</em></span> (DI). It is a process whereby objects define
their dependencies, that is, the other objects they work with, only through constructor
arguments, arguments to a factory method, or properties that are set on the object
instance after it is constructed or returned from a factory method. The container then
<span class="emphasis"><em>injects</em></span> those dependencies when it creates the bean. This process is fundamentally
the inverse, hence the name <span class="emphasis"><em>Inversion of Control</em></span> (IoC), of the bean itself
controlling the instantiation or location of its dependencies by using direct
construction of classes, or a mechanism such as the <span class="emphasis"><em>Service Locator</em></span> pattern.</p>
<p>The <code class="literal">org.springframework.beans</code> and <code class="literal">org.springframework.context</code> packages are the basis
for Spring Framework’s IoC container. The
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/beans/factory/BeanFactory.html" target="_top"><code class="literal">BeanFactory</code></a>
interface provides an advanced configuration mechanism capable of managing any type of
object.
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/ApplicationContext.html" target="_top"><code class="literal">ApplicationContext</code></a>
is a sub-interface of <code class="literal">BeanFactory</code>. It adds easier integration with Spring’s AOP
features; message resource handling (for use in internationalization), event
publication; and application-layer specific contexts such as the <code class="literal">WebApplicationContext</code>
for use in web applications.</p>
<p>In short, the <code class="literal">BeanFactory</code> provides the configuration framework and basic
functionality, and the <code class="literal">ApplicationContext</code> adds more enterprise-specific functionality.
The <code class="literal">ApplicationContext</code> is a complete superset of the <code class="literal">BeanFactory</code>, and is used
exclusively in this chapter in descriptions of Spring’s IoC container. For more
information on using the <code class="literal">BeanFactory</code> instead of the <code class="literal">ApplicationContext,</code> refer to
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanfactory" title="7.16 The BeanFactory">Section&nbsp;7.16, “The BeanFactory”</a>.</p>
<p>In Spring, the objects that form the backbone of your application and that are managed
by the Spring IoC <span class="emphasis"><em>container</em></span> are called <span class="emphasis"><em>beans</em></span>. A bean is an object that is
instantiated, assembled, and otherwise managed by a Spring IoC container. Otherwise, a
bean is simply one of many objects in your application. Beans, and the <span class="emphasis"><em>dependencies</em></span>
among them, are reflected in the <span class="emphasis"><em>configuration metadata</em></span> used by a container.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-basics" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-basics"></a>7.2&nbsp;Container overview</h2></div></div></div>
<p>The interface <code class="literal">org.springframework.context.ApplicationContext</code> represents the Spring IoC
container and is responsible for instantiating, configuring, and assembling the
aforementioned beans. The container gets its instructions on what objects to
instantiate, configure, and assemble by reading configuration metadata. The
configuration metadata is represented in XML, Java annotations, or Java code. It allows
you to express the objects that compose your application and the rich interdependencies
between such objects.</p>
<p>Several implementations of the <code class="literal">ApplicationContext</code> interface are supplied
out-of-the-box with Spring. In standalone applications it is common to create an
instance of
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html" target="_top"><code class="literal">ClassPathXmlApplicationContext</code></a>
or <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/support/FileSystemXmlApplicationContext.html" target="_top"><code class="literal">FileSystemXmlApplicationContext</code></a>.
While XML has been the traditional format for defining configuration metadata you can
instruct the container to use Java annotations or code as the metadata format by
providing a small amount of XML configuration to declaratively enable support for these
additional metadata formats.</p>
<p>In most application scenarios, explicit user code is not required to instantiate one or
more instances of a Spring IoC container. For example, in a web application scenario, a
simple eight (or so) lines of boilerplate web descriptor XML in the <code class="literal">web.xml</code> file
of the application will typically suffice (see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-create" title="7.15.4 Convenient ApplicationContext instantiation for web applications">Section&nbsp;7.15.4, “Convenient ApplicationContext instantiation for web applications”</a>). If you are using the
<a class="ulink" href="https://spring.io/tools/sts" target="_top">Spring Tool Suite</a> Eclipse-powered development
environment this boilerplate configuration can be easily created with few mouse clicks or
keystrokes.</p>
<p>The following diagram is a high-level view of how Spring works. Your application classes
are combined with configuration metadata so that after the <code class="literal">ApplicationContext</code> is
created and initialized, you have a fully configured and executable system or
application.</p>
<div class="figure"><a name="d5e1806" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e1806"></a><p class="title"><b>Figure&nbsp;7.1.&nbsp;The Spring IoC container</b></p><div class="figure-contents">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/container-magic.png.pagespeed.ce.-0JjaOG5As.png" alt="container magic"></div>
</div></div><br class="figure-break">
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-metadata" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-metadata"></a>7.2.1&nbsp;Configuration metadata</h3></div></div></div>
<p>As the preceding diagram shows, the Spring IoC container consumes a form of
<span class="emphasis"><em>configuration metadata</em></span>; this configuration metadata represents how you as an
application developer tell the Spring container to instantiate, configure, and assemble
the objects in your application.</p>
<p>Configuration metadata is traditionally supplied in a simple and intuitive XML format,
which is what most of this chapter uses to convey key concepts and features of the
Spring IoC container.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>XML-based metadata is <span class="emphasis"><em>not</em></span> the only allowed form of configuration metadata. The
Spring IoC container itself is <span class="emphasis"><em>totally</em></span> decoupled from the format in which this
configuration metadata is actually written. These days many developers choose
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java" title="7.12 Java-based container configuration">Java-based configuration</a> for their Spring applications.</p>
</td></tr></tbody></table></div>
<p>For information about using other forms of metadata with the Spring container, see:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-annotation-config" title="7.9 Annotation-based container configuration">Annotation-based configuration</a>: Spring 2.5 introduced
support for annotation-based configuration metadata.
</li><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java" title="7.12 Java-based container configuration">Java-based configuration</a>: Starting with Spring 3.0, many features
provided by the Spring JavaConfig project became part of the core Spring Framework.
Thus you can define beans external to your application classes by using Java rather
than XML files. To use these new features, see the <code class="literal">@Configuration</code>, <code class="literal">@Bean</code>, <code class="literal">@Import</code>
and <code class="literal">@DependsOn</code> annotations.
</li></ul></div>
<p>Spring configuration consists of at least one and typically more than one bean
definition that the container must manage. XML-based configuration metadata shows these
beans configured as <code class="literal">&lt;bean/&gt;</code> elements inside a top-level <code class="literal">&lt;beans/&gt;</code> element. Java
configuration typically uses <code class="literal">@Bean</code> annotated methods within a <code class="literal">@Configuration</code> class.</p>
<p>These bean definitions correspond to the actual objects that make up your application.
Typically you define service layer objects, data access objects (DAOs), presentation
objects such as Struts <code class="literal">Action</code> instances, infrastructure objects such as Hibernate
<code class="literal">SessionFactories</code>, JMS <code class="literal">Queues</code>, and so forth. Typically one does not configure
fine-grained domain objects in the container, because it is usually the responsibility
of DAOs and business logic to create and load domain objects. However, you can use
Spring’s integration with AspectJ to configure objects that have been created outside
the control of an IoC container. See <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-atconfigurable" title="11.8.1 Using AspectJ to dependency inject domain objects with Spring">Using AspectJ to
dependency-inject domain objects with Spring</a>.</p>
<p>The following example shows the basic structure of XML-based configuration metadata:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- more bean definitions go here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The <code class="literal">id</code> attribute is a string that you use to identify the individual bean definition.
The <code class="literal">class</code> attribute defines the type of the bean and uses the fully qualified
classname. The value of the id attribute refers to collaborating objects. The XML for
referring to collaborating objects is not shown in this example; see
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-dependencies" title="7.4 Dependencies">Dependencies</a> for more information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-instantiation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-instantiation"></a>7.2.2&nbsp;Instantiating a container</h3></div></div></div>
<p>Instantiating a Spring IoC container is straightforward. The location path or paths
supplied to an <code class="literal">ApplicationContext</code> constructor are actually resource strings that allow
the container to load configuration metadata from a variety of external resources such
as the local file system, from the Java <code class="literal">CLASSPATH</code>, and so on.</p>
<pre class="programlisting">ApplicationContext context =
    <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-keyword">new</span> String[] {<span class="hl-string">"services.xml"</span>, <span class="hl-string">"daos.xml"</span>});</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>After you learn about Spring’s IoC container, you may want to know more about Spring’s
<code class="literal">Resource</code> abstraction, as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources" title="8. Resources">Chapter&nbsp;8, <i>Resources</i></a>, which provides a convenient
mechanism for reading an InputStream from locations defined in a URI syntax. In
particular, <code class="literal">Resource</code> paths are used to construct applications contexts as described in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx" title="8.7 Application contexts and Resource paths">Section&nbsp;8.7, “Application contexts and Resource paths”</a>.</p>
</td></tr></tbody></table></div>
<p>The following example shows the service layer objects <code class="literal">(services.xml)</code> configuration file:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- services --&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"petStore"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.jpetstore.services.PetStoreServiceImpl"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accountDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountDao"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"itemDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"itemDao"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- more bean definitions for services go here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The following example shows the data access objects <code class="literal">daos.xml</code> file:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountDao"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.jpetstore.dao.jpa.JpaAccountDao"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"itemDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.jpetstore.dao.jpa.JpaItemDao"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- more bean definitions for data access objects go here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>In the preceding example, the service layer consists of the class <code class="literal">PetStoreServiceImpl</code>,
and two data access objects of the type <code class="literal">JpaAccountDao</code> and <code class="literal">JpaItemDao</code> (based
on the JPA Object/Relational mapping standard). The <code class="literal">property name</code> element refers to the
name of the JavaBean property, and the <code class="literal">ref</code> element refers to the name of another bean
definition. This linkage between <code class="literal">id</code> and <code class="literal">ref</code> elements expresses the dependency between
collaborating objects. For details of configuring an object’s dependencies, see
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-dependencies" title="7.4 Dependencies">Dependencies</a>.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-xml-import" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-xml-import"></a>Composing XML-based configuration metadata</h4></div></div></div>
<p>It can be useful to have bean definitions span multiple XML files. Often each individual
XML configuration file represents a logical layer or module in your architecture.</p>
<p>You can use the application context constructor to load bean definitions from all these
XML fragments. This constructor takes multiple <code class="literal">Resource</code> locations, as was shown in the
previous section. Alternatively, use one or more occurrences of the <code class="literal">&lt;import/&gt;</code> element
to load bean definitions from another file or files. For example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"services.xml"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"resources/messageSource.xml"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"/resources/themeSource.xml"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bean1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bean2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>In the preceding example, external bean definitions are loaded from three files:
<code class="literal">services.xml</code>, <code class="literal">messageSource.xml</code>, and <code class="literal">themeSource.xml</code>. All location paths are
relative to the definition file doing the importing, so <code class="literal">services.xml</code> must be in the
same directory or classpath location as the file doing the importing, while
<code class="literal">messageSource.xml</code> and <code class="literal">themeSource.xml</code> must be in a <code class="literal">resources</code> location below the
location of the importing file. As you can see, a leading slash is ignored, but given
that these paths are relative, it is better form not to use the slash at all. The
contents of the files being imported, including the top level <code class="literal">&lt;beans/&gt;</code> element, must
be valid XML bean definitions according to the Spring Schema.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>It is possible, but not recommended, to reference files in parent directories using a
relative "../" path. Doing so creates a dependency on a file that is outside the current
application. In particular, this reference is not recommended for "classpath:" URLs (for
example, "classpath:../services.xml"), where the runtime resolution process chooses the
"nearest" classpath root and then looks into its parent directory. Classpath
configuration changes may lead to the choice of a different, incorrect directory.</p>
<p>You can always use fully qualified resource locations instead of relative paths: for
example, "file:C:/config/services.xml" or "classpath:/config/services.xml". However, be
aware that you are coupling your application’s configuration to specific absolute
locations. It is generally preferable to keep an indirection for such absolute
locations, for example, through "${…&#8203;}" placeholders that are resolved against JVM
system properties at runtime.</p>
</td></tr></tbody></table></div>
<p>The import directive is a feature provided by the beans namespace itself. Further
configuration features beyond plain bean definitions are available in a selection
of XML namespaces provided by Spring, e.g. the "context" and the "util" namespace.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="groovy-bean-definition-dsl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#groovy-bean-definition-dsl"></a>The Groovy Bean Definition DSL</h4></div></div></div>
<p>As a further example for externalized configuration metadata, bean definitions can also
be expressed in Spring’s Groovy Bean Definition DSL, as known from the Grails framework.
Typically, such configuration will live in a ".groovy" file with a structure as follows:</p>
<pre class="programlisting">beans {
    dataSource(BasicDataSource) {
        driverClassName = <span class="hl-string">"org.hsqldb.jdbcDriver"</span>
        url = <span class="hl-string">"jdbc:hsqldb:mem:grailsDB"</span>
        username = <span class="hl-string">"sa"</span>
        password = <span class="hl-string">""</span>
        settings = [mynew:<span class="hl-string">"setting"</span>]
    }
    sessionFactory(SessionFactory) {
        dataSource = dataSource
    }
    myService(MyService) {
        nestedBean = { AnotherBean bean -&gt;
            dataSource = dataSource
        }
    }
}</pre>
<p>This configuration style is largely equivalent to XML bean definitions and even
supports Spring’s XML configuration namespaces. It also allows for importing XML
bean definition files through an "importBeans" directive.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-client" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-client"></a>7.2.3&nbsp;Using the container</h3></div></div></div>
<p>The <code class="literal">ApplicationContext</code> is the interface for an advanced factory capable of maintaining
a registry of different beans and their dependencies. Using the method <code class="literal">T getBean(String
name, Class&lt;T&gt; requiredType)</code> you can retrieve instances of your beans.</p>
<p>The <code class="literal">ApplicationContext</code> enables you to read bean definitions and access them as follows:</p>
<pre class="programlisting"><span class="hl-comment">// create and configure beans</span>
ApplicationContext context = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"services.xml"</span>, <span class="hl-string">"daos.xml"</span>);

<span class="hl-comment">// retrieve configured instance</span>
PetStoreService service = context.getBean(<span class="hl-string">"petStore"</span>, PetStoreService.<span class="hl-keyword">class</span>);

<span class="hl-comment">// use configured instance</span>
List&lt;String&gt; userList = service.getUsernameList();</pre>
<p>With Groovy configuration, bootstrapping looks very similar, just a different context
implementation class which is Groovy-aware (but also understands XML bean definitions):</p>
<pre class="programlisting">ApplicationContext context = <span class="hl-keyword">new</span> GenericGroovyApplicationContext(<span class="hl-string">"services.groovy"</span>, <span class="hl-string">"daos.groovy"</span>);</pre>
<p>The most flexible variant is <code class="literal">GenericApplicationContext</code> in combination with reader
delegates, e.g. with <code class="literal">XmlBeanDefinitionReader</code> for XML files:</p>
<pre class="programlisting">GenericApplicationContext context = <span class="hl-keyword">new</span> GenericApplicationContext();
<span class="hl-keyword">new</span> XmlBeanDefinitionReader(context).loadBeanDefinitions(<span class="hl-string">"services.xml"</span>, <span class="hl-string">"daos.xml"</span>);
context.refresh();</pre>
<p>Or with <code class="literal">GroovyBeanDefinitionReader</code> for Groovy files:</p>
<pre class="programlisting">GenericApplicationContext context = <span class="hl-keyword">new</span> GenericApplicationContext();
<span class="hl-keyword">new</span> GroovyBeanDefinitionReader(context).loadBeanDefinitions(<span class="hl-string">"services.groovy"</span>, <span class="hl-string">"daos.groovy"</span>);
context.refresh();</pre>
<p>Such reader delegates can be mixed and matched on the same <code class="literal">ApplicationContext</code>,
reading bean definitions from diverse configuration sources, if desired.</p>
<p>You can then use <code class="literal">getBean</code> to retrieve instances of your beans. The <code class="literal">ApplicationContext</code>
interface has a few other methods for retrieving beans, but ideally your application
code should never use them. Indeed, your application code should have no calls to the
<code class="literal">getBean()</code> method at all, and thus no dependency on Spring APIs at all. For example,
Spring’s integration with web frameworks provides dependency injection for various web
framework components such as controllers and JSF-managed beans, allowing you to declare
a dependency on a specific bean through metadata (e.g. an autowiring annotation).</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-definition" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition"></a>7.3&nbsp;Bean overview</h2></div></div></div>
<p>A Spring IoC container manages one or more <span class="emphasis"><em>beans</em></span>. These beans are created with the
configuration metadata that you supply to the container, for example, in the form of XML
<code class="literal">&lt;bean/&gt;</code> definitions.</p>
<p>Within the container itself, these bean definitions are represented as <code class="literal">BeanDefinition</code>
objects, which contain (among other information) the following metadata:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>A package-qualified class name:</em></span> typically the actual implementation class of the
bean being defined.
</li><li class="listitem">
Bean behavioral configuration elements, which state how the bean should behave in the
container (scope, lifecycle callbacks, and so forth).
</li><li class="listitem">
References to other beans that are needed for the bean to do its work; these
references are also called <span class="emphasis"><em>collaborators</em></span> or <span class="emphasis"><em>dependencies</em></span>.
</li><li class="listitem">
Other configuration settings to set in the newly created object, for example, the
number of connections to use in a bean that manages a connection pool, or the size
limit of the pool.
</li></ul></div>
<p>This metadata translates to a set of properties that make up each bean definition.</p>
<div class="table"><a name="beans-factory-bean-definition-tbl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-bean-definition-tbl"></a><p class="title"><b>Table&nbsp;7.1.&nbsp;The bean definition</b></p><div class="table-contents">
<table summary="The bean definition" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explained in…&#8203;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>class</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class" title="7.3.2 Instantiating beans">Section&nbsp;7.3.2, “Instantiating beans”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>name</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanname" title="7.3.1 Naming beans">Section&nbsp;7.3.1, “Naming beans”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>scope</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes" title="7.5 Bean scopes">Section&nbsp;7.5, “Bean scopes”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>constructor arguments</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-collaborators" title="7.4.1 Dependency Injection">Section&nbsp;7.4.1, “Dependency Injection”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>properties</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-collaborators" title="7.4.1 Dependency Injection">Section&nbsp;7.4.1, “Dependency Injection”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>autowiring mode</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="7.4.5 Autowiring collaborators">Section&nbsp;7.4.5, “Autowiring collaborators”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>lazy-initialization mode</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lazy-init" title="7.4.4 Lazy-initialized beans">Section&nbsp;7.4.4, “Lazy-initialized beans”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>initialization method</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">the section called “Initialization callbacks”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>destruction method</p></td><td style="" align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean" title="Destruction callbacks">the section called “Destruction callbacks”</a></p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>In addition to bean definitions that contain information on how to create a specific
bean, the <code class="literal">ApplicationContext</code> implementations also permit the registration of existing
objects that are created outside the container, by users. This is done by accessing the
ApplicationContext’s BeanFactory via the method <code class="literal">getBeanFactory()</code> which returns the
BeanFactory implementation <code class="literal">DefaultListableBeanFactory</code>. <code class="literal">DefaultListableBeanFactory</code>
supports this registration through the methods <code class="literal">registerSingleton(..)</code> and
<code class="literal">registerBeanDefinition(..)</code>. However, typical applications work solely with beans
defined through metadata bean definitions.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Bean metadata and manually supplied singleton instances need to be registered as early
as possible, in order for the container to properly reason about them during autowiring
and other introspection steps. While overriding of existing metadata and existing
singleton instances is supported to some degree, the registration of new beans at
runtime (concurrently with live access to factory) is not officially supported and may
lead to concurrent access exceptions and/or inconsistent state in the bean container.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-beanname" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanname"></a>7.3.1&nbsp;Naming beans</h3></div></div></div>
<p>Every bean has one or more identifiers. These identifiers must be unique within the
container that hosts the bean. A bean usually has only one identifier, but if it
requires more than one, the extra ones can be considered aliases.</p>
<p>In XML-based configuration metadata, you use the <code class="literal">id</code> and/or <code class="literal">name</code> attributes
to specify the bean identifier(s). The <code class="literal">id</code> attribute allows you to specify
exactly one id. Conventionally these names are alphanumeric ('myBean',
'fooService', etc.), but may contain special characters as well. If you want to
introduce other aliases to the bean, you can also specify them in the <code class="literal">name</code>
attribute, separated by a comma (<code class="literal">,</code>), semicolon (<code class="literal">;</code>), or white space. As a
historical note, in versions prior to Spring 3.1, the <code class="literal">id</code> attribute was
defined as an <code class="literal">xsd:ID</code> type, which constrained possible characters. As of 3.1,
it is defined as an <code class="literal">xsd:string</code> type. Note that bean <code class="literal">id</code> uniqueness is still
enforced by the container, though no longer by XML parsers.</p>
<p>You are not required to supply a name or id for a bean. If no name or id is supplied
explicitly, the container generates a unique name for that bean. However, if you want to
refer to that bean by name, through the use of the <code class="literal">ref</code> element or
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-servicelocator" title="7.16.2 Glue code and the evil singleton">Service Locator</a> style lookup, you must provide a name.
Motivations for not supplying a name are related to using <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-inner-beans" title="Inner beans">inner
beans</a> and <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="7.4.5 Autowiring collaborators">autowiring collaborators</a>.</p>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Bean Naming Conventions</b></p></div></div></div>
<p>The convention is to use the standard Java convention for instance field names when
naming beans. That is, bean names start with a lowercase letter, and are camel-cased
from then on. Examples of such names would be (without quotes) <code class="literal">'accountManager'</code>,
<code class="literal">'accountService'</code>, <code class="literal">'userDao'</code>, <code class="literal">'loginController'</code>, and so forth.</p>
<p>Naming beans consistently makes your configuration easier to read and understand, and if
you are using Spring AOP it helps a lot when applying advice to a set of beans related
by name.</p>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>With component scanning in the classpath, Spring generates bean names for unnamed
components, following the rules above: essentially, taking the simple class name
and turning its initial character to lower-case. However, in the (unusual) special
case when there is more than one character and both the first and second characters
are upper case, the original casing gets preserved. These are the same rules as
defined by <code class="literal">java.beans.Introspector.decapitalize</code> (which Spring is using here).</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-beanname-alias" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanname-alias"></a>Aliasing a bean outside the bean definition</h4></div></div></div>
<p>In a bean definition itself, you can supply more than one name for the bean, by using a
combination of up to one name specified by the <code class="literal">id</code> attribute, and any number of other
names in the <code class="literal">name</code> attribute. These names can be equivalent aliases to the same bean,
and are useful for some situations, such as allowing each component in an application to
refer to a common dependency by using a bean name that is specific to that component
itself.</p>
<p>Specifying all aliases where the bean is actually defined is not always adequate,
however. It is sometimes desirable to introduce an alias for a bean that is defined
elsewhere. This is commonly the case in large systems where configuration is split
amongst each subsystem, each subsystem having its own set of object definitions. In
XML-based configuration metadata, you can use the <code class="literal">&lt;alias/&gt;</code> element to accomplish this.</p>
<pre class="programlisting"><span class="hl-tag">&lt;alias</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fromName"</span> <span class="hl-attribute">alias</span>=<span class="hl-value">"toName"</span><span class="hl-tag">/&gt;</span></pre>
<p>In this case, a bean in the same container which is named <code class="literal">fromName</code>, may also,
after the use of this alias definition, be referred to as <code class="literal">toName</code>.</p>
<p>For example, the configuration metadata for subsystem A may refer to a DataSource via
the name <code class="literal">subsystemA-dataSource</code>. The configuration metadata for subsystem B may refer to
a DataSource via the name <code class="literal">subsystemB-dataSource</code>. When composing the main application
that uses both these subsystems the main application refers to the DataSource via the
name <code class="literal">myApp-dataSource</code>. To have all three names refer to the same object you add to the
MyApp configuration metadata the following aliases definitions:</p>
<pre class="programlisting"><span class="hl-tag">&lt;alias</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subsystemA-dataSource"</span> <span class="hl-attribute">alias</span>=<span class="hl-value">"subsystemB-dataSource"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;alias</span> <span class="hl-attribute">name</span>=<span class="hl-value">"subsystemA-dataSource"</span> <span class="hl-attribute">alias</span>=<span class="hl-value">"myApp-dataSource"</span><span class="hl-tag"> /&gt;</span></pre>
<p>Now each component and the main application can refer to the dataSource through a name
that is unique and guaranteed not to clash with any other definition (effectively
creating a namespace), yet they refer to the same bean.</p>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Java-configuration</b></p></div></div></div>
<p>If you are using Java-configuration, the <code class="literal">@Bean</code> annotation can be used to provide aliases
see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-bean-annotation" title="7.12.3 Using the @Bean annotation">Section&nbsp;7.12.3, “Using the @Bean annotation”</a> for details.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-class" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class"></a>7.3.2&nbsp;Instantiating beans</h3></div></div></div>
<p>A bean definition essentially is a recipe for creating one or more objects. The
container looks at the recipe for a named bean when asked, and uses the configuration
metadata encapsulated by that bean definition to create (or acquire) an actual object.</p>
<p>If you use XML-based configuration metadata, you specify the type (or class) of object
that is to be instantiated in the <code class="literal">class</code> attribute of the <code class="literal">&lt;bean/&gt;</code> element. This
<code class="literal">class</code> attribute, which internally is a <code class="literal">Class</code> property on a <code class="literal">BeanDefinition</code>
instance, is usually mandatory. (For exceptions, see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-instance-factory-method" title="Instantiation using an instance factory method">the section called “Instantiation using an instance factory method”</a> and <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-child-bean-definitions" title="7.7 Bean definition inheritance">Section&nbsp;7.7, “Bean definition inheritance”</a>.)
You use the <code class="literal">Class</code> property in one of two ways:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Typically, to specify the bean class to be constructed in the case where the container
itself directly creates the bean by calling its constructor reflectively, somewhat
equivalent to Java code using the <code class="literal">new</code> operator.
</li><li class="listitem">
To specify the actual class containing the <code class="literal">static</code> factory method that will be
invoked to create the object, in the less common case where the container invokes a
<code class="literal">static</code> <span class="emphasis"><em>factory</em></span> method on a class to create the bean. The object type returned
from the invocation of the <code class="literal">static</code> factory method may be the same class or another
class entirely.
</li></ul></div>
<div class="sidebar"><div class="titlepage"></div>
<p>
<b>Inner class names.&nbsp;</b>
If you want to configure a bean definition for a <code class="literal">static</code> nested class, you have to use
the <span class="emphasis"><em>binary</em></span> name of the nested class.
</p>
<p>For example, if you have a class called <code class="literal">Foo</code> in the <code class="literal">com.example</code> package, and this
<code class="literal">Foo</code> class has a <code class="literal">static</code> nested class called <code class="literal">Bar</code>, the value of the <code class="literal">'class'</code>
attribute on a bean definition would be…&#8203;</p>
<p><code class="literal">com.example.Foo$Bar</code></p>
<p>Notice the use of the <code class="literal">$</code> character in the name to separate the nested class name from
the outer class name.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-class-ctor" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-ctor"></a>Instantiation with a constructor</h4></div></div></div>
<p>When you create a bean by the constructor approach, all normal classes are usable by and
compatible with Spring. That is, the class being developed does not need to implement
any specific interfaces or to be coded in a specific fashion. Simply specifying the bean
class should suffice. However, depending on what type of IoC you use for that specific
bean, you may need a default (empty) constructor.</p>
<p>The Spring IoC container can manage virtually <span class="emphasis"><em>any</em></span> class you want it to manage; it is
not limited to managing true JavaBeans. Most Spring users prefer actual JavaBeans with
only a default (no-argument) constructor and appropriate setters and getters modeled
after the properties in the container. You can also have more exotic non-bean-style
classes in your container. If, for example, you need to use a legacy connection pool
that absolutely does not adhere to the JavaBean specification, Spring can manage it as
well.</p>
<p>With XML-based configuration metadata you can specify your bean class as follows:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"anotherExample"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBeanTwo"</span><span class="hl-tag">/&gt;</span></pre>
<p>For details about the mechanism for supplying arguments to the constructor (if required)
and setting object instance properties after the object is constructed, see
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-collaborators" title="7.4.1 Dependency Injection">Injecting Dependencies</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-class-static-factory-method" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-static-factory-method"></a>Instantiation with a static factory method</h4></div></div></div>
<p>When defining a bean that you create with a static factory method, you use the <code class="literal">class</code>
attribute to specify the class containing the <code class="literal">static</code> factory method and an attribute
named <code class="literal">factory-method</code> to specify the name of the factory method itself. You should be
able to call this method (with optional arguments as described later) and return a live
object, which subsequently is treated as if it had been created through a constructor.
One use for such a bean definition is to call <code class="literal">static</code> factories in legacy code.</p>
<p>The following bean definition specifies that the bean will be created by calling a
factory-method. The definition does not specify the type (class) of the returned object,
only the class containing the factory method. In this example, the <code class="literal">createInstance()</code>
method must be a <span class="emphasis"><em>static</em></span> method.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"clientService"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ClientService"</span>
    <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createInstance"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ClientService {
    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> ClientService clientService = <span class="hl-keyword">new</span> ClientService();
    <span class="hl-keyword">private</span> ClientService() {}

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> ClientService createInstance() {
        <span class="hl-keyword">return</span> clientService;
    }
}</pre>
<p>For details about the mechanism for supplying (optional) arguments to the factory method
and setting object instance properties after the object is returned from the factory,
see <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-properties-detailed" title="7.4.2 Dependencies and configuration in detail">Dependencies and configuration in detail</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-class-instance-factory-method" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-instance-factory-method"></a>Instantiation using an instance factory method</h4></div></div></div>
<p>Similar to instantiation through a <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-static-factory-method" title="Instantiation with a static factory method">static
factory method</a>, instantiation with an instance factory method invokes a non-static
method of an existing bean from the container to create a new bean. To use this
mechanism, leave the <code class="literal">class</code> attribute empty, and in the <code class="literal">factory-bean</code> attribute,
specify the name of a bean in the current (or parent/ancestor) container that contains
the instance method that is to be invoked to create the object. Set the name of the
factory method itself with the <code class="literal">factory-method</code> attribute.</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- the factory bean, which contains a method called createInstance() --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceLocator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.DefaultServiceLocator"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-comment">&lt;!-- the bean to be created via the factory bean --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"clientService"</span>
    <span class="hl-attribute">factory-bean</span>=<span class="hl-value">"serviceLocator"</span>
    <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createClientServiceInstance"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultServiceLocator {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> ClientService clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
    <span class="hl-keyword">private</span> DefaultServiceLocator() {}

    <span class="hl-keyword">public</span> ClientService createClientServiceInstance() {
        <span class="hl-keyword">return</span> clientService;
    }
}</pre>
<p>One factory class can also hold more than one factory method as shown here:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceLocator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.DefaultServiceLocator"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"clientService"</span>
    <span class="hl-attribute">factory-bean</span>=<span class="hl-value">"serviceLocator"</span>
    <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createClientServiceInstance"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span>
    <span class="hl-attribute">factory-bean</span>=<span class="hl-value">"serviceLocator"</span>
    <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createAccountServiceInstance"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultServiceLocator {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> ClientService clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> AccountService accountService = <span class="hl-keyword">new</span> AccountServiceImpl();

    <span class="hl-keyword">private</span> DefaultServiceLocator() {}

    <span class="hl-keyword">public</span> ClientService createClientServiceInstance() {
        <span class="hl-keyword">return</span> clientService;
    }

    <span class="hl-keyword">public</span> AccountService createAccountServiceInstance() {
        <span class="hl-keyword">return</span> accountService;
    }

}</pre>
<p>This approach shows that the factory bean itself can be managed and configured through
dependency injection (DI). See <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-properties-detailed" title="7.4.2 Dependencies and configuration in detail">Dependencies and
configuration in detail</a>.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>In Spring documentation,<span class="emphasis"><em> factory bean</em></span> refers to a bean that is configured in the
Spring container that will create objects through an
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-instance-factory-method" title="Instantiation using an instance factory method">instance</a> or
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class-static-factory-method" title="Instantiation with a static factory method">static</a> factory method. By contrast,
<code class="literal">FactoryBean</code> (notice the capitalization) refers to a Spring-specific
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-factorybean" title="7.8.3 Customizing instantiation logic with a FactoryBean"><code class="literal">FactoryBean</code></a>.</p>
</td></tr></tbody></table></div>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-dependencies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-dependencies"></a>7.4&nbsp;Dependencies</h2></div></div></div>
<p>A typical enterprise application does not consist of a single object (or bean in the
Spring parlance). Even the simplest application has a few objects that work together to
present what the end-user sees as a coherent application. This next section explains how
you go from defining a number of bean definitions that stand alone to a fully realized
application where objects collaborate to achieve a goal.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-collaborators" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-collaborators"></a>7.4.1&nbsp;Dependency Injection</h3></div></div></div>
<p><span class="emphasis"><em>Dependency injection</em></span> (DI) is a process whereby objects define their dependencies,
that is, the other objects they work with, only through constructor arguments, arguments
to a factory method, or properties that are set on the object instance after it is
constructed or returned from a factory method. The container then <span class="emphasis"><em>injects</em></span> those
dependencies when it creates the bean. This process is fundamentally the inverse, hence
the name <span class="emphasis"><em>Inversion of Control</em></span> (IoC), of the bean itself controlling the instantiation
or location of its dependencies on its own by using direct construction of classes, or
the <span class="emphasis"><em>Service Locator</em></span> pattern.</p>
<p>Code is cleaner with the DI principle and decoupling is more effective when objects are
provided with their dependencies. The object does not look up its dependencies, and does
not know the location or class of the dependencies. As such, your classes become easier
to test, in particular when the dependencies are on interfaces or abstract base classes,
which allow for stub or mock implementations to be used in unit tests.</p>
<p>DI exists in two major variants, <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-constructor-injection" title="Constructor-based dependency injection">Constructor-based
dependency injection</a> and <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-setter-injection" title="Setter-based dependency injection">Setter-based dependency injection</a>.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-constructor-injection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-constructor-injection"></a>Constructor-based dependency injection</h4></div></div></div>
<p><span class="emphasis"><em>Constructor-based</em></span> DI is accomplished by the container invoking a constructor with a
number of arguments, each representing a dependency. Calling a <code class="literal">static</code> factory method
with specific arguments to construct the bean is nearly equivalent, and this discussion
treats arguments to a constructor and to a <code class="literal">static</code> factory method similarly. The
following example shows a class that can only be dependency-injected with constructor
injection. Notice that there is nothing <span class="emphasis"><em>special</em></span> about this class, it is a POJO that
has no dependencies on container specific interfaces, base classes or annotations.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-comment">// the SimpleMovieLister has a dependency on a MovieFinder</span>
    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <span class="hl-comment">// a constructor so that the Spring container can inject a MovieFinder</span>
    <span class="hl-keyword">public</span> SimpleMovieLister(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// business logic that actually uses the injected MovieFinder is omitted...</span>

}</pre>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-ctor-arguments-resolution" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-ctor-arguments-resolution"></a>Constructor argument resolution</h5></div></div></div>

<p>Constructor argument resolution matching occurs using the argument’s type. If no
potential ambiguity exists in the constructor arguments of a bean definition, then the
order in which the constructor arguments are defined in a bean definition is the order
in which those arguments are supplied to the appropriate constructor when the bean is
being instantiated. Consider the following class:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> x.y;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Foo {

    <span class="hl-keyword">public</span> Foo(Bar bar, Baz baz) {
        <span class="hl-comment">// ...</span>
    }

}</pre>
<p>No potential ambiguity exists, assuming that <code class="literal">Bar</code> and <code class="literal">Baz</code> classes are not related by
inheritance. Thus the following configuration works fine, and you do not need to specify
the constructor argument indexes and/or types explicitly in the <code class="literal">&lt;constructor-arg/&gt;</code>
element.</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"bar"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"baz"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Bar"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"baz"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Baz"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>When another bean is referenced, the type is known, and matching can occur (as was the
case with the preceding example). When a simple type is used, such as
<code class="literal">&lt;value&gt;true&lt;/value&gt;</code>, Spring cannot determine the type of the value, and so cannot match
by type without help. Consider the following class:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> examples;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-comment">// Number of years to calculate the Ultimate Answer</span>
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> years;

    <span class="hl-comment">// The Answer to Life, the Universe, and Everything</span>
    <span class="hl-keyword">private</span> String ultimateAnswer;

    <span class="hl-keyword">public</span> ExampleBean(<span class="hl-keyword">int</span> years, String ultimateAnswer) {
        <span class="hl-keyword">this</span>.years = years;
        <span class="hl-keyword">this</span>.ultimateAnswer = ultimateAnswer;
    }

}</pre>
<p>In the preceding scenario, the container <span class="emphasis"><em>can</em></span> use type matching with simple types if
you explicitly specify the type of the constructor argument using the <code class="literal">type</code> attribute.
For example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">type</span>=<span class="hl-value">"int"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"7500000"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">type</span>=<span class="hl-value">"java.lang.String"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"42"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Use the <code class="literal">index</code> attribute to specify explicitly the index of constructor arguments. For
example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">index</span>=<span class="hl-value">"0"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"7500000"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">index</span>=<span class="hl-value">"1"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"42"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>In addition to resolving the ambiguity of multiple simple values, specifying an index
resolves ambiguity where a constructor has two arguments of the same type. Note that the
<span class="emphasis"><em>index is 0 based</em></span>.</p>
<p>You can also use the constructor parameter name for value disambiguation:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">name</span>=<span class="hl-value">"years"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"7500000"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ultimateAnswer"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"42"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Keep in mind that to make this work out of the box your code must be compiled with the
debug flag enabled so that Spring can look up the parameter name from the constructor.
If you can’t compile your code with debug flag (or don’t want to) you can use
<a class="ulink" href="http://download.oracle.com/javase/6/docs/api/java/beans/ConstructorProperties.html" target="_top">@ConstructorProperties</a>
JDK annotation to explicitly name your constructor arguments. The sample class would
then have to look as follows:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> examples;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-comment">// Fields omitted</span>

    <em><span class="hl-annotation" style="color: gray">@ConstructorProperties({"years", "ultimateAnswer"})</span></em>
    <span class="hl-keyword">public</span> ExampleBean(<span class="hl-keyword">int</span> years, String ultimateAnswer) {
        <span class="hl-keyword">this</span>.years = years;
        <span class="hl-keyword">this</span>.ultimateAnswer = ultimateAnswer;
    }

}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-setter-injection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-setter-injection"></a>Setter-based dependency injection</h4></div></div></div>

<p><span class="emphasis"><em>Setter-based</em></span> DI is accomplished by the container calling setter methods on your
beans after invoking a no-argument constructor or no-argument <code class="literal">static</code> factory method to
instantiate your bean.</p>
<p>The following example shows a class that can only be dependency-injected using pure
setter injection. This class is conventional Java. It is a POJO that has no dependencies
on container specific interfaces, base classes or annotations.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-comment">// the SimpleMovieLister has a dependency on the MovieFinder</span>
    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <span class="hl-comment">// a setter method so that the Spring container can inject a MovieFinder</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// business logic that actually uses the injected MovieFinder is omitted...</span>

}</pre>
<p>The <code class="literal">ApplicationContext</code> supports constructor-based and setter-based DI for the beans it
manages. It also supports setter-based DI after some dependencies have already been
injected through the constructor approach. You configure the dependencies in the form of
a <code class="literal">BeanDefinition</code>, which you use in conjunction with <code class="literal">PropertyEditor</code> instances to
convert properties from one format to another. However, most Spring users do not work
with these classes directly (i.e., programmatically) but rather with XML <code class="literal">bean</code>
definitions, annotated components (i.e., classes annotated with <code class="literal">@Component</code>,
<code class="literal">@Controller</code>, etc.), or <code class="literal">@Bean</code> methods in Java-based <code class="literal">@Configuration</code> classes. These
sources are then converted internally into instances of <code class="literal">BeanDefinition</code> and used to
load an entire Spring IoC container instance.</p>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Constructor-based or setter-based DI?</b></p></div></div></div>

<p>Since you can mix constructor-based and setter-based DI, it is a good rule of thumb to
use constructors for <span class="emphasis"><em>mandatory dependencies</em></span> and setter methods or configuration methods
for <span class="emphasis"><em>optional dependencies</em></span>. Note that use of the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-required-annotation" title="7.9.1 @Required">@Required</a>
annotation on a setter method can be used to make the property a required dependency.</p>
<p>The Spring team generally advocates constructor injection as it enables one to implement
application components as <span class="emphasis"><em>immutable objects</em></span> and to ensure that required dependencies
are not <code class="literal">null</code>. Furthermore constructor-injected components are always returned to client
(calling) code in a fully initialized state. As a side note, a large number of constructor
arguments is a <span class="emphasis"><em>bad code smell</em></span>, implying that the class likely has too many
responsibilities and should be refactored to better address proper separation of concerns.</p>
<p>Setter injection should primarily only be used for optional dependencies that can be
assigned reasonable default values within the class. Otherwise, not-null checks must be
performed everywhere the code uses the dependency. One benefit of setter injection is that
setter methods make objects of that class amenable to reconfiguration or re-injection
later. Management through <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx" title="31. JMX">JMX MBeans</a> is therefore a compelling use case for setter
injection.</p>
<p>Use the DI style that makes the most sense for a particular class. Sometimes, when dealing
with third-party classes for which you do not have the source, the choice is made for you.
For example, if a third-party class does not expose any setter methods, then constructor
injection may be the only available form of DI.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-dependency-resolution" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-dependency-resolution"></a>Dependency resolution process</h4></div></div></div>

<p>The container performs bean dependency resolution as follows:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The <code class="literal">ApplicationContext</code> is created and initialized with configuration metadata that
describes all the beans. Configuration metadata can be specified via XML, Java code, or
annotations.
</li><li class="listitem">
For each bean, its dependencies are expressed in the form of properties, constructor
arguments, or arguments to the static-factory method if you are using that instead of
a normal constructor. These dependencies are provided to the bean, <span class="emphasis"><em>when the bean is
actually created</em></span>.
</li><li class="listitem">
Each property or constructor argument is an actual definition of the value to set, or
a reference to another bean in the container.
</li><li class="listitem">
Each property or constructor argument which is a value is converted from its specified
format to the actual type of that property or constructor argument. By default Spring
can convert a value supplied in string format to all built-in types, such as <code class="literal">int</code>,
<code class="literal">long</code>, <code class="literal">String</code>, <code class="literal">boolean</code>, etc.
</li></ul></div>
<p>The Spring container validates the configuration of each bean as the container is created.
However, the bean properties themselves are not set until the bean <span class="emphasis"><em>is actually created</em></span>.
Beans that are singleton-scoped and set to be pre-instantiated (the default) are created
when the container is created. Scopes are defined in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes" title="7.5 Bean scopes">Section&nbsp;7.5, “Bean scopes”</a>. Otherwise,
the bean is created only when it is requested. Creation of a bean potentially causes a
graph of beans to be created, as the bean’s dependencies and its dependencies'
dependencies (and so on) are created and assigned. Note that resolution mismatches among
those dependencies may show up late, i.e. on first creation of the affected bean.</p>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Circular dependencies</b></p></div></div></div>

<p>If you use predominantly constructor injection, it is possible to create an unresolvable
circular dependency scenario.</p>
<p>For example: Class A requires an instance of class B through constructor injection, and
class B requires an instance of class A through constructor injection. If you configure
beans for classes A and B to be injected into each other, the Spring IoC container
detects this circular reference at runtime, and throws a
<code class="literal">BeanCurrentlyInCreationException</code>.</p>
<p>One possible solution is to edit the source code of some classes to be configured by
setters rather than constructors. Alternatively, avoid constructor injection and use
setter injection only. In other words, although it is not recommended, you can configure
circular dependencies with setter injection.</p>
<p>Unlike the <span class="emphasis"><em>typical</em></span> case (with no circular dependencies), a circular dependency
between bean A and bean B forces one of the beans to be injected into the other prior to
being fully initialized itself (a classic chicken/egg scenario).</p>
</div>
<p>You can generally trust Spring to do the right thing. It detects configuration problems,
such as references to non-existent beans and circular dependencies, at container
load-time. Spring sets properties and resolves dependencies as late as possible, when
the bean is actually created. This means that a Spring container which has loaded
correctly can later generate an exception when you request an object if there is a
problem creating that object or one of its dependencies. For example, the bean throws an
exception as a result of a missing or invalid property. This potentially delayed
visibility of some configuration issues is why <code class="literal">ApplicationContext</code> implementations by
default pre-instantiate singleton beans. At the cost of some upfront time and memory to
create these beans before they are actually needed, you discover configuration issues
when the <code class="literal">ApplicationContext</code> is created, not later. You can still override this default
behavior so that singleton beans will lazy-initialize, rather than be pre-instantiated.</p>
<p>If no circular dependencies exist, when one or more collaborating beans are being
injected into a dependent bean, each collaborating bean is <span class="emphasis"><em>totally</em></span> configured prior
to being injected into the dependent bean. This means that if bean A has a dependency on
bean B, the Spring IoC container completely configures bean B prior to invoking the
setter method on bean A. In other words, the bean is instantiated (if not a
pre-instantiated singleton), its dependencies are set, and the relevant lifecycle
methods (such as a <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">configured init method</a>
or the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">InitializingBean callback method</a>)
are invoked.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-some-examples" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-some-examples"></a>Examples of dependency injection</h4></div></div></div>

<p>The following example uses XML-based configuration metadata for setter-based DI. A small
part of a Spring XML configuration file specifies some bean definitions:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- setter injection using the nested ref element --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beanOne"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"anotherExampleBean"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>

    <span class="hl-comment">&lt;!-- setter injection using the neater ref attribute --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beanTwo"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"yetAnotherBean"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"integerProperty"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherExampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherBean"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"yetAnotherBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.YetAnotherBean"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-keyword">private</span> AnotherBean beanOne;
    <span class="hl-keyword">private</span> YetAnotherBean beanTwo;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> i;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBeanOne(AnotherBean beanOne) {
        <span class="hl-keyword">this</span>.beanOne = beanOne;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBeanTwo(YetAnotherBean beanTwo) {
        <span class="hl-keyword">this</span>.beanTwo = beanTwo;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setIntegerProperty(<span class="hl-keyword">int</span> i) {
        <span class="hl-keyword">this</span>.i = i;
    }

}</pre>
<p>In the preceding example, setters are declared to match against the properties specified
in the XML file. The following example uses constructor-based DI:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- constructor injection using the nested ref element --&gt;</span>
    <span class="hl-tag">&lt;constructor-arg&gt;</span>
        <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"anotherExampleBean"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/constructor-arg&gt;</span>

    <span class="hl-comment">&lt;!-- constructor injection using the neater ref attribute --&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"yetAnotherBean"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">type</span>=<span class="hl-value">"int"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherExampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherBean"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"yetAnotherBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.YetAnotherBean"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-keyword">private</span> AnotherBean beanOne;
    <span class="hl-keyword">private</span> YetAnotherBean beanTwo;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> i;

    <span class="hl-keyword">public</span> ExampleBean(
        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="hl-keyword">int</span> i) {
        <span class="hl-keyword">this</span>.beanOne = anotherBean;
        <span class="hl-keyword">this</span>.beanTwo = yetAnotherBean;
        <span class="hl-keyword">this</span>.i = i;
    }

}</pre>
<p>The constructor arguments specified in the bean definition will be used as arguments to
the constructor of the <code class="literal">ExampleBean</code>.</p>
<p>Now consider a variant of this example, where instead of using a constructor, Spring is
told to call a <code class="literal">static</code> factory method to return an instance of the object:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span> <span class="hl-attribute">factory-method</span>=<span class="hl-value">"createInstance"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"anotherExampleBean"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"yetAnotherBean"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherExampleBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherBean"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"yetAnotherBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.YetAnotherBean"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-comment">// a private constructor</span>
    <span class="hl-keyword">private</span> ExampleBean(...) {
        ...
    }

    <span class="hl-comment">// a static factory method; the arguments to this method can be</span>
    <span class="hl-comment">// considered the dependencies of the bean that is returned,</span>
    <span class="hl-comment">// regardless of how those arguments are actually used.</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> ExampleBean createInstance (
        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="hl-keyword">int</span> i) {

        ExampleBean eb = <span class="hl-keyword">new</span> ExampleBean (...);
        <span class="hl-comment">// some other operations...</span>
        <span class="hl-keyword">return</span> eb;
    }

}</pre>
<p>Arguments to the <code class="literal">static</code> factory method are supplied via <code class="literal">&lt;constructor-arg/&gt;</code> elements,
exactly the same as if a constructor had actually been used. The type of the class being
returned by the factory method does not have to be of the same type as the class that
contains the <code class="literal">static</code> factory method, although in this example it is. An instance
(non-static) factory method would be used in an essentially identical fashion (aside
from the use of the <code class="literal">factory-bean</code> attribute instead of the <code class="literal">class</code> attribute), so
details will not be discussed here.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-properties-detailed" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-properties-detailed"></a>7.4.2&nbsp;Dependencies and configuration in detail</h3></div></div></div>

<p>As mentioned in the previous section, you can define bean properties and constructor
arguments as references to other managed beans (collaborators), or as values defined
inline. Spring’s XML-based configuration metadata supports sub-element types within its
<code class="literal">&lt;property/&gt;</code> and <code class="literal">&lt;constructor-arg/&gt;</code> elements for this purpose.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-value-element" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-value-element"></a>Straight values (primitives, Strings, and so on)</h4></div></div></div>

<p>The <code class="literal">value</code> attribute of the <code class="literal">&lt;property/&gt;</code> element specifies a property or constructor
argument as a human-readable string representation. Spring’s
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-ConversionService-API" title="9.5.4 ConversionService API">conversion service</a> is used to convert these
values from a <code class="literal">String</code> to the actual type of the property or argument.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myDataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setDriverClassName(String) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.mysql.jdbc.Driver"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:mysql://localhost:3306/mydb"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"root"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"masterkaoli"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The following example uses the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-p-namespace" title="XML shortcut with the p-namespace">p-namespace</a> for even more succinct
XML configuration.</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">"http://www.springframework.org/schema/p"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myDataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span>
        <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>
        <span class="hl-attribute">p:driverClassName</span>=<span class="hl-value">"com.mysql.jdbc.Driver"</span>
        <span class="hl-attribute">p:url</span>=<span class="hl-value">"jdbc:mysql://localhost:3306/mydb"</span>
        <span class="hl-attribute">p:username</span>=<span class="hl-value">"root"</span>
        <span class="hl-attribute">p:password</span>=<span class="hl-value">"masterkaoli"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The preceding XML is more succinct; however, typos are discovered at runtime rather than
design time, unless you use an IDE such as <a class="ulink" href="https://www.jetbrains.com/idea/" target="_top">IntelliJ
IDEA</a> or the <a class="ulink" href="https://spring.io/tools/sts" target="_top">Spring Tool Suite</a> (STS)
that support automatic property completion when you create bean definitions. Such IDE
assistance is highly recommended.</p>
<p>You can also configure a <code class="literal">java.util.Properties</code> instance as:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mappings"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- typed as a java.util.Properties --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"properties"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>
            jdbc.driver.className=com.mysql.jdbc.Driver
            jdbc.url=jdbc:mysql://localhost:3306/mydb
        <span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The Spring container converts the text inside the <code class="literal">&lt;value/&gt;</code> element into a
<code class="literal">java.util.Properties</code> instance by using the JavaBeans <code class="literal">PropertyEditor</code> mechanism. This
is a nice shortcut, and is one of a few places where the Spring team do favor the use of
the nested <code class="literal">&lt;value/&gt;</code> element over the <code class="literal">value</code> attribute style.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-idref-element" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-idref-element"></a>The idref element</h5></div></div></div>

<p>The <code class="literal">idref</code> element is simply an error-proof way to pass the <span class="emphasis"><em>id</em></span> (string value - not
a reference) of another bean in the container to a <code class="literal">&lt;constructor-arg/&gt;</code> or <code class="literal">&lt;property/&gt;</code>
element.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theTargetBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theClientBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetName"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;idref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"theTargetBean"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The above bean definition snippet is <span class="emphasis"><em>exactly</em></span> equivalent (at runtime) to the
following snippet:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theTargetBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"client"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"theTargetBean"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The first form is preferable to the second, because using the <code class="literal">idref</code> tag allows the
container to validate <span class="emphasis"><em>at deployment time</em></span> that the referenced, named bean actually
exists. In the second variation, no validation is performed on the value that is passed
to the <code class="literal">targetName</code> property of the <code class="literal">client</code> bean. Typos are only discovered (with most
likely fatal results) when the <code class="literal">client</code> bean is actually instantiated. If the <code class="literal">client</code>
bean is a <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes" title="7.5 Bean scopes">prototype</a> bean, this typo and the resulting exception
may only be discovered long after the container is deployed.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">local</code> attribute on the <code class="literal">idref</code> element is no longer supported in the 4.0 beans xsd
since it does not provide value over a regular <code class="literal">bean</code> reference anymore. Simply change
your existing <code class="literal">idref local</code> references to <code class="literal">idref bean</code> when upgrading to the 4.0 schema.</p>
</td></tr></tbody></table></div>
<p>A common place (at least in versions earlier than Spring 2.0) where the <code class="literal">&lt;idref/&gt;</code> element
brings value is in the configuration of <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-1" title="12.5.1 Basics">AOP interceptors</a> in a
<code class="literal">ProxyFactoryBean</code> bean definition. Using <code class="literal">&lt;idref/&gt;</code> elements when you specify the
interceptor names prevents you from misspelling an interceptor id.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-ref-element" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-ref-element"></a>References to other beans (collaborators)</h4></div></div></div>

<p>The <code class="literal">ref</code> element is the final element inside a <code class="literal">&lt;constructor-arg/&gt;</code> or <code class="literal">&lt;property/&gt;</code>
definition element. Here you set the value of the specified property of a bean to be a
reference to another bean (a collaborator) managed by the container. The referenced bean
is a dependency of the bean whose property will be set, and it is initialized on demand
as needed before the property is set. (If the collaborator is a singleton bean, it may
be initialized already by the container.) All references are ultimately a reference to
another object. Scoping and validation depend on whether you specify the id/name of the
other object through the <code class="literal">bean</code>, <code class="literal">local,</code> or <code class="literal">parent</code> attributes.</p>
<p>Specifying the target bean through the <code class="literal">bean</code> attribute of the <code class="literal">&lt;ref/&gt;</code> tag is the most
general form, and allows creation of a reference to any bean in the same container or
parent container, regardless of whether it is in the same XML file. The value of the
<code class="literal">bean</code> attribute may be the same as the <code class="literal">id</code> attribute of the target bean, or as one of
the values in the <code class="literal">name</code> attribute of the target bean.</p>
<pre class="programlisting"><span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"someBean"</span><span class="hl-tag">/&gt;</span></pre>
<p>Specifying the target bean through the <code class="literal">parent</code> attribute creates a reference to a bean
that is in a parent container of the current container. The value of the <code class="literal">parent</code>
attribute may be the same as either the <code class="literal">id</code> attribute of the target bean, or one of the
values in the <code class="literal">name</code> attribute of the target bean, and the target bean must be in a
parent container of the current one. You use this bean reference variant mainly when you
have a hierarchy of containers and you want to wrap an existing bean in a parent
container with a proxy that will have the same name as the parent bean.</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- in the parent context --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.SimpleAccountService"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- insert dependencies as required as here --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<pre class="programlisting"><span class="hl-comment">&lt;!-- in the child (descendant) context --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">&lt;!--</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">name</span> <span class="hl-attribute">is</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">as</span> <span class="hl-attribute">the</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">--&gt;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"accountService"</span><span class="hl-tag">/&gt;</span> <span class="hl-comment">&lt;!-- notice how we refer to the parent bean --&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-comment">&lt;!-- insert other configuration and dependencies as required here --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">local</code> attribute on the <code class="literal">ref</code> element is no longer supported in the 4.0 beans xsd
since it does not provide value over a regular <code class="literal">bean</code> reference anymore. Simply change
your existing <code class="literal">ref local</code> references to <code class="literal">ref bean</code> when upgrading to the 4.0 schema.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-inner-beans" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-inner-beans"></a>Inner beans</h4></div></div></div>

<p>A <code class="literal">&lt;bean/&gt;</code> element inside the <code class="literal">&lt;property/&gt;</code> or <code class="literal">&lt;constructor-arg/&gt;</code> elements defines a
so-called <span class="emphasis"><em>inner bean</em></span>.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"outer"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- instead of using a reference to a target bean, simply define the target bean inline --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.Person"</span><span class="hl-tag">&gt;</span> <span class="hl-comment">&lt;!-- this is the inner bean --&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Fiona Apple"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"25"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>An inner bean definition does not require a defined id or name; if specified, the container
does not use such a value as an identifier. The container also ignores the <code class="literal">scope</code> flag on
creation: Inner beans are <span class="emphasis"><em>always</em></span> anonymous and they are <span class="emphasis"><em>always</em></span> created with the outer
bean. It is <span class="emphasis"><em>not</em></span> possible to inject inner beans into collaborating beans other than into
the enclosing bean or to access them independently.</p>
<p>As a corner case, it is possible to receive destruction callbacks from a custom scope, e.g.
for a request-scoped inner bean contained within a singleton bean: The creation of the inner
bean instance will be tied to its containing bean, but destruction callbacks allow it to
participate in the request scope’s lifecycle. This is not a common scenario; inner beans
typically simply share their containing bean’s scope.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-collection-elements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-collection-elements"></a>Collections</h4></div></div></div>

<p>In the <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;set/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, and <code class="literal">&lt;props/&gt;</code> elements, you set the properties
and arguments of the Java <code class="literal">Collection</code> types <code class="literal">List</code>, <code class="literal">Set</code>, <code class="literal">Map</code>, and <code class="literal">Properties</code>,
respectively.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreComplexObject"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.ComplexObject"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setAdminEmails(java.util.Properties) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"adminEmails"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;props&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"administrator"</span><span class="hl-tag">&gt;</span>administrator@example.org<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"support"</span><span class="hl-tag">&gt;</span>support@example.org<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"development"</span><span class="hl-tag">&gt;</span>development@example.org<span class="hl-tag">&lt;/prop&gt;</span>
        <span class="hl-tag">&lt;/props&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setSomeList(java.util.List) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someList"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>a list element followed by a reference<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"myDataSource"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setSomeMap(java.util.Map) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someMap"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"an entry"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"just some string"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span> =<span class="hl-value">"a ref"</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">"myDataSource"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setSomeSet(java.util.Set) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someSet"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;set&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>just some string<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"myDataSource"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/set&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p><span class="emphasis"><em>The value of a map key or value, or a set value, can also again be any of the
following elements:</em></span></p>
<pre class="programlisting">bean | ref | idref | list | set | map | props | value | null</pre>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-collection-elements-merging" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-collection-elements-merging"></a>Collection merging</h5></div></div></div>

<p>The Spring container also supports the <span class="emphasis"><em>merging</em></span> of collections. An application
developer can define a parent-style <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, <code class="literal">&lt;set/&gt;</code> or <code class="literal">&lt;props/&gt;</code> element,
and have child-style <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, <code class="literal">&lt;set/&gt;</code> or <code class="literal">&lt;props/&gt;</code> elements inherit and
override values from the parent collection. That is, the child collection’s values are
the result of merging the elements of the parent and child collections, with the child’s
collection elements overriding values specified in the parent collection.</p>
<p><span class="emphasis"><em>This section on merging discusses the parent-child bean mechanism. Readers unfamiliar
with parent and child bean definitions may wish to read the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-child-bean-definitions" title="7.7 Bean definition inheritance">relevant section</a> before continuing.</em></span></p>
<p>The following example demonstrates collection merging:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"parent"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.ComplexObject"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"adminEmails"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;props&gt;</span>
                <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"administrator"</span><span class="hl-tag">&gt;</span>administrator@example.com<span class="hl-tag">&lt;/prop&gt;</span>
                <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"support"</span><span class="hl-tag">&gt;</span>support@example.com<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;/props&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"child"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"parent"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"adminEmails"</span><span class="hl-tag">&gt;</span>
            <span class="hl-comment">&lt;!-- the merge is specified on the child collection definition --&gt;</span>
            <span class="hl-tag">&lt;props</span> <span class="hl-attribute">merge</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"sales"</span><span class="hl-tag">&gt;</span>sales@example.com<span class="hl-tag">&lt;/prop&gt;</span>
                <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"support"</span><span class="hl-tag">&gt;</span>support@example.co.uk<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;/props&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;beans&gt;</span></pre>
<p>Notice the use of the <code class="literal">merge=true</code> attribute on the <code class="literal">&lt;props/&gt;</code> element of the
<code class="literal">adminEmails</code> property of the <code class="literal">child</code> bean definition. When the <code class="literal">child</code> bean is resolved
and instantiated by the container, the resulting instance has an <code class="literal">adminEmails</code>
<code class="literal">Properties</code> collection that contains the result of the merging of the child’s
<code class="literal">adminEmails</code> collection with the parent’s <code class="literal">adminEmails</code> collection.</p>
<pre class="literallayout">administrator=administrator@example.com
sales=sales@example.com
support=support@example.co.uk</pre>
<p>The child <code class="literal">Properties</code> collection’s value set inherits all property elements from the
parent <code class="literal">&lt;props/&gt;</code>, and the child’s value for the <code class="literal">support</code> value overrides the value in
the parent collection.</p>
<p>This merging behavior applies similarly to the <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, and <code class="literal">&lt;set/&gt;</code>
collection types. In the specific case of the <code class="literal">&lt;list/&gt;</code> element, the semantics
associated with the <code class="literal">List</code> collection type, that is, the notion of an <code class="literal">ordered</code>
collection of values, is maintained; the parent’s values precede all of the child list’s
values. In the case of the <code class="literal">Map</code>, <code class="literal">Set</code>, and <code class="literal">Properties</code> collection types, no ordering
exists. Hence no ordering semantics are in effect for the collection types that underlie
the associated <code class="literal">Map</code>, <code class="literal">Set</code>, and <code class="literal">Properties</code> implementation types that the container
uses internally.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-collection-merge-limitations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-collection-merge-limitations"></a>Limitations of collection merging</h5></div></div></div>

<p>You cannot merge different collection types (such as a <code class="literal">Map</code> and a <code class="literal">List</code>), and if you
do attempt to do so an appropriate <code class="literal">Exception</code> is thrown. The <code class="literal">merge</code> attribute must be
specified on the lower, inherited, child definition; specifying the <code class="literal">merge</code> attribute on
a parent collection definition is redundant and will not result in the desired merging.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-collection-elements-strongly-typed" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-collection-elements-strongly-typed"></a>Strongly-typed collection</h5></div></div></div>

<p>With the introduction of generic types in Java 5, you can use strongly typed collections.
That is, it is possible to declare a <code class="literal">Collection</code> type such that it can only contain
<code class="literal">String</code> elements (for example). If you are using Spring to dependency-inject a
strongly-typed <code class="literal">Collection</code> into a bean, you can take advantage of Spring’s
type-conversion support such that the elements of your strongly-typed <code class="literal">Collection</code>
instances are converted to the appropriate type prior to being added to the <code class="literal">Collection</code>.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Foo {

    <span class="hl-keyword">private</span> Map&lt;String, Float&gt; accounts;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAccounts(Map&lt;String, Float&gt; accounts) {
        <span class="hl-keyword">this</span>.accounts = accounts;
    }
}</pre>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accounts"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"one"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"9.99"</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"two"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"2.75"</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"six"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"3.99"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>When the <code class="literal">accounts</code> property of the <code class="literal">foo</code> bean is prepared for injection, the generics
information about the element type of the strongly-typed <code class="literal">Map&lt;String, Float&gt;</code> is
available by reflection. Thus Spring’s type conversion infrastructure recognizes the
various value elements as being of type <code class="literal">Float</code>, and the string values <code class="literal">9.99, 2.75</code>, and
<code class="literal">3.99</code> are converted into an actual <code class="literal">Float</code> type.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-null-element" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-null-element"></a>Null and empty string values</h4></div></div></div>

<p>Spring treats empty arguments for properties and the like as empty <code class="literal">Strings</code>. The
following XML-based configuration metadata snippet sets the email property to the empty
<code class="literal">String</code> value ("").</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ExampleBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"email"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The preceding example is equivalent to the following Java code:</p>
<pre class="programlisting">exampleBean.setEmail(<span class="hl-string">""</span>)</pre>
<p>The <code class="literal">&lt;null/&gt;</code> element handles <code class="literal">null</code> values. For example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ExampleBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"email"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;null/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The above configuration is equivalent to the following Java code:</p>
<pre class="programlisting">exampleBean.setEmail(null)</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-p-namespace" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-p-namespace"></a>XML shortcut with the p-namespace</h4></div></div></div>

<p>The p-namespace enables you to use the <code class="literal">bean</code> element’s attributes, instead of nested
<code class="literal">&lt;property/&gt;</code> elements, to describe your property values and/or collaborating beans.</p>
<p>Spring supports extensible configuration formats <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-configuration" title="41. XML Schema-based configuration">with namespaces</a>, which are
based on an XML Schema definition. The <code class="literal">beans</code> configuration format discussed in this
chapter is defined in an XML Schema document. However, the p-namespace is not defined in
an XSD file and exists only in the core of Spring.</p>
<p>The following example shows two XML snippets that resolve to the same result: The first
uses standard XML format and the second uses the p-namespace.</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">"http://www.springframework.org/schema/p"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"classic"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.ExampleBean"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"email"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"foo@bar.com"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"p-namespace"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.ExampleBean"</span>
        <span class="hl-attribute">p:email</span>=<span class="hl-value">"foo@bar.com"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The example shows an attribute in the p-namespace called email in the bean definition.
This tells Spring to include a property declaration. As previously mentioned, the
p-namespace does not have a schema definition, so you can set the name of the attribute
to the property name.</p>
<p>This next example includes two more bean definitions that both have a reference to
another bean:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">"http://www.springframework.org/schema/p"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"john-classic"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.Person"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"John Doe"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"spouse"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"jane"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"john-modern"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.Person"</span>
        <span class="hl-attribute">p:name</span>=<span class="hl-value">"John Doe"</span>
        <span class="hl-attribute">p:spouse-ref</span>=<span class="hl-value">"jane"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jane"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.Person"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Jane Doe"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>As you can see, this example includes not only a property value using the p-namespace,
but also uses a special format to declare property references. Whereas the first bean
definition uses <code class="literal">&lt;property name="spouse" ref="jane"/&gt;</code> to create a reference from bean
<code class="literal">john</code> to bean <code class="literal">jane</code>, the second bean definition uses <code class="literal">p:spouse-ref="jane"</code> as an
attribute to do the exact same thing. In this case <code class="literal">spouse</code> is the property name,
whereas the <code class="literal">-ref</code> part indicates that this is not a straight value but rather a
reference to another bean.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The p-namespace is not as flexible as the standard XML format. For example, the format
for declaring property references clashes with properties that end in <code class="literal">Ref</code>, whereas the
standard XML format does not. We recommend that you choose your approach carefully and
communicate this to your team members, to avoid producing XML documents that use all
three approaches at the same time.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-c-namespace" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-c-namespace"></a>XML shortcut with the c-namespace</h4></div></div></div>

<p>Similar to the <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-p-namespace" title="XML shortcut with the p-namespace">the section called “XML shortcut with the p-namespace”</a>, the <span class="emphasis"><em>c-namespace</em></span>, newly introduced in Spring
3.1, allows usage of inlined attributes for configuring the constructor arguments rather
then nested <code class="literal">constructor-arg</code> elements.</p>
<p>Let’s review the examples from <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-constructor-injection" title="Constructor-based dependency injection">the section called “Constructor-based dependency injection”</a> with the <code class="literal">c:</code> namespace:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:c</span>=<span class="hl-value">"http://www.springframework.org/schema/c"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Bar"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"baz"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Baz"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- traditional declaration --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"bar"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"baz"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"foo@bar.com"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- c-namespace declaration --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span> <span class="hl-attribute">c:bar-ref</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">c:baz-ref</span>=<span class="hl-value">"baz"</span> <span class="hl-attribute">c:email</span>=<span class="hl-value">"foo@bar.com"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The <code class="literal">c:</code> namespace uses the same conventions as the <code class="literal">p:</code> one (trailing <code class="literal">-ref</code> for bean
references) for setting the constructor arguments by their names. And just as well, it
needs to be declared even though it is not defined in an XSD schema (but it exists
inside the Spring core).</p>
<p>For the rare cases where the constructor argument names are not available (usually if
the bytecode was compiled without debugging information), one can use fallback to the
argument indexes:</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- c-namespace index declaration --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span> <span class="hl-attribute">c:_0-ref</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">c:_1-ref</span>=<span class="hl-value">"baz"</span><span class="hl-tag">/&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Due to the XML grammar, the index notation requires the presence of the leading <code class="literal">_</code> as
XML attribute names cannot start with a number (even though some IDE allow it).</p>
</td></tr></tbody></table></div>
<p>In practice, the constructor resolution
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-ctor-arguments-resolution" title="Constructor argument resolution">mechanism</a> is quite efficient in matching
arguments so unless one really needs to, we recommend using the name notation
through-out your configuration.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-compound-property-names" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-compound-property-names"></a>Compound property names</h4></div></div></div>

<p>You can use compound or nested property names when you set bean properties, as long as
all components of the path except the final property name are not <code class="literal">null</code>. Consider the
following bean definition.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"foo.Bar"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fred.bob.sammy"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"123"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The <code class="literal">foo</code> bean has a <code class="literal">fred</code> property, which has a <code class="literal">bob</code> property, which has a <code class="literal">sammy</code>
property, and that final <code class="literal">sammy</code> property is being set to the value <code class="literal">123</code>. In order for
this to work, the <code class="literal">fred</code> property of <code class="literal">foo</code>, and the <code class="literal">bob</code> property of <code class="literal">fred</code> must not be
<code class="literal">null</code> after the bean is constructed, or a <code class="literal">NullPointerException</code> is thrown.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-dependson" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-dependson"></a>7.4.3&nbsp;Using depends-on</h3></div></div></div>

<p>If a bean is a dependency of another that usually means that one bean is set as a
property of another. Typically you accomplish this with the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-ref-element" title="References to other beans (collaborators)"><code class="literal">&lt;ref/&gt;</code>
element</a> in XML-based configuration metadata. However, sometimes dependencies between
beans are less direct; for example, a static initializer in a class needs to be
triggered, such as database driver registration. The <code class="literal">depends-on</code> attribute can
explicitly force one or more beans to be initialized before the bean using this element
is initialized. The following example uses the <code class="literal">depends-on</code> attribute to express a
dependency on a single bean:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beanOne"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ExampleBean"</span> <span class="hl-attribute">depends-on</span>=<span class="hl-value">"manager"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"manager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ManagerBean"</span><span class="hl-tag"> /&gt;</span></pre>
<p>To express a dependency on multiple beans, supply a list of bean names as the value of
the <code class="literal">depends-on</code> attribute, with commas, whitespace and semicolons, used as valid
delimiters:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beanOne"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ExampleBean"</span> <span class="hl-attribute">depends-on</span>=<span class="hl-value">"manager,accountDao"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"manager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"manager"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"manager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"ManagerBean"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.jdbc.JdbcAccountDao"</span><span class="hl-tag"> /&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">depends-on</code> attribute in the bean definition can specify both an initialization
time dependency and, in the case of <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="7.5.1 The singleton scope">singleton</a> beans
only, a corresponding destroy time dependency. Dependent beans that define a
<code class="literal">depends-on</code> relationship with a given bean are destroyed first, prior to the given bean
itself being destroyed. Thus <code class="literal">depends-on</code> can also control shutdown order.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-lazy-init" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lazy-init"></a>7.4.4&nbsp;Lazy-initialized beans</h3></div></div></div>

<p>By default, <code class="literal">ApplicationContext</code> implementations eagerly create and configure all
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="7.5.1 The singleton scope">singleton</a> beans as part of the initialization
process. Generally, this pre-instantiation is desirable, because errors in the
configuration or surrounding environment are discovered immediately, as opposed to hours
or even days later. When this behavior is <span class="emphasis"><em>not</em></span> desirable, you can prevent
pre-instantiation of a singleton bean by marking the bean definition as
lazy-initialized. A lazy-initialized bean tells the IoC container to create a bean
instance when it is first requested, rather than at startup.</p>
<p>In XML, this behavior is controlled by the <code class="literal">lazy-init</code> attribute on the <code class="literal">&lt;bean/&gt;</code>
element; for example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lazy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.ExpensiveToCreateBean"</span> <span class="hl-attribute">lazy-init</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"not.lazy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.AnotherBean"</span><span class="hl-tag">/&gt;</span></pre>
<p>When the preceding configuration is consumed by an <code class="literal">ApplicationContext</code>, the bean named
<code class="literal">lazy</code> is not eagerly pre-instantiated when the <code class="literal">ApplicationContext</code> is starting up,
whereas the <code class="literal">not.lazy</code> bean is eagerly pre-instantiated.</p>
<p>However, when a lazy-initialized bean is a dependency of a singleton bean that is
<span class="emphasis"><em>not</em></span> lazy-initialized, the <code class="literal">ApplicationContext</code> creates the lazy-initialized bean at
startup, because it must satisfy the singleton’s dependencies. The lazy-initialized bean
is injected into a singleton bean elsewhere that is not lazy-initialized.</p>
<p>You can also control lazy-initialization at the container level by using the
<code class="literal">default-lazy-init</code> attribute on the <code class="literal">&lt;beans/&gt;</code> element; for example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">default-lazy-init</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- no beans will be pre-instantiated... --&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-autowire" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire"></a>7.4.5&nbsp;Autowiring collaborators</h3></div></div></div>

<p>The Spring container can <span class="emphasis"><em>autowire</em></span> relationships between collaborating beans. You can
allow Spring to resolve collaborators (other beans) automatically for your bean by
inspecting the contents of the <code class="literal">ApplicationContext</code>. Autowiring has the following
advantages:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Autowiring can significantly reduce the need to specify properties or constructor
arguments. (Other mechanisms such as a bean template
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-child-bean-definitions" title="7.7 Bean definition inheritance">discussed elsewhere in this chapter</a> are also valuable
in this regard.)
</li><li class="listitem">
Autowiring can update a configuration as your objects evolve. For example, if you need
to add a dependency to a class, that dependency can be satisfied automatically without
you needing to modify the configuration. Thus autowiring can be especially useful
during development, without negating the option of switching to explicit wiring when
the code base becomes more stable.
</li></ul></div>
<p>When using XML-based configuration metadata <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ftn.d5e2606" class="footnote" name="d5e2606"><sup class="footnote">[2]</sup></a>, you specify autowire
mode for a bean definition with the <code class="literal">autowire</code> attribute of the <code class="literal">&lt;bean/&gt;</code> element. The
autowiring functionality has four modes. You specify autowiring <span class="emphasis"><em>per</em></span> bean and thus
can choose which ones to autowire.</p>
<div class="table"><a name="beans-factory-autowiring-modes-tbl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowiring-modes-tbl"></a><p class="title"><b>Table&nbsp;7.2.&nbsp;Autowiring modes</b></p><div class="table-contents">

<table summary="Autowiring modes" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Mode</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>no</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>(Default) No autowiring. Bean references must be defined via a <code class="literal">ref</code> element. Changing
  the default setting is not recommended for larger deployments, because specifying
  collaborators explicitly gives greater control and clarity. To some extent, it
  documents the structure of a system.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>byName</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Autowiring by property name. Spring looks for a bean with the same name as the
  property that needs to be autowired. For example, if a bean definition is set to
  autowire by name, and it contains a <span class="emphasis"><em>master</em></span> property (that is, it has a
  <span class="emphasis"><em>setMaster(..)</em></span> method), Spring looks for a bean definition named <code class="literal">master</code>, and uses
  it to set the property.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>byType</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Allows a property to be autowired if exactly one bean of the property type exists in
  the container. If more than one exists, a fatal exception is thrown, which indicates
  that you may not use <span class="emphasis"><em>byType</em></span> autowiring for that bean. If there are no matching
  beans, nothing happens; the property is not set.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>constructor</p></td><td style="" align="left" valign="top"><p>Analogous to <span class="emphasis"><em>byType</em></span>, but applies to constructor arguments. If there is not exactly
  one bean of the constructor argument type in the container, a fatal error is raised.</p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>With <span class="emphasis"><em>byType</em></span> or <span class="emphasis"><em>constructor</em></span> autowiring mode, you can wire arrays and
typed-collections. In such cases <span class="emphasis"><em>all</em></span> autowire candidates within the container that
match the expected type are provided to satisfy the dependency. You can autowire
strongly-typed Maps if the expected key type is <code class="literal">String</code>. An autowired Maps values will
consist of all bean instances that match the expected type, and the Maps keys will
contain the corresponding bean names.</p>
<p>You can combine autowire behavior with dependency checking, which is performed after
autowiring completes.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-autowired-exceptions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-exceptions"></a>Limitations and disadvantages of autowiring</h4></div></div></div>

<p>Autowiring works best when it is used consistently across a project. If autowiring is
not used in general, it might be confusing to developers to use it to wire only one or
two bean definitions.</p>
<p>Consider the limitations and disadvantages of autowiring:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Explicit dependencies in <code class="literal">property</code> and <code class="literal">constructor-arg</code> settings always override
autowiring. You cannot autowire so-called <span class="emphasis"><em>simple</em></span> properties such as primitives,
<code class="literal">Strings</code>, and <code class="literal">Classes</code> (and arrays of such simple properties). This limitation is
by-design.
</li><li class="listitem">
Autowiring is less exact than explicit wiring. Although, as noted in the above table,
Spring is careful to avoid guessing in case of ambiguity that might have unexpected
results, the relationships between your Spring-managed objects are no longer
documented explicitly.
</li><li class="listitem">
Wiring information may not be available to tools that may generate documentation from
a Spring container.
</li><li class="listitem">
Multiple bean definitions within the container may match the type specified by the
setter method or constructor argument to be autowired. For arrays, collections, or
Maps, this is not necessarily a problem. However for dependencies that expect a single
value, this ambiguity is not arbitrarily resolved. If no unique bean definition is
available, an exception is thrown.
</li></ul></div>
<p>In the latter scenario, you have several options:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Abandon autowiring in favor of explicit wiring.
</li><li class="listitem">
Avoid autowiring for a bean definition by setting its <code class="literal">autowire-candidate</code> attributes
to <code class="literal">false</code> as described in the next section.
</li><li class="listitem">
Designate a single bean definition as the <span class="emphasis"><em>primary</em></span> candidate by setting the
<code class="literal">primary</code> attribute of its <code class="literal">&lt;bean/&gt;</code> element to <code class="literal">true</code>.
</li><li class="listitem">
Implement the more fine-grained control available
with annotation-based configuration, as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-annotation-config" title="7.9 Annotation-based container configuration">Section&nbsp;7.9, “Annotation-based container configuration”</a>.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-autowire-candidate" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire-candidate"></a>Excluding a bean from autowiring</h4></div></div></div>

<p>On a per-bean basis, you can exclude a bean from autowiring. In Spring’s XML format, set
the <code class="literal">autowire-candidate</code> attribute of the <code class="literal">&lt;bean/&gt;</code> element to <code class="literal">false</code>; the container
makes that specific bean definition unavailable to the autowiring infrastructure
(including annotation style configurations such as <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation" title="7.9.2 @Autowired"><code class="literal">@Autowired</code></a>).</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">autowire-candidate</code> attribute is designed to only affect type-based autowiring.
It does not affect explicit references by name, which will get resolved even if the
specified bean is not marked as an autowire candidate. As a consequence, autowiring
by name will nevertheless inject a bean if the name matches.</p>
</td></tr></tbody></table></div>
<p>You can also limit autowire candidates based on pattern-matching against bean names. The
top-level <code class="literal">&lt;beans/&gt;</code> element accepts one or more patterns within its
<code class="literal">default-autowire-candidates</code> attribute. For example, to limit autowire candidate status
to any bean whose name ends with <span class="emphasis"><em>Repository,</em></span> provide a value of *Repository. To
provide multiple patterns, define them in a comma-separated list. An explicit value of
<code class="literal">true</code> or <code class="literal">false</code> for a bean definitions <code class="literal">autowire-candidate</code> attribute always takes
precedence, and for such beans, the pattern matching rules do not apply.</p>
<p>These techniques are useful for beans that you never want to be injected into other
beans by autowiring. It does not mean that an excluded bean cannot itself be configured
using autowiring. Rather, the bean itself is not a candidate for autowiring other beans.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-method-injection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-method-injection"></a>7.4.6&nbsp;Method injection</h3></div></div></div>

<p>In most application scenarios, most beans in the container are
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="7.5.1 The singleton scope">singletons</a>. When a singleton bean needs to
collaborate with another singleton bean, or a non-singleton bean needs to collaborate
with another non-singleton bean, you typically handle the dependency by defining one
bean as a property of the other. A problem arises when the bean lifecycles are
different. Suppose singleton bean A needs to use non-singleton (prototype) bean B,
perhaps on each method invocation on A. The container only creates the singleton bean A
once, and thus only gets one opportunity to set the properties. The container cannot
provide bean A with a new instance of bean B every time one is needed.</p>
<p>A solution is to forego some inversion of control. You can <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-aware" title="7.6.2 ApplicationContextAware and BeanNameAware">make
bean A aware of the container</a> by implementing the <code class="literal">ApplicationContextAware</code> interface,
and by <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-client" title="7.2.3 Using the container">making a getBean("B") call to the container</a> ask for (a
typically new) bean B instance every time bean A needs it. The following is an example
of this approach:</p>
<pre class="programlisting"><span class="hl-comment">// a class that uses a stateful Command-style class to perform some processing</span>
<span class="hl-keyword">package</span> fiona.apple;

<span class="hl-comment">// Spring-API imports</span>
<span class="hl-keyword">import</span> org.springframework.beans.BeansException;
<span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.ApplicationContextAware;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CommandManager <span class="hl-keyword">implements</span> ApplicationContextAware {

    <span class="hl-keyword">private</span> ApplicationContext applicationContext;

    <span class="hl-keyword">public</span> Object process(Map commandState) {
        <span class="hl-comment">// grab a new instance of the appropriate Command</span>
        Command command = createCommand();
        <span class="hl-comment">// set the state on the (hopefully brand new) Command instance</span>
        command.setState(commandState);
        <span class="hl-keyword">return</span> command.execute();
    }

    <span class="hl-keyword">protected</span> Command createCommand() {
        <span class="hl-comment">// notice the Spring API dependency!</span>
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.applicationContext.getBean(<span class="hl-string">"command"</span>, Command.<span class="hl-keyword">class</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setApplicationContext(
            ApplicationContext applicationContext) <span class="hl-keyword">throws</span> BeansException {
        <span class="hl-keyword">this</span>.applicationContext = applicationContext;
    }
}</pre>
<p>The preceding is not desirable, because the business code is aware of and coupled to the
Spring Framework. Method Injection, a somewhat advanced feature of the Spring IoC
container, allows this use case to be handled in a clean fashion.</p>
<div class="sidebar"><div class="titlepage"></div>
<p>You can read more about the motivation for Method Injection in
<a class="ulink" href="https://spring.io/blog/2004/08/06/method-injection/" target="_top">this blog entry</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lookup-method-injection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lookup-method-injection"></a>Lookup method injection</h4></div></div></div>

<p>Lookup method injection is the ability of the container to override methods on
<span class="emphasis"><em>container managed beans</em></span>, to return the lookup result for another named bean in the
container. The lookup typically involves a prototype bean as in the scenario described
in the preceding section. The Spring Framework implements this method injection by using
bytecode generation from the CGLIB library to generate dynamically a subclass that
overrides the method.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
For this dynamic subclassing to work, the class that the Spring bean container will
subclass cannot be <code class="literal">final</code>, and the method to be overridden cannot be <code class="literal">final</code> either.
</li><li class="listitem">
Unit-testing a class that has an <code class="literal">abstract</code> method requires you to subclass the class
yourself and to supply a stub implementation of the <code class="literal">abstract</code> method.
</li><li class="listitem">
Concrete methods are also necessary for component scanning which requires concrete
classes to pick up.
</li><li class="listitem">
A further key limitation is that lookup methods won’t work with factory methods and
in particular not with <code class="literal">@Bean</code> methods in configuration classes, since the container
is not in charge of creating the instance in that case and therefore cannot create
a runtime-generated subclass on the fly.
</li></ul></div>
</td></tr></tbody></table></div>
<p>Looking at the <code class="literal">CommandManager</code> class in the previous code snippet, you see that the
Spring container will dynamically override the implementation of the <code class="literal">createCommand()</code>
method. Your <code class="literal">CommandManager</code> class will not have any Spring dependencies, as can be
seen in the reworked example:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> fiona.apple;

<span class="hl-comment">// no more Spring imports!</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CommandManager {

    <span class="hl-keyword">public</span> Object process(Object commandState) {
        <span class="hl-comment">// grab a new instance of the appropriate Command interface</span>
        Command command = createCommand();
        <span class="hl-comment">// set the state on the (hopefully brand new) Command instance</span>
        command.setState(commandState);
        <span class="hl-keyword">return</span> command.execute();
    }

    <span class="hl-comment">// okay... but where is the implementation of this method?</span>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Command createCommand();
}</pre>
<p>In the client class containing the method to be injected (the <code class="literal">CommandManager</code> in this
case), the method to be injected requires a signature of the following form:</p>
<pre class="programlisting"><span class="hl-tag">&lt;public|protected&gt;</span> [abstract] <span class="hl-tag">&lt;return-type&gt;</span> theMethodName(no-arguments);</pre>
<p>If the method is <code class="literal">abstract</code>, the dynamically-generated subclass implements the method.
Otherwise, the dynamically-generated subclass overrides the concrete method defined in
the original class. For example:</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- a stateful bean deployed as a prototype (non-singleton) --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myCommand"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"fiona.apple.AsyncCommand"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- inject dependencies here as required --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-comment">&lt;!-- commandProcessor uses statefulCommandHelper --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"commandManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"fiona.apple.CommandManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;lookup-method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"createCommand"</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"myCommand"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The bean identified as <span class="emphasis"><em>commandManager</em></span> calls its own method <code class="literal">createCommand()</code>
whenever it needs a new instance of the <span class="emphasis"><em>myCommand</em></span> bean. You must be careful to deploy
the <code class="literal">myCommand</code> bean as a prototype, if that is actually what is needed. If it is
 as a <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="7.5.1 The singleton scope">singleton</a>, the same instance of the <code class="literal">myCommand</code>
bean is returned each time.</p>
<p>Alternatively, within the annotation-based component model, you may declare a lookup
method through the <code class="literal">@Lookup</code> annotation:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CommandManager {

    <span class="hl-keyword">public</span> Object process(Object commandState) {
        Command command = createCommand();
        command.setState(commandState);
        <span class="hl-keyword">return</span> command.execute();
    }

    <em><span class="hl-annotation" style="color: gray">@Lookup("myCommand")</span></em>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Command createCommand();
}</pre>
<p>Or, more idiomatically, you may rely on the target bean getting resolved against the
declared return type of the lookup method:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CommandManager {

    <span class="hl-keyword">public</span> Object process(Object commandState) {
        MyCommand command = createCommand();
        command.setState(commandState);
        <span class="hl-keyword">return</span> command.execute();
    }

    <em><span class="hl-annotation" style="color: gray">@Lookup</span></em>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> MyCommand createCommand();
}</pre>
<p>Note that you will typically declare such annotated lookup methods with a concrete
stub implementation, in order for them to be compatible with Spring’s component
scanning rules where abstract classes get ignored by default. This limitation does not
apply in case of explicitly registered or explicitly imported bean classes.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Another way of accessing differently scoped target beans is an <code class="literal">ObjectFactory</code>/
<code class="literal">Provider</code> injection point. Check out <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection" title="Scoped beans as dependencies">the section called “Scoped beans as dependencies”</a>.</p>
<p>The interested reader may also find the <code class="literal">ServiceLocatorFactoryBean</code> (in the
<code class="literal">org.springframework.beans.factory.config</code> package) to be of use.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-arbitrary-method-replacement" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-arbitrary-method-replacement"></a>Arbitrary method replacement</h4></div></div></div>

<p>A less useful form of method injection than lookup method injection is the ability to
replace arbitrary methods in a managed bean with another method implementation. Users
may safely skip the rest of this section until the functionality is actually needed.</p>
<p>With XML-based configuration metadata, you can use the <code class="literal">replaced-method</code> element to
replace an existing method implementation with another, for a deployed bean. Consider
the following class, with a method computeValue, which we want to override:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyValueCalculator {

    <span class="hl-keyword">public</span> String computeValue(String input) {
        <span class="hl-comment">// some real code...</span>
    }

    <span class="hl-comment">// some other methods...</span>

}</pre>
<p>A class implementing the <code class="literal">org.springframework.beans.factory.support.MethodReplacer</code>
interface provides the new method definition.</p>
<pre class="programlisting"><strong class="hl-tag" style="color: blue">/**
 * meant to be used to override the existing computeValue(String)
 * implementation in MyValueCalculator
 */</strong>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ReplacementComputeValue <span class="hl-keyword">implements</span> MethodReplacer {

    <span class="hl-keyword">public</span> Object reimplement(Object o, Method m, Object[] args) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// get the input value, work with it, and return a computed result</span>
        String input = (String) args[<span class="hl-number">0</span>];
        ...
        <span class="hl-keyword">return</span> ...;
    }
}</pre>
<p>The bean definition to deploy the original class and specify the method override would
look like this:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myValueCalculator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.z.MyValueCalculator"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- arbitrary method replacement --&gt;</span>
    <span class="hl-tag">&lt;replaced-method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"computeValue"</span> <span class="hl-attribute">replacer</span>=<span class="hl-value">"replacementComputeValue"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;arg-type&gt;</span>String<span class="hl-tag">&lt;/arg-type&gt;</span>
    <span class="hl-tag">&lt;/replaced-method&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"replacementComputeValue"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"a.b.c.ReplacementComputeValue"</span><span class="hl-tag">/&gt;</span></pre>
<p>You can use one or more contained <code class="literal">&lt;arg-type/&gt;</code> elements within the <code class="literal">&lt;replaced-method/&gt;</code>
element to indicate the method signature of the method being overridden. The signature
for the arguments is necessary only if the method is overloaded and multiple variants
exist within the class. For convenience, the type string for an argument may be a
substring of the fully qualified type name. For example, the following all match
<code class="literal">java.lang.String</code>:</p>
<pre class="programlisting">java.lang.String
String
Str</pre>
<p>Because the number of arguments is often enough to distinguish between each possible
choice, this shortcut can save a lot of typing, by allowing you to type only the
shortest string that will match an argument type.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-factory-scopes" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes"></a>7.5&nbsp;Bean scopes</h2></div></div></div>

<p>When you create a bean definition, you create a <span class="emphasis"><em>recipe</em></span> for creating actual instances
of the class defined by that bean definition. The idea that a bean definition is a
recipe is important, because it means that, as with a class, you can create many object
instances from a single recipe.</p>
<p>You can control not only the various dependencies and configuration values that are to
be plugged into an object that is created from a particular bean definition, but also
the <span class="emphasis"><em>scope</em></span> of the objects created from a particular bean definition. This approach is
powerful and flexible in that you can <span class="emphasis"><em>choose</em></span> the scope of the objects you create
through configuration instead of having to bake in the scope of an object at the Java
class level. Beans can be defined to be deployed in one of a number of scopes: out of
the box, the Spring Framework supports seven scopes, five of which are available only if
you use a web-aware <code class="literal">ApplicationContext</code>.</p>
<p>The following scopes are supported out of the box. You can also create
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom" title="7.5.5 Custom scopes">a custom scope.</a></p>
<div class="table"><a name="beans-factory-scopes-tbl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-tbl"></a><p class="title"><b>Table&nbsp;7.3.&nbsp;Bean scopes</b></p><div class="table-contents">

<table summary="Bean scopes" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Scope</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="7.5.1 The singleton scope">singleton</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>(Default) Scopes a single bean definition to a single object instance per Spring IoC
  container.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-prototype" title="7.5.2 The prototype scope">prototype</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Scopes a single bean definition to any number of object instances.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-request" title="Request scope">request</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Scopes a single bean definition to the lifecycle of a single HTTP request; that is,
  each HTTP request has its own instance of a bean created off the back of a single bean
  definition. Only valid in the context of a web-aware Spring <code class="literal">ApplicationContext</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-session" title="Session scope">session</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Scopes a single bean definition to the lifecycle of an HTTP <code class="literal">Session</code>. Only valid in
  the context of a web-aware Spring <code class="literal">ApplicationContext</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-global-session" title="Global session scope">globalSession</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Scopes a single bean definition to the lifecycle of a global HTTP <code class="literal">Session</code>. Typically
  only valid when used in a Portlet context. Only valid in the context of a web-aware
  Spring <code class="literal">ApplicationContext</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-application" title="Application scope">application</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Scopes a single bean definition to the lifecycle of a <code class="literal">ServletContext</code>. Only valid in
  the context of a web-aware Spring <code class="literal">ApplicationContext</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#websocket-stomp-websocket-scope" title="26.4.15 WebSocket Scope">websocket</a></p></td><td style="" align="left" valign="top"><p>Scopes a single bean definition to the lifecycle of a <code class="literal">WebSocket</code>. Only valid in
  the context of a web-aware Spring <code class="literal">ApplicationContext</code>.</p></td></tr></tbody></table>
</div></div><br class="table-break">
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>As of Spring 3.0, a <span class="emphasis"><em>thread scope</em></span> is available, but is not registered by default. For
more information, see the documentation for
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/support/SimpleThreadScope.html" target="_top"><code class="literal">SimpleThreadScope</code></a>.
For instructions on how to register this or any other custom scope, see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom-using" title="Using a custom scope">the section called “Using a custom scope”</a>.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-singleton" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton"></a>7.5.1&nbsp;The singleton scope</h3></div></div></div>

<p>Only one <span class="emphasis"><em>shared</em></span> instance of a singleton bean is managed, and all requests for beans
with an id or ids matching that bean definition result in that one specific bean
instance being returned by the Spring container.</p>
<p>To put it another way, when you define a bean definition and it is scoped as a
singleton, the Spring IoC container creates <span class="emphasis"><em>exactly one</em></span> instance of the object
defined by that bean definition. This single instance is stored in a cache of such
singleton beans, and <span class="emphasis"><em>all subsequent requests and references</em></span> for that named bean
return the cached object.</p>
<div class="informalfigure">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/singleton.png.pagespeed.ce.U0lSEQUK39.png" alt="singleton"></div>
</div>
<p>Spring’s concept of a singleton bean differs from the Singleton pattern as defined in
the Gang of Four (GoF) patterns book. The GoF Singleton hard-codes the scope of an
object such that one <span class="emphasis"><em>and only one</em></span> instance of a particular class is created <span class="emphasis"><em>per
ClassLoader</em></span>. The scope of the Spring singleton is best described as <span class="emphasis"><em>per container
and per bean</em></span>. This means that if you define one bean for a particular class in a
single Spring container, then the Spring container creates one <span class="emphasis"><em>and only one</em></span> instance
of the class defined by that bean definition. <span class="emphasis"><em>The singleton scope is the default scope
in Spring</em></span>. To define a bean as a singleton in XML, you would write, for example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultAccountService"</span><span class="hl-tag">/&gt;</span>

<span class="hl-comment">&lt;!-- the following is equivalent, though redundant (singleton scope is the default) --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultAccountService"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"singleton"</span><span class="hl-tag">/&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-prototype" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-prototype"></a>7.5.2&nbsp;The prototype scope</h3></div></div></div>

<p>The non-singleton, prototype scope of bean deployment results in the <span class="emphasis"><em>creation of a new
bean instance</em></span> every time a request for that specific bean is made. That is, the bean
is injected into another bean or you request it through a <code class="literal">getBean()</code> method call on the
container. As a rule, use the prototype scope for all stateful beans and the singleton
scope for stateless beans.</p>
<p>The following diagram illustrates the Spring prototype scope. <span class="emphasis"><em>A data access object
(DAO) is not typically configured as a prototype, because a typical DAO does not hold
any conversational state; it was just easier for this author to reuse the core of the
singleton diagram.</em></span></p>
<div class="informalfigure">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/prototype.png.pagespeed.ce._EP1ydjN29.png" alt="prototype"></div>
</div>
<p>The following example defines a bean as a prototype in XML:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultAccountService"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span><span class="hl-tag">/&gt;</span></pre>
<p>In contrast to the other scopes, Spring does not manage the complete lifecycle of a
prototype bean: the container instantiates, configures, and otherwise assembles a
prototype object, and hands it to the client, with no further record of that prototype
instance. Thus, although<span class="emphasis"><em> initialization</em></span> lifecycle callback methods are called on all
objects regardless of scope, in the case of prototypes, configured <span class="emphasis"><em>destruction</em></span>
lifecycle callbacks are <span class="emphasis"><em>not</em></span> called. The client code must clean up prototype-scoped
objects and release expensive resources that the prototype bean(s) are holding. To get
the Spring container to release resources held by prototype-scoped beans, try using a
custom <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp" title="7.8.1 Customizing beans using a BeanPostProcessor">bean post-processor</a>, which holds a reference to
beans that need to be cleaned up.</p>
<p>In some respects, the Spring container’s role in regard to a prototype-scoped bean is a
replacement for the Java <code class="literal">new</code> operator. All lifecycle management past that point must
be handled by the client. (For details on the lifecycle of a bean in the Spring
container, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle" title="7.6.1 Lifecycle callbacks">Section&nbsp;7.6.1, “Lifecycle callbacks”</a>.)</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-sing-prot-interaction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-sing-prot-interaction"></a>7.5.3&nbsp;Singleton beans with prototype-bean dependencies</h3></div></div></div>

<p>When you use singleton-scoped beans with dependencies on prototype beans, be aware that
<span class="emphasis"><em>dependencies are resolved at instantiation time</em></span>. Thus if you dependency-inject a
prototype-scoped bean into a singleton-scoped bean, a new prototype bean is instantiated
and then dependency-injected into the singleton bean. The prototype instance is the sole
instance that is ever supplied to the singleton-scoped bean.</p>
<p>However, suppose you want the singleton-scoped bean to acquire a new instance of the
prototype-scoped bean repeatedly at runtime. You cannot dependency-inject a
prototype-scoped bean into your singleton bean, because that injection occurs only
<span class="emphasis"><em>once</em></span>, when the Spring container is instantiating the singleton bean and resolving
and injecting its dependencies. If you need a new instance of a prototype bean at
runtime more than once, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-method-injection" title="7.4.6 Method injection">Section&nbsp;7.4.6, “Method injection”</a></p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-other" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other"></a>7.5.4&nbsp;Request, session, global session, application, and WebSocket scopes</h3></div></div></div>

<p>The <code class="literal">request</code>, <code class="literal">session</code>, <code class="literal">globalSession</code>, <code class="literal">application</code>, and <code class="literal">websocket</code> scopes are
<span class="emphasis"><em>only</em></span> available if you use a web-aware Spring <code class="literal">ApplicationContext</code> implementation
(such as <code class="literal">XmlWebApplicationContext</code>). If you use these scopes with regular Spring IoC
containers such as the <code class="literal">ClassPathXmlApplicationContext</code>, an <code class="literal">IllegalStateException</code> will
be thrown complaining about an unknown bean scope.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-other-web-configuration" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-web-configuration"></a>Initial web configuration</h4></div></div></div>

<p>To support the scoping of beans at the <code class="literal">request</code>, <code class="literal">session</code>, <code class="literal">globalSession</code>,
<code class="literal">application</code>, and <code class="literal">websocket</code> levels (web-scoped beans), some minor initial
configuration is required before you define your beans. (This initial setup is <span class="emphasis"><em>not</em></span>
required for the standard scopes, <code class="literal">singleton</code> and <code class="literal">prototype</code>.)</p>
<p>How you accomplish this initial setup depends on your particular Servlet environment.</p>
<p>If you access scoped beans within Spring Web MVC, in effect, within a request that is
processed by the Spring <code class="literal">DispatcherServlet</code> or <code class="literal">DispatcherPortlet</code>, then no special
setup is necessary: <code class="literal">DispatcherServlet</code> and <code class="literal">DispatcherPortlet</code> already expose all
relevant state.</p>
<p>If you use a Servlet 2.5 web container, with requests processed outside of Spring’s
<code class="literal">DispatcherServlet</code> (for example, when using JSF or Struts), you need to register the
<code class="literal">org.springframework.web.context.request.RequestContextListener</code> <code class="literal">ServletRequestListener</code>.
For Servlet 3.0+, this can be done programmatically via the <code class="literal">WebApplicationInitializer</code>
interface. Alternatively, or for older containers, add the following declaration to
your web application’s <code class="literal">web.xml</code> file:</p>
<pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    ...
    <span class="hl-tag">&lt;listener&gt;</span>
        <span class="hl-tag">&lt;listener-class&gt;</span>
            org.springframework.web.context.request.RequestContextListener
        <span class="hl-tag">&lt;/listener-class&gt;</span>
    <span class="hl-tag">&lt;/listener&gt;</span>
    ...
<span class="hl-tag">&lt;/web-app&gt;</span></pre>
<p>Alternatively, if there are issues with your listener setup, consider using Spring’s
<code class="literal">RequestContextFilter</code>. The filter mapping depends on the surrounding web
application configuration, so you have to change it as appropriate.</p>
<pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    ...
    <span class="hl-tag">&lt;filter&gt;</span>
        <span class="hl-tag">&lt;filter-name&gt;</span>requestContextFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
        <span class="hl-tag">&lt;filter-class&gt;</span>org.springframework.web.filter.RequestContextFilter<span class="hl-tag">&lt;/filter-class&gt;</span>
    <span class="hl-tag">&lt;/filter&gt;</span>
    <span class="hl-tag">&lt;filter-mapping&gt;</span>
        <span class="hl-tag">&lt;filter-name&gt;</span>requestContextFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
    <span class="hl-tag">&lt;/filter-mapping&gt;</span>
    ...
<span class="hl-tag">&lt;/web-app&gt;</span></pre>
<p><code class="literal">DispatcherServlet</code>, <code class="literal">RequestContextListener</code>, and <code class="literal">RequestContextFilter</code> all do exactly
the same thing, namely bind the HTTP request object to the <code class="literal">Thread</code> that is servicing
that request. This makes beans that are request- and session-scoped available further
down the call chain.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-request" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-request"></a>Request scope</h4></div></div></div>

<p>Consider the following XML configuration for a bean definition:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"loginAction"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.LoginAction"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"request"</span><span class="hl-tag">/&gt;</span></pre>
<p>The Spring container creates a new instance of the <code class="literal">LoginAction</code> bean by using the
<code class="literal">loginAction</code> bean definition for each and every HTTP request. That is, the
<code class="literal">loginAction</code> bean is scoped at the HTTP request level. You can change the internal
state of the instance that is created as much as you want, because other instances
created from the same <code class="literal">loginAction</code> bean definition will not see these changes in state;
they are particular to an individual request. When the request completes processing, the
bean that is scoped to the request is discarded.</p>
<p>When using annotation-driven components or Java Config, the <code class="literal">@RequestScope</code> annotation
can be used to assign a component to the <code class="literal">request</code> scope.</p>
<pre class="programlisting"><span class="strong"><strong>@RequestScope</strong></span>
<em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LoginAction {
    <span class="hl-comment">// ...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-session" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-session"></a>Session scope</h4></div></div></div>

<p>Consider the following XML configuration for a bean definition:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span><span class="hl-tag">/&gt;</span></pre>
<p>The Spring container creates a new instance of the <code class="literal">UserPreferences</code> bean by using the
<code class="literal">userPreferences</code> bean definition for the lifetime of a single HTTP <code class="literal">Session</code>. In other
words, the <code class="literal">userPreferences</code> bean is effectively scoped at the HTTP <code class="literal">Session</code> level. As
with <code class="literal">request-scoped</code> beans, you can change the internal state of the instance that is
created as much as you want, knowing that other HTTP <code class="literal">Session</code> instances that are also
using instances created from the same <code class="literal">userPreferences</code> bean definition do not see these
changes in state, because they are particular to an individual HTTP <code class="literal">Session</code>. When the
HTTP <code class="literal">Session</code> is eventually discarded, the bean that is scoped to that particular HTTP
<code class="literal">Session</code> is also discarded.</p>
<p>When using annotation-driven components or Java Config, the <code class="literal">@SessionScope</code> annotation
can be used to assign a component to the <code class="literal">session</code> scope.</p>
<pre class="programlisting"><span class="strong"><strong>@SessionScope</strong></span>
<em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserPreferences {
    <span class="hl-comment">// ...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-global-session" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-global-session"></a>Global session scope</h4></div></div></div>

<p>Consider the following bean definition:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"globalSession"</span><span class="hl-tag">/&gt;</span></pre>
<p>The <code class="literal">globalSession</code> scope is similar to the standard HTTP <code class="literal">Session</code> scope
(<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-session" title="Session scope">described above</a>), and applies only in the context of
portlet-based web applications. The portlet specification defines the notion of a global
<code class="literal">Session</code> that is shared among all portlets that make up a single portlet web
application. Beans defined at the <code class="literal">globalSession</code> scope are scoped (or bound) to the
lifetime of the global portlet <code class="literal">Session</code>.</p>
<p>If you write a standard Servlet-based web application and you define one or more beans
as having <code class="literal">globalSession</code> scope, the standard HTTP <code class="literal">Session</code> scope is used, and no
error is raised.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-application" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-application"></a>Application scope</h4></div></div></div>

<p>Consider the following XML configuration for a bean definition:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"appPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.AppPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"application"</span><span class="hl-tag">/&gt;</span></pre>
<p>The Spring container creates a new instance of the <code class="literal">AppPreferences</code> bean by using the
<code class="literal">appPreferences</code> bean definition once for the entire web application. That is, the
<code class="literal">appPreferences</code> bean is scoped at the <code class="literal">ServletContext</code> level, stored as a regular
<code class="literal">ServletContext</code> attribute. This is somewhat similar to a Spring singleton bean but
differs in two important ways: It is a singleton per <code class="literal">ServletContext</code>, not per Spring
'ApplicationContext' (for which there may be several in any given web application),
and it is actually exposed and therefore visible as a <code class="literal">ServletContext</code> attribute.</p>
<p>When using annotation-driven components or Java Config, the <code class="literal">@ApplicationScope</code>
annotation can be used to assign a component to the <code class="literal">application</code> scope.</p>
<pre class="programlisting"><span class="strong"><strong>@ApplicationScope</strong></span>
<em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppPreferences {
    <span class="hl-comment">// ...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-other-injection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection"></a>Scoped beans as dependencies</h4></div></div></div>

<p>The Spring IoC container manages not only the instantiation of your objects (beans),
but also the wiring up of collaborators (or dependencies). If you want to inject (for
example) an HTTP request scoped bean into another bean of a longer-lived scope, you may
choose to inject an AOP proxy in place of the scoped bean. That is, you need to inject
a proxy object that exposes the same public interface as the scoped object but that can
also retrieve the real target object from the relevant scope (such as an HTTP request)
and delegate method calls onto the real object.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>You may also use <code class="literal">&lt;aop:scoped-proxy/&gt;</code> between beans that are scoped as <code class="literal">singleton</code>,
with the reference then going through an intermediate proxy that is serializable
and therefore able to re-obtain the target singleton bean on deserialization.</p>
<p>When declaring <code class="literal">&lt;aop:scoped-proxy/&gt;</code> against a bean of scope <code class="literal">prototype</code>, every method
call on the shared proxy will lead to the creation of a new target instance which the
call is then being forwarded to.</p>
<p>Also, scoped proxies are not the only way to access beans from shorter scopes in a
lifecycle-safe fashion. You may also simply declare your injection point (i.e. the
constructor/setter argument or autowired field) as <code class="literal">ObjectFactory&lt;MyTargetBean&gt;</code>,
allowing for a <code class="literal">getObject()</code> call to retrieve the current instance on demand every
time it is needed - without holding on to the instance or storing it separately.</p>
<p>The JSR-330 variant of this is called <code class="literal">Provider</code>, used with a <code class="literal">Provider&lt;MyTargetBean&gt;</code>
declaration and a corresponding <code class="literal">get()</code> call for every retrieval attempt.
See <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-standard-annotations" title="7.11 Using JSR 330 Standard Annotations">here</a> for more details on JSR-330 overall.</p>
</td></tr></tbody></table></div>
<p>The configuration in the following example is only one line, but it is important to
understand the "why" as well as the "how" behind it.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- an HTTP Session-scoped bean exposed as a proxy --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- instructs the container to proxy the surrounding bean --&gt;</span>
        <span class="hl-tag">&lt;aop:scoped-proxy/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- a singleton-scoped bean injected with a proxy to the above bean --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.SimpleUserService"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- a reference to the proxied userPreferences bean --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"userPreferences"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>To create such a proxy, you insert a child <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element into a scoped
bean definition (see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection-proxies" title="Choosing the type of proxy to create">the section called “Choosing the type of proxy to create”</a> and
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-configuration" title="41. XML Schema-based configuration">Chapter&nbsp;41, <i>XML Schema-based configuration</i></a>). Why do definitions of beans scoped at the <code class="literal">request</code>, <code class="literal">session</code>,
<code class="literal">globalSession</code> and custom-scope levels require the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element?
Let’s examine the following singleton bean definition and contrast it with what you need
to define for the aforementioned scopes (note that the following <code class="literal">userPreferences</code> bean
definition as it stands is <span class="emphasis"><em>incomplete</em></span>).</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"userPreferences"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>In the preceding example, the singleton bean <code class="literal">userManager</code> is injected with a reference
to the HTTP <code class="literal">Session</code>-scoped bean <code class="literal">userPreferences</code>. The salient point here is that the
<code class="literal">userManager</code> bean is a singleton: it will be instantiated <span class="emphasis"><em>exactly once</em></span> per
container, and its dependencies (in this case only one, the <code class="literal">userPreferences</code> bean) are
also injected only once. This means that the <code class="literal">userManager</code> bean will only operate on the
exact same <code class="literal">userPreferences</code> object, that is, the one that it was originally injected
with.</p>
<p>This is <span class="emphasis"><em>not</em></span> the behavior you want when injecting a shorter-lived scoped bean into a
longer-lived scoped bean, for example injecting an HTTP <code class="literal">Session</code>-scoped collaborating
bean as a dependency into singleton bean. Rather, you need a single <code class="literal">userManager</code>
object, and for the lifetime of an HTTP <code class="literal">Session</code>, you need a <code class="literal">userPreferences</code> object
that is specific to said HTTP <code class="literal">Session</code>. Thus the container creates an object that
exposes the exact same public interface as the <code class="literal">UserPreferences</code> class (ideally an
object that <span class="emphasis"><em>is a</em></span> <code class="literal">UserPreferences</code> instance) which can fetch the real
<code class="literal">UserPreferences</code> object from the scoping mechanism (HTTP request, <code class="literal">Session</code>, etc.). The
container injects this proxy object into the <code class="literal">userManager</code> bean, which is unaware that
this <code class="literal">UserPreferences</code> reference is a proxy. In this example, when a <code class="literal">UserManager</code>
instance invokes a method on the dependency-injected <code class="literal">UserPreferences</code> object, it
actually is invoking a method on the proxy. The proxy then fetches the real
<code class="literal">UserPreferences</code> object from (in this case) the HTTP <code class="literal">Session</code>, and delegates the
method invocation onto the retrieved real <code class="literal">UserPreferences</code> object.</p>
<p>Thus you need the following, correct and complete, configuration when injecting
<code class="literal">request-</code>, <code class="literal">session-</code>, and <code class="literal">globalSession-scoped</code> beans into collaborating objects:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;aop:scoped-proxy/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"userPreferences"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-factory-scopes-other-injection-proxies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection-proxies"></a>Choosing the type of proxy to create</h5></div></div></div>

<p>By default, when the Spring container creates a proxy for a bean that is marked up with
the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element, <span class="emphasis"><em>a CGLIB-based class proxy is created</em></span>.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>CGLIB proxies only intercept public method calls! Do not call non-public methods
on such a proxy; they will not be delegated to the actual scoped target object.</p>
</td></tr></tbody></table></div>
<p>Alternatively, you can configure the Spring container to create standard JDK
interface-based proxies for such scoped beans, by specifying <code class="literal">false</code> for the value of
the <code class="literal">proxy-target-class</code> attribute of the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element. Using JDK
interface-based proxies means that you do not need additional libraries in your
application classpath to effect such proxying. However, it also means that the class of
the scoped bean must implement at least one interface, and <span class="emphasis"><em>that all</em></span> collaborators
into which the scoped bean is injected must reference the bean through one of its
interfaces.</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- DefaultUserPreferences implements the UserPreferences interface --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultUserPreferences"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;aop:scoped-proxy</span> <span class="hl-attribute">proxy-target-class</span>=<span class="hl-value">"false"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.UserManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"userPreferences"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"userPreferences"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>For more detailed information about choosing class-based or interface-based proxying,
see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-proxying" title="11.6 Proxying mechanisms">Section&nbsp;11.6, “Proxying mechanisms”</a>.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-scopes-custom" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom"></a>7.5.5&nbsp;Custom scopes</h3></div></div></div>

<p>The bean scoping mechanism is extensible; You can define your own
scopes, or even redefine existing scopes, although the latter is considered bad practice
and you <span class="emphasis"><em>cannot</em></span> override the built-in <code class="literal">singleton</code> and <code class="literal">prototype</code> scopes.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-custom-creating" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom-creating"></a>Creating a custom scope</h4></div></div></div>

<p>To integrate your custom scope(s) into the Spring container, you need to implement the
<code class="literal">org.springframework.beans.factory.config.Scope</code> interface, which is described in this
section. For an idea of how to implement your own scopes, see the <code class="literal">Scope</code>
implementations that are supplied with the Spring Framework itself and the
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/beans/factory/config/Scope.html" target="_top"><code class="literal">Scope</code> javadocs</a>,
which explains the methods you need to implement in more detail.</p>
<p>The <code class="literal">Scope</code> interface has four methods to get objects from the scope, remove them from
the scope, and allow them to be destroyed.</p>
<p>The following method returns the object from the underlying scope. The session scope
implementation, for example, returns the session-scoped bean (and if it does not exist,
the method returns a new instance of the bean, after having bound it to the session for
future reference).</p>
<pre class="programlisting">Object get(String name, ObjectFactory objectFactory)</pre>
<p>The following method removes the object from the underlying scope. The session scope
implementation for example, removes the session-scoped bean from the underlying session.
The object should be returned, but you can return null if the object with the specified
name is not found.</p>
<pre class="programlisting">Object remove(String name)</pre>
<p>The following method registers the callbacks the scope should execute when it is
destroyed or when the specified object in the scope is destroyed. Refer to the javadocs
or a Spring scope implementation for more information on destruction callbacks.</p>
<pre class="programlisting"><span class="hl-keyword">void</span> registerDestructionCallback(String name, Runnable destructionCallback)</pre>
<p>The following method obtains the conversation identifier for the underlying scope. This
identifier is different for each scope. For a session scoped implementation, this
identifier can be the session identifier.</p>
<pre class="programlisting">String getConversationId()</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-scopes-custom-using" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom-using"></a>Using a custom scope</h4></div></div></div>

<p>After you write and test one or more custom <code class="literal">Scope</code> implementations, you need to make
the Spring container aware of your new scope(s). The following method is the central
method to register a new <code class="literal">Scope</code> with the Spring container:</p>
<pre class="programlisting"><span class="hl-keyword">void</span> registerScope(String scopeName, Scope scope);</pre>
<p>This method is declared on the <code class="literal">ConfigurableBeanFactory</code> interface, which is available
on most of the concrete <code class="literal">ApplicationContext</code> implementations that ship with Spring via
the BeanFactory property.</p>
<p>The first argument to the <code class="literal">registerScope(..)</code> method is the unique name associated with
a scope; examples of such names in the Spring container itself are <code class="literal">singleton</code> and
<code class="literal">prototype</code>. The second argument to the <code class="literal">registerScope(..)</code> method is an actual instance
of the custom <code class="literal">Scope</code> implementation that you wish to register and use.</p>
<p>Suppose that you write your custom <code class="literal">Scope</code> implementation, and then register it as below.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The example below uses <code class="literal">SimpleThreadScope</code> which is included with Spring, but not
registered by default. The instructions would be the same for your own custom <code class="literal">Scope</code>
implementations.</p>
</td></tr></tbody></table></div>
<pre class="programlisting">Scope threadScope = <span class="hl-keyword">new</span> SimpleThreadScope();
beanFactory.registerScope(<span class="hl-string">"thread"</span>, threadScope);</pre>
<p>You then create bean definitions that adhere to the scoping rules of your custom <code class="literal">Scope</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"thread"</span><span class="hl-tag">&gt;</span></pre>
<p>With a custom <code class="literal">Scope</code> implementation, you are not limited to programmatic registration
of the scope. You can also do the <code class="literal">Scope</code> registration declaratively, using the
<code class="literal">CustomScopeConfigurer</code> class:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.CustomScopeConfigurer"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"scopes"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"thread"</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.SimpleThreadScope"</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;/entry&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Bar"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"thread"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Rick"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;aop:scoped-proxy/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"foo"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.Foo"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bar"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"bar"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>When you place <code class="literal">&lt;aop:scoped-proxy/&gt;</code> in a <code class="literal">FactoryBean</code> implementation, it is the factory
bean itself that is scoped, not the object returned from <code class="literal">getObject()</code>.</p>
</td></tr></tbody></table></div>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-factory-nature" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-nature"></a>7.6&nbsp;Customizing the nature of a bean</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-lifecycle" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle"></a>7.6.1&nbsp;Lifecycle callbacks</h3></div></div></div>

<p>To interact with the container’s management of the bean lifecycle, you can implement the
Spring <code class="literal">InitializingBean</code> and <code class="literal">DisposableBean</code> interfaces. The container calls
<code class="literal">afterPropertiesSet()</code> for the former and <code class="literal">destroy()</code> for the latter to allow the bean
to perform certain actions upon initialization and destruction of your beans.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>The JSR-250 <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> annotations are generally considered best
practice for receiving lifecycle callbacks in a modern Spring application. Using these
annotations means that your beans are not coupled to Spring specific interfaces. For
details see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="7.9.8 @PostConstruct and @PreDestroy">Section&nbsp;7.9.8, “@PostConstruct and @PreDestroy”</a>.</p>
<p>If you don’t want to use the JSR-250 annotations but you are still looking to remove
coupling consider the use of init-method and destroy-method object definition metadata.</p>
</td></tr></tbody></table></div>
<p>Internally, the Spring Framework uses <code class="literal">BeanPostProcessor</code> implementations to process any
callback interfaces it can find and call the appropriate methods. If you need custom
features or other lifecycle behavior Spring does not offer out-of-the-box, you can
implement a <code class="literal">BeanPostProcessor</code> yourself. For more information, see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension" title="7.8 Container Extension Points">Section&nbsp;7.8, “Container Extension Points”</a>.</p>
<p>In addition to the initialization and destruction callbacks, Spring-managed objects may
also implement the <code class="literal">Lifecycle</code> interface so that those objects can participate in the
startup and shutdown process as driven by the container’s own lifecycle.</p>
<p>The lifecycle callback interfaces are described in this section.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-initializingbean" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean"></a>Initialization callbacks</h4></div></div></div>

<p>The <code class="literal">org.springframework.beans.factory.InitializingBean</code> interface allows a bean to
perform initialization work after all necessary properties on the bean have been set by
the container. The <code class="literal">InitializingBean</code> interface specifies a single method:</p>
<pre class="programlisting"><span class="hl-keyword">void</span> afterPropertiesSet() <span class="hl-keyword">throws</span> Exception;</pre>
<p>It is recommended that you do not use the <code class="literal">InitializingBean</code> interface because it
unnecessarily couples the code to Spring. Alternatively, use
the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="7.9.8 @PostConstruct and @PreDestroy"><code class="literal">@PostConstruct</code></a> annotation or
specify a POJO initialization method. In the case of XML-based configuration metadata,
you use the <code class="literal">init-method</code> attribute to specify the name of the method that has a void
no-argument signature. With Java config, you use the <code class="literal">initMethod</code> attribute of <code class="literal">@Bean</code>,
see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-lifecycle-callbacks" title="Receiving lifecycle callbacks">the section called “Receiving lifecycle callbacks”</a>. For example, the following:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleInitBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span> <span class="hl-attribute">init-method</span>=<span class="hl-value">"init"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
        <span class="hl-comment">// do some initialization work</span>
    }

}</pre>
<p>…&#8203;is exactly the same as…&#8203;</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleInitBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherExampleBean"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnotherExampleBean <span class="hl-keyword">implements</span> InitializingBean {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterPropertiesSet() {
        <span class="hl-comment">// do some initialization work</span>
    }

}</pre>
<p>but does not couple the code to Spring.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-disposablebean" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean"></a>Destruction callbacks</h4></div></div></div>

<p>Implementing the <code class="literal">org.springframework.beans.factory.DisposableBean</code> interface allows a
bean to get a callback when the container containing it is destroyed. The
<code class="literal">DisposableBean</code> interface specifies a single method:</p>
<pre class="programlisting"><span class="hl-keyword">void</span> destroy() <span class="hl-keyword">throws</span> Exception;</pre>
<p>It is recommended that you do not use the <code class="literal">DisposableBean</code> callback interface because it
unnecessarily couples the code to Spring. Alternatively, use
the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="7.9.8 @PostConstruct and @PreDestroy"><code class="literal">@PreDestroy</code></a> annotation or
specify a generic method that is supported by bean definitions. With XML-based
configuration metadata, you use the <code class="literal">destroy-method</code> attribute on the <code class="literal">&lt;bean/&gt;</code>.
With Java config, you use the <code class="literal">destroyMethod</code> attribute of <code class="literal">@Bean</code>, see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-lifecycle-callbacks" title="Receiving lifecycle callbacks">the section called “Receiving lifecycle callbacks”</a>. For example, the following definition:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleInitBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.ExampleBean"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"cleanup"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cleanup() {
        <span class="hl-comment">// do some destruction work (like releasing pooled connections)</span>
    }

}</pre>
<p>is exactly the same as:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"exampleInitBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"examples.AnotherExampleBean"</span><span class="hl-tag">/&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnotherExampleBean <span class="hl-keyword">implements</span> DisposableBean {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> destroy() {
        <span class="hl-comment">// do some destruction work (like releasing pooled connections)</span>
    }

}</pre>
<p>but does not couple the code to Spring.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">destroy-method</code> attribute of a <code class="literal">&lt;bean&gt;</code> element can be assigned a special
<code class="literal">(inferred)</code> value which instructs Spring to automatically detect a public <code class="literal">close</code> or
<code class="literal">shutdown</code> method on the specific bean class (any class that implements
<code class="literal">java.lang.AutoCloseable</code> or <code class="literal">java.io.Closeable</code> would therefore match). This special
<code class="literal">(inferred)</code> value can also be set on the <code class="literal">default-destroy-method</code> attribute of a
<code class="literal">&lt;beans&gt;</code> element to apply this behavior to an entire set of beans (see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-default-init-destroy-methods" title="Default initialization and destroy methods">the section called “Default initialization and destroy methods”</a>). Note that this is the
default behavior with Java config.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-default-init-destroy-methods" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-default-init-destroy-methods"></a>Default initialization and destroy methods</h4></div></div></div>

<p>When you write initialization and destroy method callbacks that do not use the
Spring-specific <code class="literal">InitializingBean</code> and <code class="literal">DisposableBean</code> callback interfaces, you
typically write methods with names such as <code class="literal">init()</code>, <code class="literal">initialize()</code>, <code class="literal">dispose()</code>, and so
on. Ideally, the names of such lifecycle callback methods are standardized across a
project so that all developers use the same method names and ensure consistency.</p>
<p>You can configure the Spring container to <code class="literal">look</code> for named initialization and destroy
callback method names on <span class="emphasis"><em>every</em></span> bean. This means that you, as an application
developer, can write your application classes and use an initialization callback called
<code class="literal">init()</code>, without having to configure an <code class="literal">init-method="init"</code> attribute with each bean
definition. The Spring IoC container calls that method when the bean is created (and in
accordance with the standard lifecycle callback contract described previously). This
feature also enforces a consistent naming convention for initialization and destroy
method callbacks.</p>
<p>Suppose that your initialization callback methods are named <code class="literal">init()</code> and destroy
callback methods are named <code class="literal">destroy()</code>. Your class will resemble the class in the
following example.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultBlogService <span class="hl-keyword">implements</span> BlogService {

    <span class="hl-keyword">private</span> BlogDao blogDao;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBlogDao(BlogDao blogDao) {
        <span class="hl-keyword">this</span>.blogDao = blogDao;
    }

    <span class="hl-comment">// this is (unsurprisingly) the initialization callback method</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
        <span class="hl-keyword">if</span> (<span class="hl-keyword">this</span>.blogDao == null) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalStateException(<span class="hl-string">"The [blogDao] property must be set."</span>);
        }
    }

}</pre>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">default-init-method</span>=<span class="hl-value">"init"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"blogService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.DefaultBlogService"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"blogDao"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"blogDao"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The presence of the <code class="literal">default-init-method</code> attribute on the top-level <code class="literal">&lt;beans/&gt;</code> element
attribute causes the Spring IoC container to recognize a method called <code class="literal">init</code> on beans
as the initialization method callback. When a bean is created and assembled, if the bean
class has such a method, it is invoked at the appropriate time.</p>
<p>You configure destroy method callbacks similarly (in XML, that is) by using the
<code class="literal">default-destroy-method</code> attribute on the top-level <code class="literal">&lt;beans/&gt;</code> element.</p>
<p>Where existing bean classes already have callback methods that are named at variance
with the convention, you can override the default by specifying (in XML, that is) the
method name using the <code class="literal">init-method</code> and <code class="literal">destroy-method</code> attributes of the <code class="literal">&lt;bean/&gt;</code>
itself.</p>
<p>The Spring container guarantees that a configured initialization callback is called
immediately after a bean is supplied with all dependencies. Thus the initialization
callback is called on the raw bean reference, which means that AOP interceptors and so
forth are not yet applied to the bean. A target bean is fully created <span class="emphasis"><em>first</em></span>,
<span class="emphasis"><em>then</em></span> an AOP proxy (for example) with its interceptor chain is applied. If the target
bean and the proxy are defined separately, your code can even interact with the raw
target bean, bypassing the proxy. Hence, it would be inconsistent to apply the
interceptors to the init method, because doing so would couple the lifecycle of the
target bean with its proxy/interceptors and leave strange semantics when your code
interacts directly to the raw target bean.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-combined-effects" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-combined-effects"></a>Combining lifecycle mechanisms</h4></div></div></div>

<p>As of Spring 2.5, you have three options for controlling bean lifecycle behavior: the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks"><code class="literal">InitializingBean</code></a> and
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean" title="Destruction callbacks"><code class="literal">DisposableBean</code></a> callback interfaces; custom
<code class="literal">init()</code> and <code class="literal">destroy()</code> methods; and the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="7.9.8 @PostConstruct and @PreDestroy"><code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code>
annotations</a>. You can combine these mechanisms to control a given bean.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If multiple lifecycle mechanisms are configured for a bean, and each mechanism is
configured with a different method name, then each configured method is executed in the
order listed below. However, if the same method name is configured - for example,
<code class="literal">init()</code> for an initialization method - for more than one of these lifecycle mechanisms,
that method is executed once, as explained in the preceding section.</p>
</td></tr></tbody></table></div>
<p>Multiple lifecycle mechanisms configured for the same bean, with different
initialization methods, are called as follows:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Methods annotated with <code class="literal">@PostConstruct</code>
</li><li class="listitem">
<code class="literal">afterPropertiesSet()</code> as defined by the <code class="literal">InitializingBean</code> callback interface
</li><li class="listitem">
A custom configured <code class="literal">init()</code> method
</li></ul></div>
<p>Destroy methods are called in the same order:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Methods annotated with <code class="literal">@PreDestroy</code>
</li><li class="listitem">
<code class="literal">destroy()</code> as defined by the <code class="literal">DisposableBean</code> callback interface
</li><li class="listitem">
A custom configured <code class="literal">destroy()</code> method
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-lifecycle-processor" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-processor"></a>Startup and shutdown callbacks</h4></div></div></div>

<p>The <code class="literal">Lifecycle</code> interface defines the essential methods for any object that has its own
lifecycle requirements (e.g. starts and stops some background process):</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Lifecycle {

    <span class="hl-keyword">void</span> start();

    <span class="hl-keyword">void</span> stop();

    <span class="hl-keyword">boolean</span> isRunning();

}</pre>
<p>Any Spring-managed object may implement that interface. Then, when the
<code class="literal">ApplicationContext</code> itself receives start and stop signals, e.g. for a stop/restart
scenario at runtime, it will cascade those calls to all <code class="literal">Lifecycle</code> implementations
defined within that context. It does this by delegating to a <code class="literal">LifecycleProcessor</code>:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> LifecycleProcessor <span class="hl-keyword">extends</span> Lifecycle {

    <span class="hl-keyword">void</span> onRefresh();

    <span class="hl-keyword">void</span> onClose();

}</pre>
<p>Notice that the <code class="literal">LifecycleProcessor</code> is itself an extension of the <code class="literal">Lifecycle</code>
interface. It also adds two other methods for reacting to the context being refreshed
and closed.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Note that the regular <code class="literal">org.springframework.context.Lifecycle</code> interface is just a plain
contract for explicit start/stop notifications and does NOT imply auto-startup at context
refresh time. Consider implementing <code class="literal">org.springframework.context.SmartLifecycle</code> instead
for fine-grained control over auto-startup of a specific bean (including startup phases).
Also, please note that stop notifications are not guaranteed to come before destruction:
On regular shutdown, all <code class="literal">Lifecycle</code> beans will first receive a stop notification before
the general destruction callbacks are being propagated; however, on hot refresh during a
context’s lifetime or on aborted refresh attempts, only destroy methods will be called.</p>
</td></tr></tbody></table></div>
<p>The order of startup and shutdown invocations can be important. If a "depends-on"
relationship exists between any two objects, the dependent side will start <span class="emphasis"><em>after</em></span> its
dependency, and it will stop <span class="emphasis"><em>before</em></span> its dependency. However, at times the direct
dependencies are unknown. You may only know that objects of a certain type should start
prior to objects of another type. In those cases, the <code class="literal">SmartLifecycle</code> interface defines
another option, namely the <code class="literal">getPhase()</code> method as defined on its super-interface,
<code class="literal">Phased</code>.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Phased {

    <span class="hl-keyword">int</span> getPhase();

}</pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> SmartLifecycle <span class="hl-keyword">extends</span> Lifecycle, Phased {

    <span class="hl-keyword">boolean</span> isAutoStartup();

    <span class="hl-keyword">void</span> stop(Runnable callback);

}</pre>
<p>When starting, the objects with the lowest phase start first, and when stopping, the
reverse order is followed. Therefore, an object that implements <code class="literal">SmartLifecycle</code> and
whose <code class="literal">getPhase()</code> method returns <code class="literal">Integer.MIN_VALUE</code> would be among the first to start
and the last to stop. At the other end of the spectrum, a phase value of
<code class="literal">Integer.MAX_VALUE</code> would indicate that the object should be started last and stopped
first (likely because it depends on other processes to be running). When considering the
phase value, it’s also important to know that the default phase for any "normal"
<code class="literal">Lifecycle</code> object that does not implement <code class="literal">SmartLifecycle</code> would be 0. Therefore, any
negative phase value would indicate that an object should start before those standard
components (and stop after them), and vice versa for any positive phase value.</p>
<p>As you can see the stop method defined by <code class="literal">SmartLifecycle</code> accepts a callback. Any
implementation <span class="emphasis"><em>must</em></span> invoke that callback’s <code class="literal">run()</code> method after that implementation’s
shutdown process is complete. That enables asynchronous shutdown where necessary since
the default implementation of the <code class="literal">LifecycleProcessor</code> interface,
<code class="literal">DefaultLifecycleProcessor</code>, will wait up to its timeout value for the group of objects
within each phase to invoke that callback. The default per-phase timeout is 30 seconds.
You can override the default lifecycle processor instance by defining a bean named
"lifecycleProcessor" within the context. If you only want to modify the timeout, then
defining the following would be sufficient:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lifecycleProcessor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.DefaultLifecycleProcessor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- timeout value in milliseconds --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"timeoutPerShutdownPhase"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"10000"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>As mentioned, the <code class="literal">LifecycleProcessor</code> interface defines callback methods for the
refreshing and closing of the context as well. The latter will simply drive the shutdown
process as if <code class="literal">stop()</code> had been called explicitly, but it will happen when the context is
closing. The 'refresh' callback on the other hand enables another feature of
<code class="literal">SmartLifecycle</code> beans. When the context is refreshed (after all objects have been
instantiated and initialized), that callback will be invoked, and at that point the
default lifecycle processor will check the boolean value returned by each
<code class="literal">SmartLifecycle</code> object’s <code class="literal">isAutoStartup()</code> method. If "true", then that object will be
started at that point rather than waiting for an explicit invocation of the context’s or
its own <code class="literal">start()</code> method (unlike the context refresh, the context start does not happen
automatically for a standard context implementation). The "phase" value as well as any
"depends-on" relationships will determine the startup order in the same way as described
above.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-shutdown" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-shutdown"></a>Shutting down the Spring IoC container gracefully in non-web applications</h4></div></div></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>This section applies only to non-web applications. Spring’s web-based
<code class="literal">ApplicationContext</code> implementations already have code in place to shut down the Spring
IoC container gracefully when the relevant web application is shut down.</p>
</td></tr></tbody></table></div>
<p>If you are using Spring’s IoC container in a non-web application environment; for
example, in a rich client desktop environment; you register a shutdown hook with the
JVM. Doing so ensures a graceful shutdown and calls the relevant destroy methods on your
singleton beans so that all resources are released. Of course, you must still configure
and implement these destroy callbacks correctly.</p>
<p>To register a shutdown hook, you call the <code class="literal">registerShutdownHook()</code> method that is
declared on the <code class="literal">ConfigurableApplicationContext</code> interface:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.context.ConfigurableApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {

        ConfigurableApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(
                <span class="hl-keyword">new</span> String []{<span class="hl-string">"beans.xml"</span>});

        <span class="hl-comment">// add a shutdown hook for the above context...</span>
        ctx.registerShutdownHook();

        <span class="hl-comment">// app runs here...</span>

        <span class="hl-comment">// main method exits, hook is called prior to the app shutting down...</span>

    }
}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-aware" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-aware"></a>7.6.2&nbsp;ApplicationContextAware and BeanNameAware</h3></div></div></div>

<p>When an <code class="literal">ApplicationContext</code> creates an object instance that implements the
<code class="literal">org.springframework.context.ApplicationContextAware</code> interface, the instance is provided
with a reference to that <code class="literal">ApplicationContext</code>.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ApplicationContextAware {

    <span class="hl-keyword">void</span> setApplicationContext(ApplicationContext applicationContext) <span class="hl-keyword">throws</span> BeansException;

}</pre>
<p>Thus beans can manipulate programmatically the <code class="literal">ApplicationContext</code> that created them,
through the <code class="literal">ApplicationContext</code> interface, or by casting the reference to a known
subclass of this interface, such as <code class="literal">ConfigurableApplicationContext</code>, which exposes
additional functionality. One use would be the programmatic retrieval of other beans.
Sometimes this capability is useful; however, in general you should avoid it, because it
couples the code to Spring and does not follow the Inversion of Control style, where
collaborators are provided to beans as properties. Other methods of the
<code class="literal">ApplicationContext</code> provide access to file resources, publishing application events, and
accessing a <code class="literal">MessageSource</code>. These additional features are described in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-introduction" title="7.15 Additional Capabilities of the ApplicationContext">Section&nbsp;7.15, “Additional Capabilities of the ApplicationContext”</a></p>
<p>As of Spring 2.5, autowiring is another alternative to obtain reference to the
<code class="literal">ApplicationContext</code>. The "traditional" <code class="literal">constructor</code> and <code class="literal">byType</code> autowiring modes (as
described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="7.4.5 Autowiring collaborators">Section&nbsp;7.4.5, “Autowiring collaborators”</a>) can provide a dependency of type
<code class="literal">ApplicationContext</code> for a constructor argument or setter method parameter,
respectively. For more flexibility, including the ability to autowire fields and
multiple parameter methods, use the new annotation-based autowiring features. If you do,
the <code class="literal">ApplicationContext</code> is autowired into a field, constructor argument, or method
parameter that is expecting the <code class="literal">ApplicationContext</code> type if the field, constructor, or
method in question carries the <code class="literal">@Autowired</code> annotation. For more information, see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation" title="7.9.2 @Autowired">Section&nbsp;7.9.2, “@Autowired”</a>.</p>
<p>When an <code class="literal">ApplicationContext</code> creates a class that implements the
<code class="literal">org.springframework.beans.factory.BeanNameAware</code> interface, the class is provided with
a reference to the name defined in its associated object definition.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> BeanNameAware {

    <span class="hl-keyword">void</span> setBeanName(String name) <span class="hl-keyword">throws</span> BeansException;

}</pre>
<p>The callback is invoked after population of normal bean properties but before an
initialization callback such as <code class="literal">InitializingBean</code> <span class="emphasis"><em>afterPropertiesSet</em></span> or a custom
init-method.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aware-list" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aware-list"></a>7.6.3&nbsp;Other Aware interfaces</h3></div></div></div>

<p>Besides <code class="literal">ApplicationContextAware</code> and <code class="literal">BeanNameAware</code> discussed above, Spring offers a
range of <code class="literal">Aware</code> interfaces that allow beans to indicate to the container that they
require a certain <span class="emphasis"><em>infrastructure</em></span> dependency. The most important <code class="literal">Aware</code> interfaces
are summarized below - as a general rule, the name is a good indication of the
dependency type:</p>
<div class="table"><a name="beans-factory-nature-aware-list" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-nature-aware-list"></a><p class="title"><b>Table&nbsp;7.4.&nbsp;Aware interfaces</b></p><div class="table-contents">

<table summary="Aware interfaces" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Name</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Injected Dependency</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explained in…&#8203;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ApplicationContextAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Declaring <code class="literal">ApplicationContext</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-aware" title="7.6.2 ApplicationContextAware and BeanNameAware">Section&nbsp;7.6.2, “ApplicationContextAware and BeanNameAware”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ApplicationEventPublisherAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Event publisher of the enclosing <code class="literal">ApplicationContext</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-introduction" title="7.15 Additional Capabilities of the ApplicationContext">Section&nbsp;7.15, “Additional Capabilities of the ApplicationContext”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BeanClassLoaderAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Class loader used to load the bean classes.</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-class" title="7.3.2 Instantiating beans">Section&nbsp;7.3.2, “Instantiating beans”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BeanFactoryAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Declaring <code class="literal">BeanFactory</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-aware" title="7.6.2 ApplicationContextAware and BeanNameAware">Section&nbsp;7.6.2, “ApplicationContextAware and BeanNameAware”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BeanNameAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the declaring bean</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-aware" title="7.6.2 ApplicationContextAware and BeanNameAware">Section&nbsp;7.6.2, “ApplicationContextAware and BeanNameAware”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BootstrapContextAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Resource adapter <code class="literal">BootstrapContext</code> the container runs in. Typically available only in
  JCA aware <code class="literal">ApplicationContext</code>s</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cci" title="32. JCA CCI">Chapter&nbsp;32, <i>JCA CCI</i></a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">LoadTimeWeaverAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Defined <span class="emphasis"><em>weaver</em></span> for processing class definition at load time</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="11.8.4 Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;11.8.4, “Load-time weaving with AspectJ in the Spring Framework”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">MessageSourceAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Configured strategy for resolving messages (with support for parametrization and
  internationalization)</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-introduction" title="7.15 Additional Capabilities of the ApplicationContext">Section&nbsp;7.15, “Additional Capabilities of the ApplicationContext”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">NotificationPublisherAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Spring JMX notification publisher</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jmx-notifications" title="31.7 Notifications">Section&nbsp;31.7, “Notifications”</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PortletConfigAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Current <code class="literal">PortletConfig</code> the container runs in. Valid only in a web-aware Spring
  <code class="literal">ApplicationContext</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet" title="25. Portlet MVC Framework">Chapter&nbsp;25, <i>Portlet MVC Framework</i></a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PortletContextAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Current <code class="literal">PortletContext</code> the container runs in. Valid only in a web-aware Spring
  <code class="literal">ApplicationContext</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#portlet" title="25. Portlet MVC Framework">Chapter&nbsp;25, <i>Portlet MVC Framework</i></a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ResourceLoaderAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Configured loader for low-level access to resources</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources" title="8. Resources">Chapter&nbsp;8, <i>Resources</i></a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ServletConfigAware</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Current <code class="literal">ServletConfig</code> the container runs in. Valid only in a web-aware Spring
  <code class="literal">ApplicationContext</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc" title="22. Web MVC framework">Chapter&nbsp;22, <i>Web MVC framework</i></a></p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ServletContextAware</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Current <code class="literal">ServletContext</code> the container runs in. Valid only in a web-aware Spring
  <code class="literal">ApplicationContext</code></p></td><td style="" align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc" title="22. Web MVC framework">Chapter&nbsp;22, <i>Web MVC framework</i></a></p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>Note again that usage of these interfaces ties your code to the Spring API and does not
follow the Inversion of Control style. As such, they are recommended for infrastructure
beans that require programmatic access to the container.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-child-bean-definitions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-child-bean-definitions"></a>7.7&nbsp;Bean definition inheritance</h2></div></div></div>

<p>A bean definition can contain a lot of configuration information, including constructor
arguments, property values, and container-specific information such as initialization
method, static factory method name, and so on. A child bean definition inherits
configuration data from a parent definition. The child definition can override some
values, or add others, as needed. Using parent and child bean definitions can save a lot
of typing. Effectively, this is a form of templating.</p>
<p>If you work with an <code class="literal">ApplicationContext</code> interface programmatically, child bean
definitions are represented by the <code class="literal">ChildBeanDefinition</code> class. Most users do not work
with them on this level, instead configuring bean definitions declaratively in something
like the <code class="literal">ClassPathXmlApplicationContext</code>. When you use XML-based configuration
metadata, you indicate a child bean definition by using the <code class="literal">parent</code> attribute,
specifying the parent bean as the value of this attribute.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inheritedTestBean"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.TestBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"parent"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inheritsWithDifferentClass"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.DerivedTestBean"</span>
        <span class="strong"><strong>parent="inheritedTestBean"</strong></span> init-method="initialize"&gt;
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"override"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-comment">&lt;!-- the age property value of 1 will be inherited from parent --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>A child bean definition uses the bean class from the parent definition if none is
specified, but can also override it. In the latter case, the child bean class must be
compatible with the parent, that is, it must accept the parent’s property values.</p>
<p>A child bean definition inherits scope, constructor argument values, property values, and
method overrides from the parent, with the option to add new values. Any scope, initialization
method, destroy method, and/or <code class="literal">static</code> factory method settings that you specify will
override the corresponding parent settings.</p>
<p>The remaining settings are <span class="emphasis"><em>always</em></span> taken from the child definition: <span class="emphasis"><em>depends on</em></span>,
<span class="emphasis"><em>autowire mode</em></span>, <span class="emphasis"><em>dependency check</em></span>, <span class="emphasis"><em>singleton</em></span>, <span class="emphasis"><em>lazy init</em></span>.</p>
<p>The preceding example explicitly marks the parent bean definition as abstract by using
the <code class="literal">abstract</code> attribute. If the parent definition does not specify a class, explicitly
marking the parent bean definition as <code class="literal">abstract</code> is required, as follows:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inheritedTestBeanWithoutClass"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"parent"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"inheritsWithClass"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.DerivedTestBean"</span>
        <span class="hl-attribute">parent</span>=<span class="hl-value">"inheritedTestBeanWithoutClass"</span> <span class="hl-attribute">init-method</span>=<span class="hl-value">"initialize"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"override"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-comment">&lt;!-- age will inherit the value of 1 from the parent bean definition--&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The parent bean cannot be instantiated on its own because it is incomplete, and it is
also explicitly marked as <code class="literal">abstract</code>. When a definition is <code class="literal">abstract</code> like this, it is
usable only as a pure template bean definition that serves as a parent definition for
child definitions. Trying to use such an <code class="literal">abstract</code> parent bean on its own, by referring
to it as a ref property of another bean or doing an explicit <code class="literal">getBean()</code> call with the
parent bean id, returns an error. Similarly, the container’s internal
<code class="literal">preInstantiateSingletons()</code> method ignores bean definitions that are defined as
abstract.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">ApplicationContext</code> pre-instantiates all singletons by default. Therefore, it is
important (at least for singleton beans) that if you have a (parent) bean definition
which you intend to use only as a template, and this definition specifies a class, you
must make sure to set the <span class="emphasis"><em>abstract</em></span> attribute to <span class="emphasis"><em>true</em></span>, otherwise the application
context will actually (attempt to) pre-instantiate the <code class="literal">abstract</code> bean.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-factory-extension" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension"></a>7.8&nbsp;Container Extension Points</h2></div></div></div>

<p>Typically, an application developer does not need to subclass <code class="literal">ApplicationContext</code>
implementation classes. Instead, the Spring IoC container can be extended by plugging in
implementations of special integration interfaces. The next few sections describe these
integration interfaces.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-extension-bpp" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp"></a>7.8.1&nbsp;Customizing beans using a BeanPostProcessor</h3></div></div></div>

<p>The <code class="literal">BeanPostProcessor</code> interface defines <span class="emphasis"><em>callback methods</em></span> that you can implement to
provide your own (or override the container’s default) instantiation logic,
dependency-resolution logic, and so forth. If you want to implement some custom logic
after the Spring container finishes instantiating, configuring, and initializing a bean,
you can plug in one or more <code class="literal">BeanPostProcessor</code> implementations.</p>
<p>You can configure multiple <code class="literal">BeanPostProcessor</code> instances, and you can control the order
in which these <code class="literal">BeanPostProcessor</code>s execute by setting the <code class="literal">order</code> property. You can
set this property only if the <code class="literal">BeanPostProcessor</code> implements the <code class="literal">Ordered</code> interface; if
you write your own <code class="literal">BeanPostProcessor</code> you should consider implementing the <code class="literal">Ordered</code>
interface too. For further details, consult the javadocs of the <code class="literal">BeanPostProcessor</code> and
<code class="literal">Ordered</code> interfaces. See also the note below on
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-programmatically-registering-beanpostprocessors" title="Programmatically registering BeanPostProcessors">programmatic
registration of <code class="literal">BeanPostProcessor</code>s</a>.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">BeanPostProcessor</code>s operate on bean (or object) <span class="emphasis"><em>instances</em></span>; that is to say, the
Spring IoC container instantiates a bean instance and <span class="emphasis"><em>then</em></span> <code class="literal">BeanPostProcessor</code>s do
their work.</p>
<p><code class="literal">BeanPostProcessor</code>s are scoped <span class="emphasis"><em>per-container</em></span>. This is only relevant if you are
using container hierarchies. If you define a <code class="literal">BeanPostProcessor</code> in one container, it
will <span class="emphasis"><em>only</em></span> post-process the beans in that container. In other words, beans that are
defined in one container are not post-processed by a <code class="literal">BeanPostProcessor</code> defined in
another container, even if both containers are part of the same hierarchy.</p>
<p>To change the actual bean definition (i.e., the <span class="emphasis"><em>blueprint</em></span> that defines the bean),
you instead need to use a <code class="literal">BeanFactoryPostProcessor</code> as described in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-factory-postprocessors" title="7.8.2 Customizing configuration metadata with a BeanFactoryPostProcessor">Section&nbsp;7.8.2, “Customizing configuration metadata with a BeanFactoryPostProcessor”</a>.</p>
</td></tr></tbody></table></div>
<p>The <code class="literal">org.springframework.beans.factory.config.BeanPostProcessor</code> interface consists of
exactly two callback methods. When such a class is registered as a post-processor with
the container, for each bean instance that is created by the container, the
post-processor gets a callback from the container both <span class="emphasis"><em>before</em></span> container
initialization methods (such as InitializingBean’s <span class="emphasis"><em>afterPropertiesSet()</em></span> and any
declared init method) are called as well as <span class="emphasis"><em>after</em></span> any bean initialization callbacks.
The post-processor can take any action with the bean instance, including ignoring the
callback completely. A bean post-processor typically checks for callback interfaces or
may wrap a bean with a proxy. Some Spring AOP infrastructure classes are implemented as
bean post-processors in order to provide proxy-wrapping logic.</p>
<p>An <code class="literal">ApplicationContext</code> <span class="emphasis"><em>automatically detects</em></span> any beans that are defined in the
configuration metadata which implement the <code class="literal">BeanPostProcessor</code> interface. The
<code class="literal">ApplicationContext</code> registers these beans as post-processors so that they can be called
later upon bean creation. Bean post-processors can be deployed in the container just
like any other beans.</p>
<p>Note that when declaring a <code class="literal">BeanPostProcessor</code> using an <code class="literal">@Bean</code> factory method on a
configuration class, the return type of the factory method should be the implementation
class itself or at least the <code class="literal">org.springframework.beans.factory.config.BeanPostProcessor</code>
interface, clearly indicating the post-processor nature of that bean. Otherwise, the
<code class="literal">ApplicationContext</code> won’t be able to autodetect it by type before fully creating it.
Since a <code class="literal">BeanPostProcessor</code> needs to be instantiated early in order to apply to the
initialization of other beans in the context, this early type detection is critical.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Programmatically registering BeanPostProcessors"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left"><a name="beans-factory-programmatically-registering-beanpostprocessors" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-programmatically-registering-beanpostprocessors"></a>Programmatically registering BeanPostProcessors</th></tr><tr><td align="left" valign="top">

<p>While the recommended approach for <code class="literal">BeanPostProcessor</code> registration is through
<code class="literal">ApplicationContext</code> auto-detection (as described above), it is also possible to
register them <span class="emphasis"><em>programmatically</em></span> against a <code class="literal">ConfigurableBeanFactory</code> using the
<code class="literal">addBeanPostProcessor</code> method. This can be useful when needing to evaluate conditional
logic before registration, or even for copying bean post processors across contexts in a
hierarchy. Note however that <code class="literal">BeanPostProcessor</code>s added programmatically <span class="emphasis"><em>do not
respect the <code class="literal">Ordered</code> interface</em></span>. Here it is the <span class="emphasis"><em>order of registration</em></span> that
dictates the order of execution. Note also that <code class="literal">BeanPostProcessor</code>s registered
programmatically are always processed before those registered through auto-detection,
regardless of any explicit ordering.</p>
</td></tr></tbody></table></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: BeanPostProcessors and AOP auto-proxying"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">BeanPostProcessors and AOP auto-proxying</th></tr><tr><td align="left" valign="top">

<p>Classes that implement the <code class="literal">BeanPostProcessor</code> interface are <span class="emphasis"><em>special</em></span> and are treated
differently by the container. All <code class="literal">BeanPostProcessor</code>s <span class="emphasis"><em>and beans that they reference
directly</em></span> are instantiated on startup, as part of the special startup phase of the
<code class="literal">ApplicationContext</code>. Next, all <code class="literal">BeanPostProcessor</code>s are registered in a sorted fashion
and applied to all further beans in the container. Because AOP auto-proxying is
implemented as a <code class="literal">BeanPostProcessor</code> itself, neither <code class="literal">BeanPostProcessor</code>s nor the beans
they reference directly are eligible for auto-proxying, and thus do not have aspects
woven into them.</p>
<p>For any such bean, you should see an informational log message: "<span class="emphasis"><em>Bean foo is not
eligible for getting processed by all BeanPostProcessor interfaces (for example: not
eligible for auto-proxying)</em></span>".</p>
<p>Note that if you have beans wired into your <code class="literal">BeanPostProcessor</code> using autowiring or
<code class="literal">@Resource</code> (which may fall back to autowiring), Spring might access unexpected beans
when searching for type-matching dependency candidates, and therefore make them
ineligible for auto-proxying or other kinds of bean post-processing. For example, if you
have a dependency annotated with <code class="literal">@Resource</code> where the field/setter name does not
directly correspond to the declared name of a bean and no name attribute is used, then
Spring will access other beans for matching them by type.</p>
</td></tr></tbody></table></div>
<p>The following examples show how to write, register, and use <code class="literal">BeanPostProcessor</code>s in an
<code class="literal">ApplicationContext</code>.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-extension-bpp-examples-hw" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp-examples-hw"></a>Example: Hello World, BeanPostProcessor-style</h4></div></div></div>

<p>This first example illustrates basic usage. The example shows a custom
<code class="literal">BeanPostProcessor</code> implementation that invokes the <code class="literal">toString()</code> method of each bean as
it is created by the container and prints the resulting string to the system console.</p>
<p>Find below the custom <code class="literal">BeanPostProcessor</code> implementation class definition:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> scripting;

<span class="hl-keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;
<span class="hl-keyword">import</span> org.springframework.beans.BeansException;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> InstantiationTracingBeanPostProcessor <span class="hl-keyword">implements</span> BeanPostProcessor {

    <span class="hl-comment">// simply return the instantiated bean as-is</span>
    <span class="hl-keyword">public</span> Object postProcessBeforeInitialization(Object bean,
            String beanName) <span class="hl-keyword">throws</span> BeansException {
        <span class="hl-keyword">return</span> bean; <span class="hl-comment">// we could potentially return any object reference here...</span>
    }

    <span class="hl-keyword">public</span> Object postProcessAfterInitialization(Object bean,
            String beanName) <span class="hl-keyword">throws</span> BeansException {
        System.out.println(<span class="hl-string">"Bean '"</span> + beanName + <span class="hl-string">"' created : "</span> + bean.toString());
        <span class="hl-keyword">return</span> bean;
    }

}</pre>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:lang</span>=<span class="hl-value">"http://www.springframework.org/schema/lang"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/lang
        http://www.springframework.org/schema/lang/spring-lang.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messenger"</span>
            <span class="hl-attribute">script-source</span>=<span class="hl-value">"classpath:org/springframework/scripting/groovy/Messenger.groovy"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"message"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Fiona Apple Is Just So Dreamy."</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/lang:groovy&gt;</span>

    <span class="hl-comment">&lt;!--
    when the above bean (messenger) is instantiated, this custom
    BeanPostProcessor implementation will output the fact to the system console
    --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"scripting.InstantiationTracingBeanPostProcessor"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>Notice how the <code class="literal">InstantiationTracingBeanPostProcessor</code> is simply defined. It does not
even have a name, and because it is a bean it can be dependency-injected just like any
other bean. (The preceding configuration also defines a bean that is backed by a Groovy
script. The Spring dynamic language support is detailed in the chapter entitled
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dynamic-language" title="35. Dynamic language support">Chapter&nbsp;35, <i>Dynamic language support</i></a>.)</p>
<p>The following simple Java application executes the preceding code and configuration:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;
<span class="hl-keyword">import</span> org.springframework.scripting.Messenger;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"scripting/beans.xml"</span>);
        Messenger messenger = (Messenger) ctx.getBean(<span class="hl-string">"messenger"</span>);
        System.out.println(messenger);
    }

}</pre>
<p>The output of the preceding application resembles the following:</p>
<pre class="literallayout">Bean 'messenger' created : org.springframework.scripting.groovy.GroovyMessenger@272961
org.springframework.scripting.groovy.GroovyMessenger@272961</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-extension-bpp-examples-rabpp" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp-examples-rabpp"></a>Example: The RequiredAnnotationBeanPostProcessor</h4></div></div></div>

<p>Using callback interfaces or annotations in conjunction with a custom
<code class="literal">BeanPostProcessor</code> implementation is a common means of extending the Spring IoC
container. An example is Spring’s <code class="literal">RequiredAnnotationBeanPostProcessor</code> - a
<code class="literal">BeanPostProcessor</code> implementation that ships with the Spring distribution which ensures
that JavaBean properties on beans that are marked with an (arbitrary) annotation are
actually (configured to be) dependency-injected with a value.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-extension-factory-postprocessors" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-factory-postprocessors"></a>7.8.2&nbsp;Customizing configuration metadata with a BeanFactoryPostProcessor</h3></div></div></div>

<p>The next extension point that we will look at is the
<code class="literal">org.springframework.beans.factory.config.BeanFactoryPostProcessor</code>. The semantics of
this interface are similar to those of the <code class="literal">BeanPostProcessor</code>, with one major
difference: <code class="literal">BeanFactoryPostProcessor</code> operates on the <span class="emphasis"><em>bean configuration metadata</em></span>;
that is, the Spring IoC container allows a <code class="literal">BeanFactoryPostProcessor</code> to read the
configuration metadata and potentially change it <span class="emphasis"><em>before</em></span> the container instantiates
any beans other than <code class="literal">BeanFactoryPostProcessor</code>s.</p>
<p>You can configure multiple <code class="literal">BeanFactoryPostProcessor</code>s, and you can control the order in
which these <code class="literal">BeanFactoryPostProcessor</code>s execute by setting the <code class="literal">order</code> property.
However, you can only set this property if the <code class="literal">BeanFactoryPostProcessor</code> implements the
<code class="literal">Ordered</code> interface. If you write your own <code class="literal">BeanFactoryPostProcessor</code>, you should
consider implementing the <code class="literal">Ordered</code> interface too. Consult the javadocs of the
<code class="literal">BeanFactoryPostProcessor</code> and <code class="literal">Ordered</code> interfaces for more details.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If you want to change the actual bean <span class="emphasis"><em>instances</em></span> (i.e., the objects that are created
from the configuration metadata), then you instead need to use a <code class="literal">BeanPostProcessor</code>
(described above in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp" title="7.8.1 Customizing beans using a BeanPostProcessor">Section&nbsp;7.8.1, “Customizing beans using a BeanPostProcessor”</a>). While it is technically possible
to work with bean instances within a <code class="literal">BeanFactoryPostProcessor</code> (e.g., using
<code class="literal">BeanFactory.getBean()</code>), doing so causes premature bean instantiation, violating the
standard container lifecycle. This may cause negative side effects such as bypassing
bean post processing.</p>
<p>Also, <code class="literal">BeanFactoryPostProcessor</code>s are scoped <span class="emphasis"><em>per-container</em></span>. This is only relevant if
you are using container hierarchies. If you define a <code class="literal">BeanFactoryPostProcessor</code> in one
container, it will <span class="emphasis"><em>only</em></span> be applied to the bean definitions in that container. Bean
definitions in one container will not be post-processed by <code class="literal">BeanFactoryPostProcessor</code>s
in another container, even if both containers are part of the same hierarchy.</p>
</td></tr></tbody></table></div>
<p>A bean factory post-processor is executed automatically when it is declared inside an
<code class="literal">ApplicationContext</code>, in order to apply changes to the configuration metadata that
define the container. Spring includes a number of predefined bean factory
post-processors, such as <code class="literal">PropertyOverrideConfigurer</code> and
<code class="literal">PropertyPlaceholderConfigurer</code>. A custom <code class="literal">BeanFactoryPostProcessor</code> can also be used,
for example, to register custom property editors.</p>
<p><a name="null" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#null"></a>An <code class="literal">ApplicationContext</code> automatically detects any beans that are deployed into it that
implement the <code class="literal">BeanFactoryPostProcessor</code> interface. It uses these beans as bean factory
post-processors, at the appropriate time. You can deploy these post-processor beans as
you would any other bean.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>As with <code class="literal">BeanPostProcessor</code>s , you typically do not want to configure
<code class="literal">BeanFactoryPostProcessor</code>s for lazy initialization. If no other bean references a
<code class="literal">Bean(Factory)PostProcessor</code>, that post-processor will not get instantiated at all.
Thus, marking it for lazy initialization will be ignored, and the
<code class="literal">Bean(Factory)PostProcessor</code> will be instantiated eagerly even if you set the
<code class="literal">default-lazy-init</code> attribute to <code class="literal">true</code> on the declaration of your <code class="literal">&lt;beans /&gt;</code> element.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-placeholderconfigurer" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-placeholderconfigurer"></a>Example: the Class name substitution PropertyPlaceholderConfigurer</h4></div></div></div>

<p>You use the <code class="literal">PropertyPlaceholderConfigurer</code> to externalize property values from a bean
definition in a separate file using the standard Java <code class="literal">Properties</code> format. Doing so
enables the person deploying an application to customize environment-specific properties
such as database URLs and passwords, without the complexity or risk of modifying the
main XML definition file or files for the container.</p>
<p>Consider the following XML-based configuration metadata fragment, where a <code class="literal">DataSource</code>
with placeholder values is defined. The example shows properties configured from an
external <code class="literal">Properties</code> file. At runtime, a <code class="literal">PropertyPlaceholderConfigurer</code> is applied to
the metadata that will replace some properties of the DataSource. The values to replace
are specified as <span class="emphasis"><em>placeholders</em></span> of the form <code class="literal">${property-name}</code> which follows the Ant /
log4j / JSP EL style.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"locations"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:com/foo/jdbc.properties"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The actual values come from another file in the standard Java <code class="literal">Properties</code> format:</p>
<pre class="literallayout">jdbc.driverClassName=org.hsqldb.jdbcDriver
jdbc.url=jdbc:hsqldb:hsql://production:9002
jdbc.username=sa
jdbc.password=root</pre>
<p>Therefore, the string <code class="literal">${jdbc.username}</code> is replaced at runtime with the value 'sa', and
the same applies for other placeholder values that match keys in the properties file.
The <code class="literal">PropertyPlaceholderConfigurer</code> checks for placeholders in most properties and
attributes of a bean definition. Furthermore, the placeholder prefix and suffix can be
customized.</p>
<p>With the <code class="literal">context</code> namespace introduced in Spring 2.5, it is possible to configure
property placeholders with a dedicated configuration element. One or more locations can
be provided as a comma-separated list in the <code class="literal">location</code> attribute.</p>
<pre class="programlisting"><span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/foo/jdbc.properties"</span><span class="hl-tag">/&gt;</span></pre>
<p>The <code class="literal">PropertyPlaceholderConfigurer</code> not only looks for properties in the <code class="literal">Properties</code>
file you specify. By default it also checks against the Java <code class="literal">System</code> properties if it
cannot find a property in the specified properties files. You can customize this
behavior by setting the <code class="literal">systemPropertiesMode</code> property of the configurer with one of
the following three supported integer values:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>never</em></span> (0): Never check system properties
</li><li class="listitem">
<span class="emphasis"><em>fallback</em></span> (1): Check system properties if not resolvable in the specified
properties files. This is the default.
</li><li class="listitem">
<span class="emphasis"><em>override</em></span> (2): Check system properties first, before trying the specified
properties files. This allows system properties to override any other property source.
</li></ul></div>
<p>Consult the <code class="literal">PropertyPlaceholderConfigurer</code> javadocs for more information.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>You can use the <code class="literal">PropertyPlaceholderConfigurer</code> to substitute class names, which is
sometimes useful when you have to pick a particular implementation class at runtime. For
example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"locations"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>classpath:com/foo/strategy.properties<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"properties"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>custom.strategy.class=com.foo.DefaultStrategy<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceStrategy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"${custom.strategy.class}"</span><span class="hl-tag">/&gt;</span></pre>
<p>If the class cannot be resolved at runtime to a valid class, resolution of the bean
fails when it is about to be created, which is during the <code class="literal">preInstantiateSingletons()</code>
phase of an <code class="literal">ApplicationContext</code> for a non-lazy-init bean.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-factory-overrideconfigurer" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-overrideconfigurer"></a>Example: the PropertyOverrideConfigurer</h4></div></div></div>

<p>The <code class="literal">PropertyOverrideConfigurer</code>, another bean factory post-processor, resembles the
<code class="literal">PropertyPlaceholderConfigurer</code>, but unlike the latter, the original definitions can
have default values or no values at all for bean properties. If an overriding
<code class="literal">Properties</code> file does not have an entry for a certain bean property, the default
context definition is used.</p>
<p>Note that the bean definition is <span class="emphasis"><em>not</em></span> aware of being overridden, so it is not
immediately obvious from the XML definition file that the override configurer is being
used. In case of multiple <code class="literal">PropertyOverrideConfigurer</code> instances that define different
values for the same bean property, the last one wins, due to the overriding mechanism.</p>
<p>Properties file configuration lines take this format:</p>
<pre class="literallayout">beanName.property=value</pre>
<p>For example:</p>
<pre class="literallayout">dataSource.driverClassName=com.mysql.jdbc.Driver
dataSource.url=jdbc:mysql:mydb</pre>
<p>This example file can be used with a container definition that contains a bean called
<span class="emphasis"><em>dataSource</em></span>, which has <span class="emphasis"><em>driver</em></span> and <span class="emphasis"><em>url</em></span> properties.</p>
<p>Compound property names are also supported, as long as every component of the path
except the final property being overridden is already non-null (presumably initialized
by the constructors). In this example…&#8203;</p>
<pre class="literallayout">foo.fred.bob.sammy=123</pre>
<div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
the <code class="literal">sammy</code> property of the <code class="literal">bob</code> property of the <code class="literal">fred</code> property of the <code class="literal">foo</code> bean
is set to the scalar value <code class="literal">123</code>.
</li></ol></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Specified override values are always <span class="emphasis"><em>literal</em></span> values; they are not translated into
bean references. This convention also applies when the original value in the XML bean
definition specifies a bean reference.</p>
</td></tr></tbody></table></div>
<p>With the <code class="literal">context</code> namespace introduced in Spring 2.5, it is possible to configure
property overriding with a dedicated configuration element:</p>
<pre class="programlisting"><span class="hl-tag">&lt;context:property-override</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:override.properties"</span><span class="hl-tag">/&gt;</span></pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factory-extension-factorybean" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-factorybean"></a>7.8.3&nbsp;Customizing instantiation logic with a FactoryBean</h3></div></div></div>

<p>Implement the <code class="literal">org.springframework.beans.factory.FactoryBean</code> interface for objects that
<span class="emphasis"><em>are themselves factories</em></span>.</p>
<p>The <code class="literal">FactoryBean</code> interface is a point of pluggability into the Spring IoC container’s
instantiation logic. If you have complex initialization code that is better expressed in
Java as opposed to a (potentially) verbose amount of XML, you can create your own
<code class="literal">FactoryBean</code>, write the complex initialization inside that class, and then plug your
custom <code class="literal">FactoryBean</code> into the container.</p>
<p>The <code class="literal">FactoryBean</code> interface provides three methods:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">Object getObject()</code>: returns an instance of the object this factory creates. The
instance can possibly be shared, depending on whether this factory returns singletons
or prototypes.
</li><li class="listitem">
<code class="literal">boolean isSingleton()</code>: returns <code class="literal">true</code> if this <code class="literal">FactoryBean</code> returns singletons,
<code class="literal">false</code> otherwise.
</li><li class="listitem">
<code class="literal">Class getObjectType()</code>: returns the object type returned by the <code class="literal">getObject()</code> method
or <code class="literal">null</code> if the type is not known in advance.
</li></ul></div>
<p>The <code class="literal">FactoryBean</code> concept and interface is used in a number of places within the Spring
Framework; more than 50 implementations of the <code class="literal">FactoryBean</code> interface ship with Spring
itself.</p>
<p>When you need to ask a container for an actual <code class="literal">FactoryBean</code> instance itself instead of
the bean it produces, preface the bean’s id with the ampersand symbol ( <code class="literal">&amp;</code>) when
calling the <code class="literal">getBean()</code> method of the <code class="literal">ApplicationContext</code>. So for a given <code class="literal">FactoryBean</code>
with an id of <code class="literal">myBean</code>, invoking <code class="literal">getBean("myBean")</code> on the container returns the
product of the <code class="literal">FactoryBean</code>; whereas, invoking <code class="literal">getBean("&amp;myBean")</code> returns the
<code class="literal">FactoryBean</code> instance itself.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-annotation-config" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-annotation-config"></a>7.9&nbsp;Annotation-based container configuration</h2></div></div></div>

<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Are annotations better than XML for configuring Spring?</b></p></div></div></div>

<p>The introduction of annotation-based configurations raised the question of whether this
approach is 'better' than XML. The short answer is <span class="emphasis"><em>it depends</em></span>. The long answer is
that each approach has its pros and cons, and usually it is up to the developer to
decide which strategy suits them better. Due to the way they are defined, annotations
provide a lot of context in their declaration, leading to shorter and more concise
configuration. However, XML excels at wiring up components without touching their source
code or recompiling them. Some developers prefer having the wiring close to the source
while others argue that annotated classes are no longer POJOs and, furthermore, that the
configuration becomes decentralized and harder to control.</p>
<p>No matter the choice, Spring can accommodate both styles and even mix them together.
It’s worth pointing out that through its <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java" title="7.12 Java-based container configuration">JavaConfig</a> option, Spring allows
annotations to be used in a non-invasive way, without touching the target components
source code and that in terms of tooling, all configuration styles are supported by the
<a class="ulink" href="https://spring.io/tools/sts" target="_top">Spring Tool Suite</a>.</p>
</div>
<p>An alternative to XML setups is provided by annotation-based configuration which rely on
the bytecode metadata for wiring up components instead of angle-bracket declarations.
Instead of using XML to describe a bean wiring, the developer moves the configuration
into the component class itself by using annotations on the relevant class, method, or
field declaration. As mentioned in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp-examples-rabpp" title="Example: The RequiredAnnotationBeanPostProcessor">the section called “Example: The RequiredAnnotationBeanPostProcessor”</a>, using
a <code class="literal">BeanPostProcessor</code> in conjunction with annotations is a common means of extending the
Spring IoC container. For example, Spring 2.0 introduced the possibility of enforcing
required properties with the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-required-annotation" title="7.9.1 @Required">@Required</a> annotation. Spring
2.5 made it possible to follow that same general approach to drive Spring’s dependency
injection. Essentially, the <code class="literal">@Autowired</code> annotation provides the same capabilities as
described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="7.4.5 Autowiring collaborators">Section&nbsp;7.4.5, “Autowiring collaborators”</a> but with more fine-grained control and wider
applicability. Spring 2.5 also added support for JSR-250 annotations such as
<code class="literal">@PostConstruct</code>, and <code class="literal">@PreDestroy</code>. Spring 3.0 added support for JSR-330 (Dependency
Injection for Java) annotations contained in the javax.inject package such as <code class="literal">@Inject</code>
and <code class="literal">@Named</code>. Details about those annotations can be found in the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-standard-annotations" title="7.11 Using JSR 330 Standard Annotations">relevant section</a>.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Annotation injection is performed <span class="emphasis"><em>before</em></span> XML injection, thus the latter
configuration will override the former for properties wired through both approaches.</p>
</td></tr></tbody></table></div>
<p>As always, you can register them as individual bean definitions, but they can also be
implicitly registered by including the following tag in an XML-based Spring
configuration (notice the inclusion of the <code class="literal">context</code> namespace):</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>(The implicitly registered post-processors include
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/beans/factory/annotation/AutowiredAnnotationBeanPostProcessor.html" target="_top"><code class="literal">AutowiredAnnotationBeanPostProcessor</code></a>,
 <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/annotation/CommonAnnotationBeanPostProcessor.html" target="_top"><code class="literal">CommonAnnotationBeanPostProcessor</code></a>,
 <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/orm/jpa/support/PersistenceAnnotationBeanPostProcessor.html" target="_top"><code class="literal">PersistenceAnnotationBeanPostProcessor</code></a>,
as well as the aforementioned
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/beans/factory/annotation/RequiredAnnotationBeanPostProcessor.html" target="_top"><code class="literal">RequiredAnnotationBeanPostProcessor</code></a>.)</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">&lt;context:annotation-config/&gt;</code> only looks for annotations on beans in the same
application context in which it is defined. This means that, if you put
<code class="literal">&lt;context:annotation-config/&gt;</code> in a <code class="literal">WebApplicationContext</code> for a <code class="literal">DispatcherServlet</code>,
it only checks for <code class="literal">@Autowired</code> beans in your controllers, and not your services. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-servlet" title="22.2 The DispatcherServlet">Section&nbsp;22.2, “The DispatcherServlet”</a> for more information.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-required-annotation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-required-annotation"></a>7.9.1&nbsp;@Required</h3></div></div></div>

<p>The <code class="literal">@Required</code> annotation applies to bean property setter methods, as in the following
example:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <em><span class="hl-annotation" style="color: gray">@Required</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>This annotation simply indicates that the affected bean property must be populated at
configuration time, through an explicit property value in a bean definition or through
autowiring. The container throws an exception if the affected bean property has not been
populated; this allows for eager and explicit failure, avoiding <code class="literal">NullPointerException</code>s
or the like later on. It is still recommended that you put assertions into the bean
class itself, for example, into an init method. Doing so enforces those required
references and values even when you use the class outside of a container.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-autowired-annotation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation"></a>7.9.2&nbsp;@Autowired</h3></div></div></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>JSR 330’s <code class="literal">@Inject</code> annotation can be used in place of Spring’s <code class="literal">@Autowired</code> annotation
in the examples below. See <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-standard-annotations" title="7.11 Using JSR 330 Standard Annotations">here</a> for more details.</p>
</td></tr></tbody></table></div>
<p>You can apply the <code class="literal">@Autowired</code> annotation to constructors:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> CustomerPreferenceDao customerPreferenceDao;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao) {
        <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>As of Spring Framework 4.3, the <code class="literal">@Autowired</code> constructor is no longer necessary if the
target bean only defines one constructor. If several constructors are available, at
least one must be annotated to teach the container which one it has to use.</p>
</td></tr></tbody></table></div>
<p>As expected, you can also apply the <code class="literal">@Autowired</code> annotation to "traditional" setter
methods:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>You can also apply the annotation to methods with arbitrary names and/or multiple
arguments:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

    <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(MovieCatalog movieCatalog,
            CustomerPreferenceDao customerPreferenceDao) {
        <span class="hl-keyword">this</span>.movieCatalog = movieCatalog;
        <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>You can apply <code class="literal">@Autowired</code> to fields as well and even mix it with constructors:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> CustomerPreferenceDao customerPreferenceDao;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao) {
        <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>It is also possible to provide <span class="emphasis"><em>all</em></span> beans of a particular type from the
<code class="literal">ApplicationContext</code> by adding the annotation to a field or method that expects an array
of that type:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> MovieCatalog[] movieCatalogs;

    <span class="hl-comment">// ...</span>

}</pre>
<p>The same applies for typed collections:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> Set&lt;MovieCatalog&gt; movieCatalogs;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieCatalogs(Set&lt;MovieCatalog&gt; movieCatalogs) {
        <span class="hl-keyword">this</span>.movieCatalogs = movieCatalogs;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Your beans can implement the <code class="literal">org.springframework.core.Ordered</code> interface or either use
the <code class="literal">@Order</code> or standard <code class="literal">@Priority</code> annotation if you want items in the array or list
to be sorted into a specific order.</p>
</td></tr></tbody></table></div>
<p>Even typed Maps can be autowired as long as the expected key type is <code class="literal">String</code>. The Map
values will contain all beans of the expected type, and the keys will contain the
corresponding bean names:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> Map&lt;String, MovieCatalog&gt; movieCatalogs;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieCatalogs(Map&lt;String, MovieCatalog&gt; movieCatalogs) {
        <span class="hl-keyword">this</span>.movieCatalogs = movieCatalogs;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>By default, the autowiring fails whenever <span class="emphasis"><em>zero</em></span> candidate beans are available; the
default behavior is to treat annotated methods, constructors, and fields as
indicating <span class="emphasis"><em>required</em></span> dependencies. This behavior can be changed as demonstrated below.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <em><span class="hl-annotation" style="color: gray">@Autowired(required=false)</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Only <span class="emphasis"><em>one annotated constructor per-class</em></span> can be marked as <span class="emphasis"><em>required</em></span>, but multiple
non-required constructors can be annotated. In that case, each is considered among the
candidates and Spring uses the <span class="emphasis"><em>greediest</em></span> constructor whose dependencies can be
satisfied, that is the constructor that has the largest number of arguments.</p>
<p><code class="literal">@Autowired’s <span class="emphasis"><em>required</em></span> attribute is recommended over the `@Required</code> annotation.
The <span class="emphasis"><em>required</em></span> attribute indicates that the property is not required for autowiring
purposes, the property is ignored if it cannot be autowired. <code class="literal">@Required</code>, on the other
hand, is stronger in that it enforces the property that was set by any means supported
by the container. If no value is injected, a corresponding exception is raised.</p>
</td></tr></tbody></table></div>
<p>You can also use <code class="literal">@Autowired</code> for interfaces that are well-known resolvable
dependencies: <code class="literal">BeanFactory</code>, <code class="literal">ApplicationContext</code>, <code class="literal">Environment</code>, <code class="literal">ResourceLoader</code>,
<code class="literal">ApplicationEventPublisher</code>, and <code class="literal">MessageSource</code>. These interfaces and their extended
interfaces, such as <code class="literal">ConfigurableApplicationContext</code> or <code class="literal">ResourcePatternResolver</code>, are
automatically resolved, with no special setup necessary.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> ApplicationContext context;

    <span class="hl-keyword">public</span> MovieRecommender() {
    }

    <span class="hl-comment">// ...</span>

}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">@Autowired</code>, <code class="literal">@Inject</code>, <code class="literal">@Resource</code>, and <code class="literal">@Value</code> annotations are handled by Spring
<code class="literal">BeanPostProcessor</code> implementations which in turn means that you <span class="emphasis"><em>cannot</em></span> apply these
annotations within your own <code class="literal">BeanPostProcessor</code> or <code class="literal">BeanFactoryPostProcessor</code> types (if
any). These types must be 'wired up' explicitly via XML or using a Spring <code class="literal">@Bean</code> method.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-autowired-annotation-primary" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation-primary"></a>7.9.3&nbsp;Fine-tuning annotation-based autowiring with @Primary</h3></div></div></div>

<p>Because autowiring by type may lead to multiple candidates, it is often necessary to have
more control over the selection process. One way to accomplish this is with Spring’s
<code class="literal">@Primary</code> annotation. <code class="literal">@Primary</code> indicates that a particular bean should be given
preference when multiple beans are candidates to be autowired to a single-valued
dependency. If exactly one 'primary' bean exists among the candidates, it will be the
autowired value.</p>
<p>Let’s assume we have the following configuration that defines <code class="literal">firstMovieCatalog</code> as the
<span class="emphasis"><em>primary</em></span> <code class="literal">MovieCatalog</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieConfiguration {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="strong"><strong>@Primary</strong></span>
    <span class="hl-keyword">public</span> MovieCatalog firstMovieCatalog() { ... }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> MovieCatalog secondMovieCatalog() { ... }

    <span class="hl-comment">// ...</span>

}</pre>
<p>With such configuration, the following <code class="literal">MovieRecommender</code> will be autowired with the
<code class="literal">firstMovieCatalog</code>.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

    <span class="hl-comment">// ...</span>

}</pre>
<p>The corresponding bean definitions appear as follows.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span> <span class="strong"><strong>primary="true"</strong></span>&gt;
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"movieRecommender"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MovieRecommender"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-autowired-annotation-qualifiers" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation-qualifiers"></a>7.9.4&nbsp;Fine-tuning annotation-based autowiring with qualifiers</h3></div></div></div>

<p><code class="literal">@Primary</code> is an effective way to use autowiring by type with several instances when one
primary candidate can be determined. When more control over the selection process is
required, Spring’s <code class="literal">@Qualifier</code> annotation can be used. You can associate qualifier values
with specific arguments, narrowing the set of type matches so that a specific bean is
chosen for each argument. In the simplest case, this can be a plain descriptive value:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="strong"><strong>@Qualifier("main")</strong></span>
    <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

    <span class="hl-comment">// ...</span>

}</pre>
<p>The <code class="literal">@Qualifier</code> annotation can also be specified on individual constructor arguments or
method parameters:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

    <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(<span class="strong"><strong>@Qualifier("main")</strong></span>MovieCatalog movieCatalog,
            CustomerPreferenceDao customerPreferenceDao) {
        <span class="hl-keyword">this</span>.movieCatalog = movieCatalog;
        <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>The corresponding bean definitions appear as follows. The bean with qualifier value
"main" is wired with the constructor argument that is qualified with the same value.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
        <span class="strong"><strong>&lt;qualifier value="main"/&gt;</strong></span>

        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
        <span class="strong"><strong>&lt;qualifier value="action"/&gt;</strong></span>

        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"movieRecommender"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MovieRecommender"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>For a fallback match, the bean name is considered a default qualifier value. Thus you
can define the bean with an id "main" instead of the nested qualifier element, leading
to the same matching result. However, although you can use this convention to refer to
specific beans by name, <code class="literal">@Autowired</code> is fundamentally about type-driven injection with
optional semantic qualifiers. This means that qualifier values, even with the bean name
fallback, always have narrowing semantics within the set of type matches; they do not
semantically express a reference to a unique bean id. Good qualifier values are "main"
or "EMEA" or "persistent", expressing characteristics of a specific component that are
independent from the bean <code class="literal">id</code>, which may be auto-generated in case of an anonymous bean
definition like the one in the preceding example.</p>
<p>Qualifiers also apply to typed collections, as discussed above, for example, to
<code class="literal">Set&lt;MovieCatalog&gt;</code>. In this case, all matching beans according to the declared
qualifiers are injected as a collection. This implies that qualifiers do not have to be
unique; they rather simply constitute filtering criteria. For example, you can define
multiple <code class="literal">MovieCatalog</code> beans with the same qualifier value "action", all of which would
be injected into a <code class="literal">Set&lt;MovieCatalog&gt;</code> annotated with <code class="literal">@Qualifier("action")</code>.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>If you intend to express annotation-driven injection by name, do not primarily use
<code class="literal">@Autowired</code>, even if is technically capable of referring to a bean name through
<code class="literal">@Qualifier</code> values. Instead, use the JSR-250 <code class="literal">@Resource</code> annotation, which is
semantically defined to identify a specific target component by its unique name, with
the declared type being irrelevant for the matching process. <code class="literal">@Autowired</code> has rather
different semantics: After selecting candidate beans by type, the specified String
qualifier value will be considered within those type-selected candidates only, e.g.
matching an "account" qualifier against beans marked with the same qualifier label.</p>
<p>For beans that are themselves defined as a collection/map or array type, <code class="literal">@Resource</code>
is a fine solution, referring to the specific collection or array bean by unique name.
That said, as of 4.3, collection/map and array types can be matched through Spring’s
<code class="literal">@Autowired</code> type matching algorithm as well, as long as the element type information
is preserved in <code class="literal">@Bean</code> return type signatures or collection inheritance hierarchies.
In this case, qualifier values can be used to select among same-typed collections,
as outlined in the previous paragraph.</p>
<p>As of 4.3, <code class="literal">@Autowired</code> also considers self references for injection, i.e. references
back to the bean that is currently injected. Note that self injection is a fallback;
regular dependencies on other components always have precedence. In that sense, self
references do not participate in regular candidate selection and are therefore in
particular never primary; on the contrary, they always end up as lowest precedence.
In practice, use self references as a last resort only, e.g. for calling other methods
on the same instance through the bean’s transactional proxy: Consider factoring out
the affected methods to a separate delegate bean in such a scenario. Alternatively,
use <code class="literal">@Resource</code> which may obtain a proxy back to the current bean by its unique name.</p>
<p><code class="literal">@Autowired</code> applies to fields, constructors, and multi-argument methods, allowing for
narrowing through qualifier annotations at the parameter level. By contrast, <code class="literal">@Resource</code>
is supported only for fields and bean property setter methods with a single argument.
As a consequence, stick with qualifiers if your injection target is a constructor or a
multi-argument method.</p>
</td></tr></tbody></table></div>
<p>You can create your own custom qualifier annotations. Simply define an annotation and
provide the <code class="literal">@Qualifier</code> annotation within your definition:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target({ElementType.FIELD, ElementType.PARAMETER})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<span class="strong"><strong>@Qualifier</strong></span>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Genre {

    String value();
}</pre>
<p>Then you can provide the custom qualifier on autowired fields and parameters:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="strong"><strong>@Genre("Action")</strong></span>
    <span class="hl-keyword">private</span> MovieCatalog actionCatalog;
    <span class="hl-keyword">private</span> MovieCatalog comedyCatalog;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setComedyCatalog(<span class="strong"><strong>@Genre("Comedy")</strong></span> MovieCatalog comedyCatalog) {
        <span class="hl-keyword">this</span>.comedyCatalog = comedyCatalog;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>Next, provide the information for the candidate bean definitions. You can add
<code class="literal">&lt;qualifier/&gt;</code> tags as sub-elements of the <code class="literal">&lt;bean/&gt;</code> tag and then specify the <code class="literal">type</code> and
<code class="literal">value</code> to match your custom qualifier annotations. The type is matched against the
fully-qualified class name of the annotation. Or, as a convenience if no risk of
conflicting names exists, you can use the short class name. Both approaches are
demonstrated in the following example.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
        <span class="strong"><strong>&lt;qualifier type="Genre" value="Action"/&gt;</strong></span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
        <span class="strong"><strong>&lt;qualifier type="example.Genre" value="Comedy"/&gt;</strong></span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"movieRecommender"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MovieRecommender"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>In <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-classpath-scanning" title="7.10 Classpath scanning and managed components">Section&nbsp;7.10, “Classpath scanning and managed components”</a>, you will see an annotation-based alternative to
providing the qualifier metadata in XML. Specifically, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-qualifiers" title="7.10.8 Providing qualifier metadata with annotations">Section&nbsp;7.10.8, “Providing qualifier metadata with annotations”</a>.</p>
<p>In some cases, it may be sufficient to use an annotation without a value. This may be
useful when the annotation serves a more generic purpose and can be applied across
several different types of dependencies. For example, you may provide an <span class="emphasis"><em>offline</em></span>
catalog that would be searched when no Internet connection is available. First define
the simple annotation:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target({ElementType.FIELD, ElementType.PARAMETER})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Qualifier</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Offline {

}</pre>
<p>Then add the annotation to the field or property to be autowired:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="strong"><strong>@Offline</strong></span>
    <span class="hl-keyword">private</span> MovieCatalog offlineCatalog;

    <span class="hl-comment">// ...</span>

}</pre>
<p>Now the bean definition only needs a qualifier <code class="literal">type</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
    <span class="strong"><strong>&lt;qualifier type="Offline"/&gt;</strong></span>
    <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>You can also define custom qualifier annotations that accept named attributes in
addition to or instead of the simple <code class="literal">value</code> attribute. If multiple attribute values are
then specified on a field or parameter to be autowired, a bean definition must match
<span class="emphasis"><em>all</em></span> such attribute values to be considered an autowire candidate. As an example,
consider the following annotation definition:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target({ElementType.FIELD, ElementType.PARAMETER})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Qualifier</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> MovieQualifier {

    String genre();

    Format format();

}</pre>
<p>In this case <code class="literal">Format</code> is an enum:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> enum Format {
    VHS, DVD, BLURAY
}</pre>
<p>The fields to be autowired are annotated with the custom qualifier and include values
for both attributes: <code class="literal">genre</code> and <code class="literal">format</code>.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <em><span class="hl-annotation" style="color: gray">@MovieQualifier(format=Format.VHS, genre="Action")</span></em>
    <span class="hl-keyword">private</span> MovieCatalog actionVhsCatalog;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <em><span class="hl-annotation" style="color: gray">@MovieQualifier(format=Format.VHS, genre="Comedy")</span></em>
    <span class="hl-keyword">private</span> MovieCatalog comedyVhsCatalog;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <em><span class="hl-annotation" style="color: gray">@MovieQualifier(format=Format.DVD, genre="Action")</span></em>
    <span class="hl-keyword">private</span> MovieCatalog actionDvdCatalog;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <em><span class="hl-annotation" style="color: gray">@MovieQualifier(format=Format.BLURAY, genre="Comedy")</span></em>
    <span class="hl-keyword">private</span> MovieCatalog comedyBluRayCatalog;

    <span class="hl-comment">// ...</span>

}</pre>
<p>Finally, the bean definitions should contain matching qualifier values. This example
also demonstrates that bean <span class="emphasis"><em>meta</em></span> attributes may be used instead of the
<code class="literal">&lt;qualifier/&gt;</code> sub-elements. If available, the <code class="literal">&lt;qualifier/&gt;</code> and its attributes take
precedence, but the autowiring mechanism falls back on the values provided within the
<code class="literal">&lt;meta/&gt;</code> tags if no such qualifier is present, as in the last two bean definitions in
the following example.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;qualifier</span> <span class="hl-attribute">type</span>=<span class="hl-value">"MovieQualifier"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">"format"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"VHS"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">"genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Action"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/qualifier&gt;</span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;qualifier</span> <span class="hl-attribute">type</span>=<span class="hl-value">"MovieQualifier"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">"format"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"VHS"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">"genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Comedy"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/qualifier&gt;</span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">"format"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"DVD"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">"genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Action"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.SimpleMovieCatalog"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">"format"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"BLURAY"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">"genre"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Comedy"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-generics-as-qualifiers" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-generics-as-qualifiers"></a>7.9.5&nbsp;Using generics as autowiring qualifiers</h3></div></div></div>

<p>In addition to the <code class="literal">@Qualifier</code> annotation, it is also possible to use Java generic types
as an implicit form of qualification. For example, suppose you have the following
configuration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyConfiguration {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> StringStore stringStore() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> StringStore();
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> IntegerStore integerStore() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> IntegerStore();
    }

}</pre>
<p>Assuming that beans above implement a generic interface, i.e. <code class="literal">Store&lt;String&gt;</code> and
<code class="literal">Store&lt;Integer&gt;</code>, you can <code class="literal">@Autowire</code> the <code class="literal">Store</code> interface and the <span class="emphasis"><em>generic</em></span> will
be used as a qualifier:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
<span class="hl-keyword">private</span> Store&lt;String&gt; s1; <span class="hl-comment">// &lt;String&gt; qualifier, injects the stringStore bean</span>

<em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
<span class="hl-keyword">private</span> Store&lt;Integer&gt; s2; <span class="hl-comment">// &lt;Integer&gt; qualifier, injects the integerStore bean</span></pre>
<p>Generic qualifiers also apply when autowiring Lists, Maps and Arrays:</p>
<pre class="programlisting"><span class="hl-comment">// Inject all Store beans as long as they have an &lt;Integer&gt; generic</span>
<span class="hl-comment">// Store&lt;String&gt; beans will not appear in this list</span>
<em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
<span class="hl-keyword">private</span> List&lt;Store&lt;Integer&gt;&gt; s;</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-custom-autowire-configurer" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-custom-autowire-configurer"></a>7.9.6&nbsp;CustomAutowireConfigurer</h3></div></div></div>

<p>The
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/beans/factory/annotation/CustomAutowireConfigurer.html" target="_top"><code class="literal">CustomAutowireConfigurer</code></a>
is a <code class="literal">BeanFactoryPostProcessor</code> that enables you to register your own custom qualifier
annotation types even if they are not annotated with Spring’s <code class="literal">@Qualifier</code> annotation.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"customAutowireConfigurer"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.annotation.CustomAutowireConfigurer"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"customQualifierTypes"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;set&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>example.CustomQualifier<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/set&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The <code class="literal">AutowireCandidateResolver</code> determines autowire candidates by:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
the <code class="literal">autowire-candidate</code> value of each bean definition
</li><li class="listitem">
any <code class="literal">default-autowire-candidates</code> pattern(s) available on the <code class="literal">&lt;beans/&gt;</code> element
</li><li class="listitem">
the presence of <code class="literal">@Qualifier</code> annotations and any custom annotations registered
with the <code class="literal">CustomAutowireConfigurer</code>
</li></ul></div>
<p>When multiple beans qualify as autowire candidates, the determination of a "primary" is
the following: if exactly one bean definition among the candidates has a <code class="literal">primary</code>
attribute set to <code class="literal">true</code>, it will be selected.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-resource-annotation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-resource-annotation"></a>7.9.7&nbsp;@Resource</h3></div></div></div>

<p>Spring also supports injection using the JSR-250 <code class="literal">@Resource</code> annotation on fields or
bean property setter methods. This is a common pattern in Java EE 5 and 6, for example
in JSF 1.2 managed beans or JAX-WS 2.0 endpoints. Spring supports this pattern for
Spring-managed objects as well.</p>
<p><code class="literal">@Resource</code> takes a name attribute, and by default Spring interprets that value as the
bean name to be injected. In other words, it follows <span class="emphasis"><em>by-name</em></span> semantics, as
demonstrated in this example:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <span class="strong"><strong>@Resource(name="myMovieFinder")</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

}</pre>
<p>If no name is specified explicitly, the default name is derived from the field name or
setter method. In case of a field, it takes the field name; in case of a setter method,
it takes the bean property name. So the following example is going to have the bean with
name "movieFinder" injected into its setter method:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <span class="strong"><strong>@Resource</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The name provided with the annotation is resolved as a bean name by the
<code class="literal">ApplicationContext</code> of which the <code class="literal">CommonAnnotationBeanPostProcessor</code> is aware. The
names can be resolved through JNDI if you configure Spring’s
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/jndi/support/SimpleJndiBeanFactory.html" target="_top"><code class="literal">SimpleJndiBeanFactory</code></a>
explicitly. However, it is recommended that you rely on the default behavior and simply
use Spring’s JNDI lookup capabilities to preserve the level of indirection.</p>
</td></tr></tbody></table></div>
<p>In the exclusive case of <code class="literal">@Resource</code> usage with no explicit name specified, and similar
to <code class="literal">@Autowired</code>, <code class="literal">@Resource</code> finds a primary type match instead of a specific named bean
and resolves well-known resolvable dependencies: the <code class="literal">BeanFactory</code>,
<code class="literal">ApplicationContext</code>, <code class="literal">ResourceLoader</code>, <code class="literal">ApplicationEventPublisher</code>, and <code class="literal">MessageSource</code>
interfaces.</p>
<p>Thus in the following example, the <code class="literal">customerPreferenceDao</code> field first looks for a bean
named customerPreferenceDao, then falls back to a primary type match for the type
<code class="literal">CustomerPreferenceDao</code>. The "context" field is injected based on the known resolvable
dependency type <code class="literal">ApplicationContext</code>.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <em><span class="hl-annotation" style="color: gray">@Resource</span></em>
    <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

    <em><span class="hl-annotation" style="color: gray">@Resource</span></em>
    <span class="hl-keyword">private</span> ApplicationContext context;

    <span class="hl-keyword">public</span> MovieRecommender() {
    }

    <span class="hl-comment">// ...</span>

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-postconstruct-and-predestroy-annotations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations"></a>7.9.8&nbsp;@PostConstruct and @PreDestroy</h3></div></div></div>

<p>The <code class="literal">CommonAnnotationBeanPostProcessor</code> not only recognizes the <code class="literal">@Resource</code> annotation
but also the JSR-250 <span class="emphasis"><em>lifecycle</em></span> annotations. Introduced in Spring 2.5, the support
for these annotations offers yet another alternative to those described in
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">initialization callbacks</a> and
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean" title="Destruction callbacks">destruction callbacks</a>. Provided that the
<code class="literal">CommonAnnotationBeanPostProcessor</code> is registered within the Spring
<code class="literal">ApplicationContext</code>, a method carrying one of these annotations is invoked at the same
point in the lifecycle as the corresponding Spring lifecycle interface method or
explicitly declared callback method. In the example below, the cache will be
pre-populated upon initialization and cleared upon destruction.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CachingMovieLister {

    <em><span class="hl-annotation" style="color: gray">@PostConstruct</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateMovieCache() {
        <span class="hl-comment">// populates the movie cache upon initialization...</span>
    }

    <em><span class="hl-annotation" style="color: gray">@PreDestroy</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> clearMovieCache() {
        <span class="hl-comment">// clears the movie cache upon destruction...</span>
    }

}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>For details about the effects of combining various lifecycle mechanisms, see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-combined-effects" title="Combining lifecycle mechanisms">the section called “Combining lifecycle mechanisms”</a>.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-classpath-scanning" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-classpath-scanning"></a>7.10&nbsp;Classpath scanning and managed components</h2></div></div></div>

<p>Most examples in this chapter use XML to specify the configuration metadata that produces
each <code class="literal">BeanDefinition</code> within the Spring container. The previous section
(<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-annotation-config" title="7.9 Annotation-based container configuration">Section&nbsp;7.9, “Annotation-based container configuration”</a>) demonstrates how to provide a lot of the configuration
metadata through source-level annotations. Even in those examples, however, the "base"
bean definitions are explicitly defined in the XML file, while the annotations only drive
the dependency injection. This section describes an option for implicitly detecting the
<span class="emphasis"><em>candidate components</em></span> by scanning the classpath. Candidate components are classes that
match against a filter criteria and have a corresponding bean definition registered with
the container. This removes the need to use XML to perform bean registration; instead you
can use annotations (for example <code class="literal">@Component</code>), AspectJ type expressions, or your own
custom filter criteria to select which classes will have bean definitions registered with
the container.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Starting with Spring 3.0, many features provided by the Spring JavaConfig project are
part of the core Spring Framework. This allows you to define beans using Java rather
than using the traditional XML files. Take a look at the <code class="literal">@Configuration</code>, <code class="literal">@Bean</code>,
<code class="literal">@Import</code>, and <code class="literal">@DependsOn</code> annotations for examples of how to use these new features.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-stereotype-annotations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-stereotype-annotations"></a>7.10.1&nbsp;@Component and further stereotype annotations</h3></div></div></div>

<p>The <code class="literal">@Repository</code> annotation is a marker for any class that fulfills the role or
<span class="emphasis"><em>stereotype</em></span> of a repository (also known as Data Access Object or DAO). Among the uses
of this marker is the automatic translation of exceptions as described in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-exception-translation" title="20.2.2 Exception translation">Section&nbsp;20.2.2, “Exception translation”</a>.</p>
<p>Spring provides further stereotype annotations: <code class="literal">@Component</code>, <code class="literal">@Service</code>, and
<code class="literal">@Controller</code>. <code class="literal">@Component</code> is a generic stereotype for any Spring-managed component.
<code class="literal">@Repository</code>, <code class="literal">@Service</code>, and <code class="literal">@Controller</code> are specializations of <code class="literal">@Component</code> for
more specific use cases, for example, in the persistence, service, and presentation
layers, respectively. Therefore, you can annotate your component classes with
<code class="literal">@Component</code>, but by annotating them with <code class="literal">@Repository</code>, <code class="literal">@Service</code>, or <code class="literal">@Controller</code>
instead, your classes are more properly suited for processing by tools or associating
with aspects. For example, these stereotype annotations make ideal targets for
pointcuts. It is also possible that <code class="literal">@Repository</code>, <code class="literal">@Service</code>, and <code class="literal">@Controller</code> may
carry additional semantics in future releases of the Spring Framework. Thus, if you are
choosing between using <code class="literal">@Component</code> or <code class="literal">@Service</code> for your service layer, <code class="literal">@Service</code> is
clearly the better choice. Similarly, as stated above, <code class="literal">@Repository</code> is already
supported as a marker for automatic exception translation in your persistence layer.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-meta-annotations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-meta-annotations"></a>7.10.2&nbsp;Meta-annotations</h3></div></div></div>

<p>Many of the annotations provided by Spring can be used as <span class="emphasis"><em>meta-annotations</em></span> in your
own code. A meta-annotation is simply an annotation that can be applied to another
annotation. For example, the <code class="literal">@Service</code> annotation mentioned above is meta-annotated with
<code class="literal">@Component</code>:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target(ElementType.TYPE)</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Documented</span></em>
<span class="strong"><strong>@Component</strong></span> <span class="hl-comment">// Spring will see this and treat @Service in the same way as @Component</span>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Service {

    <span class="hl-comment">// ....</span>
}</pre>
<p>Meta-annotations can also be combined to create <span class="emphasis"><em>composed annotations</em></span>. For example,
the <code class="literal">@RestController</code> annotation from Spring MVC is <span class="emphasis"><em>composed</em></span> of <code class="literal">@Controller</code> and
<code class="literal">@ResponseBody</code>.</p>
<p>In addition, composed annotations may optionally redeclare attributes from
meta-annotations to allow user customization. This can be particularly useful when you
want to only expose a subset of the meta-annotation’s attributes. For example, Spring’s
<code class="literal">@SessionScope</code> annotation hardcodes the scope name to <code class="literal">session</code> but still allows
customization of the <code class="literal">proxyMode</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target({ElementType.TYPE, ElementType.METHOD})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Documented</span></em>
<em><span class="hl-annotation" style="color: gray">@Scope(WebApplicationContext.SCOPE_SESSION)</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> SessionScope {

    <strong class="hl-tag" style="color: blue">/**
     * Alias for {@link Scope#proxyMode}.
     * &lt;p&gt;Defaults to {@link ScopedProxyMode#TARGET_CLASS}.
     */</strong>
    <em><span class="hl-annotation" style="color: gray">@AliasFor(annotation = Scope.class)</span></em>
    ScopedProxyMode proxyMode() <span class="hl-keyword">default</span> ScopedProxyMode.TARGET_CLASS;

}</pre>
<p><code class="literal">@SessionScope</code> can then be used without declaring the <code class="literal">proxyMode</code> as follows:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Service</span></em>
<span class="strong"><strong>@SessionScope</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SessionScopedService {
    <span class="hl-comment">// ...</span>
}</pre>
<p>Or with an overridden value for the <code class="literal">proxyMode</code> as follows:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Service</span></em>
<span class="strong"><strong>@SessionScope(proxyMode = ScopedProxyMode.INTERFACES)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SessionScopedUserService <span class="hl-keyword">implements</span> UserService {
    <span class="hl-comment">// ...</span>
}</pre>
<p>For further details, consult the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#annotation-programming-model" title="38. Spring Annotation Programming Model">Spring Annotation Programming Model</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-autodetection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-autodetection"></a>7.10.3&nbsp;Automatically detecting classes and registering bean definitions</h3></div></div></div>

<p>Spring can automatically detect stereotyped classes and register corresponding
<code class="literal">BeanDefinition</code>s with the <code class="literal">ApplicationContext</code>. For example, the following two classes
are eligible for such autodetection:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Service</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> SimpleMovieLister(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Repository</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JpaMovieFinder <span class="hl-keyword">implements</span> MovieFinder {
    <span class="hl-comment">// implementation elided for clarity</span>
}</pre>
<p>To autodetect these classes and register the corresponding beans, you need to add
<code class="literal">@ComponentScan</code> to your <code class="literal">@Configuration</code> class, where the <code class="literal">basePackages</code> attribute
is a common parent package for the two classes. (Alternatively, you can specify a
comma/semicolon/space-separated list that includes the parent package of each class.)</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@ComponentScan(basePackages = "org.example")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig  {
    ...
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>for concision, the above may have used the <code class="literal">value</code> attribute of the
annotation, i.e. <code class="literal">@ComponentScan("org.example")</code></p>
</td></tr></tbody></table></div>
<p>The following is an alternative using XML</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>The use of <code class="literal">&lt;context:component-scan&gt;</code> implicitly enables the functionality of
<code class="literal">&lt;context:annotation-config&gt;</code>. There is usually no need to include the
<code class="literal">&lt;context:annotation-config&gt;</code> element when using <code class="literal">&lt;context:component-scan&gt;</code>.</p>
</td></tr></tbody></table></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The scanning of classpath packages requires the presence of corresponding directory
entries in the classpath. When you build JARs with Ant, make sure that you do <span class="emphasis"><em>not</em></span>
activate the files-only switch of the JAR task. Also, classpath directories may not
get exposed based on security policies in some environments, e.g. standalone apps on
JDK 1.7.0_45 and higher (which requires 'Trusted-Library' setup in your manifests; see
<a class="ulink" href="https://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources" target="_top">http://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources</a>).</p>
</td></tr></tbody></table></div>
<p>Furthermore, the <code class="literal">AutowiredAnnotationBeanPostProcessor</code> and
<code class="literal">CommonAnnotationBeanPostProcessor</code> are both included implicitly when you use the
component-scan element. That means that the two components are autodetected <span class="emphasis"><em>and</em></span>
wired together - all without any bean configuration metadata provided in XML.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>You can disable the registration of <code class="literal">AutowiredAnnotationBeanPostProcessor</code> and
<code class="literal">CommonAnnotationBeanPostProcessor</code> by including the <span class="emphasis"><em>annotation-config</em></span> attribute
with a value of false.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-filters" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-filters"></a>7.10.4&nbsp;Using filters to customize scanning</h3></div></div></div>

<p>By default, classes annotated with <code class="literal">@Component</code>, <code class="literal">@Repository</code>, <code class="literal">@Service</code>,
<code class="literal">@Controller</code>, or a custom annotation that itself is annotated with <code class="literal">@Component</code> are the
only detected candidate components. However, you can modify and extend this behavior
simply by applying custom filters. Add them as <span class="emphasis"><em>includeFilters</em></span> or <span class="emphasis"><em>excludeFilters</em></span>
parameters of the <code class="literal">@ComponentScan</code> annotation (or as <span class="emphasis"><em>include-filter</em></span> or <span class="emphasis"><em>exclude-filter</em></span>
sub-elements of the <code class="literal">component-scan</code> element). Each filter element requires the <code class="literal">type</code>
and <code class="literal">expression</code> attributes. The following table describes the filtering options.</p>
<div class="table"><a name="beans-scanning-filters-tbl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-filters-tbl"></a><p class="title"><b>Table&nbsp;7.5.&nbsp;Filter Types</b></p><div class="table-contents">

<table summary="Filter Types" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Filter Type</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Example Expression</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>annotation (default)</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org.example.SomeAnnotation</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>An annotation to be present at the type level in target components.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>assignable</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org.example.SomeClass</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A class (or interface) that the target components are assignable to (extend/implement).</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>aspectj</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org.example..*Service+</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>An AspectJ type expression to be matched by the target components.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>regex</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org\.example\.Default.*</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A regex expression to be matched by the target components class names.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>custom</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org.example.MyTypeFilter</code></p></td><td style="" align="left" valign="top"><p>A custom implementation of the <code class="literal">org.springframework.core.type .TypeFilter</code> interface.</p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>The following example shows the configuration ignoring all <code class="literal">@Repository</code> annotations
and using "stub" repositories instead.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@ComponentScan(basePackages = "org.example",
        includeFilters = @Filter(type = FilterType.REGEX, pattern = ".*Stub.*Repository"),
        excludeFilters = @Filter(Repository.class))</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
    ...
}</pre>
<p>and the equivalent using XML</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;context:include-filter</span> <span class="hl-attribute">type</span>=<span class="hl-value">"regex"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">".*Stub.*Repository"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;context:exclude-filter</span> <span class="hl-attribute">type</span>=<span class="hl-value">"annotation"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">"org.springframework.stereotype.Repository"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/context:component-scan&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>You can also disable the default filters by setting <code class="literal">useDefaultFilters=false</code> on the annotation or
providing <code class="literal">use-default-filters="false"</code> as an attribute of the <code class="literal">&lt;component-scan/&gt;</code> element. This
will in effect disable automatic detection of classes annotated with <code class="literal">@Component</code>, <code class="literal">@Repository</code>,
<code class="literal">@Service</code>, <code class="literal">@Controller</code>, or <code class="literal">@Configuration</code>.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-factorybeans-annotations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factorybeans-annotations"></a>7.10.5&nbsp;Defining bean metadata within components</h3></div></div></div>

<p>Spring components can also contribute bean definition metadata to the container. You do
this with the same <code class="literal">@Bean</code> annotation used to define bean metadata within <code class="literal">@Configuration</code>
annotated classes. Here is a simple example:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FactoryMethodComponent {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <em><span class="hl-annotation" style="color: gray">@Qualifier("public")</span></em>
    <span class="hl-keyword">public</span> TestBean publicInstance() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"publicInstance"</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doWork() {
        <span class="hl-comment">// Component method implementation omitted</span>
    }

}</pre>
<p>This class is a Spring component that has application-specific code contained in its
<code class="literal">doWork()</code> method. However, it also contributes a bean definition that has a factory
method referring to the method <code class="literal">publicInstance()</code>. The <code class="literal">@Bean</code> annotation identifies the
factory method and other bean definition properties, such as a qualifier value through
the <code class="literal">@Qualifier</code> annotation. Other method level annotations that can be specified are
<code class="literal">@Scope</code>, <code class="literal">@Lazy</code>, and custom qualifier annotations.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>In addition to its role for component initialization, the <code class="literal">@Lazy</code> annotation may also be
placed on injection points marked with <code class="literal">@Autowired</code> or <code class="literal">@Inject</code>. In this context, it
leads to the injection of a lazy-resolution proxy.</p>
</td></tr></tbody></table></div>
<p>Autowired fields and methods are supported as previously discussed, with additional
support for autowiring of <code class="literal">@Bean</code> methods:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FactoryMethodComponent {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">int</span> i;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <em><span class="hl-annotation" style="color: gray">@Qualifier("public")</span></em>
    <span class="hl-keyword">public</span> TestBean publicInstance() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"publicInstance"</span>);
    }

    <span class="hl-comment">// use of a custom qualifier and autowiring of method parameters</span>
    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">protected</span> TestBean protectedInstance(
            <em><span class="hl-annotation" style="color: gray">@Qualifier("public")</span></em> TestBean spouse,
            <em><span class="hl-annotation" style="color: gray">@Value("#{privateInstance.age}")</span></em> String country) {
        TestBean tb = <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"protectedInstance"</span>, <span class="hl-number">1</span>);
        tb.setSpouse(spouse);
        tb.setCountry(country);
        <span class="hl-keyword">return</span> tb;
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">private</span> TestBean privateInstance() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"privateInstance"</span>, i++);
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <em><span class="hl-annotation" style="color: gray">@RequestScope</span></em>
    <span class="hl-keyword">public</span> TestBean requestScopedInstance() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"requestScopedInstance"</span>, <span class="hl-number">3</span>);
    }

}</pre>
<p>The example autowires the <code class="literal">String</code> method parameter <code class="literal">country</code> to the value of the <code class="literal">Age</code>
property on another bean named <code class="literal">privateInstance</code>. A Spring Expression Language element
defines the value of the property through the notation <code class="literal">#{ &lt;expression&gt; }</code>. For <code class="literal">@Value</code>
annotations, an expression resolver is preconfigured to look for bean names when
resolving expression text.</p>
<p>As of Spring Framework 4.3, you may also declare a factory method parameter of type
<code class="literal">InjectionPoint</code> (or its more specific subclass <code class="literal">DependencyDescriptor</code>) in order to
access the requesting injection point that triggers the creation of the current bean.
Note that this will only apply to the actual creation of bean instances, not to the
injection of existing instances. As a consequence, this feature makes most sense for
beans of prototype scope. For other scopes, the factory method will only ever see the
injection point which triggered the creation of a new bean instance in the given scope:
for example, the dependency that triggered the creation of a lazy singleton bean.
Use the provided injection point metadata with semantic care in such scenarios.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FactoryMethodComponent {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em> <em><span class="hl-annotation" style="color: gray">@Scope("prototype")</span></em>
    <span class="hl-keyword">public</span> TestBean prototypeInstance(InjectionPoint injectionPoint) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">"prototypeInstance for "</span> + injectionPoint.getMember());
    }
}</pre>
<p>The <code class="literal">@Bean</code> methods in a regular Spring component are processed differently than their
counterparts inside a Spring <code class="literal">@Configuration</code> class. The difference is that <code class="literal">@Component</code>
classes are not enhanced with CGLIB to intercept the invocation of methods and fields.
CGLIB proxying is the means by which invoking methods or fields within <code class="literal">@Bean</code> methods
in <code class="literal">@Configuration</code> classes creates bean metadata references to collaborating objects;
such methods are <span class="emphasis"><em>not</em></span> invoked with normal Java semantics but rather go through the
container in order to provide the usual lifecycle management and proxying of Spring
beans even when referring to other beans via programmatic calls to <code class="literal">@Bean</code> methods.
In contrast, invoking a method or field in an <code class="literal">@Bean</code> method within a plain <code class="literal">@Component</code>
class <span class="emphasis"><em>has</em></span> standard Java semantics, with no special CGLIB processing or other
constraints applying.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>You may declare <code class="literal">@Bean</code> methods as <code class="literal">static</code>, allowing for them to be called without
creating their containing configuration class as an instance. This makes particular
sense when defining post-processor beans, e.g. of type <code class="literal">BeanFactoryPostProcessor</code> or
<code class="literal">BeanPostProcessor</code>, since such beans will get initialized early in the container
lifecycle and should avoid triggering other parts of the configuration at that point.</p>
<p>Note that calls to static <code class="literal">@Bean</code> methods will never get intercepted by the container,
not even within <code class="literal">@Configuration</code> classes (see above). This is due to technical
limitations: CGLIB subclassing can only override non-static methods. As a consequence,
a direct call to another <code class="literal">@Bean</code> method will have standard Java semantics, resulting
in an independent instance being returned straight from the factory method itself.</p>
<p>The Java language visibility of <code class="literal">@Bean</code> methods does not have an immediate impact on
the resulting bean definition in Spring’s container. You may freely declare your
factory methods as you see fit in non-<code class="literal">@Configuration</code> classes and also for static
methods anywhere. However, regular <code class="literal">@Bean</code> methods in <code class="literal">@Configuration</code> classes need
to be overridable, i.e. they must not be declared as <code class="literal">private</code> or <code class="literal">final</code>.</p>
<p><code class="literal">@Bean</code> methods will also be discovered on base classes of a given component or
configuration class, as well as on Java 8 default methods declared in interfaces
implemented by the component or configuration class. This allows for a lot of
flexibility in composing complex configuration arrangements, with even multiple
inheritance being possible through Java 8 default methods as of Spring 4.2.</p>
<p>Finally, note that a single class may hold multiple <code class="literal">@Bean</code> methods for the same
bean, as an arrangement of multiple factory methods to use depending on available
dependencies at runtime. This is the same algorithm as for choosing the "greediest"
constructor or factory method in other configuration scenarios: The variant with
the largest number of satisfiable dependencies will be picked at construction time,
analogous to how the container selects between multiple <code class="literal">@Autowired</code> constructors.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-name-generator" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-name-generator"></a>7.10.6&nbsp;Naming autodetected components</h3></div></div></div>

<p>When a component is autodetected as part of the scanning process, its bean name is
generated by the <code class="literal">BeanNameGenerator</code> strategy known to that scanner. By default, any
Spring stereotype annotation (<code class="literal">@Component</code>, <code class="literal">@Repository</code>, <code class="literal">@Service</code>, and
<code class="literal">@Controller</code>) that contains a <span class="emphasis"><em>name</em></span> <code class="literal">value</code> will thereby provide that name to the
corresponding bean definition.</p>
<p>If such an annotation contains no <span class="emphasis"><em>name</em></span> <code class="literal">value</code> or for any other detected component (such
as those discovered by custom filters), the default bean name generator returns the
uncapitalized non-qualified class name. For example, if the following two components
were detected, the names would be <code class="literal">myMovieLister</code> and <code class="literal">movieFinderImpl</code>:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Service("myMovieLister")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {
    <span class="hl-comment">// ...</span>
}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Repository</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieFinderImpl <span class="hl-keyword">implements</span> MovieFinder {
    <span class="hl-comment">// ...</span>
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If you do not want to rely on the default bean-naming strategy, you can provide a custom
bean-naming strategy. First, implement the
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/beans/factory/support/BeanNameGenerator.html" target="_top"><code class="literal">BeanNameGenerator</code></a>
interface, and be sure to include a default no-arg constructor. Then, provide the
fully-qualified class name when configuring the scanner:</p>
</td></tr></tbody></table></div>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@ComponentScan(basePackages = "org.example", nameGenerator = MyNameGenerator.class)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
    ...
}</pre>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span>
        <span class="hl-attribute">name-generator</span>=<span class="hl-value">"org.example.MyNameGenerator"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>As a general rule, consider specifying the name with the annotation whenever other
components may be making explicit references to it. On the other hand, the
auto-generated names are adequate whenever the container is responsible for wiring.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-scope-resolver" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-scope-resolver"></a>7.10.7&nbsp;Providing a scope for autodetected components</h3></div></div></div>

<p>As with Spring-managed components in general, the default and most common scope for
autodetected components is <code class="literal">singleton</code>. However, sometimes you need a different scope
which can be specified via the <code class="literal">@Scope</code> annotation. Simply provide the name of the scope
within the annotation:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Scope("prototype")</span></em>
<em><span class="hl-annotation" style="color: gray">@Repository</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieFinderImpl <span class="hl-keyword">implements</span> MovieFinder {
    <span class="hl-comment">// ...</span>
}</pre>
<p>For details on web-specific scopes, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other" title="7.5.4 Request, session, global session, application, and WebSocket scopes">Section&nbsp;7.5.4, “Request, session, global session, application, and WebSocket scopes”</a>.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>To provide a custom strategy for scope resolution rather than relying on the
annotation-based approach, implement the
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/annotation/ScopeMetadataResolver.html" target="_top"><code class="literal">ScopeMetadataResolver</code></a>
interface, and be sure to include a default no-arg constructor. Then, provide the
fully-qualified class name when configuring the scanner:</p>
</td></tr></tbody></table></div>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@ComponentScan(basePackages = "org.example", scopeResolver = MyScopeResolver.class)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
    ...
}</pre>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span>
            <span class="hl-attribute">scope-resolver</span>=<span class="hl-value">"org.example.MyScopeResolver"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>When using certain non-singleton scopes, it may be necessary to generate proxies for the
scoped objects. The reasoning is described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection" title="Scoped beans as dependencies">the section called “Scoped beans as dependencies”</a>.
For this purpose, a <span class="emphasis"><em>scoped-proxy</em></span> attribute is available on the component-scan
element. The three possible values are: no, interfaces, and targetClass. For example,
the following configuration will result in standard JDK dynamic proxies:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@ComponentScan(basePackages = "org.example", scopedProxy = ScopedProxyMode.INTERFACES)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
    ...
}</pre>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.example"</span>
        <span class="hl-attribute">scoped-proxy</span>=<span class="hl-value">"interfaces"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-scanning-qualifiers" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-scanning-qualifiers"></a>7.10.8&nbsp;Providing qualifier metadata with annotations</h3></div></div></div>

<p>The <code class="literal">@Qualifier</code> annotation is discussed in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation-qualifiers" title="7.9.4 Fine-tuning annotation-based autowiring with qualifiers">Section&nbsp;7.9.4, “Fine-tuning annotation-based autowiring with qualifiers”</a>.
The examples in that section demonstrate the use of the <code class="literal">@Qualifier</code> annotation and
custom qualifier annotations to provide fine-grained control when you resolve autowire
candidates. Because those examples were based on XML bean definitions, the qualifier
metadata was provided on the candidate bean definitions using the <code class="literal">qualifier</code> or <code class="literal">meta</code>
sub-elements of the <code class="literal">bean</code> element in the XML. When relying upon classpath scanning for
autodetection of components, you provide the qualifier metadata with type-level
annotations on the candidate class. The following three examples demonstrate this
technique:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="strong"><strong>@Qualifier("Action")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ActionMovieCatalog <span class="hl-keyword">implements</span> MovieCatalog {
    <span class="hl-comment">// ...</span>
}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="strong"><strong>@Genre("Action")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ActionMovieCatalog <span class="hl-keyword">implements</span> MovieCatalog {
    <span class="hl-comment">// ...</span>
}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="strong"><strong>@Offline</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CachingMovieCatalog <span class="hl-keyword">implements</span> MovieCatalog {
    <span class="hl-comment">// ...</span>
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>As with most annotation-based alternatives, keep in mind that the annotation metadata is
bound to the class definition itself, while the use of XML allows for multiple beans
<span class="emphasis"><em>of the same type</em></span> to provide variations in their qualifier metadata, because that
metadata is provided per-instance rather than per-class.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-standard-annotations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-standard-annotations"></a>7.11&nbsp;Using JSR 330 Standard Annotations</h2></div></div></div>

<p>Starting with Spring 3.0, Spring offers support for JSR-330 standard annotations
(Dependency Injection). Those annotations are scanned in the same way as the Spring
annotations. You just need to have the relevant jars in your classpath.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If you are using Maven, the <code class="literal">javax.inject</code> artifact is available in the standard Maven
repository (
<a class="ulink" href="https://repo1.maven.org/maven2/javax/inject/javax.inject/1/" target="_top">http://repo1.maven.org/maven2/javax/inject/javax.inject/1/</a>).
You can add the following dependency to your file pom.xml:</p>
<pre class="programlisting"><span class="hl-tag">&lt;dependency&gt;</span>
    <span class="hl-tag">&lt;groupId&gt;</span>javax.inject<span class="hl-tag">&lt;/groupId&gt;</span>
    <span class="hl-tag">&lt;artifactId&gt;</span>javax.inject<span class="hl-tag">&lt;/artifactId&gt;</span>
    <span class="hl-tag">&lt;version&gt;</span>1<span class="hl-tag">&lt;/version&gt;</span>
<span class="hl-tag">&lt;/dependency&gt;</span></pre>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-inject-named" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-inject-named"></a>7.11.1&nbsp;Dependency Injection with @Inject and @Named</h3></div></div></div>

<p>Instead of <code class="literal">@Autowired</code>, <code class="literal">@javax.inject.Inject</code> may be used as follows:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <em><span class="hl-annotation" style="color: gray">@Inject</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> listMovies() {
        <span class="hl-keyword">this</span>.movieFinder.findMovies(...);
        ...
    }
}</pre>
<p>As with <code class="literal">@Autowired</code>, it is possible to use <code class="literal">@Inject</code> at the field level, method level
and constructor-argument level. Furthermore, you may declare your injection point as a
<code class="literal">Provider</code>, allowing for on-demand access to beans of shorter scopes or lazy access to
other beans through a <code class="literal">Provider.get()</code> call. As a variant of the example above:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Provider;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> Provider&lt;MovieFinder&gt; movieFinder;

    <em><span class="hl-annotation" style="color: gray">@Inject</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(Provider&lt;MovieFinder&gt; movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> listMovies() {
        <span class="hl-keyword">this</span>.movieFinder.get().findMovies(...);
        ...
    }
}</pre>
<p>If you would like to use a qualified name for the dependency that should be injected,
you should use the <code class="literal">@Named</code> annotation as follows:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Named;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <em><span class="hl-annotation" style="color: gray">@Inject</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(<em><span class="hl-annotation" style="color: gray">@Named("main")</span></em> MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-named" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-named"></a>7.11.2&nbsp;@Named and @ManagedBean: standard equivalents to the @Component annotation</h3></div></div></div>

<p>Instead of <code class="literal">@Component</code>, <code class="literal">@javax.inject.Named</code> or <code class="literal">javax.annotation.ManagedBean</code> may be
used as follows:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Named;

<em><span class="hl-annotation" style="color: gray">@Named("movieListener")</span></em> <span class="hl-comment">// @ManagedBean("movieListener") could be used as well</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <em><span class="hl-annotation" style="color: gray">@Inject</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>
}</pre>
<p>It is very common to use <code class="literal">@Component</code> without specifying a name for the component.
<code class="literal">@Named</code> can be used in a similar fashion:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Named;

<em><span class="hl-annotation" style="color: gray">@Named</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <em><span class="hl-annotation" style="color: gray">@Inject</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>
}</pre>
<p>When using <code class="literal">@Named</code> or <code class="literal">@ManagedBean</code>, it is possible to use component scanning in the
exact same way as when using Spring annotations:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@ComponentScan(basePackages = "org.example")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig  {
    ...
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>In contrast to <code class="literal">@Component</code>, the JSR-330 <code class="literal">@Named</code> and the JSR-250 <code class="literal">ManagedBean</code>
annotations are not composable. Please use Spring’s stereotype model for building custom
component annotations.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-standard-annotations-limitations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-standard-annotations-limitations"></a>7.11.3&nbsp;Limitations of JSR-330 standard annotations</h3></div></div></div>

<p>When working with standard annotations, it is important to know that some significant
features are not available as shown in the table below:</p>
<div class="table"><a name="annotations-comparison" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#annotations-comparison"></a><p class="title"><b>Table&nbsp;7.6.&nbsp;Spring component model elements vs. JSR-330 variants</b></p><div class="table-contents">

<table summary="Spring component model elements vs. JSR-330 variants" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Spring</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">javax.inject.*</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">javax.inject restrictions / comments</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Autowired</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Inject</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">@Inject</code> has no 'required' attribute; can be used with Java 8’s <code class="literal">Optional</code> instead.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Component</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Named / @ManagedBean</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>JSR-330 does not provide a composable model, just a way to identify named components.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Scope("singleton")</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Singleton</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The JSR-330 default scope is like Spring’s <code class="literal">prototype</code>. However, in order to keep it
  consistent with Spring’s general defaults, a JSR-330 bean declared in the Spring
  container is a <code class="literal">singleton</code> by default. In order to use a scope other than <code class="literal">singleton</code>,
  you should use Spring’s <code class="literal">@Scope</code> annotation. <code class="literal">javax.inject</code> also provides a
  <a class="ulink" href="http://download.oracle.com/javaee/6/api/javax/inject/Scope.html" target="_top">@Scope</a> annotation.
  Nevertheless, this one is only intended to be used for creating your own annotations.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Qualifier</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Qualifier / @Named</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">javax.inject.Qualifier</code> is just a meta-annotation for building custom qualifiers.
  Concrete String qualifiers (like Spring’s <code class="literal">@Qualifier</code> with a value) can be associated
  through <code class="literal">javax.inject.Named</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Value</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>-</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>no equivalent</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Required</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>-</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>no equivalent</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Lazy</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>-</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>no equivalent</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>ObjectFactory</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Provider</p></td><td style="" align="left" valign="top"><p><code class="literal">javax.inject.Provider</code> is a direct alternative to Spring’s <code class="literal">ObjectFactory</code>,
  just with a shorter <code class="literal">get()</code> method name. It can also be used in combination with
  Spring’s <code class="literal">@Autowired</code> or with non-annotated constructors and setter methods.</p></td></tr></tbody></table>
</div></div><br class="table-break">
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-java" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java"></a>7.12&nbsp;Java-based container configuration</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-basic-concepts" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-basic-concepts"></a>7.12.1&nbsp;Basic concepts: @Bean and @Configuration</h3></div></div></div>

<p>The central artifacts in Spring’s new Java-configuration support are
<code class="literal">@Configuration</code>-annotated classes and <code class="literal">@Bean</code>-annotated methods.</p>
<p>The <code class="literal">@Bean</code> annotation is used to indicate that a method instantiates, configures and
initializes a new object to be managed by the Spring IoC container. For those familiar
with Spring’s <code class="literal">&lt;beans/&gt;</code> XML configuration the <code class="literal">@Bean</code> annotation plays the same role as
the <code class="literal">&lt;bean/&gt;</code> element. You can use <code class="literal">@Bean</code> annotated methods with any Spring
<code class="literal">@Component</code>, however, they are most often used with <code class="literal">@Configuration</code> beans.</p>
<p>Annotating a class with <code class="literal">@Configuration</code> indicates that its primary purpose is as a
source of bean definitions. Furthermore, <code class="literal">@Configuration</code> classes allow inter-bean
dependencies to be defined by simply calling other <code class="literal">@Bean</code> methods in the same class.
The simplest possible <code class="literal">@Configuration</code> class would read as follows:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> MyService myService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> MyServiceImpl();
    }

}</pre>
<p>The <code class="literal">AppConfig</code> class above would be equivalent to the following Spring <code class="literal">&lt;beans/&gt;</code> XML:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.acme.services.MyServiceImpl"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Full @Configuration vs 'lite' @Beans mode?</b></p></div></div></div>

<p>When <code class="literal">@Bean</code> methods are declared within classes that are <span class="emphasis"><em>not</em></span> annotated with
<code class="literal">@Configuration</code> they are referred to as being processed in a 'lite' mode. For example,
bean methods declared in a <code class="literal">@Component</code> or even in a <span class="emphasis"><em>plain old class</em></span> will be
considered 'lite'.</p>
<p>Unlike full <code class="literal">@Configuration</code>, lite <code class="literal">@Bean</code> methods cannot easily declare inter-bean
dependencies. Usually one <code class="literal">@Bean</code> method should not invoke another <code class="literal">@Bean</code> method when
operating in 'lite' mode.</p>
<p>Only using <code class="literal">@Bean</code> methods within <code class="literal">@Configuration</code> classes is a recommended approach of
ensuring that 'full' mode is always used. This will prevent the same <code class="literal">@Bean</code> method from
accidentally being invoked multiple times and helps to reduce subtle bugs that can be
hard to track down when operating in 'lite' mode.</p>
</div>
<p>The <code class="literal">@Bean</code> and <code class="literal">@Configuration</code> annotations will be discussed in depth in the sections
below. First, however, we’ll cover the various ways of creating a spring container using
Java-based configuration.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-instantiating-container" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container"></a>7.12.2&nbsp;Instantiating the Spring container using AnnotationConfigApplicationContext</h3></div></div></div>

<p>The sections below document Spring’s <code class="literal">AnnotationConfigApplicationContext</code>, new in Spring
3.0. This versatile <code class="literal">ApplicationContext</code> implementation is capable of accepting not only
<code class="literal">@Configuration</code> classes as input, but also plain <code class="literal">@Component</code> classes and classes
annotated with JSR-330 metadata.</p>
<p>When <code class="literal">@Configuration</code> classes are provided as input, the <code class="literal">@Configuration</code> class itself
is registered as a bean definition, and all declared <code class="literal">@Bean</code> methods within the class
are also registered as bean definitions.</p>
<p>When <code class="literal">@Component</code> and JSR-330 classes are provided, they are registered as bean
definitions, and it is assumed that DI metadata such as <code class="literal">@Autowired</code> or <code class="literal">@Inject</code> are
used within those classes where necessary.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-instantiating-container-contstructor" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container-contstructor"></a>Simple construction</h4></div></div></div>

<p>In much the same way that Spring XML files are used as input when instantiating a
<code class="literal">ClassPathXmlApplicationContext</code>, <code class="literal">@Configuration</code> classes may be used as input when
instantiating an <code class="literal">AnnotationConfigApplicationContext</code>. This allows for completely
XML-free usage of the Spring container:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(AppConfig.<span class="hl-keyword">class</span>);
    MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
    myService.doStuff();
}</pre>
<p>As mentioned above, <code class="literal">AnnotationConfigApplicationContext</code> is not limited to working only
with <code class="literal">@Configuration</code> classes. Any <code class="literal">@Component</code> or JSR-330 annotated class may be supplied
as input to the constructor. For example:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(MyServiceImpl.<span class="hl-keyword">class</span>, Dependency1.<span class="hl-keyword">class</span>, Dependency2.<span class="hl-keyword">class</span>);
    MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
    myService.doStuff();
}</pre>
<p>The above assumes that <code class="literal">MyServiceImpl</code>, <code class="literal">Dependency1</code> and <code class="literal">Dependency2</code> use Spring
dependency injection annotations such as <code class="literal">@Autowired</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-instantiating-container-register" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container-register"></a>Building the container programmatically using register(Class&lt;?&gt;…&#8203;)</h4></div></div></div>

<p>An <code class="literal">AnnotationConfigApplicationContext</code> may be instantiated using a no-arg constructor
and then configured using the <code class="literal">register()</code> method. This approach is particularly useful
when programmatically building an <code class="literal">AnnotationConfigApplicationContext</code>.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    AnnotationConfigApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext();
    ctx.register(AppConfig.<span class="hl-keyword">class</span>, OtherConfig.<span class="hl-keyword">class</span>);
    ctx.register(AdditionalConfig.<span class="hl-keyword">class</span>);
    ctx.refresh();
    MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
    myService.doStuff();
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-instantiating-container-scan" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container-scan"></a>Enabling component scanning with scan(String…&#8203;)</h4></div></div></div>

<p>To enable component scanning, just annotate your <code class="literal">@Configuration</code> class as follows:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@ComponentScan(basePackages = "com.acme")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig  {
    ...
}</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Experienced Spring users will be familiar with the XML declaration equivalent from
Spring’s <code class="literal">context:</code> namespace</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"com.acme"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
</td></tr></tbody></table></div>
<p>In the example above, the <code class="literal">com.acme</code> package will be scanned, looking for any
<code class="literal">@Component</code>-annotated classes, and those classes will be registered as Spring bean
definitions within the container. <code class="literal">AnnotationConfigApplicationContext</code> exposes the
<code class="literal">scan(String…&#8203;)</code> method to allow for the same component-scanning functionality:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    AnnotationConfigApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext();
    ctx.scan(<span class="hl-string">"com.acme"</span>);
    ctx.refresh();
    MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Remember that <code class="literal">@Configuration</code> classes are <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-meta-annotations" title="7.10.2 Meta-annotations">meta-annotated</a>
with <code class="literal">@Component</code>, so they are candidates for component-scanning! In the example above,
assuming that <code class="literal">AppConfig</code> is declared within the <code class="literal">com.acme</code> package (or any package
underneath), it will be picked up during the call to <code class="literal">scan()</code>, and upon <code class="literal">refresh()</code> all
its <code class="literal">@Bean</code> methods will be processed and registered as bean definitions within the
container.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-instantiating-container-web" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-instantiating-container-web"></a>Support for web applications with AnnotationConfigWebApplicationContext</h4></div></div></div>

<p>A <code class="literal">WebApplicationContext</code> variant of <code class="literal">AnnotationConfigApplicationContext</code> is available
with <code class="literal">AnnotationConfigWebApplicationContext</code>. This implementation may be used when
configuring the Spring <code class="literal">ContextLoaderListener</code> servlet listener, Spring MVC
<code class="literal">DispatcherServlet</code>, etc. What follows is a <code class="literal">web.xml</code> snippet that configures a typical
Spring MVC web application. Note the use of the <code class="literal">contextClass</code> context-param and
init-param:</p>
<pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    <span class="hl-comment">&lt;!-- Configure ContextLoaderListener to use AnnotationConfigWebApplicationContext
        instead of the default XmlWebApplicationContext --&gt;</span>
    <span class="hl-tag">&lt;context-param&gt;</span>
        <span class="hl-tag">&lt;param-name&gt;</span>contextClass<span class="hl-tag">&lt;/param-name&gt;</span>
        <span class="hl-tag">&lt;param-value&gt;</span>
            org.springframework.web.context.support.AnnotationConfigWebApplicationContext
        <span class="hl-tag">&lt;/param-value&gt;</span>
    <span class="hl-tag">&lt;/context-param&gt;</span>

    <span class="hl-comment">&lt;!-- Configuration locations must consist of one or more comma- or space-delimited
        fully-qualified @Configuration classes. Fully-qualified packages may also be
        specified for component-scanning --&gt;</span>
    <span class="hl-tag">&lt;context-param&gt;</span>
        <span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
        <span class="hl-tag">&lt;param-value&gt;</span>com.acme.AppConfig<span class="hl-tag">&lt;/param-value&gt;</span>
    <span class="hl-tag">&lt;/context-param&gt;</span>

    <span class="hl-comment">&lt;!-- Bootstrap the root application context as usual using ContextLoaderListener --&gt;</span>
    <span class="hl-tag">&lt;listener&gt;</span>
        <span class="hl-tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hl-tag">&lt;/listener-class&gt;</span>
    <span class="hl-tag">&lt;/listener&gt;</span>

    <span class="hl-comment">&lt;!-- Declare a Spring MVC DispatcherServlet as usual --&gt;</span>
    <span class="hl-tag">&lt;servlet&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcher<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
        <span class="hl-comment">&lt;!-- Configure DispatcherServlet to use AnnotationConfigWebApplicationContext
            instead of the default XmlWebApplicationContext --&gt;</span>
        <span class="hl-tag">&lt;init-param&gt;</span>
            <span class="hl-tag">&lt;param-name&gt;</span>contextClass<span class="hl-tag">&lt;/param-name&gt;</span>
            <span class="hl-tag">&lt;param-value&gt;</span>
                org.springframework.web.context.support.AnnotationConfigWebApplicationContext
            <span class="hl-tag">&lt;/param-value&gt;</span>
        <span class="hl-tag">&lt;/init-param&gt;</span>
        <span class="hl-comment">&lt;!-- Again, config locations must consist of one or more comma- or space-delimited
            and fully-qualified @Configuration classes --&gt;</span>
        <span class="hl-tag">&lt;init-param&gt;</span>
            <span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
            <span class="hl-tag">&lt;param-value&gt;</span>com.acme.web.MvcConfig<span class="hl-tag">&lt;/param-value&gt;</span>
        <span class="hl-tag">&lt;/init-param&gt;</span>
    <span class="hl-tag">&lt;/servlet&gt;</span>

    <span class="hl-comment">&lt;!-- map all requests for /app/* to the dispatcher servlet --&gt;</span>
    <span class="hl-tag">&lt;servlet-mapping&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcher<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/app/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
    <span class="hl-tag">&lt;/servlet-mapping&gt;</span>
<span class="hl-tag">&lt;/web-app&gt;</span></pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-bean-annotation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-bean-annotation"></a>7.12.3&nbsp;Using the @Bean annotation</h3></div></div></div>

<p><code class="literal">@Bean</code> is a method-level annotation and a direct analog of the XML <code class="literal">&lt;bean/&gt;</code> element.
The annotation supports some of the attributes offered by <code class="literal">&lt;bean/&gt;</code>, such as:
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">init-method</a>,
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean" title="Destruction callbacks">destroy-method</a>,
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="7.4.5 Autowiring collaborators">autowiring</a> and <code class="literal">name</code>.</p>
<p>You can use the <code class="literal">@Bean</code> annotation in a <code class="literal">@Configuration</code>-annotated or in a
<code class="literal">@Component</code>-annotated class.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-declaring-a-bean" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-declaring-a-bean"></a>Declaring a bean</h4></div></div></div>

<p>To declare a bean, simply annotate a method with the <code class="literal">@Bean</code> annotation. You use this
method to register a bean definition within an <code class="literal">ApplicationContext</code> of the type
specified as the method’s return value. By default, the bean name will be the same as
the method name. The following is a simple example of a <code class="literal">@Bean</code> method declaration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl();
    }

}</pre>
<p>The preceding configuration is exactly equivalent to the following Spring XML:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transferService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.acme.TransferServiceImpl"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>Both declarations make a bean named <code class="literal">transferService</code> available in the
<code class="literal">ApplicationContext</code>, bound to an object instance of type <code class="literal">TransferServiceImpl</code>:</p>
<pre class="literallayout">transferService -&gt; com.acme.TransferServiceImpl</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-dependencies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-dependencies"></a>Bean dependencies</h4></div></div></div>

<p>A <code class="literal">@Bean</code> annotated method can have an arbitrary number of parameters describing the
dependencies required to build that bean. For instance if our <code class="literal">TransferService</code>
requires an <code class="literal">AccountRepository</code> we can materialize that dependency via a method
parameter:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TransferService transferService(AccountRepository accountRepository) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(accountRepository);
    }

}</pre>
<p>The resolution mechanism is pretty much identical to constructor-based dependency
injection, see <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-constructor-injection" title="Constructor-based dependency injection">the relevant section</a> for more details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-lifecycle-callbacks" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-lifecycle-callbacks"></a>Receiving lifecycle callbacks</h4></div></div></div>

<p>Any classes defined with the <code class="literal">@Bean</code> annotation support the regular lifecycle callbacks
and can use the <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> annotations from JSR-250, see
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="7.9.8 @PostConstruct and @PreDestroy">JSR-250 annotations</a> for further
details.</p>
<p>The regular Spring <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-nature" title="7.6 Customizing the nature of a bean">lifecycle</a> callbacks are fully supported as
well. If a bean implements <code class="literal">InitializingBean</code>, <code class="literal">DisposableBean</code>, or <code class="literal">Lifecycle</code>, their
respective methods are called by the container.</p>
<p>The standard set of <code class="literal">*Aware</code> interfaces such as <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanfactory" title="7.16 The BeanFactory">BeanFactoryAware</a>,
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-aware" title="7.6.2 ApplicationContextAware and BeanNameAware">BeanNameAware</a>,
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-messagesource" title="7.15.1 Internationalization using MessageSource">MessageSourceAware</a>,
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-aware" title="7.6.2 ApplicationContextAware and BeanNameAware">ApplicationContextAware</a>, and so on are also fully supported.</p>
<p>The <code class="literal">@Bean</code> annotation supports specifying arbitrary initialization and destruction
callback methods, much like Spring XML’s <code class="literal">init-method</code> and <code class="literal">destroy-method</code> attributes
on the <code class="literal">bean</code> element:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Foo {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
        <span class="hl-comment">// initialization logic</span>
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Bar {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cleanup() {
        <span class="hl-comment">// destruction logic</span>
    }
}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean(initMethod = "init")</span></em>
    <span class="hl-keyword">public</span> Foo foo() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo();
    }

    <em><span class="hl-annotation" style="color: gray">@Bean(destroyMethod = "cleanup")</span></em>
    <span class="hl-keyword">public</span> Bar bar() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Bar();
    }

}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>By default, beans defined using Java config that have a public <code class="literal">close</code> or <code class="literal">shutdown</code>
method are automatically enlisted with a destruction callback. If you have a public
<code class="literal">close</code> or <code class="literal">shutdown</code> method and you do not wish for it to be called when the container
shuts down, simply add <code class="literal">@Bean(destroyMethod="")</code> to your bean definition to disable the
default <code class="literal">(inferred)</code> mode.</p>
<p>You may want to do that by default for a resource that you acquire via JNDI as its
lifecycle is managed outside the application. In particular, make sure to always do it
for a <code class="literal">DataSource</code> as it is known to be problematic on Java EE application servers.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Bean(destroyMethod="")</span></em>
<span class="hl-keyword">public</span> DataSource dataSource() <span class="hl-keyword">throws</span> NamingException {
    <span class="hl-keyword">return</span> (DataSource) jndiTemplate.lookup(<span class="hl-string">"MyDS"</span>);
}</pre>
<p>Also, with <code class="literal">@Bean</code> methods, you will typically choose to use programmatic JNDI lookups:
either using Spring’s <code class="literal">JndiTemplate</code>/<code class="literal">JndiLocatorDelegate</code> helpers or straight JNDI
<code class="literal">InitialContext</code> usage, but not the <code class="literal">JndiObjectFactoryBean</code> variant which would force
you to declare the return type as the <code class="literal">FactoryBean</code> type instead of the actual target
type, making it harder to use for cross-reference calls in other <code class="literal">@Bean</code> methods that
intend to refer to the provided resource here.</p>
</td></tr></tbody></table></div>
<p>Of course, in the case of <code class="literal">Foo</code> above, it would be equally as valid to call the <code class="literal">init()</code>
method directly during construction:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> Foo foo() {
        Foo foo = <span class="hl-keyword">new</span> Foo();
        foo.init();
        <span class="hl-keyword">return</span> foo;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>When you work directly in Java, you can do anything you like with your objects and do
not always need to rely on the container lifecycle!</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-specifying-bean-scope" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-specifying-bean-scope"></a>Specifying bean scope</h4></div></div></div>

<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-available-scopes" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-available-scopes"></a>Using the @Scope annotation</h5></div></div></div>

<p>You can specify that your beans defined with the <code class="literal">@Bean</code> annotation should have a
specific scope. You can use any of the standard scopes specified in the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes" title="7.5 Bean scopes">Bean Scopes</a> section.</p>
<p>The default scope is <code class="literal">singleton</code>, but you can override this with the <code class="literal">@Scope</code> annotation:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyConfiguration {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="strong"><strong>@Scope("prototype")</strong></span>
    <span class="hl-keyword">public</span> Encryptor encryptor() {
        <span class="hl-comment">// ...</span>
    }

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-scoped-proxy" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-scoped-proxy"></a>@Scope and scoped-proxy</h5></div></div></div>

<p>Spring offers a convenient way of working with scoped dependencies through
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection" title="Scoped beans as dependencies">scoped proxies</a>. The easiest way to create such
a proxy when using the XML configuration is the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element.
Configuring your beans in Java with a @Scope annotation offers equivalent support with
the proxyMode attribute. The default is no proxy ( <code class="literal">ScopedProxyMode.NO</code>), but you can
specify <code class="literal">ScopedProxyMode.TARGET_CLASS</code> or <code class="literal">ScopedProxyMode.INTERFACES</code>.</p>
<p>If you port the scoped proxy example from the XML reference documentation (see preceding
link) to our <code class="literal">@Bean</code> using Java, it would look like the following:</p>
<pre class="programlisting"><span class="hl-comment">// an HTTP Session-scoped bean exposed as a proxy</span>
<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="strong"><strong>@SessionScope</strong></span>
<span class="hl-keyword">public</span> UserPreferences userPreferences() {
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> UserPreferences();
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> Service userService() {
    UserService service = <span class="hl-keyword">new</span> SimpleUserService();
    <span class="hl-comment">// a reference to the proxied userPreferences bean</span>
    service.setUserPreferences(userPreferences());
    <span class="hl-keyword">return</span> service;
}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-customizing-bean-naming" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-customizing-bean-naming"></a>Customizing bean naming</h4></div></div></div>

<p>By default, configuration classes use a <code class="literal">@Bean</code> method’s name as the name of the
resulting bean. This functionality can be overridden, however, with the <code class="literal">name</code> attribute.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean(name = "myFoo")</span></em>
    <span class="hl-keyword">public</span> Foo foo() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo();
    }

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-bean-aliasing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-bean-aliasing"></a>Bean aliasing</h4></div></div></div>

<p>As discussed in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanname" title="7.3.1 Naming beans">Section&nbsp;7.3.1, “Naming beans”</a>, it is sometimes desirable to give a single bean
multiple names, otherwise known as <span class="emphasis"><em>bean aliasing</em></span>. The <code class="literal">name</code> attribute of the <code class="literal">@Bean</code>
annotation accepts a String array for this purpose.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean(name = { "dataSource", "subsystemA-dataSource", "subsystemB-dataSource" })</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-comment">// instantiate, configure and return DataSource bean...</span>
    }

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-bean-description" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-bean-description"></a>Bean description</h4></div></div></div>

<p>Sometimes it is helpful to provide a more detailed textual description of a bean. This can
be particularly useful when beans are exposed (perhaps via JMX) for monitoring purposes.</p>
<p>To add a description to a <code class="literal">@Bean</code> the
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/annotation/Description.html" target="_top"><code class="literal">@Description</code></a>
annotation can be used:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="strong"><strong>@Description("Provides a basic example of a bean")</strong></span>
    <span class="hl-keyword">public</span> Foo foo() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo();
    }

}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-configuration-annotation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-configuration-annotation"></a>7.12.4&nbsp;Using the @Configuration annotation</h3></div></div></div>

<p><code class="literal">@Configuration</code> is a class-level annotation indicating that an object is a source of
bean definitions. <code class="literal">@Configuration</code> classes declare beans via public <code class="literal">@Bean</code> annotated
methods. Calls to <code class="literal">@Bean</code> methods on <code class="literal">@Configuration</code> classes can also be used to define
inter-bean dependencies. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-basic-concepts" title="7.12.1 Basic concepts: @Bean and @Configuration">Section&nbsp;7.12.1, “Basic concepts: @Bean and @Configuration”</a> for a general introduction.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-injecting-dependencies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-injecting-dependencies"></a>Injecting inter-bean dependencies</h4></div></div></div>

<p>When <code class="literal">@Bean</code>s have dependencies on one another, expressing that dependency is as simple
as having one bean method call another:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> Foo foo() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo(bar());
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> Bar bar() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Bar();
    }

}</pre>
<p>In the example above, the <code class="literal">foo</code> bean receives a reference to <code class="literal">bar</code> via constructor
injection.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>This method of declaring inter-bean dependencies only works when the <code class="literal">@Bean</code> method is
declared within a <code class="literal">@Configuration</code> class. You cannot declare inter-bean dependencies
using plain <code class="literal">@Component</code> classes.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-method-injection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-method-injection"></a>Lookup method injection</h4></div></div></div>

<p>As noted earlier, <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-method-injection" title="7.4.6 Method injection">lookup method injection</a> is an
advanced feature that you should use rarely. It is useful in cases where a
singleton-scoped bean has a dependency on a prototype-scoped bean. Using Java for this
type of configuration provides a natural means for implementing this pattern.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CommandManager {
    <span class="hl-keyword">public</span> Object process(Object commandState) {
        <span class="hl-comment">// grab a new instance of the appropriate Command interface</span>
        Command command = createCommand();
        <span class="hl-comment">// set the state on the (hopefully brand new) Command instance</span>
        command.setState(commandState);
        <span class="hl-keyword">return</span> command.execute();
    }

    <span class="hl-comment">// okay... but where is the implementation of this method?</span>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Command createCommand();
}</pre>
<p>Using Java-configuration support , you can create a subclass of <code class="literal">CommandManager</code> where
the abstract <code class="literal">createCommand()</code> method is overridden in such a way that it looks up a new
(prototype) command object:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<em><span class="hl-annotation" style="color: gray">@Scope("prototype")</span></em>
<span class="hl-keyword">public</span> AsyncCommand asyncCommand() {
    AsyncCommand command = <span class="hl-keyword">new</span> AsyncCommand();
    <span class="hl-comment">// inject dependencies here as required</span>
    <span class="hl-keyword">return</span> command;
}

<em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> CommandManager commandManager() {
    <span class="hl-comment">// return new anonymous implementation of CommandManager with command() overridden</span>
    <span class="hl-comment">// to return a new prototype Command object</span>
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CommandManager() {
        <span class="hl-keyword">protected</span> Command createCommand() {
            <span class="hl-keyword">return</span> asyncCommand();
        }
    }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-further-information-java-config" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-further-information-java-config"></a>Further information about how Java-based configuration works internally</h4></div></div></div>

<p>The following example shows a <code class="literal">@Bean</code> annotated method being called twice:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> ClientService clientService1() {
        ClientServiceImpl clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
        clientService.setClientDao(clientDao());
        <span class="hl-keyword">return</span> clientService;
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> ClientService clientService2() {
        ClientServiceImpl clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
        clientService.setClientDao(clientDao());
        <span class="hl-keyword">return</span> clientService;
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> ClientDao clientDao() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ClientDaoImpl();
    }

}</pre>
<p><code class="literal">clientDao()</code> has been called once in <code class="literal">clientService1()</code> and once in <code class="literal">clientService2()</code>.
Since this method creates a new instance of <code class="literal">ClientDaoImpl</code> and returns it, you would
normally expect having 2 instances (one for each service). That definitely would be
problematic: in Spring, instantiated beans have a <code class="literal">singleton</code> scope by default. This is
where the magic comes in: All <code class="literal">@Configuration</code> classes are subclassed at startup-time
with <code class="literal">CGLIB</code>. In the subclass, the child method checks the container first for any
cached (scoped) beans before it calls the parent method and creates a new instance. Note
that as of Spring 3.2, it is no longer necessary to add CGLIB to your classpath because
CGLIB classes have been repackaged under <code class="literal">org.springframework.cglib</code> and included directly
within the spring-core JAR.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The behavior could be different according to the scope of your bean. We are talking
about singletons here.</p>
</td></tr></tbody></table></div>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>There are a few restrictions due to the fact that CGLIB dynamically adds features at
startup-time, in particular that configuration classes must not be final. However, as
of 4.3, any constructors are allowed on configuration classes, including the use of
<code class="literal">@Autowired</code> or a single non-default constructor declaration for default injection.</p>
<p>If you prefer to avoid any CGLIB-imposed limitations, consider declaring your <code class="literal">@Bean</code>
methods on non-<code class="literal">@Configuration</code> classes, e.g. on plain <code class="literal">@Component</code> classes instead.
Cross-method calls between <code class="literal">@Bean</code> methods won’t get intercepted then, so you’ll have
to exclusively rely on dependency injection at the constructor or method level there.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-java-composing-configuration-classes" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-composing-configuration-classes"></a>7.12.5&nbsp;Composing Java-based configurations</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-using-import" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-using-import"></a>Using the @Import annotation</h4></div></div></div>

<p>Much as the <code class="literal">&lt;import/&gt;</code> element is used within Spring XML files to aid in modularizing
configurations, the <code class="literal">@Import</code> annotation allows for loading <code class="literal">@Bean</code> definitions from
another configuration class:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConfigA {

     <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> A a() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> A();
    }

}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@Import(ConfigA.class)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConfigB {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> B b() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> B();
    }

}</pre>
<p>Now, rather than needing to specify both <code class="literal">ConfigA.class</code> and <code class="literal">ConfigB.class</code> when
instantiating the context, only <code class="literal">ConfigB</code> needs to be supplied explicitly:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(ConfigB.<span class="hl-keyword">class</span>);

    <span class="hl-comment">// now both beans A and B will be available...</span>
    A a = ctx.getBean(A.<span class="hl-keyword">class</span>);
    B b = ctx.getBean(B.<span class="hl-keyword">class</span>);
}</pre>
<p>This approach simplifies container instantiation, as only one class needs to be dealt
with, rather than requiring the developer to remember a potentially large number of
<code class="literal">@Configuration</code> classes during construction.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>As of Spring Framework 4.2, <code class="literal">@Import</code> also supports references to regular component
classes, analogous to the <code class="literal">AnnotationConfigApplicationContext.register</code> method.
This is particularly useful if you’d like to avoid component scanning, using a few
configuration classes as entry points for explicitly defining all your components.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-injecting-imported-beans" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-injecting-imported-beans"></a>Injecting dependencies on imported @Bean definitions</h5></div></div></div>

<p>The example above works, but is simplistic. In most practical scenarios, beans will have
dependencies on one another across configuration classes. When using XML, this is not an
issue, per se, because there is no compiler involved, and one can simply declare
<code class="literal">ref="someBean"</code> and trust that Spring will work it out during container initialization.
Of course, when using <code class="literal">@Configuration</code> classes, the Java compiler places constraints on
the configuration model, in that references to other beans must be valid Java syntax.</p>
<p>Fortunately, solving this problem is simple. As <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-dependencies" title="Bean dependencies">we already discussed</a>,
<code class="literal">@Bean</code> method can have an arbitrary number of parameters describing the bean
dependencies. Let’s consider a more real-world scenario with several <code class="literal">@Configuration</code>
classes, each depending on beans declared in the others:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TransferService transferService(AccountRepository accountRepository) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(accountRepository);
    }

}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RepositoryConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> AccountRepository accountRepository(DataSource dataSource) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
    }

}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@Import({ServiceConfig.class, RepositoryConfig.class})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemTestConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-comment">// return new DataSource</span>
    }

}

<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.<span class="hl-keyword">class</span>);
    <span class="hl-comment">// everything wires up across configuration classes...</span>
    TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
    transferService.transfer(<span class="hl-number">100.00</span>, <span class="hl-string">"A123"</span>, <span class="hl-string">"C456"</span>);
}</pre>
<p>There is another way to achieve the same result. Remember that <code class="literal">@Configuration</code> classes are
ultimately just another bean in the container: This means that they can take advantage of
<code class="literal">@Autowired</code> and <code class="literal">@Value</code> injection etc just like any other bean!</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="./Spring Framework Reference Documentation_files/warning.png.pagespeed.ce.aG27Rp2bJY.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top">
<p>Make sure that the dependencies you inject that way are of the simplest kind only. <code class="literal">@Configuration</code>
classes are processed quite early during the initialization of the context and forcing a dependency
to be injected this way may lead to unexpected early initialization. Whenever possible, resort to
parameter-based injection as in the example above.</p>
<p>Also, be particularly careful with <code class="literal">BeanPostProcessor</code> and <code class="literal">BeanFactoryPostProcessor</code> definitions
via <code class="literal">@Bean</code>. Those should usually be declared as <code class="literal">static @Bean</code> methods, not triggering the
instantiation of their containing configuration class. Otherwise, <code class="literal">@Autowired</code> and <code class="literal">@Value</code> won’t
work on the configuration class itself since it is being created as a bean instance too early.</p>
</td></tr></tbody></table></div>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> AccountRepository accountRepository;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(accountRepository);
    }

}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RepositoryConfig {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> DataSource dataSource;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> RepositoryConfig(DataSource dataSource) {
        <span class="hl-keyword">this</span>.dataSource = dataSource;
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> AccountRepository accountRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
    }

}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@Import({ServiceConfig.class, RepositoryConfig.class})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemTestConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-comment">// return new DataSource</span>
    }

}

<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.<span class="hl-keyword">class</span>);
    <span class="hl-comment">// everything wires up across configuration classes...</span>
    TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
    transferService.transfer(<span class="hl-number">100.00</span>, <span class="hl-string">"A123"</span>, <span class="hl-string">"C456"</span>);
}</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Constructor injection in <code class="literal">@Configuration</code> classes is only supported as of Spring
Framework 4.3. Note also that there is no need to specify <code class="literal">@Autowired</code> if the target
bean defines only one constructor; in the example above, <code class="literal">@Autowired</code> is not necessary
on the <code class="literal">RepositoryConfig</code> constructor.</p>
</td></tr></tbody></table></div>
<p>In the scenario above, using <code class="literal">@Autowired</code> works well and provides the desired
modularity, but determining exactly where the autowired bean definitions are declared is
still somewhat ambiguous. For example, as a developer looking at <code class="literal">ServiceConfig</code>, how do
you know exactly where the <code class="literal">@Autowired AccountRepository</code> bean is declared? It’s not
explicit in the code, and this may be just fine. Remember that the
<a class="ulink" href="https://spring.io/tools/sts" target="_top">Spring Tool Suite</a> provides tooling that
can render graphs showing how everything is wired up - that may be all you need. Also,
your Java IDE can easily find all declarations and uses of the <code class="literal">AccountRepository</code> type,
and will quickly show you the location of <code class="literal">@Bean</code> methods that return that type.</p>
<p>In cases where this ambiguity is not acceptable and you wish to have direct navigation
from within your IDE from one <code class="literal">@Configuration</code> class to another, consider autowiring the
configuration classes themselves:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> RepositoryConfig repositoryConfig;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-comment">// navigate 'through' the config class to the @Bean method!</span>
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(repositoryConfig.accountRepository());
    }

}</pre>
<p>In the situation above, it is completely explicit where <code class="literal">AccountRepository</code> is defined.
However, <code class="literal">ServiceConfig</code> is now tightly coupled to <code class="literal">RepositoryConfig</code>; that’s the
tradeoff. This tight coupling can be somewhat mitigated by using interface-based or
abstract class-based <code class="literal">@Configuration</code> classes. Consider the following:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> RepositoryConfig repositoryConfig;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(repositoryConfig.accountRepository());
    }
}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RepositoryConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    AccountRepository accountRepository();

}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultRepositoryConfig <span class="hl-keyword">implements</span> RepositoryConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> AccountRepository accountRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(...);
    }

}

<em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@Import({ServiceConfig.class, DefaultRepositoryConfig.class})</span></em> <span class="hl-comment">// import the concrete config!</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemTestConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-comment">// return DataSource</span>
    }

}

<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.<span class="hl-keyword">class</span>);
    TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
    transferService.transfer(<span class="hl-number">100.00</span>, <span class="hl-string">"A123"</span>, <span class="hl-string">"C456"</span>);
}</pre>
<p>Now <code class="literal">ServiceConfig</code> is loosely coupled with respect to the concrete
<code class="literal">DefaultRepositoryConfig</code>, and built-in IDE tooling is still useful: it will be easy for
the developer to get a type hierarchy of <code class="literal">RepositoryConfig</code> implementations. In this
way, navigating <code class="literal">@Configuration</code> classes and their dependencies becomes no different
than the usual process of navigating interface-based code.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-conditional" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-conditional"></a>Conditionally include @Configuration classes or @Bean methods</h4></div></div></div>

<p>It is often useful to conditionally enable or disable a complete <code class="literal">@Configuration</code> class,
or even individual <code class="literal">@Bean</code> methods, based on some arbitrary system state. One common
example of this is to use the <code class="literal">@Profile</code> annotation to activate beans only when a specific
profile has been enabled in the Spring <code class="literal">Environment</code> (see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles" title="7.13.1 Bean definition profiles">Section&nbsp;7.13.1, “Bean definition profiles”</a>
for details).</p>
<p>The <code class="literal">@Profile</code> annotation is actually implemented using a much more flexible annotation
called <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/annotation/Conditional.html" target="_top"><code class="literal">@Conditional</code></a>.
The <code class="literal">@Conditional</code> annotation indicates specific
<code class="literal">org.springframework.context.annotation.Condition</code> implementations that should be
consulted before a <code class="literal">@Bean</code> is registered.</p>
<p>Implementations of the <code class="literal">Condition</code> interface simply provide a <code class="literal">matches(…&#8203;)</code>
method that returns <code class="literal">true</code> or <code class="literal">false</code>. For example, here is the actual
<code class="literal">Condition</code> implementation used for <code class="literal">@Profile</code>:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Override</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
    <span class="hl-keyword">if</span> (context.getEnvironment() != null) {
        <span class="hl-comment">// Read the @Profile annotation attributes</span>
        MultiValueMap&lt;String, Object&gt; attrs = metadata.getAllAnnotationAttributes(Profile.<span class="hl-keyword">class</span>.getName());
        <span class="hl-keyword">if</span> (attrs != null) {
            <span class="hl-keyword">for</span> (Object value : attrs.get(<span class="hl-string">"value"</span>)) {
                <span class="hl-keyword">if</span> (context.getEnvironment().acceptsProfiles(((String[]) value))) {
                    <span class="hl-keyword">return</span> true;
                }
            }
            <span class="hl-keyword">return</span> false;
        }
    }
    <span class="hl-keyword">return</span> true;
}</pre>
<p>See the <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/annotation/Conditional.html" target="_top">
<code class="literal">@Conditional</code> javadocs</a> for more detail.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-java-combining" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-combining"></a>Combining Java and XML configuration</h4></div></div></div>

<p>Spring’s <code class="literal">@Configuration</code> class support does not aim to be a 100% complete replacement
for Spring XML. Some facilities such as Spring XML namespaces remain an ideal way to
configure the container. In cases where XML is convenient or necessary, you have a
choice: either instantiate the container in an "XML-centric" way using, for example,
<code class="literal">ClassPathXmlApplicationContext</code>, or in a "Java-centric" fashion using
<code class="literal">AnnotationConfigApplicationContext</code> and the <code class="literal">@ImportResource</code> annotation to import XML
as needed.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-combining-xml-centric" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-combining-xml-centric"></a>XML-centric use of @Configuration classes</h5></div></div></div>

<p>It may be preferable to bootstrap the Spring container from XML and include
<code class="literal">@Configuration</code> classes in an ad-hoc fashion. For example, in a large existing codebase
that uses Spring XML, it will be easier to create <code class="literal">@Configuration</code> classes on an
as-needed basis and include them from the existing XML files. Below you’ll find the
options for using <code class="literal">@Configuration</code> classes in this kind of "XML-centric" situation.</p>
<p>Remember that <code class="literal">@Configuration</code> classes are ultimately just bean definitions in the
container. In this example, we create a <code class="literal">@Configuration</code> class named <code class="literal">AppConfig</code> and
include it within <code class="literal">system-test-config.xml</code> as a <code class="literal">&lt;bean/&gt;</code> definition. Because
<code class="literal">&lt;context:annotation-config/&gt;</code> is switched on, the container will recognize the
<code class="literal">@Configuration</code> annotation and process the <code class="literal">@Bean</code> methods declared in <code class="literal">AppConfig</code>
properly.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> DataSource dataSource;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> AccountRepository accountRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferService(accountRepository());
    }

}</pre>
<p><span class="strong"><strong>system-test-config.xml</strong></span>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-comment">&lt;!-- enable processing of annotations such as @Autowired and @Configuration --&gt;</span>
    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>
    <span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:/com/acme/jdbc.properties"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.acme.AppConfig"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p><span class="strong"><strong>jdbc.properties</strong></span>:</p>
<pre class="literallayout">jdbc.url=jdbc:hsqldb:hsql://localhost/xdb
jdbc.username=sa
jdbc.password=</pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"classpath:/com/acme/system-test-config.xml"</span>);
    TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
    <span class="hl-comment">// ...</span>
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>In <code class="literal">system-test-config.xml</code> above, the <code class="literal">AppConfig</code> <code class="literal">&lt;bean/&gt;</code> does not declare an <code class="literal">id</code>
element. While it would be acceptable to do so, it is unnecessary given that no other
bean will ever refer to it, and it is unlikely that it will be explicitly fetched from
the container by name. Likewise with the <code class="literal">DataSource</code> bean - it is only ever autowired
by type, so an explicit bean <code class="literal">id</code> is not strictly required.</p>
</td></tr></tbody></table></div>
<p>Because <code class="literal">@Configuration</code> is meta-annotated with <code class="literal">@Component</code>, <code class="literal">@Configuration</code>-annotated
classes are automatically candidates for component scanning. Using the same scenario as
above, we can redefine <code class="literal">system-test-config.xml</code> to take advantage of component-scanning.
Note that in this case, we don’t need to explicitly declare
<code class="literal">&lt;context:annotation-config/&gt;</code>, because <code class="literal">&lt;context:component-scan/&gt;</code> enables the same
functionality.</p>
<p><span class="strong"><strong>system-test-config.xml</strong></span>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-comment">&lt;!-- picks up and registers AppConfig as a bean definition --&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"com.acme"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:/com/acme/jdbc.properties"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-java-combining-java-centric" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java-combining-java-centric"></a>@Configuration class-centric use of XML with @ImportResource</h5></div></div></div>

<p>In applications where <code class="literal">@Configuration</code> classes are the primary mechanism for configuring
the container, it will still likely be necessary to use at least some XML. In these
scenarios, simply use <code class="literal">@ImportResource</code> and define only as much XML as is needed. Doing
so achieves a "Java-centric" approach to configuring the container and keeps XML to a
bare minimum.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@ImportResource("classpath:/com/acme/properties-config.xml")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Value("${jdbc.url}")</span></em>
    <span class="hl-keyword">private</span> String url;

    <em><span class="hl-annotation" style="color: gray">@Value("${jdbc.username}")</span></em>
    <span class="hl-keyword">private</span> String username;

    <em><span class="hl-annotation" style="color: gray">@Value("${jdbc.password}")</span></em>
    <span class="hl-keyword">private</span> String password;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DriverManagerDataSource(url, username, password);
    }

}</pre>
<pre class="programlisting">properties-config.xml
<span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:/com/acme/jdbc.properties"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<pre class="literallayout">jdbc.properties
jdbc.url=jdbc:hsqldb:hsql://localhost/xdb
jdbc.username=sa
jdbc.password=</pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(AppConfig.<span class="hl-keyword">class</span>);
    TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
    <span class="hl-comment">// ...</span>
}</pre>
</div>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-environment" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-environment"></a>7.13&nbsp;Environment abstraction</h2></div></div></div>

<p>The <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/core/env/Environment.html" target="_top"><code class="literal">Environment</code></a>
is an abstraction integrated in the container that models two key
aspects of the application environment: <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles" title="7.13.1 Bean definition profiles"><span class="emphasis"><em>profiles</em></span></a>
and <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-property-source-abstraction" title="7.13.2 PropertySource abstraction"><span class="emphasis"><em>properties</em></span></a>.</p>
<p>A <span class="emphasis"><em>profile</em></span> is a named, logical group of bean definitions to be registered with the
container only if the given profile is active. Beans may be assigned to a profile
whether defined in XML or via annotations. The role of the <code class="literal">Environment</code> object with
relation to profiles is in determining which profiles (if any) are currently active,
and which profiles (if any) should be active by default.</p>
<p>Properties play an important role in almost all applications, and may originate from
a variety of sources: properties files, JVM system properties, system environment
variables, JNDI, servlet context parameters, ad-hoc Properties objects, Maps, and so
on. The role of the <code class="literal">Environment</code> object with relation to properties is to provide the
user with a convenient service interface for configuring property sources and resolving
properties from them.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-definition-profiles" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles"></a>7.13.1&nbsp;Bean definition profiles</h3></div></div></div>

<p>Bean definition profiles is a mechanism in the core container that allows for
registration of different beans in different environments. The word <span class="emphasis"><em>environment</em></span>
can mean different things to different users and this feature can help with many
use cases, including:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
working against an in-memory datasource in development vs looking up that same
datasource from JNDI when in QA or production
</li><li class="listitem">
registering monitoring infrastructure only when deploying an application into a
performance environment
</li><li class="listitem">
registering customized implementations of beans for customer A vs. customer
B deployments
</li></ul></div>
<p>Let’s consider the first use case in a practical application that requires a
<code class="literal">DataSource</code>. In a test environment, the configuration may look like this:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Bean</span></em>
<span class="hl-keyword">public</span> DataSource dataSource() {
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder()
        .setType(EmbeddedDatabaseType.HSQL)
        .addScript(<span class="hl-string">"my-schema.sql"</span>)
        .addScript(<span class="hl-string">"my-test-data.sql"</span>)
        .build();
}</pre>
<p>Let’s now consider how this application will be deployed into a QA or production
environment, assuming that the datasource for the application will be registered
with the production application server’s JNDI directory. Our <code class="literal">dataSource</code> bean
now looks like this:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Bean(destroyMethod="")</span></em>
<span class="hl-keyword">public</span> DataSource dataSource() <span class="hl-keyword">throws</span> Exception {
    Context ctx = <span class="hl-keyword">new</span> InitialContext();
    <span class="hl-keyword">return</span> (DataSource) ctx.lookup(<span class="hl-string">"java:comp/env/jdbc/datasource"</span>);
}</pre>
<p>The problem is how to switch between using these two variations based on the
current environment. Over time, Spring users have devised a number of ways to
get this done, usually relying on a combination of system environment variables
and XML <code class="literal">&lt;import/&gt;</code> statements containing <code class="literal">${placeholder}</code> tokens that resolve
to the correct configuration file path depending on the value of an environment
variable. Bean definition profiles is a core container feature that provides a
solution to this problem.</p>
<p>If we generalize the example use case above of environment-specific bean
definitions, we end up with the need to register certain bean definitions in
certain contexts, while not in others. You could say that you want to register a
certain profile of bean definitions in situation A, and a different profile in
situation B. Let’s first see how we can update our configuration to reflect
this need.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-definition-profiles-java" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles-java"></a>@Profile</h4></div></div></div>

<p>The <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/annotation/Profile.html" target="_top"><code class="literal">@Profile</code></a>
annotation allows you to indicate that a component is eligible for registration
when one or more specified profiles are active. Using our example above, we
can rewrite the <code class="literal">dataSource</code> configuration as follows:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="strong"><strong>@Profile("development")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> StandaloneDataConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/schema.sql"</span>)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/test-data.sql"</span>)
            .build();
    }
}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="strong"><strong>@Profile("production")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JndiDataConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean(destroyMethod="")</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() <span class="hl-keyword">throws</span> Exception {
        Context ctx = <span class="hl-keyword">new</span> InitialContext();
        <span class="hl-keyword">return</span> (DataSource) ctx.lookup(<span class="hl-string">"java:comp/env/jdbc/datasource"</span>);
    }
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>As mentioned before, with <code class="literal">@Bean</code> methods, you will typically choose to use programmatic
JNDI lookups: either using Spring’s <code class="literal">JndiTemplate</code>/<code class="literal">JndiLocatorDelegate</code> helpers or the
straight JNDI <code class="literal">InitialContext</code> usage shown above, but not the <code class="literal">JndiObjectFactoryBean</code>
variant which would force you to declare the return type as the <code class="literal">FactoryBean</code> type.</p>
</td></tr></tbody></table></div>
<p><code class="literal">@Profile</code> can be used as a <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-meta-annotations" title="7.10.2 Meta-annotations">meta-annotation</a> for the purpose
of creating a custom <span class="emphasis"><em>composed annotation</em></span>. The following example defines a custom
<code class="literal">@Production</code> annotation that can be used as a drop-in replacement for
<code class="literal">@Profile("production")</code>:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target(ElementType.TYPE)</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<span class="strong"><strong>@Profile("production")</strong></span>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Production {
}</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>If a <code class="literal">@Configuration</code> class is marked with <code class="literal">@Profile</code>, all of the <code class="literal">@Bean</code> methods and
<code class="literal">@Import</code> annotations associated with that class will be bypassed unless one or more of
the specified profiles are active. If a <code class="literal">@Component</code> or <code class="literal">@Configuration</code> class is marked
with <code class="literal">@Profile({"p1", "p2"})</code>, that class will not be registered/processed unless
profiles 'p1' and/or 'p2' have been activated. If a given profile is prefixed with the
NOT operator (<code class="literal">!</code>), the annotated element will be registered if the profile is <span class="strong"><strong>not</strong></span>
active. For example, given <code class="literal">@Profile({"p1", "!p2"})</code>, registration will occur if profile
'p1' is active or if profile 'p2' is not active.</p>
</td></tr></tbody></table></div>
<p><code class="literal">@Profile</code> can also be declared at the method level to include only one particular bean
of a configuration class, e.g. for alternative variants of a particular bean:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean("dataSource")</span></em>
    <span class="strong"><strong>@Profile("development")</strong></span>
    <span class="hl-keyword">public</span> DataSource standaloneDataSource() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/schema.sql"</span>)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/test-data.sql"</span>)
            .build();
    }

    <em><span class="hl-annotation" style="color: gray">@Bean("dataSource")</span></em>
    <span class="strong"><strong>@Profile("production")</strong></span>
    <span class="hl-keyword">public</span> DataSource jndiDataSource() <span class="hl-keyword">throws</span> Exception {
        Context ctx = <span class="hl-keyword">new</span> InitialContext();
        <span class="hl-keyword">return</span> (DataSource) ctx.lookup(<span class="hl-string">"java:comp/env/jdbc/datasource"</span>);
    }
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>With <code class="literal">@Profile</code> on <code class="literal">@Bean</code> methods, a special scenario may apply: In the case of
overloaded <code class="literal">@Bean</code> methods of the same Java method name (analogous to constructor
overloading), an <code class="literal">@Profile</code> condition needs to be consistently declared on all
overloaded methods. If the conditions are inconsistent, only the condition on the
first declaration among the overloaded methods will matter. <code class="literal">@Profile</code> can therefore
not be used to select an overloaded method with a particular argument signature over
another; resolution between all factory methods for the same bean follows Spring’s
constructor resolution algorithm at creation time.</p>
<p>If you would like to define alternative beans with different profile conditions,
use distinct Java method names pointing to the same bean name via the <code class="literal">@Bean</code> name
attribute, as indicated in the example above. If the argument signatures are all
the same (e.g. all of the variants have no-arg factory methods), this is the only
way to represent such an arrangement in a valid Java class in the first place
(since there can only be one method of a particular name and argument signature).</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-definition-profiles-xml" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles-xml"></a>XML bean definition profiles</h4></div></div></div>

<p>The XML counterpart is the <code class="literal">profile</code> attribute of the <code class="literal">&lt;beans&gt;</code> element. Our sample
configuration above can be rewritten in two XML files as follows:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"development"</span>
    <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:jdbc</span>=<span class="hl-value">"http://www.springframework.org/schema/jdbc"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;jdbc:embedded-database</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;jdbc:script</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/bank/config/sql/schema.sql"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;jdbc:script</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/bank/config/sql/test-data.sql"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/jdbc:embedded-database&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"production"</span>
    <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://www.springframework.org/schema/jee"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"java:comp/env/jdbc/datasource"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>It is also possible to avoid that split and nest <code class="literal">&lt;beans/&gt;</code> elements within the same file:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:jdbc</span>=<span class="hl-value">"http://www.springframework.org/schema/jdbc"</span>
    <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://www.springframework.org/schema/jee"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- other bean definitions --&gt;</span>

    <span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"development"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;jdbc:embedded-database</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;jdbc:script</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/bank/config/sql/schema.sql"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;jdbc:script</span> <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/bank/config/sql/test-data.sql"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/jdbc:embedded-database&gt;</span>
    <span class="hl-tag">&lt;/beans&gt;</span>

    <span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"production"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"java:comp/env/jdbc/datasource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/beans&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The <code class="literal">spring-bean.xsd</code> has been constrained to allow such elements only as the
last ones in the file. This should help provide flexibility without incurring
clutter in the XML files.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-definition-profiles-enable" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles-enable"></a>Activating a profile</h4></div></div></div>

<p>Now that we have updated our configuration, we still need to instruct Spring which
profile is active. If we started our sample application right now, we would see
a <code class="literal">NoSuchBeanDefinitionException</code> thrown, because the container could not find
the Spring bean named <code class="literal">dataSource</code>.</p>
<p>Activating a profile can be done in several ways, but the most straightforward is to do
it programmatically against the <code class="literal">Environment</code> API which is available via an
<code class="literal">ApplicationContext</code>:</p>
<pre class="programlisting">AnnotationConfigApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext();
ctx.getEnvironment().setActiveProfiles(<span class="hl-string">"development"</span>);
ctx.register(SomeConfig.<span class="hl-keyword">class</span>, StandaloneDataConfig.<span class="hl-keyword">class</span>, JndiDataConfig.<span class="hl-keyword">class</span>);
ctx.refresh();</pre>
<p>In addition, profiles may also be activated declaratively through the
<code class="literal">spring.profiles.active</code> property which may be specified through system environment
variables, JVM system properties, servlet context parameters in <code class="literal">web.xml</code>, or even as an
entry in JNDI (see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-property-source-abstraction" title="7.13.2 PropertySource abstraction">Section&nbsp;7.13.2, “PropertySource abstraction”</a>). In integration tests, active
profiles can be declared via the <code class="literal">@ActiveProfiles</code> annotation in the <code class="literal">spring-test</code> module
(see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-env-profiles" title="Context configuration with environment profiles">the section called “Context configuration with environment profiles”</a>).</p>
<p>Note that profiles are not an "either-or" proposition; it is possible to activate multiple
profiles at once. Programmatically, simply provide multiple profile names to the
<code class="literal">setActiveProfiles()</code> method, which accepts <code class="literal">String…&#8203;</code> varargs:</p>
<pre class="programlisting">ctx.getEnvironment().setActiveProfiles(<span class="hl-string">"profile1"</span>, <span class="hl-string">"profile2"</span>);</pre>
<p>Declaratively, <code class="literal">spring.profiles.active</code> may accept a comma-separated list of profile names:</p>
<pre class="programlisting">-Dspring.profiles.active=<span class="hl-string">"profile1,profile2"</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-definition-profiles-default" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles-default"></a>Default profile</h4></div></div></div>

<p>The <span class="emphasis"><em>default</em></span> profile represents the profile that is enabled by default. Consider the
following:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="strong"><strong>@Profile("default")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultDataConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/schema.sql"</span>)
            .build();
    }
}</pre>
<p>If no profile is active, the <code class="literal">dataSource</code> above will be created; this can be
seen as a way to provide a <span class="emphasis"><em>default</em></span> definition for one or more beans. If any
profile is enabled, the <span class="emphasis"><em>default</em></span> profile will not apply.</p>
<p>The name of the default profile can be changed using <code class="literal">setDefaultProfiles()</code> on
the <code class="literal">Environment</code> or declaratively using the <code class="literal">spring.profiles.default</code> property.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-property-source-abstraction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-property-source-abstraction"></a>7.13.2&nbsp;PropertySource abstraction</h3></div></div></div>

<p>Spring’s <code class="literal">Environment</code> abstraction provides search operations over a configurable
hierarchy of property sources. To explain fully, consider the following:</p>
<pre class="programlisting">ApplicationContext ctx = <span class="hl-keyword">new</span> GenericApplicationContext();
Environment env = ctx.getEnvironment();
<span class="hl-keyword">boolean</span> containsFoo = env.containsProperty(<span class="hl-string">"foo"</span>);
System.out.println(<span class="hl-string">"Does my environment contain the 'foo' property? "</span> + containsFoo);</pre>
<p>In the snippet above, we see a high-level way of asking Spring whether the <code class="literal">foo</code> property is
defined for the current environment. To answer this question, the <code class="literal">Environment</code> object performs
a search over a set of <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/core/env/PropertySource.html" target="_top"><code class="literal">PropertySource</code></a>
objects. A <code class="literal">PropertySource</code> is a simple abstraction over any source of key-value pairs, and
Spring’s <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/core/env/StandardEnvironment.html" target="_top"><code class="literal">StandardEnvironment</code></a>
is configured with two PropertySource objects&#8201;—&#8201;one representing the set of JVM system properties
(<span class="emphasis"><em>a la</em></span> <code class="literal">System.getProperties()</code>) and one representing the set of system environment variables
(<span class="emphasis"><em>a la</em></span> <code class="literal">System.getenv()</code>).</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>These default property sources are present for <code class="literal">StandardEnvironment</code>, for use in standalone
applications. <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/web/context/support/StandardServletEnvironment.html" target="_top"><code class="literal">StandardServletEnvironment</code></a>
is populated with additional default property sources including servlet config and servlet
context parameters. <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/web/portlet/context/StandardPortletEnvironment.html" target="_top"><code class="literal">StandardPortletEnvironment</code></a>
similarly has access to portlet config and portlet context parameters as property sources.
Both can optionally enable a <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/jndi/JndiPropertySource.html" target="_top"><code class="literal">JndiPropertySource</code></a>.
See the javadocs for details.</p>
</td></tr></tbody></table></div>
<p>Concretely, when using the <code class="literal">StandardEnvironment</code>, the call to <code class="literal">env.containsProperty("foo")</code>
will return true if a <code class="literal">foo</code> system property or <code class="literal">foo</code> environment variable is present at
runtime.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>The search performed is hierarchical. By default, system properties have precedence over
environment variables, so if the <code class="literal">foo</code> property happens to be set in both places during
a call to <code class="literal">env.getProperty("foo")</code>, the system property value will 'win' and be returned
preferentially over the environment variable. Note that property values will not get merged
but rather completely overridden by a preceding entry.</p>
<p>For a common <code class="literal">StandardServletEnvironment</code>, the full hierarchy looks as follows, with the
highest-precedence entries at the top:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
ServletConfig parameters (if applicable, e.g. in case of a <code class="literal">DispatcherServlet</code> context)
</li><li class="listitem">
ServletContext parameters (web.xml context-param entries)
</li><li class="listitem">
JNDI environment variables ("java:comp/env/" entries)
</li><li class="listitem">
JVM system properties ("-D" command-line arguments)
</li><li class="listitem">
JVM system environment (operating system environment variables)
</li></ul></div>
</td></tr></tbody></table></div>
<p>Most importantly, the entire mechanism is configurable. Perhaps you have a custom source
of properties that you’d like to integrate into this search. No problem&#8201;—&#8201;simply implement
and instantiate your own <code class="literal">PropertySource</code> and add it to the set of <code class="literal">PropertySources</code> for the
current <code class="literal">Environment</code>:</p>
<pre class="programlisting">ConfigurableApplicationContext ctx = <span class="hl-keyword">new</span> GenericApplicationContext();
MutablePropertySources sources = ctx.getEnvironment().getPropertySources();
sources.addFirst(<span class="hl-keyword">new</span> MyPropertySource());</pre>
<p>In the code above, <code class="literal">MyPropertySource</code> has been added with highest precedence in the
search. If it contains a  <code class="literal">foo</code> property, it will be detected and returned ahead of
any <code class="literal">foo</code> property in any other <code class="literal">PropertySource</code>. The
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/core/env/MutablePropertySources.html" target="_top"><code class="literal">MutablePropertySources</code></a>
API exposes a number of methods that allow for precise manipulation of the set of
property sources.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="__propertysource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__propertysource"></a>7.13.3&nbsp;@PropertySource</h3></div></div></div>

<p>The <a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/annotation/PropertySource.html" target="_top"><code class="literal">@PropertySource</code></a>
annotation provides a convenient and declarative mechanism for adding a <code class="literal">PropertySource</code>
to Spring’s <code class="literal">Environment</code>.</p>
<p>Given a file "app.properties" containing the key/value pair <code class="literal">testbean.name=myTestBean</code>,
the following <code class="literal">@Configuration</code> class uses <code class="literal">@PropertySource</code> in such a way that
a call to <code class="literal">testBean.getName()</code> will return "myTestBean".</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="strong"><strong>@PropertySource("classpath:/com/myco/app.properties")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    Environment env;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TestBean testBean() {
        TestBean testBean = <span class="hl-keyword">new</span> TestBean();
        testBean.setName(env.getProperty(<span class="hl-string">"testbean.name"</span>));
        <span class="hl-keyword">return</span> testBean;
    }
}</pre>
<p>Any <code class="literal">${…&#8203;}</code> placeholders present in a <code class="literal">@PropertySource</code> resource location will
be resolved against the set of property sources already registered against the
environment. For example:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@PropertySource("classpath:/com/${my.placeholder:default/path}/app.properties")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    Environment env;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TestBean testBean() {
        TestBean testBean = <span class="hl-keyword">new</span> TestBean();
        testBean.setName(env.getProperty(<span class="hl-string">"testbean.name"</span>));
        <span class="hl-keyword">return</span> testBean;
    }
}</pre>
<p>Assuming that "my.placeholder" is present in one of the property sources already
registered, e.g. system properties or environment variables, the placeholder will
be resolved to the corresponding value. If not, then "default/path" will be used
as a default. If no default is specified and a property cannot be resolved, an
<code class="literal">IllegalArgumentException</code> will be thrown.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_placeholder_resolution_in_statements" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_placeholder_resolution_in_statements"></a>7.13.4&nbsp;Placeholder resolution in statements</h3></div></div></div>

<p>Historically, the value of placeholders in elements could be resolved only against
JVM system properties or environment variables. No longer is this the case. Because
the Environment abstraction is integrated throughout the container, it’s easy to
route resolution of placeholders through it. This means that you may configure the
resolution process in any way you like: change the precedence of searching through
system properties and environment variables, or remove them entirely; add your
own property sources to the mix as appropriate.</p>
<p>Concretely, the following statement works regardless of where the <code class="literal">customer</code>
property is defined, as long as it is available in the <code class="literal">Environment</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">"com/bank/service/${customer}-config.xml"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="context-load-time-weaver" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-load-time-weaver"></a>7.14&nbsp;Registering a LoadTimeWeaver</h2></div></div></div>

<p>The <code class="literal">LoadTimeWeaver</code> is used by Spring to dynamically transform classes as they are
loaded into the Java virtual machine (JVM).</p>
<p>To enable load-time weaving add the <code class="literal">@EnableLoadTimeWeaving</code> to one of your
<code class="literal">@Configuration</code> classes:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableLoadTimeWeaving</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

}</pre>
<p>Alternatively for XML configuration use the <code class="literal">context:load-time-weaver</code> element:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:load-time-weaver/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>Once configured for the <code class="literal">ApplicationContext</code>. Any bean within that <code class="literal">ApplicationContext</code>
may implement <code class="literal">LoadTimeWeaverAware</code>, thereby receiving a reference to the load-time
weaver instance. This is particularly useful in combination with <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm-jpa" title="20.5 JPA">Spring’s JPA
support</a> where load-time weaving may be necessary for JPA class transformation. Consult
the <code class="literal">LocalContainerEntityManagerFactoryBean</code> javadocs for more detail. For more on
AspectJ load-time weaving, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="11.8.4 Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;11.8.4, “Load-time weaving with AspectJ in the Spring Framework”</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="context-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-introduction"></a>7.15&nbsp;Additional Capabilities of the ApplicationContext</h2></div></div></div>

<p>As was discussed in the chapter introduction, the <code class="literal">org.springframework.beans.factory</code>
package provides basic functionality for managing and manipulating beans, including in a
programmatic way. The <code class="literal">org.springframework.context</code> package adds the
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/ApplicationContext.html" target="_top"><code class="literal">ApplicationContext</code></a>
interface, which extends the <code class="literal">BeanFactory</code> interface, in addition to extending other
interfaces to provide additional functionality in a more <span class="emphasis"><em>application
framework-oriented style</em></span>. Many people use the <code class="literal">ApplicationContext</code> in a completely
declarative fashion, not even creating it programmatically, but instead relying on
support classes such as <code class="literal">ContextLoader</code> to automatically instantiate an
<code class="literal">ApplicationContext</code> as part of the normal startup process of a Java EE web application.</p>
<p>To enhance <code class="literal">BeanFactory</code> functionality in a more framework-oriented style the context
package also provides the following functionality:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>Access to messages in i18n-style</em></span>, through the <code class="literal">MessageSource</code> interface.
</li><li class="listitem">
<span class="emphasis"><em>Access to resources</em></span>, such as URLs and files, through the <code class="literal">ResourceLoader</code> interface.
</li><li class="listitem">
<span class="emphasis"><em>Event publication</em></span> to namely beans implementing the <code class="literal">ApplicationListener</code> interface,
through the use of the <code class="literal">ApplicationEventPublisher</code> interface.
</li><li class="listitem">
<span class="emphasis"><em>Loading of multiple (hierarchical) contexts</em></span>, allowing each to be focused on one
particular layer, such as the web layer of an application, through the
<code class="literal">HierarchicalBeanFactory</code> interface.
</li></ul></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="context-functionality-messagesource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-messagesource"></a>7.15.1&nbsp;Internationalization using MessageSource</h3></div></div></div>

<p>The <code class="literal">ApplicationContext</code> interface extends an interface called <code class="literal">MessageSource</code>, and
therefore provides internationalization (i18n) functionality. Spring also provides the
interface <code class="literal">HierarchicalMessageSource</code>, which can resolve messages hierarchically.
Together these interfaces provide the foundation upon which Spring effects message
resolution. The methods defined on these interfaces include:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">String getMessage(String code, Object[] args, String default, Locale loc)</code>: The basic
method used to retrieve a message from the <code class="literal">MessageSource</code>. When no message is found
for the specified locale, the default message is used. Any arguments passed in become
replacement values, using the <code class="literal">MessageFormat</code> functionality provided by the standard
library.
</li><li class="listitem">
<code class="literal">String getMessage(String code, Object[] args, Locale loc)</code>: Essentially the same as
the previous method, but with one difference: no default message can be specified; if
the message cannot be found, a <code class="literal">NoSuchMessageException</code> is thrown.
</li><li class="listitem">
<code class="literal">String getMessage(MessageSourceResolvable resolvable, Locale locale)</code>: All properties
used in the preceding methods are also wrapped in a class named
<code class="literal">MessageSourceResolvable</code>, which you can use with this method.
</li></ul></div>
<p>When an <code class="literal">ApplicationContext</code> is loaded, it automatically searches for a <code class="literal">MessageSource</code>
bean defined in the context. The bean must have the name <code class="literal">messageSource</code>. If such a bean
is found, all calls to the preceding methods are delegated to the message source. If no
message source is found, the <code class="literal">ApplicationContext</code> attempts to find a parent containing a
bean with the same name. If it does, it uses that bean as the <code class="literal">MessageSource</code>. If the
<code class="literal">ApplicationContext</code> cannot find any source for messages, an empty
<code class="literal">DelegatingMessageSource</code> is instantiated in order to be able to accept calls to the
methods defined above.</p>
<p>Spring provides two <code class="literal">MessageSource</code> implementations, <code class="literal">ResourceBundleMessageSource</code> and
<code class="literal">StaticMessageSource</code>. Both implement <code class="literal">HierarchicalMessageSource</code> in order to do nested
messaging. The <code class="literal">StaticMessageSource</code> is rarely used but provides programmatic ways to
add messages to the source. The <code class="literal">ResourceBundleMessageSource</code> is shown in the following
example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageSource"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.ResourceBundleMessageSource"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basenames"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;list&gt;</span>
                <span class="hl-tag">&lt;value&gt;</span>format<span class="hl-tag">&lt;/value&gt;</span>
                <span class="hl-tag">&lt;value&gt;</span>exceptions<span class="hl-tag">&lt;/value&gt;</span>
                <span class="hl-tag">&lt;value&gt;</span>windows<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;/list&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>In the example it is assumed you have three resource bundles defined in your classpath
called <code class="literal">format</code>, <code class="literal">exceptions</code> and <code class="literal">windows</code>. Any request to resolve a message will be
handled in the JDK standard way of resolving messages through ResourceBundles. For the
purposes of the example, assume the contents of two of the above resource bundle files
are…&#8203;</p>
<pre class="programlisting"># in format.properties
message=Alligators rock!</pre>
<pre class="programlisting"># in exceptions.properties
argument.required=The {<span class="hl-number">0</span>} argument is required.</pre>
<p>A program to execute the <code class="literal">MessageSource</code> functionality is shown in the next example.
Remember that all <code class="literal">ApplicationContext</code> implementations are also <code class="literal">MessageSource</code>
implementations and so can be cast to the <code class="literal">MessageSource</code> interface.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    MessageSource resources = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"beans.xml"</span>);
    String message = resources.getMessage(<span class="hl-string">"message"</span>, null, <span class="hl-string">"Default"</span>, null);
    System.out.println(message);
}</pre>
<p>The resulting output from the above program will be…&#8203;</p>
<pre class="literallayout">Alligators rock!</pre>
<p>So to summarize, the <code class="literal">MessageSource</code> is defined in a file called <code class="literal">beans.xml</code>, which
exists at the root of your classpath. The <code class="literal">messageSource</code> bean definition refers to a
number of resource bundles through its <code class="literal">basenames</code> property. The three files that are
passed in the list to the <code class="literal">basenames</code> property exist as files at the root of your
classpath and are called <code class="literal">format.properties</code>, <code class="literal">exceptions.properties</code>, and
<code class="literal">windows.properties</code> respectively.</p>
<p>The next example shows arguments passed to the message lookup; these arguments will be
converted into Strings and inserted into placeholders in the lookup message.</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-comment">&lt;!-- this MessageSource is being used in a web application --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.ResourceBundleMessageSource"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"basename"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"exceptions"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- lets inject the above MessageSource into this POJO --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"example"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.Example"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"messages"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"messageSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Example {

    <span class="hl-keyword">private</span> MessageSource messages;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMessages(MessageSource messages) {
        <span class="hl-keyword">this</span>.messages = messages;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> execute() {
        String message = <span class="hl-keyword">this</span>.messages.getMessage(<span class="hl-string">"argument.required"</span>,
            <span class="hl-keyword">new</span> Object [] {<span class="hl-string">"userDao"</span>}, <span class="hl-string">"Required"</span>, null);
        System.out.println(message);
    }

}</pre>
<p>The resulting output from the invocation of the <code class="literal">execute()</code> method will be…&#8203;</p>
<pre class="literallayout">The userDao argument is required.</pre>
<p>With regard to internationalization (i18n), Spring’s various <code class="literal">MessageSource</code>
implementations follow the same locale resolution and fallback rules as the standard JDK
<code class="literal">ResourceBundle</code>. In short, and continuing with the example <code class="literal">messageSource</code> defined
previously, if you want to resolve messages against the British (<code class="literal">en-GB</code>) locale, you
would create files called <code class="literal">format_en_GB.properties</code>, <code class="literal">exceptions_en_GB.properties</code>, and
<code class="literal">windows_en_GB.properties</code> respectively.</p>
<p>Typically, locale resolution is managed by the surrounding environment of the
application. In this example, the locale against which (British) messages will be
resolved is specified manually.</p>
<pre class="literallayout"># in exceptions_en_GB.properties
argument.required=Ebagum lad, the {0} argument is required, I say, required.</pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) {
    MessageSource resources = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"beans.xml"</span>);
    String message = resources.getMessage(<span class="hl-string">"argument.required"</span>,
        <span class="hl-keyword">new</span> Object [] {<span class="hl-string">"userDao"</span>}, <span class="hl-string">"Required"</span>, Locale.UK);
    System.out.println(message);
}</pre>
<p>The resulting output from the running of the above program will be…&#8203;</p>
<pre class="literallayout">Ebagum lad, the 'userDao' argument is required, I say, required.</pre>
<p>You can also use the <code class="literal">MessageSourceAware</code> interface to acquire a reference to any
<code class="literal">MessageSource</code> that has been defined. Any bean that is defined in an
<code class="literal">ApplicationContext</code> that implements the <code class="literal">MessageSourceAware</code> interface is injected with
the application context’s <code class="literal">MessageSource</code> when the bean is created and configured.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><span class="emphasis"><em>As an alternative to <code class="literal">ResourceBundleMessageSource</code>, Spring provides a
<code class="literal">ReloadableResourceBundleMessageSource</code> class. This variant supports the same bundle
file format but is more flexible than the standard JDK based
<code class="literal">ResourceBundleMessageSource</code> implementation.</em></span> In particular, it allows for reading
files from any Spring resource location (not just from the classpath) and supports hot
reloading of bundle property files (while efficiently caching them in between). Check
out the <code class="literal">ReloadableResourceBundleMessageSource</code> javadocs for details.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="context-functionality-events" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events"></a>7.15.2&nbsp;Standard and Custom Events</h3></div></div></div>

<p>Event handling in the <code class="literal">ApplicationContext</code> is provided through the <code class="literal">ApplicationEvent</code>
class and <code class="literal">ApplicationListener</code> interface. If a bean that implements the
<code class="literal">ApplicationListener</code> interface is deployed into the context, every time an
<code class="literal">ApplicationEvent</code> gets published to the <code class="literal">ApplicationContext</code>, that bean is notified.
Essentially, this is the standard <span class="emphasis"><em>Observer</em></span> design pattern.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>As of Spring 4.2, the event infrastructure has been significantly improved and offer
an <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-annotation" title="Annotation-based Event Listeners">annotation-based model</a> as well as the
ability to publish any arbitrary event, that is an object that does not necessarily
extend from <code class="literal">ApplicationEvent</code>. When such an object is published we wrap it in an
event for you.</p>
</td></tr></tbody></table></div>
<p>Spring provides the following standard events:</p>
<div class="table"><a name="beans-ctx-events-tbl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-ctx-events-tbl"></a><p class="title"><b>Table&nbsp;7.7.&nbsp;Built-in Events</b></p><div class="table-contents">

<table summary="Built-in Events" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Event</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContextRefreshedEvent</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Published when the <code class="literal">ApplicationContext</code> is initialized or refreshed, for example,
  using the <code class="literal">refresh()</code> method on the <code class="literal">ConfigurableApplicationContext</code> interface.
  "Initialized" here means that all beans are loaded, post-processor beans are detected
  and activated, singletons are pre-instantiated, and the <code class="literal">ApplicationContext</code> object is
  ready for use. As long as the context has not been closed, a refresh can be triggered
  multiple times, provided that the chosen <code class="literal">ApplicationContext</code> actually supports such
  "hot" refreshes. For example, <code class="literal">XmlWebApplicationContext</code> supports hot refreshes, but
  <code class="literal">GenericApplicationContext</code> does not.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContextStartedEvent</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Published when the <code class="literal">ApplicationContext</code> is started, using the <code class="literal">start()</code> method on the
  <code class="literal">ConfigurableApplicationContext</code> interface. "Started" here means that all <code class="literal">Lifecycle</code>
  beans receive an explicit start signal. Typically this signal is used to restart beans
  after an explicit stop, but it may also be used to start components that have not been
  configured for autostart , for example, components that have not already started on
  initialization.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContextStoppedEvent</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Published when the <code class="literal">ApplicationContext</code> is stopped, using the <code class="literal">stop()</code> method on the
  <code class="literal">ConfigurableApplicationContext</code> interface. "Stopped" here means that all <code class="literal">Lifecycle</code>
  beans receive an explicit stop signal. A stopped context may be restarted through a
  <code class="literal">start()</code> call.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContextClosedEvent</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Published when the <code class="literal">ApplicationContext</code> is closed, using the <code class="literal">close()</code> method on the
  <code class="literal">ConfigurableApplicationContext</code> interface. "Closed" here means that all singleton
  beans are destroyed. A closed context reaches its end of life; it cannot be refreshed
  or restarted.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">RequestHandledEvent</code></p></td><td style="" align="left" valign="top"><p>A web-specific event telling all beans that an HTTP request has been serviced. This
  event is published <span class="emphasis"><em>after</em></span> the request is complete. This event is only applicable to
  web applications using Spring’s <code class="literal">DispatcherServlet</code>.</p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>You can also create and publish your own custom events. This example demonstrates a
simple class that extends Spring’s <code class="literal">ApplicationEvent</code> base class:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BlackListEvent <span class="hl-keyword">extends</span> ApplicationEvent {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> String address;
    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> String test;

    <span class="hl-keyword">public</span> BlackListEvent(Object source, String address, String test) {
        <span class="hl-keyword">super</span>(source);
        <span class="hl-keyword">this</span>.address = address;
        <span class="hl-keyword">this</span>.test = test;
    }

    <span class="hl-comment">// accessor and other methods...</span>

}</pre>
<p>To publish a custom <code class="literal">ApplicationEvent</code>, call the <code class="literal">publishEvent()</code> method on an
<code class="literal">ApplicationEventPublisher</code>. Typically this is done by creating a class that implements
<code class="literal">ApplicationEventPublisherAware</code> and registering it as a Spring bean. The following
example demonstrates such a class:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EmailService <span class="hl-keyword">implements</span> ApplicationEventPublisherAware {

    <span class="hl-keyword">private</span> List&lt;String&gt; blackList;
    <span class="hl-keyword">private</span> ApplicationEventPublisher publisher;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBlackList(List&lt;String&gt; blackList) {
        <span class="hl-keyword">this</span>.blackList = blackList;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setApplicationEventPublisher(ApplicationEventPublisher publisher) {
        <span class="hl-keyword">this</span>.publisher = publisher;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> sendEmail(String address, String text) {
        <span class="hl-keyword">if</span> (blackList.contains(address)) {
            BlackListEvent event = <span class="hl-keyword">new</span> BlackListEvent(<span class="hl-keyword">this</span>, address, text);
            publisher.publishEvent(event);
            <span class="hl-keyword">return</span>;
        }
        <span class="hl-comment">// send email...</span>
    }

}</pre>
<p>At configuration time, the Spring container will detect that <code class="literal">EmailService</code> implements
<code class="literal">ApplicationEventPublisherAware</code> and will automatically call
<code class="literal">setApplicationEventPublisher()</code>. In reality, the parameter passed in will be the Spring
container itself; you’re simply interacting with the application context via its
<code class="literal">ApplicationEventPublisher</code> interface.</p>
<p>To receive the custom <code class="literal">ApplicationEvent</code>, create a class that implements
<code class="literal">ApplicationListener</code> and register it as a Spring bean. The following example
demonstrates such a class:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BlackListNotifier <span class="hl-keyword">implements</span> ApplicationListener&lt;BlackListEvent&gt; {

    <span class="hl-keyword">private</span> String notificationAddress;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setNotificationAddress(String notificationAddress) {
        <span class="hl-keyword">this</span>.notificationAddress = notificationAddress;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onApplicationEvent(BlackListEvent event) {
        <span class="hl-comment">// notify appropriate parties via notificationAddress...</span>
    }

}</pre>
<p>Notice that <code class="literal">ApplicationListener</code> is generically parameterized with the type of your
custom event, <code class="literal">BlackListEvent</code>. This means that the <code class="literal">onApplicationEvent()</code> method can
remain type-safe, avoiding any need for downcasting. You may register as many event
listeners as you wish, but note that by default event listeners receive events
synchronously. This means the <code class="literal">publishEvent()</code> method blocks until all listeners have
finished processing the event. One advantage of this synchronous and single-threaded
approach is that when a listener receives an event, it operates inside the transaction
context of the publisher if a transaction context is available. If another strategy for
event publication becomes necessary, refer to the javadoc for Spring’s
<code class="literal">ApplicationEventMulticaster</code> interface.</p>
<p>The following example shows the bean definitions used to register and configure each of
the classes above:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"emailService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.EmailService"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"blackList"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>known.spammer@example.org<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>known.hacker@example.org<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>john.doe@example.org<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"blackListNotifier"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.BlackListNotifier"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"notificationAddress"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"blacklist@example.org"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Putting it all together, when the <code class="literal">sendEmail()</code> method of the <code class="literal">emailService</code> bean is
called, if there are any emails that should be blacklisted, a custom event of type
<code class="literal">BlackListEvent</code> is published. The <code class="literal">blackListNotifier</code> bean is registered as an
<code class="literal">ApplicationListener</code> and thus receives the <code class="literal">BlackListEvent</code>, at which point it can
notify appropriate parties.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Spring’s eventing mechanism is designed for simple communication between Spring beans
within the same application context. However, for more sophisticated enterprise
integration needs, the separately-maintained
<a class="ulink" href="http://projects.spring.io/spring-integration/" target="_top">Spring Integration</a> project provides
complete support for building lightweight,
<a class="ulink" href="http://www.enterpriseintegrationpatterns.com/" target="_top">pattern-oriented</a>, event-driven
architectures that build upon the well-known Spring programming model.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="context-functionality-events-annotation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-annotation"></a>Annotation-based Event Listeners</h4></div></div></div>

<p>As of Spring 4.2, an event listener can be registered on any public method of a managed
bean via the <code class="literal">EventListener</code> annotation. The <code class="literal">BlackListNotifier</code> can be rewritten as
follows:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BlackListNotifier {

    <span class="hl-keyword">private</span> String notificationAddress;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setNotificationAddress(String notificationAddress) {
        <span class="hl-keyword">this</span>.notificationAddress = notificationAddress;
    }

    <em><span class="hl-annotation" style="color: gray">@EventListener</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processBlackListEvent(BlackListEvent event) {
        <span class="hl-comment">// notify appropriate parties via notificationAddress...</span>
    }

}</pre>
<p>As you can see above, the method signature once again declares the event type it listens to,
but this time with a flexible name and without implementing a specific listener interface.
The event type can also be narrowed through generics as long as the actual event type
resolves your generic parameter in its implementation hierarchy.</p>
<p>If your method should listen to several events or if you want to define it with no
parameter at all, the event type(s) can also be specified on the annotation itself:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EventListener({ContextStartedEvent.class, ContextRefreshedEvent.class})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handleContextStart() {
    ...
}</pre>
<p>It is also possible to add additional runtime filtering via the <code class="literal">condition</code> attribute of the
annotation that defines a <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions" title="10. Spring Expression Language (SpEL)"><code class="literal">SpEL</code> expression</a> that should match to actually invoke
the method for a particular event.</p>
<p>For instance, our notifier can be rewritten to be only invoked if the <code class="literal">test</code> attribute of the
event is equal to <code class="literal">foo</code>:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EventListener(condition = "#blEvent.test == 'foo'")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processBlackListEvent(BlackListEvent blEvent) {
    <span class="hl-comment">// notify appropriate parties via notificationAddress...</span>
}</pre>
<p>Each <code class="literal">SpEL</code> expression evaluates again a dedicated context. The next table lists the items made
available to the context so one can use them for conditional event processing:</p>
<div class="table"><a name="context-functionality-events-annotation-tbl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-annotation-tbl"></a><p class="title"><b>Table&nbsp;7.8.&nbsp;Event SpEL available metadata</b></p><div class="table-contents">

<table summary="Event SpEL available metadata" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Name</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Location</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Example</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Event</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>root object</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The actual <code class="literal">ApplicationEvent</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">#root.event</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Arguments array</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>root object</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The arguments (as array) used for invoking the target</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">#root.args[0]</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="emphasis"><em>Argument name</em></span></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>evaluation context</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Name of any of the method arguments. If for some reason the names are not available
  (e.g. no debug information), the argument names are also available under the <code class="literal">#a&lt;#arg&gt;</code>
  where <span class="emphasis"><em>#arg</em></span> stands for the argument index (starting from 0).</p></td><td style="" align="left" valign="top"><p><code class="literal">#blEvent</code> or <code class="literal">#a0</code> (one can also use <code class="literal">#p0</code> or <code class="literal">#p&lt;#arg&gt;</code> notation as an alias).</p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>Note that <code class="literal">#root.event</code> allows you to access to the underlying event, even if your method
signature actually refers to an arbitrary object that was published.</p>
<p>If you need to publish an event as the result of processing another, just change the
method signature to return the event that should be published, something like:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EventListener</span></em>
<span class="hl-keyword">public</span> ListUpdateEvent handleBlackListEvent(BlackListEvent event) {
    <span class="hl-comment">// notify appropriate parties via notificationAddress and</span>
    <span class="hl-comment">// then publish a ListUpdateEvent...</span>
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>This feature is not supported for <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-async" title="Asynchronous Listeners">asynchronous
listeners</a>.</p>
</td></tr></tbody></table></div>
<p>This new method will publish a new <code class="literal">ListUpdateEvent</code> for every <code class="literal">BlackListEvent</code> handled
by the method above. If you need to publish several events, just return a <code class="literal">Collection</code> of
events instead.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="context-functionality-events-async" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-async"></a>Asynchronous Listeners</h4></div></div></div>

<p>If you want a particular listener to process events asynchronously, simply reuse the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling-annotation-support-async" title="34.4.3 The @Async annotation">regular <code class="literal">@Async</code> support</a>:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EventListener</span></em>
<em><span class="hl-annotation" style="color: gray">@Async</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processBlackListEvent(BlackListEvent event) {
    <span class="hl-comment">// BlackListEvent is processed in a separate thread</span>
}</pre>
<p>Be aware of the following limitations when using asynchronous events:</p>
<div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
If the event listener throws an <code class="literal">Exception</code> it will not be propagated to the caller,
check <code class="literal">AsyncUncaughtExceptionHandler</code> for more details.
</li><li class="listitem">
Such event listener cannot send replies. If you need to send another event as the
result of the processing, inject <code class="literal">ApplicationEventPublisher</code> to send the event
manually.
</li></ol></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="context-functionality-events-order" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-order"></a>Ordering Listeners</h4></div></div></div>

<p>If you need the listener to be invoked before another one, just add the <code class="literal">@Order</code>
annotation to the method declaration:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EventListener</span></em>
<em><span class="hl-annotation" style="color: gray">@Order(42)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processBlackListEvent(BlackListEvent event) {
    <span class="hl-comment">// notify appropriate parties via notificationAddress...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="context-functionality-events-generics" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-events-generics"></a>Generic Events</h4></div></div></div>

<p>You may also use generics to further define the structure of your event. Consider an
<code class="literal">EntityCreatedEvent&lt;T&gt;</code> where <code class="literal">T</code> is the type of the actual entity that got created. You
can create the following listener definition to only receive <code class="literal">EntityCreatedEvent</code> for a
<code class="literal">Person</code>:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@EventListener</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onPersonCreated(EntityCreatedEvent&lt;Person&gt; event) {
    ...
}</pre>
<p>Due to type erasure, this will only work if the event that is fired resolves the generic
parameter(s) on which the event listener filters on (that is something like
<code class="literal">class PersonCreatedEvent extends EntityCreatedEvent&lt;Person&gt; { …&#8203; }</code>).</p>
<p>In certain circumstances, this may become quite tedious if all events follow the same
structure (as it should be the case for the event above). In such a case, you can
implement <code class="literal">ResolvableTypeProvider</code> to <span class="emphasis"><em>guide</em></span> the framework beyond what the runtime
environment provides:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EntityCreatedEvent&lt;T&gt;
        <span class="hl-keyword">extends</span> ApplicationEvent <span class="hl-keyword">implements</span> ResolvableTypeProvider {

    <span class="hl-keyword">public</span> EntityCreatedEvent(T entity) {
        <span class="hl-keyword">super</span>(entity);
    }

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> ResolvableType getResolvableType() {
        <span class="hl-keyword">return</span> ResolvableType.forClassWithGenerics(getClass(),
                ResolvableType.forInstance(getSource()));
    }
}</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>This works not only for <code class="literal">ApplicationEvent</code> but any arbitrary object that you’d send as
an event.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="context-functionality-resources" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-functionality-resources"></a>7.15.3&nbsp;Convenient access to low-level resources</h3></div></div></div>

<p>For optimal usage and understanding of application contexts, users should generally
familiarize themselves with Spring’s <code class="literal">Resource</code> abstraction, as described in the chapter
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources" title="8. Resources">Chapter&nbsp;8, <i>Resources</i></a>.</p>
<p>An application context is a <code class="literal">ResourceLoader</code>, which can be used to load <code class="literal">Resource</code>s. A
<code class="literal">Resource</code> is essentially a more feature rich version of the JDK class <code class="literal">java.net.URL</code>,
in fact, the implementations of the <code class="literal">Resource</code> wrap an instance of <code class="literal">java.net.URL</code> where
appropriate. A <code class="literal">Resource</code> can obtain low-level resources from almost any location in a
transparent fashion, including from the classpath, a filesystem location, anywhere
describable with a standard URL, and some other variations. If the resource location
string is a simple path without any special prefixes, where those resources come from is
specific and appropriate to the actual application context type.</p>
<p>You can configure a bean deployed into the application context to implement the special
callback interface, <code class="literal">ResourceLoaderAware</code>, to be automatically called back at
initialization time with the application context itself passed in as the
<code class="literal">ResourceLoader</code>. You can also expose properties of type <code class="literal">Resource</code>, to be used to
access static resources; they will be injected into it like any other properties. You
can specify those <code class="literal">Resource</code> properties as simple String paths, and rely on a special
JavaBean <code class="literal">PropertyEditor</code> that is automatically registered by the context, to convert
those text strings to actual <code class="literal">Resource</code> objects when the bean is deployed.</p>
<p>The location path or paths supplied to an <code class="literal">ApplicationContext</code> constructor are actually
resource strings, and in simple form are treated appropriately to the specific context
implementation. <code class="literal">ClassPathXmlApplicationContext</code> treats a simple location path as a
classpath location. You can also use location paths (resource strings) with special
prefixes to force loading of definitions from the classpath or a URL, regardless of the
actual context type.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="context-create" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-create"></a>7.15.4&nbsp;Convenient ApplicationContext instantiation for web applications</h3></div></div></div>

<p>You can create <code class="literal">ApplicationContext</code> instances declaratively by using, for example, a
<code class="literal">ContextLoader</code>. Of course you can also create <code class="literal">ApplicationContext</code> instances
programmatically by using one of the <code class="literal">ApplicationContext</code> implementations.</p>
<p>You can register an <code class="literal">ApplicationContext</code> using the <code class="literal">ContextLoaderListener</code> as follows:</p>
<pre class="programlisting"><span class="hl-tag">&lt;context-param&gt;</span>
    <span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
    <span class="hl-tag">&lt;param-value&gt;</span>/WEB-INF/daoContext.xml /WEB-INF/applicationContext.xml<span class="hl-tag">&lt;/param-value&gt;</span>
<span class="hl-tag">&lt;/context-param&gt;</span>

<span class="hl-tag">&lt;listener&gt;</span>
    <span class="hl-tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hl-tag">&lt;/listener-class&gt;</span>
<span class="hl-tag">&lt;/listener&gt;</span></pre>
<p>The listener inspects the <code class="literal">contextConfigLocation</code> parameter. If the parameter does not
exist, the listener uses <code class="literal">/WEB-INF/applicationContext.xml</code> as a default. When the
parameter <span class="emphasis"><em>does</em></span> exist, the listener separates the String by using predefined
delimiters (comma, semicolon and whitespace) and uses the values as locations where
application contexts will be searched. Ant-style path patterns are supported as well.
Examples are <code class="literal">/WEB-INF/*Context.xml</code> for all files with names ending with "Context.xml",
residing in the "WEB-INF" directory, and <code class="literal">/WEB-INF/**/*Context.xml</code>, for all such files
in any subdirectory of "WEB-INF".</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="context-deploy-rar" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-deploy-rar"></a>7.15.5&nbsp;Deploying a Spring ApplicationContext as a Java EE RAR file</h3></div></div></div>

<p>It is possible to deploy a Spring ApplicationContext as a RAR file, encapsulating the
context and all of its required bean classes and library JARs in a Java EE RAR deployment
unit. This is the equivalent of bootstrapping a standalone ApplicationContext, just hosted
in Java EE environment, being able to access the Java EE servers facilities. RAR deployment
is  more natural alternative to scenario of deploying a headless WAR file, in effect, a WAR
file without any HTTP entry points that is used only for bootstrapping a Spring
ApplicationContext in a Java EE environment.</p>
<p>RAR deployment is ideal for application contexts that do not need HTTP entry points but
rather consist only of message endpoints and scheduled jobs. Beans in such a context can
use application server resources such as the JTA transaction manager and JNDI-bound JDBC
DataSources and JMS ConnectionFactory instances, and may also register with the
platform’s JMX server - all through Spring’s standard transaction management and JNDI
and JMX support facilities. Application components can also interact with the
application server’s JCA WorkManager through Spring’s <code class="literal">TaskExecutor</code> abstraction.</p>
<p>Check out the javadoc of the
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/jca/context/SpringContextResourceAdapter.html" target="_top"><code class="literal">SpringContextResourceAdapter</code></a>
class for the configuration details involved in RAR deployment.</p>
<p><span class="emphasis"><em>For a simple deployment of a Spring ApplicationContext as a Java EE RAR file:</em></span> package
all application classes into a RAR file, which is a standard JAR file with a different
file extension. Add all required library JARs into the root of the RAR archive. Add a
"META-INF/ra.xml" deployment descriptor (as shown in <code class="literal">SpringContextResourceAdapter</code>s
javadoc) and the corresponding Spring XML bean definition file(s) (typically
"META-INF/applicationContext.xml"), and drop the resulting RAR file into your
application server’s deployment directory.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Such RAR deployment units are usually self-contained; they do not expose components to
the outside world, not even to other modules of the same application. Interaction with a
RAR-based ApplicationContext usually occurs through JMS destinations that it shares with
other modules. A RAR-based ApplicationContext may also, for example, schedule some jobs,
reacting to new files in the file system (or the like). If it needs to allow synchronous
access from the outside, it could for example export RMI endpoints, which of course may
be used by other application modules on the same machine.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-beanfactory" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beanfactory"></a>7.16&nbsp;The BeanFactory</h2></div></div></div>

<p>The <code class="literal">BeanFactory</code> provides the underlying basis for Spring’s IoC functionality but it is
only used directly in integration with other third-party frameworks and is now largely
historical in nature for most users of Spring. The <code class="literal">BeanFactory</code> and related interfaces,
such as <code class="literal">BeanFactoryAware</code>, <code class="literal">InitializingBean</code>, <code class="literal">DisposableBean</code>, are still present in
Spring for the purposes of backward compatibility with the large number of third-party
frameworks that integrate with Spring. Often third-party components that can not use
more modern equivalents such as <code class="literal">@PostConstruct</code> or <code class="literal">@PreDestroy</code> in order to remain
compatible with JDK 1.4 or to avoid a dependency on JSR-250.</p>
<p>This section provides additional background into the differences between the
<code class="literal">BeanFactory</code> and <code class="literal">ApplicationContext</code> and how one might access the IoC container
directly through a classic singleton lookup.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="context-introduction-ctx-vs-beanfactory" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-introduction-ctx-vs-beanfactory"></a>7.16.1&nbsp;BeanFactory or ApplicationContext?</h3></div></div></div>

<p>Use an <code class="literal">ApplicationContext</code> unless you have a good reason for not doing so.</p>
<p>Because the <code class="literal">ApplicationContext</code> includes all functionality of the <code class="literal">BeanFactory</code>, it is
generally recommended over the <code class="literal">BeanFactory</code>, except for a few situations such as in
embedded applications running on resource-constrained devices where memory consumption
might be critical and a few extra kilobytes might make a difference. However, for
most typical enterprise applications and systems, the <code class="literal">ApplicationContext</code> is what you
will want to use. Spring makes <span class="emphasis"><em>heavy</em></span> use of the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp" title="7.8.1 Customizing beans using a BeanPostProcessor"><code class="literal">BeanPostProcessor</code> extension point</a> (to effect proxying and so on). If you use only a
plain <code class="literal">BeanFactory</code>, a fair amount of support such as transactions and AOP will not take
effect, at least not without some extra steps on your part. This situation could be
confusing because nothing is actually wrong with the configuration.</p>
<p>The following table lists features provided by the <code class="literal">BeanFactory</code> and
<code class="literal">ApplicationContext</code> interfaces and implementations.</p>
<div class="table"><a name="context-introduction-ctx-vs-beanfactory-feature-matrix" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#context-introduction-ctx-vs-beanfactory-feature-matrix"></a><p class="title"><b>Table&nbsp;7.9.&nbsp;Feature Matrix</b></p><div class="table-contents">

<table summary="Feature Matrix" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Feature</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><code class="literal">BeanFactory</code></th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top"><code class="literal">ApplicationContext</code></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Bean instantiation/wiring</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Automatic <code class="literal">BeanPostProcessor</code> registration</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Automatic <code class="literal">BeanFactoryPostProcessor</code> registration</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Convenient <code class="literal">MessageSource</code> access (for i18n)</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ApplicationEvent</code> publication</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="" align="left" valign="top"><p>Yes</p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>To explicitly register a bean post-processor with a <code class="literal">BeanFactory</code> implementation,
you need to write code like this:</p>
<pre class="programlisting">DefaultListableBeanFactory factory = <span class="hl-keyword">new</span> DefaultListableBeanFactory();
<span class="hl-comment">// populate the factory with bean definitions</span>

<span class="hl-comment">// now register any needed BeanPostProcessor instances</span>
MyBeanPostProcessor postProcessor = <span class="hl-keyword">new</span> MyBeanPostProcessor();
factory.addBeanPostProcessor(postProcessor);

<span class="hl-comment">// now start using the factory</span></pre>
<p>To explicitly register a <code class="literal">BeanFactoryPostProcessor</code> when using a <code class="literal">BeanFactory</code>
implementation, you must write code like this:</p>
<pre class="programlisting">DefaultListableBeanFactory factory = <span class="hl-keyword">new</span> DefaultListableBeanFactory();
XmlBeanDefinitionReader reader = <span class="hl-keyword">new</span> XmlBeanDefinitionReader(factory);
reader.loadBeanDefinitions(<span class="hl-keyword">new</span> FileSystemResource(<span class="hl-string">"beans.xml"</span>));

<span class="hl-comment">// bring in some property values from a Properties file</span>
PropertyPlaceholderConfigurer cfg = <span class="hl-keyword">new</span> PropertyPlaceholderConfigurer();
cfg.setLocation(<span class="hl-keyword">new</span> FileSystemResource(<span class="hl-string">"jdbc.properties"</span>));

<span class="hl-comment">// now actually do the replacement</span>
cfg.postProcessBeanFactory(factory);</pre>
<p>In both cases, the explicit registration step is inconvenient, which is one reason why
the various <code class="literal">ApplicationContext</code> implementations are preferred above plain <code class="literal">BeanFactory</code>
implementations in the vast majority of Spring-backed applications, especially when
using <code class="literal">BeanFactoryPostProcessor</code>s and <code class="literal">BeanPostProcessor</code>s. These mechanisms implement
important functionality such as property placeholder replacement and AOP.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-servicelocator" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-servicelocator"></a>7.16.2&nbsp;Glue code and the evil singleton</h3></div></div></div>

<p>It is best to write most application code in a dependency-injection (DI) style, where
that code is served out of a Spring IoC container, has its own dependencies supplied by
the container when it is created, and is completely unaware of the container. However,
for the small glue layers of code that are sometimes needed to tie other code together,
you sometimes need a singleton (or quasi-singleton) style access to a Spring IoC
container. For example, third-party code may try to construct new objects directly (
<code class="literal">Class.forName()</code> style), without the ability to get these objects out of a Spring IoC
container.If the object constructed by the third-party code is a small stub or proxy,
which then uses a singleton style access to a Spring IoC container to get a real object
to delegate to, then inversion of control has still been achieved for the majority of
the code (the object coming out of the container). Thus most code is still unaware of
the container or how it is accessed, and remains decoupled from other code, with all
ensuing benefits. EJBs may also use this stub/proxy approach to delegate to a plain Java
implementation object, retrieved from a Spring IoC container. While the Spring IoC
container itself ideally does not have to be a singleton, it may be unrealistic in terms
of memory usage or initialization times (when using beans in the Spring IoC container
such as a Hibernate <code class="literal">SessionFactory</code>) for each bean to use its own, non-singleton Spring
IoC container.</p>
<p>Looking up the application context in a service locator style is sometimes the only
option for accessing shared Spring-managed components, such as in an EJB 2.1
environment, or when you want to share a single ApplicationContext as a parent to
WebApplicationContexts across WAR files. In this case you should look into using the
utility class
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/context/access/ContextSingletonBeanFactoryLocator.html" target="_top"><code class="literal">ContextSingletonBeanFactoryLocator</code></a>
locator that is described in this
<a class="ulink" href="https://spring.io/blog/2007/06/11/using-a-shared-parent-application-context-in-a-multi-war-spring-application/" target="_top">Spring
team blog entry</a>.</p>
</div>
</div>
<div class="footnotes"><br><hr style="width:100; text-align:left;margin-left: 0"><div id="ftn.d5e1761" class="footnote"><p><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e1761" class="simpara"><sup class="simpara">[1] </sup></a>See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#background-ioc" title="Background">Background</a></p></div><div id="ftn.d5e2606" class="footnote"><p><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e2606" class="simpara"><sup class="simpara">[2] </sup></a>See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-collaborators" title="7.4.1 Dependency Injection">Section&nbsp;7.4.1, “Dependency Injection”</a></p></div></div></div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="resources" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources"></a>8.&nbsp;Resources</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-introduction"></a>8.1&nbsp;Introduction</h2></div></div></div>

<p>Java’s standard <code class="literal">java.net.URL</code> class and standard handlers for various URL prefixes
unfortunately are not quite adequate enough for all access to low-level resources. For
example, there is no standardized <code class="literal">URL</code> implementation that may be used to access a
resource that needs to be obtained from the classpath, or relative to a
<code class="literal">ServletContext</code>. While it is possible to register new handlers for specialized <code class="literal">URL</code>
prefixes (similar to existing handlers for prefixes such as <code class="literal">http:</code>), this is generally
quite complicated, and the <code class="literal">URL</code> interface still lacks some desirable functionality,
such as a method to check for the existence of the resource being pointed to.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-resource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-resource"></a>8.2&nbsp;The Resource interface</h2></div></div></div>

<p>Spring’s <code class="literal">Resource</code> interface is meant to be a more capable interface for abstracting
access to low-level resources.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Resource <span class="hl-keyword">extends</span> InputStreamSource {

    <span class="hl-keyword">boolean</span> exists();

    <span class="hl-keyword">boolean</span> isOpen();

    URL getURL() <span class="hl-keyword">throws</span> IOException;

    File getFile() <span class="hl-keyword">throws</span> IOException;

    Resource createRelative(String relativePath) <span class="hl-keyword">throws</span> IOException;

    String getFilename();

    String getDescription();

}</pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> InputStreamSource {

    InputStream getInputStream() <span class="hl-keyword">throws</span> IOException;

}</pre>
<p>Some of the most important methods from the <code class="literal">Resource</code> interface are:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">getInputStream()</code>: locates and opens the resource, returning an <code class="literal">InputStream</code> for
reading from the resource. It is expected that each invocation returns a fresh
<code class="literal">InputStream</code>. It is the responsibility of the caller to close the stream.
</li><li class="listitem">
<code class="literal">exists()</code>: returns a <code class="literal">boolean</code> indicating whether this resource actually exists in
physical form.
</li><li class="listitem">
<code class="literal">isOpen()</code>: returns a <code class="literal">boolean</code> indicating whether this resource represents a handle
with an open stream. If <code class="literal">true</code>, the <code class="literal">InputStream</code> cannot be read multiple times, and
must be read once only and then closed to avoid resource leaks. Will be <code class="literal">false</code> for
all usual resource implementations, with the exception of <code class="literal">InputStreamResource</code>.
</li><li class="listitem">
<code class="literal">getDescription()</code>: returns a description for this resource, to be used for error
output when working with the resource. This is often the fully qualified file name or
the actual URL of the resource.
</li></ul></div>
<p>Other methods allow you to obtain an actual <code class="literal">URL</code> or <code class="literal">File</code> object representing the
resource (if the underlying implementation is compatible, and supports that
functionality).</p>
<p>The <code class="literal">Resource</code> abstraction is used extensively in Spring itself, as an argument type in
many method signatures when a resource is needed. Other methods in some Spring APIs
(such as the constructors to various <code class="literal">ApplicationContext</code> implementations), take a
<code class="literal">String</code> which in unadorned or simple form is used to create a <code class="literal">Resource</code> appropriate to
that context implementation, or via special prefixes on the <code class="literal">String</code> path, allow the
caller to specify that a specific <code class="literal">Resource</code> implementation must be created and used.</p>
<p>While the <code class="literal">Resource</code> interface is used a lot with Spring and by Spring, it’s actually
very useful to use as a general utility class by itself in your own code, for access to
resources, even when your code doesn’t know or care about any other parts of Spring.
While this couples your code to Spring, it really only couples it to this small set of
utility classes, which are serving as a more capable replacement for <code class="literal">URL</code>, and can be
considered equivalent to any other library you would use for this purpose.</p>
<p>It is important to note that the <code class="literal">Resource</code> abstraction does not replace functionality:
it wraps it where possible. For example, a <code class="literal">UrlResource</code> wraps a URL, and uses the
wrapped <code class="literal">URL</code> to do its work.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-implementations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations"></a>8.3&nbsp;Built-in Resource implementations</h2></div></div></div>

<p>There are a number of <code class="literal">Resource</code> implementations that come supplied straight out of the
box in Spring:</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-urlresource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-urlresource"></a>8.3.1&nbsp;UrlResource</h3></div></div></div>

<p>The <code class="literal">UrlResource</code> wraps a <code class="literal">java.net.URL</code>, and may be used to access any object that is
normally accessible via a URL, such as files, an HTTP target, an FTP target, etc. All
URLs have a standardized <code class="literal">String</code> representation, such that appropriate standardized
prefixes are used to indicate one URL type from another. This includes <code class="literal">file:</code> for
accessing filesystem paths, <code class="literal">http:</code> for accessing resources via the HTTP protocol,
<code class="literal">ftp:</code> for accessing resources via FTP, etc.</p>
<p>A <code class="literal">UrlResource</code> is created by Java code explicitly using the <code class="literal">UrlResource</code> constructor,
but will often be created implicitly when you call an API method which takes a <code class="literal">String</code>
argument which is meant to represent a path. For the latter case, a JavaBeans
<code class="literal">PropertyEditor</code> will ultimately decide which type of <code class="literal">Resource</code> to create. If the path
string contains a few well-known (to it, that is) prefixes such as <code class="literal">classpath:</code>, it will
create an appropriate specialized <code class="literal">Resource</code> for that prefix. However, if it doesn’t
recognize the prefix, it will assume the this is just a standard URL string, and will
create a <code class="literal">UrlResource</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-classpathresource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-classpathresource"></a>8.3.2&nbsp;ClassPathResource</h3></div></div></div>

<p>This class represents a resource which should be obtained from the classpath. This uses
either the thread context class loader, a given class loader, or a given class for
loading resources.</p>
<p>This <code class="literal">Resource</code> implementation supports resolution as <code class="literal">java.io.File</code> if the class path
resource resides in the file system, but not for classpath resources which reside in a
jar and have not been expanded (by the servlet engine, or whatever the environment is)
to the filesystem. To address this the various <code class="literal">Resource</code> implementations always support
resolution as a <code class="literal">java.net.URL</code>.</p>
<p>A <code class="literal">ClassPathResource</code> is created by Java code explicitly using the <code class="literal">ClassPathResource</code>
constructor, but will often be created implicitly when you call an API method which
takes a <code class="literal">String</code> argument which is meant to represent a path. For the latter case, a
JavaBeans <code class="literal">PropertyEditor</code> will recognize the special prefix <code class="literal">classpath:</code> on the string
path, and create a <code class="literal">ClassPathResource</code> in that case.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-filesystemresource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-filesystemresource"></a>8.3.3&nbsp;FileSystemResource</h3></div></div></div>

<p>This is a <code class="literal">Resource</code> implementation for <code class="literal">java.io.File</code> handles. It obviously supports
resolution as a <code class="literal">File</code>, and as a <code class="literal">URL</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-servletcontextresource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-servletcontextresource"></a>8.3.4&nbsp;ServletContextResource</h3></div></div></div>

<p>This is a <code class="literal">Resource</code> implementation for <code class="literal">ServletContext</code> resources, interpreting
relative paths within the relevant web application’s root directory.</p>
<p>This always supports stream access and URL access, but only allows <code class="literal">java.io.File</code> access
when the web application archive is expanded and the resource is physically on the
filesystem. Whether or not it’s expanded and on the filesystem like this, or accessed
directly from the JAR or somewhere else like a DB (it’s conceivable) is actually
dependent on the Servlet container.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-inputstreamresource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-inputstreamresource"></a>8.3.5&nbsp;InputStreamResource</h3></div></div></div>

<p>A <code class="literal">Resource</code> implementation for a given <code class="literal">InputStream</code>. This should only be used if no
specific <code class="literal">Resource</code> implementation is applicable. In particular, prefer
<code class="literal">ByteArrayResource</code> or any of the file-based <code class="literal">Resource</code> implementations where possible.</p>
<p>In contrast to other <code class="literal">Resource</code> implementations, this is a descriptor for an <span class="emphasis"><em>already</em></span>
opened resource - therefore returning <code class="literal">true</code> from <code class="literal">isOpen()</code>. Do not use it if you need
to keep the resource descriptor somewhere, or if you need to read a stream multiple
times.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="resources-implementations-bytearrayresource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-implementations-bytearrayresource"></a>8.3.6&nbsp;ByteArrayResource</h3></div></div></div>

<p>This is a <code class="literal">Resource</code> implementation for a given byte array. It creates a
<code class="literal">ByteArrayInputStream</code> for the given byte array.</p>
<p>It’s useful for loading content from any given byte array, without having to resort to a
single-use <code class="literal">InputStreamResource</code>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-resourceloader" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-resourceloader"></a>8.4&nbsp;The ResourceLoader</h2></div></div></div>

<p>The <code class="literal">ResourceLoader</code> interface is meant to be implemented by objects that can return
(i.e. load) <code class="literal">Resource</code> instances.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ResourceLoader {

    Resource getResource(String location);

}</pre>
<p>All application contexts implement the <code class="literal">ResourceLoader</code> interface, and therefore all
application contexts may be used to obtain <code class="literal">Resource</code> instances.</p>
<p>When you call <code class="literal">getResource()</code> on a specific application context, and the location path
specified doesn’t have a specific prefix, you will get back a <code class="literal">Resource</code> type that is
appropriate to that particular application context. For example, assume the following
snippet of code was executed against a <code class="literal">ClassPathXmlApplicationContext</code> instance:</p>
<pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">"some/resource/path/myTemplate.txt"</span>);</pre>
<p>What would be returned would be a <code class="literal">ClassPathResource</code>; if the same method was executed
against a <code class="literal">FileSystemXmlApplicationContext</code> instance, you’d get back a
<code class="literal">FileSystemResource</code>. For a <code class="literal">WebApplicationContext</code>, you’d get back a
<code class="literal">ServletContextResource</code>, and so on.</p>
<p>As such, you can load resources in a fashion appropriate to the particular application
context.</p>
<p>On the other hand, you may also force <code class="literal">ClassPathResource</code> to be used, regardless of the
application context type, by specifying the special <code class="literal">classpath:</code> prefix:</p>
<pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">"classpath:some/resource/path/myTemplate.txt"</span>);</pre>
<p>Similarly, one can force a <code class="literal">UrlResource</code> to be used by specifying any of the standard
<code class="literal">java.net.URL</code> prefixes:</p>
<pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">"file:///some/resource/path/myTemplate.txt"</span>);</pre>
<pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">"http://myhost.com/resource/path/myTemplate.txt"</span>);</pre>
<p>The following table summarizes the strategy for converting <code class="literal">String</code>s to <code class="literal">Resource</code>s:</p>
<div class="table"><a name="resources-resource-strings" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-resource-strings"></a><p class="title"><b>Table&nbsp;8.1.&nbsp;Resource strings</b></p><div class="table-contents">

<table summary="Resource strings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Prefix</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Example</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>classpath:</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">classpath:com/myapp/config.xml</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Loaded from the classpath.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>file:</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal"><a class="ulink" href="file:///data/config.xml" target="_top">file:///data/config.xml</a></code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Loaded as a <code class="literal">URL</code>, from the filesystem. <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#ftn.d5e6035" class="footnote" name="d5e6035"><sup class="footnote">[1]</sup></a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>http:</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal"><a class="ulink" href="http://myserver/logo.png" target="_top">http://myserver/logo.png</a></code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Loaded as a <code class="literal">URL</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>(none)</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">/data/config.xml</code></p></td><td style="" align="left" valign="top"><p>Depends on the underlying <code class="literal">ApplicationContext</code>.</p></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div id="ftn.d5e6035" class="footnote"><p><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#d5e6035" class="simpara"><sup class="simpara">[1] </sup></a>But see also   <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-filesystemresource-caveats" title="8.7.3 FileSystemResource caveats">Section&nbsp;8.7.3, “FileSystemResource caveats”</a>.</p></div></td></tr></tbody></table>
</div></div><br class="table-break">
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-resourceloaderaware" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-resourceloaderaware"></a>8.5&nbsp;The ResourceLoaderAware interface</h2></div></div></div>

<p>The <code class="literal">ResourceLoaderAware</code> interface is a special marker interface, identifying objects
that expect to be provided with a <code class="literal">ResourceLoader</code> reference.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ResourceLoaderAware {

    <span class="hl-keyword">void</span> setResourceLoader(ResourceLoader resourceLoader);
}</pre>
<p>When a class implements <code class="literal">ResourceLoaderAware</code> and is deployed into an application
context (as a Spring-managed bean), it is recognized as <code class="literal">ResourceLoaderAware</code> by the
application context. The application context will then invoke the
<code class="literal">setResourceLoader(ResourceLoader)</code>, supplying itself as the argument (remember, all
application contexts in Spring implement the <code class="literal">ResourceLoader</code> interface).</p>
<p>Of course, since an <code class="literal">ApplicationContext</code> is a <code class="literal">ResourceLoader</code>, the bean could also
implement the <code class="literal">ApplicationContextAware</code> interface and use the supplied application
context directly to load resources, but in general, it’s better to use the specialized
<code class="literal">ResourceLoader</code> interface if that’s all that’s needed. The code would just be coupled
to the resource loading interface, which can be considered a utility interface, and not
the whole Spring <code class="literal">ApplicationContext</code> interface.</p>
<p>As of Spring 2.5, you can rely upon autowiring of the <code class="literal">ResourceLoader</code> as an alternative
to implementing the <code class="literal">ResourceLoaderAware</code> interface. The "traditional" <code class="literal">constructor</code> and
<code class="literal">byType</code> autowiring modes (as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="7.4.5 Autowiring collaborators">Section&nbsp;7.4.5, “Autowiring collaborators”</a>) are now capable
of providing a dependency of type <code class="literal">ResourceLoader</code> for either a constructor argument or
setter method parameter respectively. For more flexibility (including the ability to
autowire fields and multiple parameter methods), consider using the new annotation-based
autowiring features. In that case, the <code class="literal">ResourceLoader</code> will be autowired into a field,
constructor argument, or method parameter that is expecting the <code class="literal">ResourceLoader</code> type as
long as the field, constructor, or method in question carries the <code class="literal">@Autowired</code>
annotation. For more information, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-autowired-annotation" title="7.9.2 @Autowired">Section&nbsp;7.9.2, “@Autowired”</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-as-dependencies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-as-dependencies"></a>8.6&nbsp;Resources as dependencies</h2></div></div></div>

<p>If the bean itself is going to determine and supply the resource path through some sort
of dynamic process, it probably makes sense for the bean to use the <code class="literal">ResourceLoader</code>
interface to load resources. Consider as an example the loading of a template of some
sort, where the specific resource that is needed depends on the role of the user. If the
resources are static, it makes sense to eliminate the use of the <code class="literal">ResourceLoader</code>
interface completely, and just have the bean expose the <code class="literal">Resource</code> properties it needs,
and expect that they will be injected into it.</p>
<p>What makes it trivial to then inject these properties, is that all application contexts
register and use a special JavaBeans <code class="literal">PropertyEditor</code> which can convert <code class="literal">String</code> paths
to <code class="literal">Resource</code> objects. So if <code class="literal">myBean</code> has a template property of type <code class="literal">Resource</code>, it can
be configured with a simple string for that resource, as follows:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"template"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"some/resource/path/myTemplate.txt"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Note that the resource path has no prefix, so because the application context itself is
going to be used as the <code class="literal">ResourceLoader</code>, the resource itself will be loaded via a
<code class="literal">ClassPathResource</code>, <code class="literal">FileSystemResource</code>, or <code class="literal">ServletContextResource</code> (as appropriate)
depending on the exact type of the context.</p>
<p>If there is a need to force a specific <code class="literal">Resource</code> type to be used, then a prefix may be
used. The following two examples show how to force a <code class="literal">ClassPathResource</code> and a
<code class="literal">UrlResource</code> (the latter being used to access a filesystem file).</p>
<pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"template"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"classpath:some/resource/path/myTemplate.txt"</span><span class="hl-tag">&gt;</span></pre>
<pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"template"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"file:///some/resource/path/myTemplate.txt"</span><span class="hl-tag">/&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="resources-app-ctx" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx"></a>8.7&nbsp;Application contexts and Resource paths</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="resources-app-ctx-construction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx-construction"></a>8.7.1&nbsp;Constructing application contexts</h3></div></div></div>

<p>An application context constructor (for a specific application context type) generally
takes a string or array of strings as the location path(s) of the resource(s) such as
XML files that make up the definition of the context.</p>
<p>When such a location path doesn’t have a prefix, the specific <code class="literal">Resource</code> type built from
that path and used to load the bean definitions, depends on and is appropriate to the
specific application context. For example, if you create a
<code class="literal">ClassPathXmlApplicationContext</code> as follows:</p>
<pre class="programlisting">ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"conf/appContext.xml"</span>);</pre>
<p>The bean definitions will be loaded from the classpath, as a <code class="literal">ClassPathResource</code> will be
used. But if you create a <code class="literal">FileSystemXmlApplicationContext</code> as follows:</p>
<pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"conf/appContext.xml"</span>);</pre>
<p>The bean definition will be loaded from a filesystem location, in this case relative to
the current working directory.</p>
<p>Note that the use of the special classpath prefix or a standard URL prefix on the
location path will override the default type of <code class="literal">Resource</code> created to load the
definition. So this <code class="literal">FileSystemXmlApplicationContext</code>…&#8203;</p>
<pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"classpath:conf/appContext.xml"</span>);</pre>
<div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
will actually load its bean definitions from the classpath. However, it is still a
<code class="literal">FileSystemXmlApplicationContext</code>. If it is subsequently used as a <code class="literal">ResourceLoader</code>, any
unprefixed paths will still be treated as filesystem paths.
</li></ol></div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="resources-app-ctx-classpathxml" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx-classpathxml"></a>Constructing ClassPathXmlApplicationContext instances - shortcuts</h4></div></div></div>

<p>The <code class="literal">ClassPathXmlApplicationContext</code> exposes a number of constructors to enable
convenient instantiation. The basic idea is that one supplies merely a string array
containing just the filenames of the XML files themselves (without the leading path
information), and one <span class="emphasis"><em>also</em></span> supplies a <code class="literal">Class</code>; the <code class="literal">ClassPathXmlApplicationContext</code>
will derive the path information from the supplied class.</p>
<p>An example will hopefully make this clear. Consider a directory layout that looks like
this:</p>
<pre class="literallayout">com/
  foo/
	services.xml
	daos.xml
    MessengerService.class</pre>
<p>A <code class="literal">ClassPathXmlApplicationContext</code> instance composed of the beans defined in the
<code class="literal">'services.xml'</code> and <code class="literal">'daos.xml'</code> could be instantiated like so…&#8203;</p>
<pre class="programlisting">ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(
    <span class="hl-keyword">new</span> String[] {<span class="hl-string">"services.xml"</span>, <span class="hl-string">"daos.xml"</span>}, MessengerService.<span class="hl-keyword">class</span>);</pre>
<p>Please do consult the <code class="literal">ClassPathXmlApplicationContext</code> javadocs for details
on the various constructors.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="resources-app-ctx-wildcards-in-resource-paths" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx-wildcards-in-resource-paths"></a>8.7.2&nbsp;Wildcards in application context constructor resource paths</h3></div></div></div>

<p>The resource paths in application context constructor values may be a simple path (as
shown above) which has a one-to-one mapping to a target Resource, or alternately may
contain the special "classpath*:" prefix and/or internal Ant-style regular expressions
(matched using Spring’s <code class="literal">PathMatcher</code> utility). Both of the latter are effectively
wildcards</p>
<p>One use for this mechanism is when doing component-style application assembly. All
components can 'publish' context definition fragments to a well-known location path, and
when the final application context is created using the same path prefixed via
<code class="literal">classpath*:</code>, all component fragments will be picked up automatically.</p>
<p>Note that this wildcarding is specific to use of resource paths in application context
constructors (or when using the <code class="literal">PathMatcher</code> utility class hierarchy directly), and is
resolved at construction time. It has nothing to do with the <code class="literal">Resource</code> type itself.
It’s not possible to use the <code class="literal">classpath*:</code> prefix to construct an actual <code class="literal">Resource</code>, as
a resource points to just one resource at a time.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="resources-app-ctx-ant-patterns-in-paths" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx-ant-patterns-in-paths"></a>Ant-style Patterns</h4></div></div></div>

<p>When the path location contains an Ant-style pattern, for example:</p>
<pre class="literallayout">/WEB-INF/*-context.xml
  com/mycompany/**/applicationContext.xml
  file:C:/some/path/*-context.xml
  classpath:com/mycompany/**/applicationContext.xml</pre>
<p>The resolver follows a more complex but defined procedure to try to resolve the
wildcard. It produces a Resource for the path up to the last non-wildcard segment and
obtains a URL from it. If this URL is not a <code class="literal">jar:</code> URL or container-specific variant
(e.g. <code class="literal">zip:</code> in WebLogic, <code class="literal">wsjar</code> in WebSphere, etc.), then a <code class="literal">java.io.File</code> is
obtained from it and used to resolve the wildcard by traversing the filesystem. In the
case of a jar URL, the resolver either gets a <code class="literal">java.net.JarURLConnection</code> from it or
manually parses the jar URL and then traverses the contents of the jar file to resolve
the wildcards.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="resources-app-ctx-portability" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-app-ctx-portability"></a>Implications on portability</h5></div></div></div>

<p>If the specified path is already a file URL (either explicitly, or implicitly because
the base <code class="literal">ResourceLoader</code> is a filesystem one, then wildcarding is guaranteed to work in
a completely portable fashion.</p>
<p>If the specified path is a classpath location, then the resolver must obtain the last
non-wildcard path segment URL via a <code class="literal">Classloader.getResource()</code> call. Since this is just
a node of the path (not the file at the end) it is actually undefined (in the
<code class="literal">ClassLoader</code> javadocs) exactly what sort of a URL is returned in this case. In
practice, it is always a <code class="literal">java.io.File</code> representing the directory, where the classpath
resource resolves to a filesystem location, or a jar URL of some sort, where the
classpath resource resolves to a jar location. Still, there is a portability concern on
this operation.</p>
<p>If a jar URL is obtained for the last non-wildcard segment, the resolver must be able to
get a <code class="literal">java.net.JarURLConnection</code> from it, or manually parse the jar URL, to be able to
walk the contents of the jar, and resolve the wildcard. This will work in most
environments, but will fail in others, and it is strongly recommended that the wildcard
resolution of resources coming from jars be thoroughly tested in your specific
environment before you rely on it.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="resources-classpath-wildcards" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-classpath-wildcards"></a>The Classpath*: portability classpath*: prefix</h4></div></div></div>

<p>When constructing an XML-based application context, a location string may use the
special <code class="literal">classpath*:</code> prefix:</p>
<pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"classpath*:conf/appContext.xml"</span>);</pre>
<p>This special prefix specifies that all classpath resources that match the given name
must be obtained (internally, this essentially happens via a
<code class="literal">ClassLoader.getResources(…&#8203;)</code> call), and then merged to form the final application
context definition.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The wildcard classpath relies on the <code class="literal">getResources()</code> method of the underlying
classloader. As most application servers nowadays supply their own classloader
implementation, the behavior might differ especially when dealing with jar files. A
simple test to check if <code class="literal">classpath*</code> works is to use the classloader to load a file from
within a jar on the classpath:
<code class="literal">getClass().getClassLoader().getResources("&lt;someFileInsideTheJar&gt;")</code>. Try this test with
files that have the same name but are placed inside two different locations. In case an
inappropriate result is returned, check the application server documentation for
settings that might affect the classloader behavior.</p>
</td></tr></tbody></table></div>
<p>The <code class="literal">classpath*:</code> prefix can also be combined with a <code class="literal">PathMatcher</code> pattern in the
rest of the location path, for example <code class="literal">classpath*:META-INF/*-beans.xml</code>. In this
case, the resolution strategy is fairly simple: a <code class="literal">ClassLoader.getResources()</code> call is
used on the last non-wildcard path segment to get all the matching resources in the
class loader hierarchy, and then off each resource the same PathMatcher resolution
strategy described above is used for the wildcard subpath.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="resources-wildcards-in-path-other-stuff" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-wildcards-in-path-other-stuff"></a>Other notes relating to wildcards</h4></div></div></div>

<p>Please note that <code class="literal">classpath*:</code> when combined with Ant-style patterns will only work
reliably with at least one root directory before the pattern starts, unless the actual
target files reside in the file system. This means that a pattern like
<code class="literal">classpath*:*.xml</code> will not retrieve files from the root of jar files but rather only
from the root of expanded directories. This originates from a limitation in the JDK’s
<code class="literal">ClassLoader.getResources()</code> method which only returns file system locations for a
passed-in empty string (indicating potential roots to search).</p>
<p>Ant-style patterns with <code class="literal">classpath:</code> resources are not guaranteed to find matching
resources if the root package to search is available in multiple class path locations.
This is because a resource such as</p>
<pre class="literallayout">com/mycompany/package1/service-context.xml</pre>
<p>may be in only one location, but when a path such as</p>
<pre class="literallayout">classpath:com/mycompany/**/service-context.xml</pre>
<p>is used to try to resolve it, the resolver will work off the (first) URL returned by
<code class="literal">getResource("com/mycompany")</code>;. If this base package node exists in multiple
classloader locations, the actual end resource may not be underneath. Therefore,
preferably, use " `classpath*:`" with the same Ant-style pattern in such a case, which
will search all class path locations that contain the root package.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="resources-filesystemresource-caveats" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#resources-filesystemresource-caveats"></a>8.7.3&nbsp;FileSystemResource caveats</h3></div></div></div>

<p>A <code class="literal">FileSystemResource</code> that is not attached to a <code class="literal">FileSystemApplicationContext</code> (that
is, a <code class="literal">FileSystemApplicationContext</code> is not the actual <code class="literal">ResourceLoader</code>) will treat
absolute vs. relative paths as you would expect. Relative paths are relative to the
current working directory, while absolute paths are relative to the root of the
filesystem.</p>
<p>For backwards compatibility (historical) reasons however, this changes when the
<code class="literal">FileSystemApplicationContext</code> is the <code class="literal">ResourceLoader</code>. The
<code class="literal">FileSystemApplicationContext</code> simply forces all attached <code class="literal">FileSystemResource</code> instances
to treat all location paths as relative, whether they start with a leading slash or not.
In practice, this means the following are equivalent:</p>
<pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"conf/context.xml"</span>);</pre>
<pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"/conf/context.xml"</span>);</pre>
<p>As are the following: (Even though it would make sense for them to be different, as one
case is relative and the other absolute.)</p>
<pre class="programlisting">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource(<span class="hl-string">"some/resource/path/myTemplate.txt"</span>);</pre>
<pre class="programlisting">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource(<span class="hl-string">"/some/resource/path/myTemplate.txt"</span>);</pre>
<p>In practice, if true absolute filesystem paths are needed, it is better to forgo the use
of absolute paths with <code class="literal">FileSystemResource</code> / <code class="literal">FileSystemXmlApplicationContext</code>, and
just force the use of a <code class="literal">UrlResource</code>, by using the <code class="literal">file:</code> URL prefix.</p>
<pre class="programlisting"><span class="hl-comment">// actual context type doesn't matter, the Resource will always be UrlResource</span>
ctx.getResource(<span class="hl-string">"file:///some/resource/path/myTemplate.txt"</span>);</pre>
<pre class="programlisting"><span class="hl-comment">// force this FileSystemXmlApplicationContext to load its definition via a UrlResource</span>
ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">"file:///conf/context.xml"</span>);</pre>
</div>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="validation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation"></a>9.&nbsp;Validation, Data Binding, and Type Conversion</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-introduction"></a>9.1&nbsp;Introduction</h2></div></div></div>

<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>JSR-303/JSR-349 Bean Validation</b></p></div></div></div>

<p>Spring Framework 4.0 supports Bean Validation 1.0 (JSR-303) and Bean Validation 1.1
(JSR-349) in terms of setup support, also adapting it to Spring’s <code class="literal">Validator</code> interface.</p>
<p>An application can choose to enable Bean Validation once globally, as described in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation" title="9.8 Spring Validation">Section&nbsp;9.8, “Spring Validation”</a>, and use it exclusively for all validation needs.</p>
<p>An application can also register additional Spring <code class="literal">Validator</code> instances per
<code class="literal">DataBinder</code> instance, as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-binder" title="9.8.3 Configuring a DataBinder">Section&nbsp;9.8.3, “Configuring a DataBinder”</a>. This may be useful for
plugging in validation logic without the use of annotations.</p>
</div>
<p>There are pros and cons for considering validation as business logic, and Spring offers
a design for validation (and data binding) that does not exclude either one of them.
Specifically validation should not be tied to the web tier, should be easy to localize
and it should be possible to plug in any validator available. Considering the above,
Spring has come up with a <code class="literal">Validator</code> interface that is both basic and eminently usable
in every layer of an application.</p>
<p>Data binding is useful for allowing user input to be dynamically bound to the domain
model of an application (or whatever objects you use to process user input). Spring
provides the so-called <code class="literal">DataBinder</code> to do exactly that. The <code class="literal">Validator</code> and the
<code class="literal">DataBinder</code> make up the <code class="literal">validation</code> package, which is primarily used in but not
limited to the MVC framework.</p>
<p>The <code class="literal">BeanWrapper</code> is a fundamental concept in the Spring Framework and is used in a lot
of places. However, you probably will not have the need to use the <code class="literal">BeanWrapper</code>
directly. Because this is reference documentation however, we felt that some explanation
might be in order. We will explain the <code class="literal">BeanWrapper</code> in this chapter since, if you were
going to use it at all, you would most likely do so when trying to bind data to objects.</p>
<p>Spring’s DataBinder and the lower-level BeanWrapper both use PropertyEditors to parse
and format property values. The <code class="literal">PropertyEditor</code> concept is part of the JavaBeans
specification, and is also explained in this chapter. Spring 3 introduces a
"core.convert" package that provides a general type conversion facility, as well as a
higher-level "format" package for formatting UI field values. These new packages may be
used as simpler alternatives to PropertyEditors, and will also be discussed in this
chapter.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validator" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validator"></a>9.2&nbsp;Validation using Spring’s Validator interface</h2></div></div></div>

<p>Spring features a <code class="literal">Validator</code> interface that you can use to validate objects. The
<code class="literal">Validator</code> interface works using an <code class="literal">Errors</code> object so that while validating,
validators can report validation failures to the <code class="literal">Errors</code> object.</p>
<p>Let’s consider a small data object:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Person {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;

    <span class="hl-comment">// the usual getters and setters...</span>
}</pre>
<p>We’re going to provide validation behavior for the <code class="literal">Person</code> class by implementing the
following two methods of the <code class="literal">org.springframework.validation.Validator</code> interface:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">supports(Class)</code> - Can this <code class="literal">Validator</code> validate instances of the supplied <code class="literal">Class</code>?
</li><li class="listitem">
<code class="literal">validate(Object, org.springframework.validation.Errors)</code> - validates the given object
and in case of validation errors, registers those with the given <code class="literal">Errors</code> object
</li></ul></div>
<p>Implementing a <code class="literal">Validator</code> is fairly straightforward, especially when you know of the
<code class="literal">ValidationUtils</code> helper class that the Spring Framework also provides.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonValidator <span class="hl-keyword">implements</span> Validator {

    <strong class="hl-tag" style="color: blue">/**
     * This Validator validates *just* Person instances
     */</strong>
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> supports(Class clazz) {
        <span class="hl-keyword">return</span> Person.<span class="hl-keyword">class</span>.equals(clazz);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Object obj, Errors e) {
        ValidationUtils.rejectIfEmpty(e, <span class="hl-string">"name"</span>, <span class="hl-string">"name.empty"</span>);
        Person p = (Person) obj;
        <span class="hl-keyword">if</span> (p.getAge() &lt; <span class="hl-number">0</span>) {
            e.rejectValue(<span class="hl-string">"age"</span>, <span class="hl-string">"negativevalue"</span>);
        } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (p.getAge() &gt; <span class="hl-number">110</span>) {
            e.rejectValue(<span class="hl-string">"age"</span>, <span class="hl-string">"too.darn.old"</span>);
        }
    }
}</pre>
<p>As you can see, the <code class="literal">static</code> <code class="literal">rejectIfEmpty(..)</code> method on the <code class="literal">ValidationUtils</code> class
is used to reject the <code class="literal">'name'</code> property if it is <code class="literal">null</code> or the empty string. Have a look
at the <code class="literal">ValidationUtils</code> javadocs to see what functionality it provides besides the
example shown previously.</p>
<p>While it is certainly possible to implement a single <code class="literal">Validator</code> class to validate each
of the nested objects in a rich object, it may be better to encapsulate the validation
logic for each nested class of object in its own <code class="literal">Validator</code> implementation. A simple
example of a <span class="emphasis"><em>'rich'</em></span> object would be a <code class="literal">Customer</code> that is composed of two <code class="literal">String</code>
properties (a first and second name) and a complex <code class="literal">Address</code> object. <code class="literal">Address</code> objects
may be used independently of <code class="literal">Customer</code> objects, and so a distinct <code class="literal">AddressValidator</code>
has been implemented. If you want your <code class="literal">CustomerValidator</code> to reuse the logic contained
within the <code class="literal">AddressValidator</code> class without resorting to copy-and-paste, you can
dependency-inject or instantiate an <code class="literal">AddressValidator</code> within your <code class="literal">CustomerValidator</code>,
and use it like so:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomerValidator <span class="hl-keyword">implements</span> Validator {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> Validator addressValidator;

    <span class="hl-keyword">public</span> CustomerValidator(Validator addressValidator) {
        <span class="hl-keyword">if</span> (addressValidator == null) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalArgumentException(<span class="hl-string">"The supplied [Validator] is "</span> +
                <span class="hl-string">"required and must not be null."</span>);
        }
        <span class="hl-keyword">if</span> (!addressValidator.supports(Address.<span class="hl-keyword">class</span>)) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalArgumentException(<span class="hl-string">"The supplied [Validator] must "</span> +
                <span class="hl-string">"support the validation of [Address] instances."</span>);
        }
        <span class="hl-keyword">this</span>.addressValidator = addressValidator;
    }

    <strong class="hl-tag" style="color: blue">/**
     * This Validator validates Customer instances, and any subclasses of Customer too
     */</strong>
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> supports(Class clazz) {
        <span class="hl-keyword">return</span> Customer.<span class="hl-keyword">class</span>.isAssignableFrom(clazz);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Object target, Errors errors) {
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">"firstName"</span>, <span class="hl-string">"field.required"</span>);
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">"surname"</span>, <span class="hl-string">"field.required"</span>);
        Customer customer = (Customer) target;
        <span class="hl-keyword">try</span> {
            errors.pushNestedPath(<span class="hl-string">"address"</span>);
            ValidationUtils.invokeValidator(<span class="hl-keyword">this</span>.addressValidator, customer.getAddress(), errors);
        } <span class="hl-keyword">finally</span> {
            errors.popNestedPath();
        }
    }
}</pre>
<p>Validation errors are reported to the <code class="literal">Errors</code> object passed to the validator. In case
of Spring Web MVC you can use <code class="literal">&lt;spring:bind/&gt;</code> tag to inspect the error messages, but of
course you can also inspect the errors object yourself. More information about the
methods it offers can be found in the javadocs.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-conversion" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-conversion"></a>9.3&nbsp;Resolving codes to error messages</h2></div></div></div>

<p>We’ve talked about databinding and validation. Outputting messages corresponding to
validation errors is the last thing we need to discuss. In the example we’ve shown
above, we rejected the <code class="literal">name</code> and the <code class="literal">age</code> field. If we’re going to output the error
messages by using a <code class="literal">MessageSource</code>, we will do so using the error code we’ve given when
rejecting the field ('name' and 'age' in this case). When you call (either directly, or
indirectly, using for example the <code class="literal">ValidationUtils</code> class) <code class="literal">rejectValue</code> or one of the
other <code class="literal">reject</code> methods from the <code class="literal">Errors</code> interface, the underlying implementation will
not only register the code you’ve passed in, but also a number of additional error
codes. What error codes it registers is determined by the <code class="literal">MessageCodesResolver</code> that is
used. By default, the <code class="literal">DefaultMessageCodesResolver</code> is used, which for example not only
registers a message with the code you gave, but also messages that include the field
name you passed to the reject method. So in case you reject a field using
<code class="literal">rejectValue("age", "too.darn.old")</code>, apart from the <code class="literal">too.darn.old</code> code, Spring will
also register <code class="literal">too.darn.old.age</code> and <code class="literal">too.darn.old.age.int</code> (so the first will include
the field name and the second will include the type of the field); this is done as a
convenience to aid developers in targeting error messages and suchlike.</p>
<p>More information on the <code class="literal">MessageCodesResolver</code> and the default strategy can be found
online in the javadocs of
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/validation/MessageCodesResolver.html" target="_top"><code class="literal">MessageCodesResolver</code></a>
and
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.html" target="_top"><code class="literal">DefaultMessageCodesResolver</code></a>,
respectively.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="beans-beans" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans"></a>9.4&nbsp;Bean manipulation and the BeanWrapper</h2></div></div></div>

<p>The <code class="literal">org.springframework.beans</code> package adheres to the JavaBeans standard provided by
Oracle. A JavaBean is simply a class with a default no-argument constructor, which follows
a naming convention where (by way of an example) a property named <code class="literal">bingoMadness</code> would
have a setter method <code class="literal">setBingoMadness(..)</code> and a getter method <code class="literal">getBingoMadness()</code>. For
more information about JavaBeans and the specification, please refer to Oracle’s website (
<a class="ulink" href="https://docs.oracle.com/javase/6/docs/api/java/beans/package-summary.html" target="_top">javabeans</a>).</p>
<p>One quite important class in the beans package is the <code class="literal">BeanWrapper</code> interface and its
corresponding implementation ( <code class="literal">BeanWrapperImpl</code>). As quoted from the javadocs, the
<code class="literal">BeanWrapper</code> offers functionality to set and get property values (individually or in
bulk), get property descriptors, and to query properties to determine if they are
readable or writable. Also, the <code class="literal">BeanWrapper</code> offers support for nested properties,
enabling the setting of properties on sub-properties to an unlimited depth. Then, the
<code class="literal">BeanWrapper</code> supports the ability to add standard JavaBeans <code class="literal">PropertyChangeListeners</code>
and <code class="literal">VetoableChangeListeners</code>, without the need for supporting code in the target class.
Last but not least, the <code class="literal">BeanWrapper</code> provides support for the setting of indexed
properties. The <code class="literal">BeanWrapper</code> usually isn’t used by application code directly, but by
the <code class="literal">DataBinder</code> and the <code class="literal">BeanFactory</code>.</p>
<p>The way the <code class="literal">BeanWrapper</code> works is partly indicated by its name: <span class="emphasis"><em>it wraps a bean</em></span> to
perform actions on that bean, like setting and retrieving properties.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-beans-conventions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conventions"></a>9.4.1&nbsp;Setting and getting basic and nested properties</h3></div></div></div>

<p>Setting and getting properties is done using the <code class="literal">setPropertyValue(s)</code> and
<code class="literal">getPropertyValue(s)</code> methods that both come with a couple of overloaded variants.
They’re all described in more detail in the javadocs Spring comes with. What’s important
to know is that there are a couple of conventions for indicating properties of an
object. A couple of examples:</p>
<div class="table"><a name="beans-beans-conventions-properties-tbl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conventions-properties-tbl"></a><p class="title"><b>Table&nbsp;9.1.&nbsp;Examples of properties</b></p><div class="table-contents">

<table summary="Examples of properties" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Expression</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">name</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Indicates the property <code class="literal">name</code> corresponding to the methods <code class="literal">getName()</code> or <code class="literal">isName()</code>
  and <code class="literal">setName(..)</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">account.name</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Indicates the nested property <code class="literal">name</code> of the property <code class="literal">account</code> corresponding e.g. to
  the methods <code class="literal">getAccount().setName()</code> or <code class="literal">getAccount().getName()</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">account[2]</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Indicates the <span class="emphasis"><em>third</em></span> element of the indexed property <code class="literal">account</code>. Indexed properties
  can be of type <code class="literal">array</code>, <code class="literal">list</code> or other <span class="emphasis"><em>naturally ordered</em></span> collection</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">account[COMPANYNAME]</code></p></td><td style="" align="left" valign="top"><p>Indicates the value of the map entry indexed by the key <span class="emphasis"><em>COMPANYNAME</em></span> of the Map
  property <code class="literal">account</code></p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>Below you’ll find some examples of working with the <code class="literal">BeanWrapper</code> to get and set
properties.</p>
<p><span class="emphasis"><em>(This next section is not vitally important to you if you’re not planning to work with
the <code class="literal">BeanWrapper</code> directly. If you’re just using the <code class="literal">DataBinder</code> and the <code class="literal">BeanFactory</code>
and their out-of-the-box implementation, you should skip ahead to the section about
<code class="literal">PropertyEditors</code>.)</em></span></p>
<p>Consider the following two classes:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Company {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> Employee managingDirector;

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> Employee getManagingDirector() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.managingDirector;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setManagingDirector(Employee managingDirector) {
        <span class="hl-keyword">this</span>.managingDirector = managingDirector;
    }
}</pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Employee {

    <span class="hl-keyword">private</span> String name;

    <span class="hl-keyword">private</span> <span class="hl-keyword">float</span> salary;

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">float</span> getSalary() {
        <span class="hl-keyword">return</span> salary;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSalary(<span class="hl-keyword">float</span> salary) {
        <span class="hl-keyword">this</span>.salary = salary;
    }
}</pre>
<p>The following code snippets show some examples of how to retrieve and manipulate some of
the properties of instantiated <code class="literal">Companies</code> and <code class="literal">Employees</code>:</p>
<pre class="programlisting">BeanWrapper company = <span class="hl-keyword">new</span> BeanWrapperImpl(<span class="hl-keyword">new</span> Company());
<span class="hl-comment">// setting the company name..</span>
company.setPropertyValue(<span class="hl-string">"name"</span>, <span class="hl-string">"Some Company Inc."</span>);
<span class="hl-comment">// ... can also be done like this:</span>
PropertyValue value = <span class="hl-keyword">new</span> PropertyValue(<span class="hl-string">"name"</span>, <span class="hl-string">"Some Company Inc."</span>);
company.setPropertyValue(value);

<span class="hl-comment">// ok, let's create the director and tie it to the company:</span>
BeanWrapper jim = <span class="hl-keyword">new</span> BeanWrapperImpl(<span class="hl-keyword">new</span> Employee());
jim.setPropertyValue(<span class="hl-string">"name"</span>, <span class="hl-string">"Jim Stravinsky"</span>);
company.setPropertyValue(<span class="hl-string">"managingDirector"</span>, jim.getWrappedInstance());

<span class="hl-comment">// retrieving the salary of the managingDirector through the company</span>
Float salary = (Float) company.getPropertyValue(<span class="hl-string">"managingDirector.salary"</span>);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="beans-beans-conversion" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conversion"></a>9.4.2&nbsp;Built-in PropertyEditor implementations</h3></div></div></div>

<p>Spring uses the concept of <code class="literal">PropertyEditors</code> to effect the conversion between an
<code class="literal">Object</code> and a <code class="literal">String</code>. If you think about it, it sometimes might be handy to be able
to represent properties in a different way than the object itself. For example, a <code class="literal">Date</code>
can be represented in a human readable way (as the <code class="literal">String</code> <code class="literal">'2007-14-09'</code>), while
we’re still able to convert the human readable form back to the original date (or even
better: convert any date entered in a human readable form, back to <code class="literal">Date</code> objects). This
behavior can be achieved by <span class="emphasis"><em>registering custom editors</em></span>, of type
<code class="literal">java.beans.PropertyEditor</code>. Registering custom editors on a <code class="literal">BeanWrapper</code> or
alternately in a specific IoC container as mentioned in the previous chapter, gives it
the knowledge of how to convert properties to the desired type. Read more about
<code class="literal">PropertyEditors</code> in the javadocs of the <code class="literal">java.beans</code> package provided by Oracle.</p>
<p>A couple of examples where property editing is used in Spring:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>setting properties on beans</em></span> is done using <code class="literal">PropertyEditors</code>. When mentioning
<code class="literal">java.lang.String</code> as the value of a property of some bean you’re declaring in XML
file, Spring will (if the setter of the corresponding property has a
<code class="literal">Class</code>-parameter) use the <code class="literal">ClassEditor</code> to try to resolve the parameter to a <code class="literal">Class</code>
object.
</li><li class="listitem">
<span class="emphasis"><em>parsing HTTP request parameters</em></span> in Spring’s MVC framework is done using all kinds
of <code class="literal">PropertyEditors</code> that you can manually bind in all subclasses of the
<code class="literal">CommandController</code>.
</li></ul></div>
<p>Spring has a number of built-in <code class="literal">PropertyEditors</code> to make life easy. Each of those is
listed below and they are all located in the <code class="literal">org.springframework.beans.propertyeditors</code>
package. Most, but not all (as indicated below), are registered by default by
<code class="literal">BeanWrapperImpl</code>. Where the property editor is configurable in some fashion, you can of
course still register your own variant to override the default one:</p>
<div class="table"><a name="beans-beans-property-editors-tbl" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-property-editors-tbl"></a><p class="title"><b>Table&nbsp;9.2.&nbsp;Built-in PropertyEditors</b></p><div class="table-contents">

<table summary="Built-in PropertyEditors" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Class</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ByteArrayPropertyEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Editor for byte arrays. Strings will simply be converted to their corresponding byte
  representations. Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ClassEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Parses Strings representing classes to actual classes and the other way around. When a
  class is not found, an <code class="literal">IllegalArgumentException</code> is thrown. Registered by default by
  <code class="literal">BeanWrapperImpl</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CustomBooleanEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Customizable property editor for <code class="literal">Boolean</code> properties. Registered by default by
  <code class="literal">BeanWrapperImpl</code>, but, can be overridden by registering custom instance of it as
  custom editor.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CustomCollectionEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Property editor for Collections, converting any source <code class="literal">Collection</code> to a given target
  <code class="literal">Collection</code> type.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CustomDateEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Customizable property editor for java.util.Date, supporting a custom DateFormat. NOT
  registered by default. Must be user registered as needed with appropriate format.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CustomNumberEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Customizable property editor for any Number subclass like <code class="literal">Integer</code>, <code class="literal">Long</code>, <code class="literal">Float</code>,
  <code class="literal">Double</code>. Registered by default by <code class="literal">BeanWrapperImpl</code>, but can be overridden by
  registering custom instance of it as a custom editor.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">FileEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Capable of resolving Strings to <code class="literal">java.io.File</code> objects. Registered by default by
  <code class="literal">BeanWrapperImpl</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">InputStreamEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>One-way property editor, capable of taking a text string and producing (via an
  intermediate <code class="literal">ResourceEditor</code> and <code class="literal">Resource</code>) an <code class="literal">InputStream</code>, so <code class="literal">InputStream</code>
  properties may be directly set as Strings. Note that the default usage will not close
  the <code class="literal">InputStream</code> for you! Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">LocaleEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Capable of resolving Strings to <code class="literal">Locale</code> objects and vice versa (the String format is
  <span class="emphasis"><em><span class="language">[country]</span></em></span>[variant], which is the same thing the toString() method of
  Locale provides). Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PatternEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Capable of resolving Strings to <code class="literal">java.util.regex.Pattern</code> objects and vice versa.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PropertiesEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Capable of converting Strings (formatted using the format as defined in the javadocs
  of the <code class="literal">java.util.Properties</code> class) to <code class="literal">Properties</code> objects. Registered by default
  by <code class="literal">BeanWrapperImpl</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">StringTrimmerEditor</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Property editor that trims Strings. Optionally allows transforming an empty string
  into a <code class="literal">null</code> value. NOT registered by default; must be user registered as needed.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">URLEditor</code></p></td><td style="" align="left" valign="top"><p>Capable of resolving a String representation of a URL to an actual <code class="literal">URL</code> object.
  Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>Spring uses the <code class="literal">java.beans.PropertyEditorManager</code> to set the search path for property
editors that might be needed. The search path also includes <code class="literal">sun.bean.editors</code>, which
includes <code class="literal">PropertyEditor</code> implementations for types such as <code class="literal">Font</code>, <code class="literal">Color</code>, and most of
the primitive types. Note also that the standard JavaBeans infrastructure will
automatically discover <code class="literal">PropertyEditor</code> classes (without you having to register them
explicitly) if they are in the same package as the class they handle, and have the same
name as that class, with <code class="literal">'Editor'</code> appended; for example, one could have the following
class and package structure, which would be sufficient for the <code class="literal">FooEditor</code> class to be
recognized and used as the <code class="literal">PropertyEditor</code> for <code class="literal">Foo</code>-typed properties.</p>
<pre class="literallayout">com
  chank
    pop
      Foo
      FooEditor // the PropertyEditor for the Foo class</pre>
<p>Note that you can also use the standard <code class="literal">BeanInfo</code> JavaBeans mechanism here as well
(described
<a class="ulink" href="https://docs.oracle.com/javase/tutorial/javabeans/advanced/customization.html" target="_top">in
not-amazing-detail here</a>). Find below an example of using the <code class="literal">BeanInfo</code> mechanism for
explicitly registering one or more <code class="literal">PropertyEditor</code> instances with the properties of an
associated class.</p>
<pre class="literallayout">com
  chank
    pop
      Foo
      FooBeanInfo // the BeanInfo for the Foo class</pre>
<p>Here is the Java source code for the referenced <code class="literal">FooBeanInfo</code> class. This would
associate a <code class="literal">CustomNumberEditor</code> with the <code class="literal">age</code> property of the <code class="literal">Foo</code> class.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FooBeanInfo <span class="hl-keyword">extends</span> SimpleBeanInfo {

    <span class="hl-keyword">public</span> PropertyDescriptor[] getPropertyDescriptors() {
        <span class="hl-keyword">try</span> {
            <span class="hl-keyword">final</span> PropertyEditor numberPE = <span class="hl-keyword">new</span> CustomNumberEditor(Integer.<span class="hl-keyword">class</span>, true);
            PropertyDescriptor ageDescriptor = <span class="hl-keyword">new</span> PropertyDescriptor(<span class="hl-string">"age"</span>, Foo.<span class="hl-keyword">class</span>) {
                <span class="hl-keyword">public</span> PropertyEditor createPropertyEditor(Object bean) {
                    <span class="hl-keyword">return</span> numberPE;
                };
            };
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> PropertyDescriptor[] { ageDescriptor };
        }
        <span class="hl-keyword">catch</span> (IntrospectionException ex) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> Error(ex.toString());
        }
    }
}</pre>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="beans-beans-conversion-customeditor-registration" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conversion-customeditor-registration"></a>Registering additional custom PropertyEditors</h4></div></div></div>

<p>When setting bean properties as a string value, a Spring IoC container ultimately uses
standard JavaBeans <code class="literal">PropertyEditors</code> to convert these Strings to the complex type of the
property. Spring pre-registers a number of custom <code class="literal">PropertyEditors</code> (for example, to
convert a classname expressed as a string into a real <code class="literal">Class</code> object). Additionally,
Java’s standard JavaBeans <code class="literal">PropertyEditor</code> lookup mechanism allows a <code class="literal">PropertyEditor</code>
for a class simply to be named appropriately and placed in the same package as the class
it provides support for, to be found automatically.</p>
<p>If there is a need to register other custom <code class="literal">PropertyEditors</code>, there are several
mechanisms available. The most manual approach, which is not normally convenient or
recommended, is to simply use the <code class="literal">registerCustomEditor()</code> method of the
<code class="literal">ConfigurableBeanFactory</code> interface, assuming you have a <code class="literal">BeanFactory</code> reference.
Another, slightly more convenient, mechanism is to use a special bean factory
post-processor called <code class="literal">CustomEditorConfigurer</code>. Although bean factory post-processors
can be used with <code class="literal">BeanFactory</code> implementations, the <code class="literal">CustomEditorConfigurer</code> has a
nested property setup, so it is strongly recommended that it is used with the
<code class="literal">ApplicationContext</code>, where it may be deployed in similar fashion to any other bean, and
automatically detected and applied.</p>
<p>Note that all bean factories and application contexts automatically use a number of
built-in property editors, through their use of something called a <code class="literal">BeanWrapper</code> to
handle property conversions. The standard property editors that the <code class="literal">BeanWrapper</code>
registers are listed in <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conversion" title="9.4.2 Built-in PropertyEditor implementations">the previous section</a>. Additionally,
<code class="literal">ApplicationContexts</code> also override or add an additional number of editors to handle
resource lookups in a manner appropriate to the specific application context type.</p>
<p>Standard JavaBeans <code class="literal">PropertyEditor</code> instances are used to convert property values
expressed as strings to the actual complex type of the property.
<code class="literal">CustomEditorConfigurer</code>, a bean factory post-processor, may be used to conveniently add
support for additional <code class="literal">PropertyEditor</code> instances to an <code class="literal">ApplicationContext</code>.</p>
<p>Consider a user class <code class="literal">ExoticType</code>, and another class <code class="literal">DependsOnExoticType</code> which needs
<code class="literal">ExoticType</code> set as a property:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> example;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExoticType {

    <span class="hl-keyword">private</span> String name;

    <span class="hl-keyword">public</span> ExoticType(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DependsOnExoticType {

    <span class="hl-keyword">private</span> ExoticType type;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setType(ExoticType type) {
        <span class="hl-keyword">this</span>.type = type;
    }
}</pre>
<p>When things are properly set up, we want to be able to assign the type property as a
string, which a <code class="literal">PropertyEditor</code> will behind the scenes convert into an actual
<code class="literal">ExoticType</code> instance:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sample"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.DependsOnExoticType"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"type"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"aNameForExoticType"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The <code class="literal">PropertyEditor</code> implementation could look similar to this:</p>
<pre class="programlisting"><span class="hl-comment">// converts string representation to ExoticType object</span>
<span class="hl-keyword">package</span> example;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExoticTypeEditor <span class="hl-keyword">extends</span> PropertyEditorSupport {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAsText(String text) {
        setValue(<span class="hl-keyword">new</span> ExoticType(text.toUpperCase()));
    }
}</pre>
<p>Finally, we use <code class="literal">CustomEditorConfigurer</code> to register the new <code class="literal">PropertyEditor</code> with the
<code class="literal">ApplicationContext</code>, which will then be able to use it as needed:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.CustomEditorConfigurer"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"customEditors"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"example.ExoticType"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"example.ExoticTypeEditor"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="beans-beans-conversion-customeditor-registration-per" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conversion-customeditor-registration-per"></a>Using PropertyEditorRegistrars</h5></div></div></div>

<p>Another mechanism for registering property editors with the Spring container is to
create and use a <code class="literal">PropertyEditorRegistrar</code>. This interface is particularly useful when
you need to use the same set of property editors in several different situations: write
a corresponding registrar and reuse that in each case. <code class="literal">PropertyEditorRegistrars</code> work
in conjunction with an interface called <code class="literal">PropertyEditorRegistry</code>, an interface that is
implemented by the Spring <code class="literal">BeanWrapper</code> (and <code class="literal">DataBinder</code>). <code class="literal">PropertyEditorRegistrars</code>
are particularly convenient when used in conjunction with the <code class="literal">CustomEditorConfigurer</code>
(introduced <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-beans-conversion-customeditor-registration" title="Registering additional custom PropertyEditors">here</a>), which exposes a
property called <code class="literal">setPropertyEditorRegistrars(..)</code>: <code class="literal">PropertyEditorRegistrars</code> added to a
<code class="literal">CustomEditorConfigurer</code> in this fashion can easily be shared with <code class="literal">DataBinder</code> and
Spring MVC <code class="literal">Controllers</code>. Furthermore, it avoids the need for synchronization on custom
editors: a <code class="literal">PropertyEditorRegistrar</code> is expected to create fresh <code class="literal">PropertyEditor</code>
instances for each bean creation attempt.</p>
<p>Using a <code class="literal">PropertyEditorRegistrar</code> is perhaps best illustrated with an example. First
off, you need to create your own <code class="literal">PropertyEditorRegistrar</code> implementation:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> com.foo.editors.spring;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> CustomPropertyEditorRegistrar <span class="hl-keyword">implements</span> PropertyEditorRegistrar {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerCustomEditors(PropertyEditorRegistry registry) {

        <span class="hl-comment">// it is expected that new PropertyEditor instances are created</span>
        registry.registerCustomEditor(ExoticType.<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> ExoticTypeEditor());

        <span class="hl-comment">// you could register as many custom property editors as are required here...</span>
    }
}</pre>
<p>See also the <code class="literal">org.springframework.beans.support.ResourceEditorRegistrar</code> for an example
<code class="literal">PropertyEditorRegistrar</code> implementation. Notice how in its implementation of the
<code class="literal">registerCustomEditors(..)</code> method it creates new instances of each property editor.</p>
<p>Next we configure a <code class="literal">CustomEditorConfigurer</code> and inject an instance of our
<code class="literal">CustomPropertyEditorRegistrar</code> into it:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.CustomEditorConfigurer"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"propertyEditorRegistrars"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"customPropertyEditorRegistrar"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"customPropertyEditorRegistrar"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"com.foo.editors.spring.CustomPropertyEditorRegistrar"</span><span class="hl-tag">/&gt;</span></pre>
<p>Finally, and in a bit of a departure from the focus of this chapter, for those of you
using <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc" title="22. Web MVC framework">Spring’s MVC web framework</a>, using <code class="literal">PropertyEditorRegistrars</code> in
conjunction with data-binding <code class="literal">Controllers</code> (such as <code class="literal">SimpleFormController</code>) can be very
convenient. Find below an example of using a <code class="literal">PropertyEditorRegistrar</code> in the
implementation of an <code class="literal">initBinder(..)</code> method:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> RegisterUserController <span class="hl-keyword">extends</span> SimpleFormController {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> PropertyEditorRegistrar customPropertyEditorRegistrar;

    <span class="hl-keyword">public</span> RegisterUserController(PropertyEditorRegistrar propertyEditorRegistrar) {
        <span class="hl-keyword">this</span>.customPropertyEditorRegistrar = propertyEditorRegistrar;
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(HttpServletRequest request,
            ServletRequestDataBinder binder) <span class="hl-keyword">throws</span> Exception {
        <span class="strong"><strong>this.customPropertyEditorRegistrar.registerCustomEditors(binder);</strong></span>
    }

    <span class="hl-comment">// other methods to do with registering a User</span>
}</pre>
<p>This style of <code class="literal">PropertyEditor</code> registration can lead to concise code (the implementation
of <code class="literal">initBinder(..)</code> is just one line long!), and allows common <code class="literal">PropertyEditor</code>
registration code to be encapsulated in a class and then shared amongst as many
<code class="literal">Controllers</code> as needed.</p>
</div>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="core-convert" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert"></a>9.5&nbsp;Spring Type Conversion</h2></div></div></div>

<p>Spring 3 introduces a <code class="literal">core.convert</code> package that provides a general type conversion
system. The system defines an SPI to implement type conversion logic, as well as an API
to execute type conversions at runtime. Within a Spring container, this system can be
used as an alternative to PropertyEditors to convert externalized bean property value
strings to required property types. The public API may also be used anywhere in your
application where type conversion is needed.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-Converter-API" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-Converter-API"></a>9.5.1&nbsp;Converter SPI</h3></div></div></div>

<p>The SPI to implement type conversion logic is simple and strongly typed:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.converter;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Converter&lt;S, T&gt; {

    T convert(S source);

}</pre>
<p>To create your own converter, simply implement the interface above. Parameterize <code class="literal">S</code>
as the type you are converting from, and <code class="literal">T</code> as the type you are converting to. Such a
converter can also be applied transparently if a collection or array of <code class="literal">S</code> needs to be
converted to an array or collection of <code class="literal">T</code>, provided that a delegating array/collection
converter has been registered as well (which <code class="literal">DefaultConversionService</code> does by default).</p>
<p>For each call to <code class="literal">convert(S)</code>, the source argument is guaranteed to be NOT null. Your
Converter may throw any unchecked exception if conversion fails; specifically, an
<code class="literal">IllegalArgumentException</code> should be thrown to report an invalid source value.
Take care to ensure that your <code class="literal">Converter</code> implementation is thread-safe.</p>
<p>Several converter implementations are provided in the <code class="literal">core.convert.support</code> package as
a convenience. These include converters from Strings to Numbers and other common types.
Consider <code class="literal">StringToInteger</code> as an example for a typical <code class="literal">Converter</code> implementation:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.support;

<span class="hl-keyword">final</span> <span class="hl-keyword">class</span> StringToInteger <span class="hl-keyword">implements</span> Converter&lt;String, Integer&gt; {

    <span class="hl-keyword">public</span> Integer convert(String source) {
        <span class="hl-keyword">return</span> Integer.valueOf(source);
    }

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-ConverterFactory-SPI" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-ConverterFactory-SPI"></a>9.5.2&nbsp;ConverterFactory</h3></div></div></div>

<p>When you need to centralize the conversion logic for an entire class hierarchy, for
example, when converting from String to java.lang.Enum objects, implement
<code class="literal">ConverterFactory</code>:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.converter;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConverterFactory&lt;S, R&gt; {

    &lt;T <span class="hl-keyword">extends</span> R&gt; Converter&lt;S, T&gt; getConverter(Class&lt;T&gt; targetType);

}</pre>
<p>Parameterize S to be the type you are converting from and R to be the base type defining
the <span class="emphasis"><em>range</em></span> of classes you can convert to. Then implement getConverter(Class&lt;T&gt;),
where T is a subclass of R.</p>
<p>Consider the <code class="literal">StringToEnum</code> ConverterFactory as an example:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.support;

<span class="hl-keyword">final</span> <span class="hl-keyword">class</span> StringToEnumConverterFactory <span class="hl-keyword">implements</span> ConverterFactory&lt;String, Enum&gt; {

    <span class="hl-keyword">public</span> &lt;T <span class="hl-keyword">extends</span> Enum&gt; Converter&lt;String, T&gt; getConverter(Class&lt;T&gt; targetType) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> StringToEnumConverter(targetType);
    }

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> StringToEnumConverter&lt;T <span class="hl-keyword">extends</span> Enum&gt; <span class="hl-keyword">implements</span> Converter&lt;String, T&gt; {

        <span class="hl-keyword">private</span> Class&lt;T&gt; enumType;

        <span class="hl-keyword">public</span> StringToEnumConverter(Class&lt;T&gt; enumType) {
            <span class="hl-keyword">this</span>.enumType = enumType;
        }

        <span class="hl-keyword">public</span> T convert(String source) {
            <span class="hl-keyword">return</span> (T) Enum.valueOf(<span class="hl-keyword">this</span>.enumType, source.trim());
        }
    }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-GenericConverter-SPI" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-GenericConverter-SPI"></a>9.5.3&nbsp;GenericConverter</h3></div></div></div>

<p>When you require a sophisticated Converter implementation, consider the GenericConverter
interface. With a more flexible but less strongly typed signature, a GenericConverter
supports converting between multiple source and target types. In addition, a
GenericConverter makes available source and target field context you can use when
implementing your conversion logic. Such context allows a type conversion to be driven
by a field annotation, or generic information declared on a field signature.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.converter;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> GenericConverter {

    <span class="hl-keyword">public</span> Set&lt;ConvertiblePair&gt; getConvertibleTypes();

    Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);

}</pre>
<p>To implement a GenericConverter, have getConvertibleTypes() return the supported
source&#8594;target type pairs. Then implement convert(Object, TypeDescriptor,
TypeDescriptor) to implement your conversion logic. The source TypeDescriptor provides
access to the source field holding the value being converted. The target TypeDescriptor
provides access to the target field where the converted value will be set.</p>
<p>A good example of a GenericConverter is a converter that converts between a Java Array
and a Collection. Such an ArrayToCollectionConverter introspects the field that declares
the target Collection type to resolve the Collection’s element type. This allows each
element in the source array to be converted to the Collection element type before the
Collection is set on the target field.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Because GenericConverter is a more complex SPI interface, only use it when you need it.
Favor Converter or ConverterFactory for basic type conversion needs.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="core-convert-ConditionalGenericConverter-SPI" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-ConditionalGenericConverter-SPI"></a>ConditionalGenericConverter</h4></div></div></div>

<p>Sometimes you only want a <code class="literal">Converter</code> to execute if a specific condition holds true. For
example, you might only want to execute a <code class="literal">Converter</code> if a specific annotation is present
on the target field. Or you might only want to execute a <code class="literal">Converter</code> if a specific method,
such as a <code class="literal">static valueOf</code> method, is defined on the target class.
<code class="literal">ConditionalGenericConverter</code> is the union of the <code class="literal">GenericConverter</code> and
<code class="literal">ConditionalConverter</code> interfaces that allows you to define such custom matching criteria:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConditionalConverter {

    <span class="hl-keyword">boolean</span> matches(TypeDescriptor sourceType, TypeDescriptor targetType);

}

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConditionalGenericConverter
    <span class="hl-keyword">extends</span> GenericConverter, ConditionalConverter {

}</pre>
<p>A good example of a <code class="literal">ConditionalGenericConverter</code> is an EntityConverter that converts
between an persistent entity identifier and an entity reference. Such a EntityConverter
might only match if the target entity type declares a static finder method e.g.
<code class="literal">findAccount(Long)</code>. You would perform such a finder method check in the implementation of
<code class="literal">matches(TypeDescriptor, TypeDescriptor)</code>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-ConversionService-API" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-ConversionService-API"></a>9.5.4&nbsp;ConversionService API</h3></div></div></div>

<p>The ConversionService defines a unified API for executing type conversion logic at
runtime. Converters are often executed behind this facade interface:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConversionService {

    <span class="hl-keyword">boolean</span> canConvert(Class&lt;?&gt; sourceType, Class&lt;?&gt; targetType);

    &lt;T&gt; T convert(Object source, Class&lt;T&gt; targetType);

    <span class="hl-keyword">boolean</span> canConvert(TypeDescriptor sourceType, TypeDescriptor targetType);

    Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);

}</pre>
<p>Most ConversionService implementations also implement <code class="literal">ConverterRegistry</code>, which
provides an SPI for registering converters. Internally, a ConversionService
implementation delegates to its registered converters to carry out type conversion logic.</p>
<p>A robust ConversionService implementation is provided in the <code class="literal">core.convert.support</code>
package. <code class="literal">GenericConversionService</code> is the general-purpose implementation suitable for
use in most environments. <code class="literal">ConversionServiceFactory</code> provides a convenient factory for
creating common ConversionService configurations.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-Spring-config" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-Spring-config"></a>9.5.5&nbsp;Configuring a ConversionService</h3></div></div></div>

<p>A ConversionService is a stateless object designed to be instantiated at application
startup, then shared between multiple threads. In a Spring application, you typically
configure a ConversionService instance per Spring container (or ApplicationContext).
That ConversionService will be picked up by Spring and then used whenever a type
conversion needs to be performed by the framework. You may also inject this
ConversionService into any of your beans and invoke it directly.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If no ConversionService is registered with Spring, the original PropertyEditor-based
system is used.</p>
</td></tr></tbody></table></div>
<p>To register a default ConversionService with Spring, add the following bean definition
with id <code class="literal">conversionService</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.ConversionServiceFactoryBean"</span><span class="hl-tag">/&gt;</span></pre>
<p>A default ConversionService can convert between strings, numbers, enums, collections,
maps, and other common types. To supplement or override the default converters with your
own custom converter(s), set the <code class="literal">converters</code> property. Property values may implement
either of the Converter, ConverterFactory, or GenericConverter interfaces.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.context.support.ConversionServiceFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"converters"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;set&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"example.MyCustomConverter"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/set&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>It is also common to use a ConversionService within a Spring MVC application. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-conversion" title="22.16.3 Conversion and Formatting">Section&nbsp;22.16.3, “Conversion and Formatting”</a> in the Spring MVC chapter.</p>
<p>In certain situations you may wish to apply formatting during conversion. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-FormatterRegistry-SPI" title="9.6.3 FormatterRegistry SPI">Section&nbsp;9.6.3, “FormatterRegistry SPI”</a> for details on using
<code class="literal">FormattingConversionServiceFactoryBean</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="core-convert-programmatic-usage" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert-programmatic-usage"></a>9.5.6&nbsp;Using a ConversionService programmatically</h3></div></div></div>

<p>To work with a ConversionService instance programmatically, simply inject a reference to
it like you would for any other bean:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Service</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyService {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> MyService(ConversionService conversionService) {
        <span class="hl-keyword">this</span>.conversionService = conversionService;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doIt() {
        <span class="hl-keyword">this</span>.conversionService.convert(...)
    }
}</pre>
<p>For most use cases, the <code class="literal">convert</code> method specifying the <span class="emphasis"><em>targetType</em></span> can be used but it
will not work with more complex types such as a collection of a parameterized element.
If you want to convert a <code class="literal">List</code> of <code class="literal">Integer</code> to a <code class="literal">List</code> of <code class="literal">String</code> programmatically,
for instance, you need to provide a formal definition of the source and target types.</p>
<p>Fortunately, <code class="literal">TypeDescriptor</code> provides various options to make that straightforward:</p>
<pre class="programlisting">DefaultConversionService cs = <span class="hl-keyword">new</span> DefaultConversionService();

List&lt;Integer&gt; input = ....
cs.convert(input,
    TypeDescriptor.forObject(input), <span class="hl-comment">// List&lt;Integer&gt; type descriptor</span>
    TypeDescriptor.collection(List.<span class="hl-keyword">class</span>, TypeDescriptor.valueOf(String.<span class="hl-keyword">class</span>)));</pre>
<p>Note that <code class="literal">DefaultConversionService</code> registers converters automatically which are
appropriate for most environments. This includes collection converters, scalar
converters, and also basic <code class="literal">Object</code> to <code class="literal">String</code> converters. The same converters can
be registered with any <code class="literal">ConverterRegistry</code> using the <span class="emphasis"><em>static</em></span> <code class="literal">addDefaultConverters</code>
method on the <code class="literal">DefaultConversionService</code> class.</p>
<p>Converters for value types will be reused for arrays and collections, so there is
no need to create a specific converter to convert from a <code class="literal">Collection</code> of <code class="literal">S</code> to a
<code class="literal">Collection</code> of <code class="literal">T</code>, assuming that standard collection handling is appropriate.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="format" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format"></a>9.6&nbsp;Spring Field Formatting</h2></div></div></div>

<p>As discussed in the previous section, <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#core-convert" title="9.5 Spring Type Conversion"><code class="literal">core.convert</code></a> is a
general-purpose type conversion system. It provides a unified ConversionService API as
well as a strongly-typed Converter SPI for implementing conversion logic from one type
to another. A Spring Container uses this system to bind bean property values. In
addition, both the Spring Expression Language (SpEL) and DataBinder use this system to
bind field values. For example, when SpEL needs to coerce a <code class="literal">Short</code> to a <code class="literal">Long</code> to
complete an <code class="literal">expression.setValue(Object bean, Object value)</code> attempt, the core.convert
system performs the coercion.</p>
<p>Now consider the type conversion requirements of a typical client environment such as a
web or desktop application. In such environments, you typically convert <span class="emphasis"><em>from String</em></span>
to support the client postback process, as well as back <span class="emphasis"><em>to String</em></span> to support the
view rendering process. In addition, you often need to localize String values. The more
general <span class="emphasis"><em>core.convert</em></span> Converter SPI does not address such <span class="emphasis"><em>formatting</em></span> requirements
directly. To directly address them, Spring 3 introduces a convenient Formatter SPI that
provides a simple and robust alternative to PropertyEditors for client environments.</p>
<p>In general, use the Converter SPI when you need to implement general-purpose type
conversion logic; for example, for converting between a java.util.Date and and
java.lang.Long. Use the Formatter SPI when you’re working in a client environment, such
as a web application, and need to parse and print localized field values. The
ConversionService provides a unified type conversion API for both SPIs.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="format-Formatter-SPI" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-Formatter-SPI"></a>9.6.1&nbsp;Formatter SPI</h3></div></div></div>

<p>The Formatter SPI to implement field formatting logic is simple and strongly typed:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Formatter&lt;T&gt; <span class="hl-keyword">extends</span> Printer&lt;T&gt;, Parser&lt;T&gt; {
}</pre>
<p>Where Formatter extends from the Printer and Parser building-block interfaces:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Printer&lt;T&gt; {
    String print(T fieldValue, Locale locale);
}</pre>
<pre class="programlisting"><span class="hl-keyword">import</span> java.text.ParseException;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Parser&lt;T&gt; {
    T parse(String clientValue, Locale locale) <span class="hl-keyword">throws</span> ParseException;
}</pre>
<p>To create your own Formatter, simply implement the Formatter interface above.
Parameterize T to be the type of object you wish to format, for example,
<code class="literal">java.util.Date</code>. Implement the <code class="literal">print()</code> operation to print an instance of T for
display in the client locale. Implement the <code class="literal">parse()</code> operation to parse an instance of
T from the formatted representation returned from the client locale. Your Formatter
should throw a ParseException or IllegalArgumentException if a parse attempt fails. Take
care to ensure your Formatter implementation is thread-safe.</p>
<p>Several Formatter implementations are provided in <code class="literal">format</code> subpackages as a convenience.
The <code class="literal">number</code> package provides a <code class="literal">NumberFormatter</code>, <code class="literal">CurrencyFormatter</code>, and
<code class="literal">PercentFormatter</code> to format <code class="literal">java.lang.Number</code> objects using a <code class="literal">java.text.NumberFormat</code>.
The <code class="literal">datetime</code> package provides a <code class="literal">DateFormatter</code> to format <code class="literal">java.util.Date</code> objects with
a <code class="literal">java.text.DateFormat</code>. The <code class="literal">datetime.joda</code> package provides comprehensive datetime
formatting support based on the <a class="ulink" href="http://joda-time.sourceforge.net/" target="_top">Joda Time library</a>.</p>
<p>Consider <code class="literal">DateFormatter</code> as an example <code class="literal">Formatter</code> implementation:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format.datetime;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> DateFormatter <span class="hl-keyword">implements</span> Formatter&lt;Date&gt; {

    <span class="hl-keyword">private</span> String pattern;

    <span class="hl-keyword">public</span> DateFormatter(String pattern) {
        <span class="hl-keyword">this</span>.pattern = pattern;
    }

    <span class="hl-keyword">public</span> String print(Date date, Locale locale) {
        <span class="hl-keyword">if</span> (date == null) {
            <span class="hl-keyword">return</span> <span class="hl-string">""</span>;
        }
        <span class="hl-keyword">return</span> getDateFormat(locale).format(date);
    }

    <span class="hl-keyword">public</span> Date parse(String formatted, Locale locale) <span class="hl-keyword">throws</span> ParseException {
        <span class="hl-keyword">if</span> (formatted.length() == <span class="hl-number">0</span>) {
            <span class="hl-keyword">return</span> null;
        }
        <span class="hl-keyword">return</span> getDateFormat(locale).parse(formatted);
    }

    <span class="hl-keyword">protected</span> DateFormat getDateFormat(Locale locale) {
        DateFormat dateFormat = <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-keyword">this</span>.pattern, locale);
        dateFormat.setLenient(false);
        <span class="hl-keyword">return</span> dateFormat;
    }

}</pre>
<p>The Spring team welcomes community-driven <code class="literal">Formatter</code> contributions; see
<a class="ulink" href="https://jira.spring.io/browse/SPR" target="_top">jira.spring.io</a> to contribute.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="format-CustomFormatAnnotations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-CustomFormatAnnotations"></a>9.6.2&nbsp;Annotation-driven Formatting</h3></div></div></div>

<p>As you will see, field formatting can be configured by field type or annotation. To bind
an Annotation to a formatter, implement AnnotationFormatterFactory:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> AnnotationFormatterFactory&lt;A <span class="hl-keyword">extends</span> Annotation&gt; {

    Set&lt;Class&lt;?&gt;&gt; getFieldTypes();

    Printer&lt;?&gt; getPrinter(A annotation, Class&lt;?&gt; fieldType);

    Parser&lt;?&gt; getParser(A annotation, Class&lt;?&gt; fieldType);

}</pre>
<p>Parameterize A to be the field annotationType you wish to associate formatting logic
with, for example <code class="literal">org.springframework.format.annotation.DateTimeFormat</code>. Have
<code class="literal">getFieldTypes()</code> return the types of fields the annotation may be used on. Have
<code class="literal">getPrinter()</code> return a Printer to print the value of an annotated field. Have
<code class="literal">getParser()</code> return a Parser to parse a clientValue for an annotated field.</p>
<p>The example AnnotationFormatterFactory implementation below binds the @NumberFormat
Annotation to a formatter. This annotation allows either a number style or pattern to be
specified:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> NumberFormatAnnotationFormatterFactory
        <span class="hl-keyword">implements</span> AnnotationFormatterFactory&lt;NumberFormat&gt; {

    <span class="hl-keyword">public</span> Set&lt;Class&lt;?&gt;&gt; getFieldTypes() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> HashSet&lt;Class&lt;?&gt;&gt;(asList(<span class="hl-keyword">new</span> Class&lt;?&gt;[] {
            Short.<span class="hl-keyword">class</span>, Integer.<span class="hl-keyword">class</span>, Long.<span class="hl-keyword">class</span>, Float.<span class="hl-keyword">class</span>,
            Double.<span class="hl-keyword">class</span>, BigDecimal.<span class="hl-keyword">class</span>, BigInteger.<span class="hl-keyword">class</span> }));
    }

    <span class="hl-keyword">public</span> Printer&lt;Number&gt; getPrinter(NumberFormat annotation, Class&lt;?&gt; fieldType) {
        <span class="hl-keyword">return</span> configureFormatterFrom(annotation, fieldType);
    }

    <span class="hl-keyword">public</span> Parser&lt;Number&gt; getParser(NumberFormat annotation, Class&lt;?&gt; fieldType) {
        <span class="hl-keyword">return</span> configureFormatterFrom(annotation, fieldType);
    }

    <span class="hl-keyword">private</span> Formatter&lt;Number&gt; configureFormatterFrom(NumberFormat annotation,
            Class&lt;?&gt; fieldType) {
        <span class="hl-keyword">if</span> (!annotation.pattern().isEmpty()) {
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> NumberFormatter(annotation.pattern());
        } <span class="hl-keyword">else</span> {
            Style style = annotation.style();
            <span class="hl-keyword">if</span> (style == Style.PERCENT) {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> PercentFormatter();
            } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (style == Style.CURRENCY) {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CurrencyFormatter();
            } <span class="hl-keyword">else</span> {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> NumberFormatter();
            }
        }
    }
}</pre>
<p>To trigger formatting, simply annotate fields with @NumberFormat:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyModel {

    <em><span class="hl-annotation" style="color: gray">@NumberFormat(style=Style.CURRENCY)</span></em>
    <span class="hl-keyword">private</span> BigDecimal decimal;

}</pre>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="format-annotations-api" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-annotations-api"></a>Format Annotation API</h4></div></div></div>

<p>A portable format annotation API exists in the <code class="literal">org.springframework.format.annotation</code>
package. Use @NumberFormat to format java.lang.Number fields. Use @DateTimeFormat to
format java.util.Date, java.util.Calendar, java.util.Long, or Joda Time fields.</p>
<p>The example below uses @DateTimeFormat to format a java.util.Date as a ISO Date
(yyyy-MM-dd):</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyModel {

    <em><span class="hl-annotation" style="color: gray">@DateTimeFormat(iso=ISO.DATE)</span></em>
    <span class="hl-keyword">private</span> Date date;

}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="format-FormatterRegistry-SPI" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-FormatterRegistry-SPI"></a>9.6.3&nbsp;FormatterRegistry SPI</h3></div></div></div>

<p>The FormatterRegistry is an SPI for registering formatters and converters.
<code class="literal">FormattingConversionService</code> is an implementation of FormatterRegistry suitable for
most environments. This implementation may be configured programmatically or
declaratively as a Spring bean using <code class="literal">FormattingConversionServiceFactoryBean</code>. Because
this implementation also implements <code class="literal">ConversionService</code>, it can be directly configured
for use with Spring’s DataBinder and the Spring Expression Language (SpEL).</p>
<p>Review the FormatterRegistry SPI below:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FormatterRegistry <span class="hl-keyword">extends</span> ConverterRegistry {

    <span class="hl-keyword">void</span> addFormatterForFieldType(Class&lt;?&gt; fieldType, Printer&lt;?&gt; printer, Parser&lt;?&gt; parser);

    <span class="hl-keyword">void</span> addFormatterForFieldType(Class&lt;?&gt; fieldType, Formatter&lt;?&gt; formatter);

    <span class="hl-keyword">void</span> addFormatterForFieldType(Formatter&lt;?&gt; formatter);

    <span class="hl-keyword">void</span> addFormatterForAnnotation(AnnotationFormatterFactory&lt;?, ?&gt; factory);

}</pre>
<p>As shown above, Formatters can be registered by fieldType or annotation.</p>
<p>The FormatterRegistry SPI allows you to configure Formatting rules centrally, instead of
duplicating such configuration across your Controllers. For example, you might want to
enforce that all Date fields are formatted a certain way, or fields with a specific
annotation are formatted in a certain way. With a shared FormatterRegistry, you define
these rules once and they are applied whenever formatting is needed.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="format-FormatterRegistrar-SPI" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-FormatterRegistrar-SPI"></a>9.6.4&nbsp;FormatterRegistrar SPI</h3></div></div></div>

<p>The FormatterRegistrar is an SPI for registering formatters and converters through the
FormatterRegistry:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FormatterRegistrar {

    <span class="hl-keyword">void</span> registerFormatters(FormatterRegistry registry);

}</pre>
<p>A FormatterRegistrar is useful when registering multiple related converters and
formatters for a given formatting category, such as Date formatting. It can also be
useful where declarative registration is insufficient. For example when a formatter
needs to be indexed under a specific field type different from its own &lt;T&gt; or when
registering a Printer/Parser pair. The next section provides more information on
converter and formatter registration.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="format-configuring-formatting-mvc" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-configuring-formatting-mvc"></a>9.6.5&nbsp;Configuring Formatting in Spring MVC</h3></div></div></div>

<p>See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-conversion" title="22.16.3 Conversion and Formatting">Section&nbsp;22.16.3, “Conversion and Formatting”</a> in the Spring MVC chapter.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="format-configuring-formatting-globaldatetimeformat" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#format-configuring-formatting-globaldatetimeformat"></a>9.7&nbsp;Configuring a global date &amp; time format</h2></div></div></div>

<p>By default, date and time fields that are not annotated with <code class="literal">@DateTimeFormat</code> are
converted from strings using the <code class="literal">DateFormat.SHORT</code> style. If you prefer, you can
change this by defining your own global format.</p>
<p>You will need to ensure that Spring does not register default formatters, and instead
you should register all formatters manually. Use the
<code class="literal">org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar</code> or
<code class="literal">org.springframework.format.datetime.DateFormatterRegistrar</code> class depending on whether
you use the Joda Time library.</p>
<p>For example, the following Java configuration will register a global ' `yyyyMMdd’
format. This example does not depend on the Joda Time library:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> FormattingConversionService conversionService() {

        <span class="hl-comment">// Use the DefaultFormattingConversionService but do not register defaults</span>
        DefaultFormattingConversionService conversionService = <span class="hl-keyword">new</span> DefaultFormattingConversionService(false);

        <span class="hl-comment">// Ensure @NumberFormat is still supported</span>
        conversionService.addFormatterForFieldAnnotation(<span class="hl-keyword">new</span> NumberFormatAnnotationFormatterFactory());

        <span class="hl-comment">// Register date conversion with a specific global format</span>
        DateFormatterRegistrar registrar = <span class="hl-keyword">new</span> DateFormatterRegistrar();
        registrar.setFormatter(<span class="hl-keyword">new</span> DateFormatter(<span class="hl-string">"yyyyMMdd"</span>));
        registrar.registerFormatters(conversionService);

        <span class="hl-keyword">return</span> conversionService;
    }
}</pre>
<p>If you prefer XML based configuration you can use a
<code class="literal">FormattingConversionServiceFactoryBean</code>. Here is the same example, this time using Joda
Time:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&gt;

    &lt;bean id="</span><span class="hl-attribute">conversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"registerDefaultFormatters"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"false"</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"formatters"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;set&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.format.number.NumberFormatAnnotationFormatterFactory"</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;/set&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"formatterRegistrars"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;set&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar"</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dateFormatter"</span><span class="hl-tag">&gt;</span>
                        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.format.datetime.joda.DateTimeFormatterFactoryBean"</span><span class="hl-tag">&gt;</span>
                            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"pattern"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"yyyyMMdd"</span><span class="hl-tag">/&gt;</span>
                        <span class="hl-tag">&lt;/bean&gt;</span>
                    <span class="hl-tag">&lt;/property&gt;</span>
                <span class="hl-tag">&lt;/bean&gt;</span>
            <span class="hl-tag">&lt;/set&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Joda Time provides separate distinct types to represent <code class="literal">date</code>, <code class="literal">time</code> and <code class="literal">date-time</code>
values. The <code class="literal">dateFormatter</code>, <code class="literal">timeFormatter</code> and <code class="literal">dateTimeFormatter</code> properties of the
<code class="literal">JodaTimeFormatterRegistrar</code> should be used to configure the different formats for each
type. The <code class="literal">DateTimeFormatterFactoryBean</code> provides a convenient way to create formatters.</p>
</td></tr></tbody></table></div>
<p>If you are using Spring MVC remember to explicitly configure the conversion service that
is used. For Java based <code class="literal">@Configuration</code> this means extending the
<code class="literal">WebMvcConfigurationSupport</code> class and overriding the <code class="literal">mvcConversionService()</code> method.
For XML you should use the <code class="literal">'conversion-service'</code> attribute of the
<code class="literal">mvc:annotation-driven</code> element. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-conversion" title="22.16.3 Conversion and Formatting">Section&nbsp;22.16.3, “Conversion and Formatting”</a> for details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-beanvalidation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation"></a>9.8&nbsp;Spring Validation</h2></div></div></div>

<p>Spring 3 introduces several enhancements to its validation support. First, the JSR-303
Bean Validation API is now fully supported. Second, when used programmatically, Spring’s
DataBinder can now validate objects as well as bind to them. Third, Spring MVC now has
support for declaratively validating <code class="literal">@Controller</code> inputs.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="validation-beanvalidation-overview" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-overview"></a>9.8.1&nbsp;Overview of the JSR-303 Bean Validation API</h3></div></div></div>

<p>JSR-303 standardizes validation constraint declaration and metadata for the Java
platform. Using this API, you annotate domain model properties with declarative
validation constraints and the runtime enforces them. There are a number of built-in
constraints you can take advantage of. You may also define your own custom constraints.</p>
<p>To illustrate, consider a simple PersonForm model with two properties:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonForm {
    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;
}</pre>
<p>JSR-303 allows you to define declarative validation constraints against such properties:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonForm {

    <em><span class="hl-annotation" style="color: gray">@NotNull</span></em>
    <em><span class="hl-annotation" style="color: gray">@Size(max=64)</span></em>
    <span class="hl-keyword">private</span> String name;

    <em><span class="hl-annotation" style="color: gray">@Min(0)</span></em>
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;

}</pre>
<p>When an instance of this class is validated by a JSR-303 Validator, these constraints
will be enforced.</p>
<p>For general information on JSR-303/JSR-349, see the <a class="ulink" href="http://beanvalidation.org/" target="_top">Bean
Validation website</a>. For information on the specific capabilities of the default
reference implementation, see the <a class="ulink" href="https://www.hibernate.org/412.html" target="_top">Hibernate
Validator</a> documentation. To learn how to setup a Bean Validation provider as a Spring
bean, keep reading.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="validation-beanvalidation-spring" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring"></a>9.8.2&nbsp;Configuring a Bean Validation Provider</h3></div></div></div>

<p>Spring provides full support for the Bean Validation API. This includes convenient
support for bootstrapping a JSR-303/JSR-349 Bean Validation provider as a Spring bean.
This allows for a <code class="literal">javax.validation.ValidatorFactory</code> or <code class="literal">javax.validation.Validator</code> to
be injected wherever validation is needed in your application.</p>
<p>Use the <code class="literal">LocalValidatorFactoryBean</code> to configure a default Validator as a Spring bean:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"validator"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"</span><span class="hl-tag">/&gt;</span></pre>
<p>The basic configuration above will trigger Bean Validation to initialize using its
default bootstrap mechanism. A JSR-303/JSR-349 provider, such as Hibernate Validator,
is expected to be present in the classpath and will be detected automatically.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="validation-beanvalidation-spring-inject" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring-inject"></a>Injecting a Validator</h4></div></div></div>

<p><code class="literal">LocalValidatorFactoryBean</code> implements both <code class="literal">javax.validation.ValidatorFactory</code> and
<code class="literal">javax.validation.Validator</code>, as well as Spring’s
<code class="literal">org.springframework.validation.Validator</code>. You may inject a reference to either of
these interfaces into beans that need to invoke validation logic.</p>
<p>Inject a reference to <code class="literal">javax.validation.Validator</code> if you prefer to work with the Bean
Validation API directly:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.validation.Validator;

<em><span class="hl-annotation" style="color: gray">@Service</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyService {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> Validator validator;</pre>
<p>Inject a reference to <code class="literal">org.springframework.validation.Validator</code> if your bean requires
the Spring Validation API:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.validation.Validator;

<em><span class="hl-annotation" style="color: gray">@Service</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyService {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> Validator validator;

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="validation-beanvalidation-spring-constraints" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring-constraints"></a>Configuring Custom Constraints</h4></div></div></div>

<p>Each Bean Validation constraint consists of two parts. First, a <code class="literal">@Constraint</code> annotation
that declares the constraint and its configurable properties. Second, an implementation
of the <code class="literal">javax.validation.ConstraintValidator</code> interface that implements the constraint’s
behavior. To associate a declaration with an implementation, each <code class="literal">@Constraint</code> annotation
references a corresponding ValidationConstraint implementation class. At runtime, a
<code class="literal">ConstraintValidatorFactory</code> instantiates the referenced implementation when the
constraint annotation is encountered in your domain model.</p>
<p>By default, the <code class="literal">LocalValidatorFactoryBean</code> configures a <code class="literal">SpringConstraintValidatorFactory</code>
that uses Spring to create ConstraintValidator instances. This allows your custom
ConstraintValidators to benefit from dependency injection like any other Spring bean.</p>
<p>Shown below is an example of a custom <code class="literal">@Constraint</code> declaration, followed by an associated
<code class="literal">ConstraintValidator</code> implementation that uses Spring for dependency injection:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD, ElementType.FIELD})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Constraint(validatedBy=MyConstraintValidator.class)</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> MyConstraint {
}</pre>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.validation.ConstraintValidator;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyConstraintValidator <span class="hl-keyword">implements</span> ConstraintValidator {

    <em><span class="hl-annotation" style="color: gray">@Autowired;</span></em>
    <span class="hl-keyword">private</span> Foo aDependency;

    ...
}</pre>
<p>As you can see, a ConstraintValidator implementation may have its dependencies
@Autowired like any other Spring bean.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="validation-beanvalidation-spring-method" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring-method"></a>Spring-driven Method Validation</h4></div></div></div>

<p>The method validation feature supported by Bean Validation 1.1, and as a custom
extension also by Hibernate Validator 4.3, can be integrated into a Spring context
through a <code class="literal">MethodValidationPostProcessor</code> bean definition:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.validation.beanvalidation.MethodValidationPostProcessor"</span><span class="hl-tag">/&gt;</span></pre>
<p>In order to be eligible for Spring-driven method validation, all target classes need
to be annotated with Spring’s <code class="literal">@Validated</code> annotation, optionally declaring the
validation groups to use. Check out the <code class="literal">MethodValidationPostProcessor</code> javadocs
for setup details with Hibernate Validator and Bean Validation 1.1 providers.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="validation-beanvalidation-spring-other" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring-other"></a>Additional Configuration Options</h4></div></div></div>

<p>The default <code class="literal">LocalValidatorFactoryBean</code> configuration should prove sufficient for most
cases. There are a number of configuration options for various Bean Validation
constructs, from message interpolation to traversal resolution. See the
<code class="literal">LocalValidatorFactoryBean</code> javadocs for more information on these options.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="validation-binder" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-binder"></a>9.8.3&nbsp;Configuring a DataBinder</h3></div></div></div>

<p>Since Spring 3, a DataBinder instance can be configured with a Validator. Once
configured, the Validator may be invoked by calling <code class="literal">binder.validate()</code>. Any validation
Errors are automatically added to the binder’s BindingResult.</p>
<p>When working with the DataBinder programmatically, this can be used to invoke validation
logic after binding to a target object:</p>
<pre class="programlisting">Foo target = <span class="hl-keyword">new</span> Foo();
DataBinder binder = <span class="hl-keyword">new</span> DataBinder(target);
binder.setValidator(<span class="hl-keyword">new</span> FooValidator());

<span class="hl-comment">// bind to the target object</span>
binder.bind(propertyValues);

<span class="hl-comment">// validate the target object</span>
binder.validate();

<span class="hl-comment">// get BindingResult that includes any validation errors</span>
BindingResult results = binder.getBindingResult();</pre>
<p>A DataBinder can also be configured with multiple <code class="literal">Validator</code> instances via
<code class="literal">dataBinder.addValidators</code> and <code class="literal">dataBinder.replaceValidators</code>. This is useful when
combining globally configured Bean Validation with a Spring <code class="literal">Validator</code> configured
locally on a DataBinder instance. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#">???</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="validation-mvc" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-mvc"></a>9.8.4&nbsp;Spring MVC 3 Validation</h3></div></div></div>

<p>See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-config-validation" title="22.16.4 Validation">Section&nbsp;22.16.4, “Validation”</a> in the Spring MVC chapter.</p>
</div>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="expressions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions"></a>10.&nbsp;Spring Expression Language (SpEL)</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-intro" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-intro"></a>10.1&nbsp;Introduction</h2></div></div></div>

<p>The Spring Expression Language (SpEL for short) is a powerful expression language that
supports querying and manipulating an object graph at runtime. The language syntax is
similar to Unified EL but offers additional features, most notably method invocation and
basic string templating functionality.</p>
<p>While there are several other Java expression languages available, OGNL, MVEL, and JBoss
EL, to name a few, the Spring Expression Language was created to provide the Spring
community with a single well supported expression language that can be used across all
the products in the Spring portfolio. Its language features are driven by the
requirements of the projects in the Spring portfolio, including tooling requirements for
code completion support within the eclipse based Spring Tool Suite. That said,
SpEL is based on a technology agnostic API allowing other expression language
implementations to be integrated should the need arise.</p>
<p>While SpEL serves as the foundation for expression evaluation within the Spring
portfolio, it is not directly tied to Spring and can be used independently. In order to
be self contained, many of the examples in this chapter use SpEL as if it were an
independent expression language. This requires creating a few bootstrapping
infrastructure classes such as the parser. Most Spring users will not need to deal with
this infrastructure and will instead only author expression strings for evaluation. An
example of this typical use is the integration of SpEL into creating XML or annotated
based bean definitions as shown in the section <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-beandef" title="10.4 Expression support for defining bean definitions">Expression support
for defining bean definitions.</a></p>
<p>This chapter covers the features of the expression language, its API, and its language
syntax. In several places an Inventor and Inventor’s Society class are used as the
target objects for expression evaluation. These class declarations and the data used to
populate them are listed at the end of the chapter.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-features" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-features"></a>10.2&nbsp;Feature Overview</h2></div></div></div>

<p>The expression language supports the following functionality</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Literal expressions
</li><li class="listitem">
Boolean and relational operators
</li><li class="listitem">
Regular expressions
</li><li class="listitem">
Class expressions
</li><li class="listitem">
Accessing properties, arrays, lists, maps
</li><li class="listitem">
Method invocation
</li><li class="listitem">
Relational operators
</li><li class="listitem">
Assignment
</li><li class="listitem">
Calling constructors
</li><li class="listitem">
Bean references
</li><li class="listitem">
Array construction
</li><li class="listitem">
Inline lists
</li><li class="listitem">
Inline maps
</li><li class="listitem">
Ternary operator
</li><li class="listitem">
Variables
</li><li class="listitem">
User defined functions
</li><li class="listitem">
Collection projection
</li><li class="listitem">
Collection selection
</li><li class="listitem">
Templated expressions
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-evaluation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-evaluation"></a>10.3&nbsp;Expression Evaluation using Spring’s Expression Interface</h2></div></div></div>

<p>This section introduces the simple use of SpEL interfaces and its expression language.
The complete language reference can be found in the section
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-language-ref" title="10.5 Language Reference">Language Reference</a>.</p>
<p>The following code introduces the SpEL API to evaluate the literal string expression
'Hello World'.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"</span><span class="strong"><strong>'Hello World'</strong></span><span class="hl-string">");
</span>String message = (String) exp.getValue();</pre>
<p>The value of the message variable is simply 'Hello World'.</p>
<p>The SpEL classes and interfaces you are most likely to use are located in the packages
<code class="literal">org.springframework.expression</code> and its sub packages and <code class="literal">spel.support</code>.</p>
<p>The interface <code class="literal">ExpressionParser</code> is responsible for parsing an expression string. In
this example the expression string is a string literal denoted by the surrounding single
quotes. The interface <code class="literal">Expression</code> is responsible for evaluating the previously defined
expression string. There are two exceptions that can be thrown, <code class="literal">ParseException</code> and
<code class="literal">EvaluationException</code> when calling <code class="literal">parser.parseExpression</code> and <code class="literal">exp.getValue</code>
respectively.</p>
<p>SpEL supports a wide range of features, such as calling methods, accessing properties,
and calling constructors.</p>
<p>As an example of method invocation, we call the <code class="literal">concat</code> method on the string literal.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"</span><span class="strong"><strong>'Hello World'.concat('!')</strong></span><span class="hl-string">");
</span>String message = (String) exp.getValue();</pre>
<p>The value of message is now 'Hello World!'.</p>
<p>As an example of calling a JavaBean property, the String property <code class="literal">Bytes</code> can be called
as shown below.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// invokes 'getBytes()'</span>
Expression exp = parser.parseExpression(<span class="hl-string">"</span><span class="strong"><strong>'Hello World'.bytes</strong></span><span class="hl-string">");
</span><span class="hl-keyword">byte</span>[] bytes = (<span class="hl-keyword">byte</span>[]) exp.getValue();</pre>
<p>SpEL also supports nested properties using standard <span class="emphasis"><em>dot</em></span> notation, i.e.
prop1.prop2.prop3 and the setting of property values</p>
<p>Public fields may also be accessed.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// invokes 'getBytes().length'</span>
Expression exp = parser.parseExpression(<span class="hl-string">"</span><span class="strong"><strong>'Hello World'.bytes.length</strong></span><span class="hl-string">");
</span><span class="hl-keyword">int</span> length = (Integer) exp.getValue();</pre>
<p>The String’s constructor can be called instead of using a string literal.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"</span><span class="strong"><strong>new String('hello world').toUpperCase()</strong></span><span class="hl-string">");
</span>String message = exp.getValue(String.<span class="hl-keyword">class</span>);</pre>
<p>Note the use of the generic method <code class="literal">public &lt;T&gt; T getValue(Class&lt;T&gt; desiredResultType)</code>.
Using this method removes the need to cast the value of the expression to the desired
result type. An <code class="literal">EvaluationException</code> will be thrown if the value cannot be cast to the
type <code class="literal">T</code> or converted using the registered type converter.</p>
<p>The more common usage of SpEL is to provide an expression string that is evaluated
against a specific object instance (called the root object). There are two options here
and which to choose depends on whether the object against which the expression is being
evaluated will be changing with each call to evaluate the expression. In the following
example we retrieve the <code class="literal">name</code> property from an instance of the Inventor class.</p>
<pre class="programlisting"><span class="hl-comment">// Create and set a calendar</span>
GregorianCalendar c = <span class="hl-keyword">new</span> GregorianCalendar();
c.set(<span class="hl-number">1856</span>, <span class="hl-number">7</span>, <span class="hl-number">9</span>);

<span class="hl-comment">// The constructor arguments are name, birthday, and nationality.</span>
Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, c.getTime(), <span class="hl-string">"Serbian"</span>);

ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"</span><span class="strong"><strong>name</strong></span><span class="hl-string">");
</span>
EvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);
String name = (String) exp.getValue(context);</pre>
<p>In the last line, the value of the string variable <code class="literal">name</code> will be set to "Nikola Tesla".
The class StandardEvaluationContext is where you can specify which object the "name"
property will be evaluated against. This is the mechanism to use if the root object is
unlikely to change, it can simply be set once in the evaluation context. If the root
object is likely to change repeatedly, it can be supplied on each call to <code class="literal">getValue</code>, as
this next example shows:</p>
<pre class="programlisting">/ Create and set a calendar
GregorianCalendar c = <span class="hl-keyword">new</span> GregorianCalendar();
c.set(<span class="hl-number">1856</span>, <span class="hl-number">7</span>, <span class="hl-number">9</span>);

<span class="hl-comment">// The constructor arguments are name, birthday, and nationality.</span>
Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, c.getTime(), <span class="hl-string">"Serbian"</span>);

ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">"</span><span class="strong"><strong>name</strong></span><span class="hl-string">");
</span>String name = (String) exp.getValue(tesla);</pre>
<p>In this case the inventor <code class="literal">tesla</code> has been supplied directly to <code class="literal">getValue</code> and the
expression evaluation infrastructure creates and manages a default evaluation context
internally - it did not require one to be supplied.</p>
<p>The StandardEvaluationContext is relatively expensive to construct and during repeated
usage it builds up cached state that enables subsequent expression evaluations to be
performed more quickly. For this reason it is better to cache and reuse them where
possible, rather than construct a new one for each expression evaluation.</p>
<p>In some cases it can be desirable to use a configured evaluation context and yet still
supply a different root object on each call to <code class="literal">getValue</code>. <code class="literal">getValue</code> allows both to be
specified on the same call. In these situations the root object passed on the call is
considered to override any (which maybe null) specified on the evaluation context.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>In standalone usage of SpEL there is a need to create the parser, parse expressions and
perhaps provide evaluation contexts and a root context object. However, more common
usage is to provide only the SpEL expression string as part of a configuration file, for
example for Spring bean or Spring Web Flow definitions. In this case, the parser,
evaluation context, root object and any predefined variables are all set up implicitly,
requiring the user to specify nothing other than the expressions.</p>
</td></tr></tbody></table></div>
<p>As a final introductory example, the use of a boolean operator is shown using the
Inventor object in the previous example.</p>
<pre class="programlisting">Expression exp = parser.parseExpression(<span class="hl-string">"name == 'Nikola Tesla'"</span>);
<span class="hl-keyword">boolean</span> result = exp.getValue(context, Boolean.<span class="hl-keyword">class</span>); <span class="hl-comment">// evaluates to true</span></pre>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-evaluation-context" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-evaluation-context"></a>10.3.1&nbsp;The EvaluationContext interface</h3></div></div></div>

<p>The interface <code class="literal">EvaluationContext</code> is used when evaluating an expression to resolve
properties, methods, fields, and to help perform type conversion. The out-of-the-box
implementation, <code class="literal">StandardEvaluationContext</code>, uses reflection to manipulate the object,
caching <code class="literal">java.lang.reflect.Method</code>, <code class="literal">java.lang.reflect.Field</code>, and
<code class="literal">java.lang.reflect.Constructor</code> instances for increased performance.</p>
<p>The <code class="literal">StandardEvaluationContext</code> is where you may specify the root object to evaluate
against via the method <code class="literal">setRootObject()</code> or passing the root object into the
constructor. You can also specify variables and functions that will be used in the
expression using the methods <code class="literal">setVariable()</code> and <code class="literal">registerFunction()</code>. The use of
variables and functions are described in the language reference sections
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-ref-variables" title="10.5.11 Variables">Variables</a> and <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-ref-functions" title="10.5.12 Functions">Functions</a>. The
<code class="literal">StandardEvaluationContext</code> is also where you can register custom
<code class="literal">ConstructorResolver</code>s, <code class="literal">MethodResolver</code>s, and <code class="literal">PropertyAccessor</code>s to extend how SpEL
evaluates expressions. Please refer to the javadoc of these classes for more details.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="expressions-type-conversion" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-type-conversion"></a>Type Conversion</h4></div></div></div>

<p>By default SpEL uses the conversion service available in Spring core (
<code class="literal">org.springframework.core.convert.ConversionService</code>). This conversion service comes
with many converters built in for common conversions but is also fully extensible so
custom conversions between types can be added. Additionally it has the key capability
that it is generics aware. This means that when working with generic types in
expressions, SpEL will attempt conversions to maintain type correctness for any objects
it encounters.</p>
<p>What does this mean in practice? Suppose assignment, using <code class="literal">setValue()</code>, is being used
to set a <code class="literal">List</code> property. The type of the property is actually <code class="literal">List&lt;Boolean&gt;</code>. SpEL
will recognize that the elements of the list need to be converted to <code class="literal">Boolean</code> before
being placed in it. A simple example:</p>
<pre class="programlisting"><span class="hl-keyword">class</span> Simple {
    <span class="hl-keyword">public</span> List&lt;Boolean&gt; booleanList = <span class="hl-keyword">new</span> ArrayList&lt;Boolean&gt;();
}

Simple simple = <span class="hl-keyword">new</span> Simple();

simple.booleanList.add(true);

StandardEvaluationContext simpleContext = <span class="hl-keyword">new</span> StandardEvaluationContext(simple);

<span class="hl-comment">// false is passed in here as a string. SpEL and the conversion service will</span>
<span class="hl-comment">// correctly recognize that it needs to be a Boolean and convert it</span>
parser.parseExpression(<span class="hl-string">"booleanList[0]"</span>).setValue(simpleContext, <span class="hl-string">"false"</span>);

<span class="hl-comment">// b will be false</span>
Boolean b = simple.booleanList.get(<span class="hl-number">0</span>);</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-parser-configuration" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-parser-configuration"></a>10.3.2&nbsp;Parser configuration</h3></div></div></div>

<p>It is possible to configure the SpEL expression parser using a parser configuration object
(<code class="literal">org.springframework.expression.spel.SpelParserConfiguration</code>). The configuration
object controls the behavior of some of the expression components. For example, if
indexing into an array or collection and the element at the specified index is <code class="literal">null</code>
it is possible to automatically create the element. This is useful when using expressions made up of a
chain of property references. If indexing into an array or list
and specifying an index that is beyond the end of the current size of the array or
list it is possible to automatically grow the array or list to accommodate that index.</p>
<pre class="programlisting"><span class="hl-keyword">class</span> Demo {
    <span class="hl-keyword">public</span> List&lt;String&gt; list;
}

<span class="hl-comment">// Turn on:</span>
<span class="hl-comment">// - auto null reference initialization</span>
<span class="hl-comment">// - auto collection growing</span>
SpelParserConfiguration config = <span class="hl-keyword">new</span> SpelParserConfiguration(true,true);

ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser(config);

Expression expression = parser.parseExpression(<span class="hl-string">"list[3]"</span>);

Demo demo = <span class="hl-keyword">new</span> Demo();

Object o = expression.getValue(demo);

<span class="hl-comment">// demo.list will now be a real collection of 4 entries</span>
<span class="hl-comment">// Each entry is a new empty String</span></pre>
<p>It is also possible to configure the behaviour of the SpEL expression compiler.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-spel-compilation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-spel-compilation"></a>10.3.3&nbsp;SpEL compilation</h3></div></div></div>

<p>Spring Framework 4.1 includes a basic expression compiler. Expressions are usually
interpreted which provides a lot of dynamic flexibility during evaluation but
does not provide the optimum performance. For occasional expression usage
this is fine, but when used by other components like Spring Integration,
performance can be very important and there is no real need for the dynamism.</p>
<p>The new SpEL compiler is intended to address this need. The
compiler will generate a real Java class on the fly during evaluation that embodies the
expression behavior and use that to achieve much faster expression
evaluation. Due to the lack of typing around expressions the compiler
uses information gathered during the interpreted evaluations of an
expression when performing compilation. For example, it does not know the type
of a property reference purely from the expression but during the first
interpreted evaluation it will find out what it is. Of course, basing the
compilation on this information could cause trouble later if the types of
the various expression elements change over time. For this reason compilation
is best suited to expressions whose type information is not going to change
on repeated evaluations.</p>
<p>For a basic expression like this:</p>
<p><code class="literal">someArray[0].someProperty.someOtherProperty &lt; 0.1</code></p>
<p>which involves array access, some property derefencing and numeric operations, the performance
gain can be very noticeable. In an example micro benchmark run of 50000 iterations, it was
taking 75ms to evaluate using only the interpreter and just 3ms using the compiled version
of the expression.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="expressions-compiler-configuration" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-compiler-configuration"></a>Compiler configuration</h4></div></div></div>

<p>The compiler is not turned on by default, but there are two ways to turn
it on. It can be turned on using the parser configuration process discussed earlier or
via a system property when SpEL usage is embedded inside another component. This section
discusses both of these options.</p>
<p>It is important to understand that there are a few modes the compiler can operate in, captured
in an enum (<code class="literal">org.springframework.expression.spel.SpelCompilerMode</code>). The modes are as follows:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">OFF</code> - The compiler is switched off; this is the default.
</li><li class="listitem">
<code class="literal">IMMEDIATE</code> - In immediate mode the expressions are compiled as soon as possible. This
is typically after the first interpreted evaluation. If the compiled expression fails
(typically due to a type changing, as described above) then the caller of the expression
evaluation will receive an exception.
</li><li class="listitem">
<code class="literal">MIXED</code> - In mixed mode the expressions silently switch between interpreted and compiled
mode over time.  After some number of interpreted runs they will switch to compiled
form and if something goes wrong with the compiled form (like a type changing, as
described above) then the expression will automatically switch back to interpreted form
again. Sometime later it may generate another compiled form and switch to it. Basically
the exception that the user gets in <code class="literal">IMMEDIATE</code> mode is instead handled internally.
</li></ul></div>
<p><code class="literal">IMMEDIATE</code> mode exists because <code class="literal">MIXED</code> mode could cause issues for expressions that
have side effects. If a compiled expression blows up after partially succeeding it
may have already done something that has affected the state of the system. If this
has happened the caller may not want it to silently re-run in interpreted mode
since part of the expression may be running twice.</p>
<p>After selecting a mode, use the <code class="literal">SpelParserConfiguration</code> to configure the parser:</p>
<pre class="programlisting">SpelParserConfiguration config = <span class="hl-keyword">new</span> SpelParserConfiguration(SpelCompilerMode.IMMEDIATE,
    <span class="hl-keyword">this</span>.getClass().getClassLoader());

SpelExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser(config);

Expression expr = parser.parseExpression(<span class="hl-string">"payload"</span>);

MyMessage message = <span class="hl-keyword">new</span> MyMessage();

Object payload = expr.getValue(message);</pre>
<p>When specifying the compiler mode it is also possible to specify a classloader (passing null is allowed).
Compiled expressions will be defined in a child classloader created under any that is supplied.
It is important to ensure if a classloader is specified it can see all the types involved in
the expression evaluation process.
If none is specified then a default classloader will be used (typically the context classloader for
the thread that is running during expression evaluation).</p>
<p>The second way to configure the compiler is for use when SpEL is embedded inside some other
component and it may not be possible to configure via a configuration object.
In these cases it is possible to use a system property. The property
<code class="literal">spring.expression.compiler.mode</code> can be set to one of the <code class="literal">SpelCompilerMode</code>
enum values (<code class="literal">off</code>, <code class="literal">immediate</code>, or <code class="literal">mixed</code>).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="expressions-compiler-limitations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-compiler-limitations"></a>Compiler limitations</h4></div></div></div>

<p>With Spring Framework 4.1 the basic compilation framework is in place. However, the framework does not
yet support compiling every kind of expression. The initial focus has been on the common expressions that are
likely to be used in performance critical contexts.  These kinds of expression cannot be compiled
at the moment:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
expressions involving assignment
</li><li class="listitem">
expressions relying on the conversion service
</li><li class="listitem">
expressions using custom resolvers or accessors
</li><li class="listitem">
expressions using selection or projection
</li></ul></div>
<p>More and more types of expression will be compilable in the future.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-beandef" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-beandef"></a>10.4&nbsp;Expression support for defining bean definitions</h2></div></div></div>

<p>SpEL expressions can be used with XML or annotation-based configuration metadata for
defining <code class="literal">BeanDefinition</code>s. In both cases the syntax to define the expression is of the
form <code class="literal">#{ &lt;expression string&gt; }</code>.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-beandef-xml-based" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-beandef-xml-based"></a>10.4.1&nbsp;XML based configuration</h3></div></div></div>

<p>A property or constructor-arg value can be set using expressions as shown below.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"numberGuess"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.spring.samples.NumberGuess"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"randomNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{ T(java.lang.Math).random() * 100.0 }"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- other properties --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The variable <code class="literal">systemProperties</code> is predefined, so you can use it in your expressions as
shown below. Note that you do not have to prefix the predefined variable with the <code class="literal">#</code>
symbol in this context.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"taxCalculator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.spring.samples.TaxCalculator"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"defaultLocale"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{ systemProperties['user.region'] }"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- other properties --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>You can also refer to other bean properties by name, for example.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"numberGuess"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.spring.samples.NumberGuess"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"randomNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{ T(java.lang.Math).random() * 100.0 }"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- other properties --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"shapeGuess"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.spring.samples.ShapeGuess"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"initialShapeSeed"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{ numberGuess.randomNumber }"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- other properties --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-beandef-annotation-based" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-beandef-annotation-based"></a>10.4.2&nbsp;Annotation-based configuration</h3></div></div></div>

<p>The <code class="literal">@Value</code> annotation can be placed on fields, methods and method/constructor
parameters to specify a default value.</p>
<p>Here is an example to set the default value of a field variable.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> FieldValueTestBean

    <em><span class="hl-annotation" style="color: gray">@Value("#{ systemProperties['user.region'] }")</span></em>
    <span class="hl-keyword">private</span> String defaultLocale;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDefaultLocale(String defaultLocale) {
        <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
    }

    <span class="hl-keyword">public</span> String getDefaultLocale() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.defaultLocale;
    }

}</pre>
<p>The equivalent but on a property setter method is shown below.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> PropertyValueTestBean

    <span class="hl-keyword">private</span> String defaultLocale;

    <em><span class="hl-annotation" style="color: gray">@Value("#{ systemProperties['user.region'] }")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDefaultLocale(String defaultLocale) {
        <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
    }

    <span class="hl-keyword">public</span> String getDefaultLocale() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.defaultLocale;
    }

}</pre>
<p>Autowired methods and constructors can also use the <code class="literal">@Value</code> annotation.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;
    <span class="hl-keyword">private</span> String defaultLocale;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configure(MovieFinder movieFinder,
            <em><span class="hl-annotation" style="color: gray">@Value("#{ systemProperties['user.region'] }")</span></em> String defaultLocale) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
        <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
    }

    <span class="hl-comment">// ...</span>
}</pre>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> String defaultLocale;

    <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao,
            <em><span class="hl-annotation" style="color: gray">@Value("#{systemProperties['user.country']}")</span></em> String defaultLocale) {
        <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
        <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
    }

    <span class="hl-comment">// ...</span>
}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-language-ref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-language-ref"></a>10.5&nbsp;Language Reference</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-ref-literal" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-ref-literal"></a>10.5.1&nbsp;Literal expressions</h3></div></div></div>

<p>The types of literal expressions supported are strings, numeric values (int, real, hex),
boolean and null. Strings are delimited by single quotes. To put a single quote itself
in a string, use two single quote characters.</p>
<p>The following listing shows simple usage of literals. Typically they would not be used
in isolation like this but rather as part of a more complex expression, for example
using a literal on one side of a logical comparison operator.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// evals to "Hello World"</span>
String helloWorld = (String) parser.parseExpression(<span class="hl-string">"'Hello World'"</span>).getValue();

<span class="hl-keyword">double</span> avogadrosNumber = (Double) parser.parseExpression(<span class="hl-string">"6.0221415E+23"</span>).getValue();

<span class="hl-comment">// evals to 2147483647</span>
<span class="hl-keyword">int</span> maxValue = (Integer) parser.parseExpression(<span class="hl-string">"0x7FFFFFFF"</span>).getValue();

<span class="hl-keyword">boolean</span> trueValue = (Boolean) parser.parseExpression(<span class="hl-string">"true"</span>).getValue();

Object nullValue = parser.parseExpression(<span class="hl-string">"null"</span>).getValue();</pre>
<p>Numbers support the use of the negative sign, exponential notation, and decimal points.
By default real numbers are parsed using Double.parseDouble().</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-properties-arrays" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-properties-arrays"></a>10.5.2&nbsp;Properties, Arrays, Lists, Maps, Indexers</h3></div></div></div>

<p>Navigating with property references is easy: just use a period to indicate a nested
property value. The instances of the <code class="literal">Inventor</code> class, pupin, and tesla, were populated with
data listed in the section <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-example-classes" title="10.6 Classes used in the examples">Classes used in the examples</a>.
To navigate "down" and get Tesla’s year of birth and Pupin’s city of birth the following
expressions are used.</p>
<pre class="programlisting"><span class="hl-comment">// evals to 1856</span>
<span class="hl-keyword">int</span> year = (Integer) parser.parseExpression(<span class="hl-string">"Birthdate.Year + 1900"</span>).getValue(context);

String city = (String) parser.parseExpression(<span class="hl-string">"placeOfBirth.City"</span>).getValue(context);</pre>
<p>Case insensitivity is allowed for the first letter of property names. The contents of
arrays and lists are obtained using square bracket notation.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// Inventions Array</span>
StandardEvaluationContext teslaContext = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

<span class="hl-comment">// evaluates to "Induction motor"</span>
String invention = parser.parseExpression(<span class="hl-string">"inventions[3]"</span>).getValue(
        teslaContext, String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// Members List</span>
StandardEvaluationContext societyContext = <span class="hl-keyword">new</span> StandardEvaluationContext(ieee);

<span class="hl-comment">// evaluates to "Nikola Tesla"</span>
String name = parser.parseExpression(<span class="hl-string">"Members[0].Name"</span>).getValue(
        societyContext, String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// List and Array navigation</span>
<span class="hl-comment">// evaluates to "Wireless communication"</span>
String invention = parser.parseExpression(<span class="hl-string">"Members[0].Inventions[6]"</span>).getValue(
        societyContext, String.<span class="hl-keyword">class</span>);</pre>
<p>The contents of maps are obtained by specifying the literal key value within the
brackets. In this case, because keys for the Officers map are strings, we can specify
string literals.</p>
<pre class="programlisting"><span class="hl-comment">// Officer's Dictionary</span>

Inventor pupin = parser.parseExpression(<span class="hl-string">"Officers['president']"</span>).getValue(
        societyContext, Inventor.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to "Idvor"</span>
String city = parser.parseExpression(<span class="hl-string">"Officers['president'].PlaceOfBirth.City"</span>).getValue(
        societyContext, String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// setting values</span>
parser.parseExpression(<span class="hl-string">"Officers['advisors'][0].PlaceOfBirth.Country"</span>).setValue(
        societyContext, <span class="hl-string">"Croatia"</span>);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-inline-lists" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-inline-lists"></a>10.5.3&nbsp;Inline lists</h3></div></div></div>

<p>Lists can be expressed directly in an expression using <code class="literal">{}</code> notation.</p>
<pre class="programlisting"><span class="hl-comment">// evaluates to a Java list containing the four numbers</span>
List numbers = (List) parser.parseExpression(<span class="hl-string">"{1,2,3,4}"</span>).getValue(context);

List listOfLists = (List) parser.parseExpression(<span class="hl-string">"{{'a','b'},{'x','y'}}"</span>).getValue(context);</pre>
<p><code class="literal">{}</code> by itself means an empty list. For performance reasons, if the list is itself
entirely composed of fixed literals then a constant list is created to represent the
expression, rather than building a new list on each evaluation.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-inline-maps" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-inline-maps"></a>10.5.4&nbsp;Inline Maps</h3></div></div></div>

<p>Maps can also be expressed directly in an expression using <code class="literal">{key:value}</code> notation.</p>
<pre class="programlisting"><span class="hl-comment">// evaluates to a Java map containing the two entries</span>
Map inventorInfo = (Map) parser.parseExpression(<span class="hl-string">"{name:'Nikola',dob:'10-July-1856'}"</span>).getValue(context);

Map mapOfMaps = (Map) parser.parseExpression(<span class="hl-string">"{name:{first:'Nikola',last:'Tesla'},dob:{day:10,month:'July',year:1856}}"</span>).getValue(context);</pre>
<p><code class="literal">{:}</code> by itself means an empty map. For performance reasons, if the map is itself composed
of fixed literals or other nested constant structures (lists or maps) then a constant map is created
to represent the expression, rather than building a new map on each evaluation. Quoting of the map keys
is optional, the examples above are not using quoted keys.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-array-construction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-array-construction"></a>10.5.5&nbsp;Array construction</h3></div></div></div>

<p>Arrays can be built using the familiar Java syntax, optionally supplying an initializer
to have the array populated at construction time.</p>
<pre class="programlisting"><span class="hl-keyword">int</span>[] numbers1 = (<span class="hl-keyword">int</span>[]) parser.parseExpression(<span class="hl-string">"new int[4]"</span>).getValue(context);

<span class="hl-comment">// Array with initializer</span>
<span class="hl-keyword">int</span>[] numbers2 = (<span class="hl-keyword">int</span>[]) parser.parseExpression(<span class="hl-string">"new int[]{1,2,3}"</span>).getValue(context);

<span class="hl-comment">// Multi dimensional array</span>
<span class="hl-keyword">int</span>[][] numbers3 = (<span class="hl-keyword">int</span>[][]) parser.parseExpression(<span class="hl-string">"new int[4][5]"</span>).getValue(context);</pre>
<p>It is not currently allowed to supply an initializer when constructing a
multi-dimensional array.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-methods" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-methods"></a>10.5.6&nbsp;Methods</h3></div></div></div>

<p>Methods are invoked using typical Java programming syntax. You may also invoke methods
on literals. Varargs are also supported.</p>
<pre class="programlisting"><span class="hl-comment">// string literal, evaluates to "bc"</span>
String c = parser.parseExpression(<span class="hl-string">"'abc'.substring(2, 3)"</span>).getValue(String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> isMember = parser.parseExpression(<span class="hl-string">"isMember('Mihajlo Pupin')"</span>).getValue(
        societyContext, Boolean.<span class="hl-keyword">class</span>);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-operators" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operators"></a>10.5.7&nbsp;Operators</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="expressions-operators-relational" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operators-relational"></a>Relational operators</h4></div></div></div>

<p>The relational operators; equal, not equal, less than, less than or equal, greater than,
and greater than or equal are supported using standard operator notation.</p>
<pre class="programlisting"><span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(<span class="hl-string">"2 == 2"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">"2 &lt; -5.0"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(<span class="hl-string">"'black' &lt; 'block'"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Greater/less-than comparisons against <code class="literal">null</code> follow a simple rule: <code class="literal">null</code> is treated as
nothing here (i.e. NOT as zero). As a consequence, any other value is always greater
than <code class="literal">null</code> (<code class="literal">X &gt; null</code> is always <code class="literal">true</code>) and no other value is ever less than nothing
(<code class="literal">X &lt; null</code> is always <code class="literal">false</code>).</p>
<p>If you prefer numeric comparisons instead, please avoid number-based <code class="literal">null</code> comparisons
in favor of comparisons against zero (e.g. <code class="literal">X &gt; 0</code> or <code class="literal">X &lt; 0</code>).</p>
</td></tr></tbody></table></div>
<p>In addition to standard relational operators SpEL supports the <code class="literal">instanceof</code> and regular
expression based <code class="literal">matches</code> operator.</p>
<pre class="programlisting"><span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(
        <span class="hl-string">"'xyz' instanceof T(Integer)"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(
        <span class="hl-string">"'5.00' matches '\^-?\\d+(\\.\\d{2})?$'"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">//evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(
        <span class="hl-string">"'5.0067' matches '\^-?\\d+(\\.\\d{2})?$'"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Be careful with primitive types as they are immediately boxed up to the wrapper type,
so <code class="literal">1 instanceof T(int)</code> evaluates to <code class="literal">false</code> while <code class="literal">1 instanceof T(Integer)</code>
evaluates to <code class="literal">true</code>, as expected.</p>
</td></tr></tbody></table></div>
<p>Each symbolic operator can also be specified as a purely alphabetic equivalent. This
avoids problems where the symbols used have special meaning for the document type in
which the expression is embedded (eg. an XML document). The textual equivalents are
shown here: <code class="literal">lt</code> (<code class="literal">&lt;</code>), <code class="literal">gt</code> (<code class="literal">&gt;</code>), <code class="literal">le</code> (<code class="literal">&#8656;</code>), <code class="literal">ge</code> (<code class="literal">&gt;=</code>), <code class="literal">eq</code> (<code class="literal">==</code>),
<code class="literal">ne</code> (<code class="literal">!=</code>), <code class="literal">div</code> (<code class="literal">/</code>), <code class="literal">mod</code> (<code class="literal">%</code>), <code class="literal">not</code> (<code class="literal">!</code>). These are case insensitive.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="expressions-operators-logical" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operators-logical"></a>Logical operators</h4></div></div></div>

<p>The logical operators that are supported are and, or, and not. Their use is demonstrated
below.</p>
<pre class="programlisting"><span class="hl-comment">// -- AND --</span>

<span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">"true and false"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
String expression = <span class="hl-string">"isMember('Nikola Tesla') and isMember('Mihajlo Pupin')"</span>;
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// -- OR --</span>

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(<span class="hl-string">"true or false"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
String expression = <span class="hl-string">"isMember('Nikola Tesla') or isMember('Albert Einstein')"</span>;
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// -- NOT --</span>

<span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">"!true"</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// -- AND and NOT --</span>
String expression = <span class="hl-string">"isMember('Nikola Tesla') and !isMember('Mihajlo Pupin')"</span>;
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(expression).getValue(societyContext, Boolean.<span class="hl-keyword">class</span>);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="expressions-operators-mathematical" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operators-mathematical"></a>Mathematical operators</h4></div></div></div>

<p>The addition operator can be used on both numbers and strings. Subtraction, multiplication
and division can be used only on numbers. Other mathematical operators supported are
modulus (%) and exponential power (^). Standard operator precedence is enforced. These
operators are demonstrated below.</p>
<pre class="programlisting"><span class="hl-comment">// Addition</span>
<span class="hl-keyword">int</span> two = parser.parseExpression(<span class="hl-string">"1 + 1"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 2</span>

String testString = parser.parseExpression(
        <span class="hl-string">"'test' + ' ' + 'string'"</span>).getValue(String.<span class="hl-keyword">class</span>); <span class="hl-comment">// 'test string'</span>

<span class="hl-comment">// Subtraction</span>
<span class="hl-keyword">int</span> four = parser.parseExpression(<span class="hl-string">"1 - -3"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 4</span>

<span class="hl-keyword">double</span> d = parser.parseExpression(<span class="hl-string">"1000.00 - 1e4"</span>).getValue(Double.<span class="hl-keyword">class</span>); <span class="hl-comment">// -9000</span>

<span class="hl-comment">// Multiplication</span>
<span class="hl-keyword">int</span> six = parser.parseExpression(<span class="hl-string">"-2 * -3"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 6</span>

<span class="hl-keyword">double</span> twentyFour = parser.parseExpression(<span class="hl-string">"2.0 * 3e0 * 4"</span>).getValue(Double.<span class="hl-keyword">class</span>); <span class="hl-comment">// 24.0</span>

<span class="hl-comment">// Division</span>
<span class="hl-keyword">int</span> minusTwo = parser.parseExpression(<span class="hl-string">"6 / -3"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// -2</span>

<span class="hl-keyword">double</span> one = parser.parseExpression(<span class="hl-string">"8.0 / 4e0 / 2"</span>).getValue(Double.<span class="hl-keyword">class</span>); <span class="hl-comment">// 1.0</span>

<span class="hl-comment">// Modulus</span>
<span class="hl-keyword">int</span> three = parser.parseExpression(<span class="hl-string">"7 % 4"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 3</span>

<span class="hl-keyword">int</span> one = parser.parseExpression(<span class="hl-string">"8 / 5 % 2"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 1</span>

<span class="hl-comment">// Operator precedence</span>
<span class="hl-keyword">int</span> minusTwentyOne = parser.parseExpression(<span class="hl-string">"1+2-3*8"</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// -21</span></pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-assignment" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-assignment"></a>10.5.8&nbsp;Assignment</h3></div></div></div>

<p>Setting of a property is done by using the assignment operator. This would typically be
done within a call to <code class="literal">setValue</code> but can also be done inside a call to <code class="literal">getValue</code>.</p>
<pre class="programlisting">Inventor inventor = <span class="hl-keyword">new</span> Inventor();
StandardEvaluationContext inventorContext = <span class="hl-keyword">new</span> StandardEvaluationContext(inventor);

parser.parseExpression(<span class="hl-string">"Name"</span>).setValue(inventorContext, <span class="hl-string">"Alexander Seovic2"</span>);

<span class="hl-comment">// alternatively</span>

String aleks = parser.parseExpression(
        <span class="hl-string">"Name = 'Alexandar Seovic'"</span>).getValue(inventorContext, String.<span class="hl-keyword">class</span>);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-types" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-types"></a>10.5.9&nbsp;Types</h3></div></div></div>

<p>The special <code class="literal">T</code> operator can be used to specify an instance of java.lang.Class (the
<span class="emphasis"><em>type</em></span>). Static methods are invoked using this operator as well. The
<code class="literal">StandardEvaluationContext</code> uses a <code class="literal">TypeLocator</code> to find types and the
<code class="literal">StandardTypeLocator</code> (which can be replaced) is built with an understanding of the
java.lang package. This means T() references to types within java.lang do not need to be
fully qualified, but all other type references must be.</p>
<pre class="programlisting">Class dateClass = parser.parseExpression(<span class="hl-string">"T(java.util.Date)"</span>).getValue(Class.<span class="hl-keyword">class</span>);

Class stringClass = parser.parseExpression(<span class="hl-string">"T(String)"</span>).getValue(Class.<span class="hl-keyword">class</span>);

<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(
        <span class="hl-string">"T(java.math.RoundingMode).CEILING &lt; T(java.math.RoundingMode).FLOOR"</span>)
        .getValue(Boolean.<span class="hl-keyword">class</span>);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-constructors" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-constructors"></a>10.5.10&nbsp;Constructors</h3></div></div></div>

<p>Constructors can be invoked using the new operator. The fully qualified class name
should be used for all but the primitive type and String (where int, float, etc, can be
used).</p>
<pre class="programlisting">Inventor einstein = p.parseExpression(
        <span class="hl-string">"new org.spring.samples.spel.inventor.Inventor('Albert Einstein', 'German')"</span>)
        .getValue(Inventor.<span class="hl-keyword">class</span>);

<span class="hl-comment">//create new inventor instance within add method of List</span>
p.parseExpression(
        <span class="hl-string">"Members.add(new org.spring.samples.spel.inventor.Inventor(
</span>            <span class="hl-string">'Albert Einstein'</span>, <span class="hl-string">'German'</span>))<span class="hl-string">").getValue(societyContext);</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-ref-variables" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-ref-variables"></a>10.5.11&nbsp;Variables</h3></div></div></div>

<p>Variables can be referenced in the expression using the syntax <code class="literal">#variableName</code>. Variables
are set using the method setVariable on the <code class="literal">StandardEvaluationContext</code>.</p>
<pre class="programlisting">Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, <span class="hl-string">"Serbian"</span>);
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);
context.setVariable(<span class="hl-string">"newName"</span>, <span class="hl-string">"Mike Tesla"</span>);

parser.parseExpression(<span class="hl-string">"Name = #newName"</span>).getValue(context);

System.out.println(tesla.getName()) <span class="hl-comment">// "Mike Tesla"</span></pre>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="expressions-this-root" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-this-root"></a>The #this and #root variables</h4></div></div></div>

<p>The variable #this is always defined and refers to the current evaluation object
(against which unqualified references are resolved). The variable #root is always
defined and refers to the root context object. Although #this may vary as components of
an expression are evaluated, #root always refers to the root.</p>
<pre class="programlisting"><span class="hl-comment">// create an array of integers</span>
List&lt;Integer&gt; primes = <span class="hl-keyword">new</span> ArrayList&lt;Integer&gt;();
primes.addAll(Arrays.asList(<span class="hl-number">2</span>,<span class="hl-number">3</span>,<span class="hl-number">5</span>,<span class="hl-number">7</span>,<span class="hl-number">11</span>,<span class="hl-number">13</span>,<span class="hl-number">17</span>));

<span class="hl-comment">// create parser and set variable 'primes' as the array of integers</span>
ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();
context.setVariable(<span class="hl-string">"primes"</span>,primes);

<span class="hl-comment">// all prime numbers &gt; 10 from the list (using selection ?{...})</span>
<span class="hl-comment">// evaluates to [11, 13, 17]</span>
List&lt;Integer&gt; primesGreaterThanTen = (List&lt;Integer&gt;) parser.parseExpression(
        <span class="hl-string">"#primes.?[#this&gt;10]"</span>).getValue(context);</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-ref-functions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-ref-functions"></a>10.5.12&nbsp;Functions</h3></div></div></div>

<p>You can extend SpEL by registering user defined functions that can be called within the
expression string. The function is registered with the <code class="literal">StandardEvaluationContext</code> using
the method.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerFunction(String name, Method m)</pre>
<p>A reference to a Java Method provides the implementation of the function. For example, a
utility method to reverse a string is shown below.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> StringUtils {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> String reverseString(String input) {
        StringBuilder backwards = <span class="hl-keyword">new</span> StringBuilder();
        <span class="hl-keyword">for</span> (<span class="hl-keyword">int</span> i = <span class="hl-number">0</span>; i &lt; input.length(); i++)
            backwards.append(input.charAt(input.length() - <span class="hl-number">1</span> - i));
        }
        <span class="hl-keyword">return</span> backwards.toString();
    }
}</pre>
<p>This method is then registered with the evaluation context and can be used within an
expression string.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();

context.registerFunction(<span class="hl-string">"reverseString"</span>,
    StringUtils.<span class="hl-keyword">class</span>.getDeclaredMethod(<span class="hl-string">"reverseString"</span>, <span class="hl-keyword">new</span> Class[] { String.<span class="hl-keyword">class</span> }));

String helloWorldReversed = parser.parseExpression(
    <span class="hl-string">"#reverseString('hello')"</span>).getValue(context, String.<span class="hl-keyword">class</span>);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-bean-references" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-bean-references"></a>10.5.13&nbsp;Bean references</h3></div></div></div>

<p>If the evaluation context has been configured with a bean resolver it is possible to
lookup beans from an expression using the (@) symbol.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();
context.setBeanResolver(<span class="hl-keyword">new</span> MyBeanResolver());

<span class="hl-comment">// This will end up calling resolve(context,"foo") on MyBeanResolver during evaluation</span>
Object bean = parser.parseExpression(<span class="hl-string">"@foo"</span>).getValue(context);</pre>
<p>To access a factory bean itself, the bean name should instead be prefixed with a (&amp;) symbol.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();
context.setBeanResolver(<span class="hl-keyword">new</span> MyBeanResolver());

<span class="hl-comment">// This will end up calling resolve(context,"&amp;foo") on MyBeanResolver during evaluation</span>
Object bean = parser.parseExpression(<span class="hl-string">"&amp;foo"</span>).getValue(context);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-operator-ternary" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operator-ternary"></a>10.5.14&nbsp;Ternary Operator (If-Then-Else)</h3></div></div></div>

<p>You can use the ternary operator for performing if-then-else conditional logic inside
the expression. A minimal example is:</p>
<pre class="programlisting">String falseString = parser.parseExpression(
        <span class="hl-string">"false ? 'trueExp' : 'falseExp'"</span>).getValue(String.<span class="hl-keyword">class</span>);</pre>
<p>In this case, the boolean false results in returning the string value 'falseExp'. A more
realistic example is shown below.</p>
<pre class="programlisting">parser.parseExpression(<span class="hl-string">"Name"</span>).setValue(societyContext, <span class="hl-string">"IEEE"</span>);
societyContext.setVariable(<span class="hl-string">"queryName"</span>, <span class="hl-string">"Nikola Tesla"</span>);

expression = <span class="hl-string">"isMember(#queryName)? #queryName + ' is a member of the ' "</span> +
        <span class="hl-string">"+ Name + ' Society' : #queryName + ' is not a member of the ' + Name + ' Society'"</span>;

String queryResultString = parser.parseExpression(expression)
        .getValue(societyContext, String.<span class="hl-keyword">class</span>);
<span class="hl-comment">// queryResultString = "Nikola Tesla is a member of the IEEE Society"</span></pre>
<p>Also see the next section on the Elvis operator for an even shorter syntax for the
ternary operator.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-operator-elvis" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operator-elvis"></a>10.5.15&nbsp;The Elvis Operator</h3></div></div></div>

<p>The Elvis operator is a shortening of the ternary operator syntax and is used in the
<a class="ulink" href="http://www.groovy-lang.org/operators.html#_elvis_operator" target="_top">Groovy</a> language.
With the ternary operator syntax you usually have to repeat a variable twice, for
example:</p>
<pre class="programlisting">String name = <span class="hl-string">"Elvis Presley"</span>;
String displayName = name != null ? name : <span class="hl-string">"Unknown"</span>;</pre>
<p>Instead you can use the Elvis operator, named for the resemblance to Elvis' hair style.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

String name = parser.parseExpression(<span class="hl-string">"name?:'Unknown'"</span>).getValue(String.<span class="hl-keyword">class</span>);

System.out.println(name); <span class="hl-comment">// 'Unknown'</span></pre>
<p>Here is a more complex example.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, <span class="hl-string">"Serbian"</span>);
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

String name = parser.parseExpression(<span class="hl-string">"Name?:'Elvis Presley'"</span>).getValue(context, String.<span class="hl-keyword">class</span>);

System.out.println(name); <span class="hl-comment">// Nikola Tesla</span>

tesla.setName(null);

name = parser.parseExpression(<span class="hl-string">"Name?:'Elvis Presley'"</span>).getValue(context, String.<span class="hl-keyword">class</span>);

System.out.println(name); <span class="hl-comment">// Elvis Presley</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-operator-safe-navigation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-operator-safe-navigation"></a>10.5.16&nbsp;Safe Navigation operator</h3></div></div></div>

<p>The Safe Navigation operator is used to avoid a <code class="literal">NullPointerException</code> and comes from
the <a class="ulink" href="http://www.groovy-lang.org/operators.html#_safe_navigation_operator" target="_top">Groovy</a>
language. Typically when you have a reference to an object you might need to verify that
it is not null before accessing methods or properties of the object. To avoid this, the
safe navigation operator will simply return null instead of throwing an exception.</p>
<pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">"Nikola Tesla"</span>, <span class="hl-string">"Serbian"</span>);
tesla.setPlaceOfBirth(<span class="hl-keyword">new</span> PlaceOfBirth(<span class="hl-string">"Smiljan"</span>));

StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

String city = parser.parseExpression(<span class="hl-string">"PlaceOfBirth?.City"</span>).getValue(context, String.<span class="hl-keyword">class</span>);
System.out.println(city); <span class="hl-comment">// Smiljan</span>

tesla.setPlaceOfBirth(null);

city = parser.parseExpression(<span class="hl-string">"PlaceOfBirth?.City"</span>).getValue(context, String.<span class="hl-keyword">class</span>);

System.out.println(city); <span class="hl-comment">// null - does not throw NullPointerException!!!</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The Elvis operator can be used to apply default values in expressions, e.g. in an
<code class="literal">@Value</code> expression:</p>
<pre class="programlisting">@Value(<span class="hl-string">"#{systemProperties['pop3.port'] ?: 25}"</span>)</pre>
<p>This will inject a system property <code class="literal">pop3.port</code> if it is defined or 25 if not.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-collection-selection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-collection-selection"></a>10.5.17&nbsp;Collection Selection</h3></div></div></div>

<p>Selection is a powerful expression language feature that allows you to transform some
source collection into another by selecting from its entries.</p>
<p>Selection uses the syntax <code class="literal">.?[selectionExpression]</code>. This will filter the collection and
return a new collection containing a subset of the original elements. For example,
selection would allow us to easily get a list of Serbian inventors:</p>
<pre class="programlisting">List&lt;Inventor&gt; list = (List&lt;Inventor&gt;) parser.parseExpression(
        <span class="hl-string">"Members.?[Nationality == 'Serbian']"</span>).getValue(societyContext);</pre>
<p>Selection is possible upon both lists and maps. In the former case the selection
criteria is evaluated against each individual list element whilst against a map the
selection criteria is evaluated against each map entry (objects of the Java type
<code class="literal">Map.Entry</code>). Map entries have their key and value accessible as properties for use in
the selection.</p>
<p>This expression will return a new map consisting of those elements of the original map
where the entry value is less than 27.</p>
<pre class="programlisting">Map newMap = parser.parseExpression(<span class="hl-string">"map.?[value&lt;27]"</span>).getValue();</pre>
<p>In addition to returning all the selected elements, it is possible to retrieve just the
first or the last value. To obtain the first entry matching the selection the syntax is
<code class="literal">^[…&#8203;]</code> whilst to obtain the last matching selection the syntax is <code class="literal">$[…&#8203;]</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-collection-projection" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-collection-projection"></a>10.5.18&nbsp;Collection Projection</h3></div></div></div>

<p>Projection allows a collection to drive the evaluation of a sub-expression and the
result is a new collection. The syntax for projection is <code class="literal">![projectionExpression]</code>. Most
easily understood by example, suppose we have a list of inventors but want the list of
cities where they were born. Effectively we want to evaluate 'placeOfBirth.city' for
every entry in the inventor list. Using projection:</p>
<pre class="programlisting"><span class="hl-comment">// returns ['Smiljan', 'Idvor' ]</span>
List placesOfBirth = (List)parser.parseExpression(<span class="hl-string">"Members.![placeOfBirth.city]"</span>);</pre>
<p>A map can also be used to drive projection and in this case the projection expression is
evaluated against each entry in the map (represented as a Java <code class="literal">Map.Entry</code>). The result
of a projection across a map is a list consisting of the evaluation of the projection
expression against each map entry.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="expressions-templating" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-templating"></a>10.5.19&nbsp;Expression templating</h3></div></div></div>

<p>Expression templates allow a mixing of literal text with one or more evaluation blocks.
Each evaluation block is delimited with prefix and suffix characters that you can
define, a common choice is to use <code class="literal">#{ }</code> as the delimiters. For example,</p>
<pre class="programlisting">String randomPhrase = parser.parseExpression(
        <span class="hl-string">"random number is #{T(java.lang.Math).random()}"</span>,
        <span class="hl-keyword">new</span> TemplateParserContext()).getValue(String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to "random number is 0.7038186818312008"</span></pre>
<p>The string is evaluated by concatenating the literal text 'random number is ' with the
result of evaluating the expression inside the #{ } delimiter, in this case the result
of calling that random() method. The second argument to the method <code class="literal">parseExpression()</code>
is of the type <code class="literal">ParserContext</code>. The <code class="literal">ParserContext</code> interface is used to influence how
the expression is parsed in order to support the expression templating functionality.
The definition of <code class="literal">TemplateParserContext</code> is shown below.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TemplateParserContext <span class="hl-keyword">implements</span> ParserContext {

    <span class="hl-keyword">public</span> String getExpressionPrefix() {
        <span class="hl-keyword">return</span> <span class="hl-string">"#{"</span>;
    }

    <span class="hl-keyword">public</span> String getExpressionSuffix() {
        <span class="hl-keyword">return</span> <span class="hl-string">"}"</span>;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isTemplate() {
        <span class="hl-keyword">return</span> true;
    }
}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="expressions-example-classes" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions-example-classes"></a>10.6&nbsp;Classes used in the examples</h2></div></div></div>

<p>Inventor.java</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.spring.samples.spel.inventor;

<span class="hl-keyword">import</span> java.util.Date;
<span class="hl-keyword">import</span> java.util.GregorianCalendar;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Inventor {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> String nationality;
    <span class="hl-keyword">private</span> String[] inventions;
    <span class="hl-keyword">private</span> Date birthdate;
    <span class="hl-keyword">private</span> PlaceOfBirth placeOfBirth;

    <span class="hl-keyword">public</span> Inventor(String name, String nationality) {
        GregorianCalendar c= <span class="hl-keyword">new</span> GregorianCalendar();
        <span class="hl-keyword">this</span>.name = name;
        <span class="hl-keyword">this</span>.nationality = nationality;
        <span class="hl-keyword">this</span>.birthdate = c.getTime();
    }

    <span class="hl-keyword">public</span> Inventor(String name, Date birthdate, String nationality) {
        <span class="hl-keyword">this</span>.name = name;
        <span class="hl-keyword">this</span>.nationality = nationality;
        <span class="hl-keyword">this</span>.birthdate = birthdate;
    }

    <span class="hl-keyword">public</span> Inventor() {
    }

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> String getNationality() {
        <span class="hl-keyword">return</span> nationality;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setNationality(String nationality) {
        <span class="hl-keyword">this</span>.nationality = nationality;
    }

    <span class="hl-keyword">public</span> Date getBirthdate() {
        <span class="hl-keyword">return</span> birthdate;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBirthdate(Date birthdate) {
        <span class="hl-keyword">this</span>.birthdate = birthdate;
    }

    <span class="hl-keyword">public</span> PlaceOfBirth getPlaceOfBirth() {
        <span class="hl-keyword">return</span> placeOfBirth;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setPlaceOfBirth(PlaceOfBirth placeOfBirth) {
        <span class="hl-keyword">this</span>.placeOfBirth = placeOfBirth;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setInventions(String[] inventions) {
        <span class="hl-keyword">this</span>.inventions = inventions;
    }

    <span class="hl-keyword">public</span> String[] getInventions() {
        <span class="hl-keyword">return</span> inventions;
    }
}</pre>
<p>PlaceOfBirth.java</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.spring.samples.spel.inventor;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PlaceOfBirth {

    <span class="hl-keyword">private</span> String city;
    <span class="hl-keyword">private</span> String country;

    <span class="hl-keyword">public</span> PlaceOfBirth(String city) {
        <span class="hl-keyword">this</span>.city=city;
    }

    <span class="hl-keyword">public</span> PlaceOfBirth(String city, String country) {
        <span class="hl-keyword">this</span>(city);
        <span class="hl-keyword">this</span>.country = country;
    }

    <span class="hl-keyword">public</span> String getCity() {
        <span class="hl-keyword">return</span> city;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setCity(String s) {
        <span class="hl-keyword">this</span>.city = s;
    }

    <span class="hl-keyword">public</span> String getCountry() {
        <span class="hl-keyword">return</span> country;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setCountry(String country) {
        <span class="hl-keyword">this</span>.country = country;
    }

}</pre>
<p>Society.java</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.spring.samples.spel.inventor;

<span class="hl-keyword">import</span> java.util.*;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Society {

    <span class="hl-keyword">private</span> String name;

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> String Advisors = <span class="hl-string">"advisors"</span>;
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> String President = <span class="hl-string">"president"</span>;

    <span class="hl-keyword">private</span> List&lt;Inventor&gt; members = <span class="hl-keyword">new</span> ArrayList&lt;Inventor&gt;();
    <span class="hl-keyword">private</span> Map officers = <span class="hl-keyword">new</span> HashMap();

    <span class="hl-keyword">public</span> List getMembers() {
        <span class="hl-keyword">return</span> members;
    }

    <span class="hl-keyword">public</span> Map getOfficers() {
        <span class="hl-keyword">return</span> officers;
    }

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isMember(String name) {
        <span class="hl-keyword">for</span> (Inventor inventor : members) {
            <span class="hl-keyword">if</span> (inventor.getName().equals(name)) {
                <span class="hl-keyword">return</span> true;
            }
        }
        <span class="hl-keyword">return</span> false;
    }

}</pre>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="aop" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop"></a>11.&nbsp;Aspect Oriented Programming with Spring</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction"></a>11.1&nbsp;Introduction</h2></div></div></div>

<p><span class="emphasis"><em>Aspect-Oriented Programming</em></span> (AOP) complements Object-Oriented Programming (OOP) by
providing another way of thinking about program structure. The key unit of modularity in
OOP is the class, whereas in AOP the unit of modularity is the <span class="emphasis"><em>aspect</em></span>. Aspects
enable the modularization of concerns such as transaction management that cut across
multiple types and objects. (Such concerns are often termed <span class="emphasis"><em>crosscutting</em></span> concerns in
AOP literature.)</p>
<p>One of the key components of Spring is the <span class="emphasis"><em>AOP framework</em></span>. While the Spring IoC
container does not depend on AOP, meaning you do not need to use AOP if you don’t want
to, AOP complements Spring IoC to provide a very capable middleware solution.</p>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Spring 2.0 AOP</b></p></div></div></div>

<p>Spring 2.0 introduces a simpler and more powerful way of writing custom aspects using
either a <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema" title="11.3 Schema-based AOP support">schema-based approach</a> or the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj" title="11.2 @AspectJ support">@AspectJ annotation
style</a>. Both of these styles offer fully typed advice and use of the AspectJ pointcut
language, while still using Spring AOP for weaving.</p>
<p>The Spring 2.0 schema- and @AspectJ-based AOP support is discussed in this chapter.
Spring 2.0 AOP remains fully backwards compatible with Spring 1.2 AOP, and the
lower-level AOP support offered by the Spring 1.2 APIs is discussed in <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api" title="12. Spring AOP APIs">the
following chapter</a>.</p>
</div>
<p>AOP is used in the Spring Framework to…&#8203;</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
…&#8203; provide declarative enterprise services, especially as a replacement for EJB
declarative services. The most important such service is
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative" title="17.5 Declarative transaction management"><span class="emphasis"><em>declarative transaction management</em></span></a>.
</li><li class="listitem">
…&#8203; allow users to implement custom aspects, complementing their use of OOP with AOP.
</li></ul></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If you are interested only in generic declarative services or other pre-packaged
declarative middleware services such as pooling, you do not need to work directly with
Spring AOP, and can skip most of this chapter.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introduction-defn" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction-defn"></a>11.1.1&nbsp;AOP concepts</h3></div></div></div>

<p>Let us begin by defining some central AOP concepts and terminology. These terms are not
Spring-specific…&#8203; unfortunately, AOP terminology is not particularly intuitive;
however, it would be even more confusing if Spring used its own terminology.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>Aspect</em></span>: a modularization of a concern that cuts across multiple classes.
Transaction management is a good example of a crosscutting concern in enterprise Java
applications. In Spring AOP, aspects are implemented using regular classes
(the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema" title="11.3 Schema-based AOP support">schema-based approach</a>) or regular classes annotated with the
<code class="literal">@Aspect</code> annotation (the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj" title="11.2 @AspectJ support"><code class="literal">@AspectJ</code> style</a>).
</li><li class="listitem">
<span class="emphasis"><em>Join point</em></span>: a point during the execution of a program, such as the execution of a
method or the handling of an exception. In Spring AOP, a join point <span class="emphasis"><em>always</em></span>
represents a method execution.
</li><li class="listitem">
<span class="emphasis"><em>Advice</em></span>: action taken by an aspect at a particular join point. Different types of
advice include "around," "before" and "after" advice. (Advice types are discussed
below.) Many AOP frameworks, including Spring, model an advice as an <span class="emphasis"><em>interceptor</em></span>,
maintaining a chain of interceptors <span class="emphasis"><em>around</em></span> the join point.
</li><li class="listitem">
<span class="emphasis"><em>Pointcut</em></span>: a predicate that matches join points. Advice is associated with a
pointcut expression and runs at any join point matched by the pointcut (for example,
the execution of a method with a certain name). The concept of join points as matched
by pointcut expressions is central to AOP, and Spring uses the AspectJ pointcut
expression language by default.
</li><li class="listitem">
<span class="emphasis"><em>Introduction</em></span>: declaring additional methods or fields on behalf of a type. Spring
AOP allows you to introduce new interfaces (and a corresponding implementation) to any
advised object. For example, you could use an introduction to make a bean implement an
<code class="literal">IsModified</code> interface, to simplify caching. (An introduction is known as an
inter-type declaration in the AspectJ community.)
</li><li class="listitem">
<span class="emphasis"><em>Target object</em></span>: object being advised by one or more aspects. Also referred to as
the <span class="emphasis"><em>advised</em></span> object. Since Spring AOP is implemented using runtime proxies, this
object will always be a <span class="emphasis"><em>proxied</em></span> object.
</li><li class="listitem">
<span class="emphasis"><em>AOP proxy</em></span>: an object created by the AOP framework in order to implement the aspect
contracts (advise method executions and so on). In the Spring Framework, an AOP proxy
will be a JDK dynamic proxy or a CGLIB proxy.
</li><li class="listitem">
<span class="emphasis"><em>Weaving</em></span>: linking aspects with other application types or objects to create an
advised object. This can be done at compile time (using the AspectJ compiler, for
example), load time, or at runtime. Spring AOP, like other pure Java AOP frameworks,
performs weaving at runtime.
</li></ul></div>
<p>Types of advice:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>Before advice</em></span>: Advice that executes before a join point, but which does not have
the ability to prevent execution flow proceeding to the join point (unless it throws
an exception).
</li><li class="listitem">
<span class="emphasis"><em>After returning advice</em></span>: Advice to be executed after a join point completes
normally: for example, if a method returns without throwing an exception.
</li><li class="listitem">
<span class="emphasis"><em>After throwing advice</em></span>: Advice to be executed if a method exits by throwing an
exception.
</li><li class="listitem">
<span class="emphasis"><em>After (finally) advice</em></span>: Advice to be executed regardless of the means by which a
join point exits (normal or exceptional return).
</li><li class="listitem">
<span class="emphasis"><em>Around advice</em></span>: Advice that surrounds a join point such as a method invocation.
This is the most powerful kind of advice. Around advice can perform custom behavior
before and after the method invocation. It is also responsible for choosing whether to
proceed to the join point or to shortcut the advised method execution by returning its
own return value or throwing an exception.
</li></ul></div>
<p>Around advice is the most general kind of advice. Since Spring AOP, like AspectJ,
provides a full range of advice types, we recommend that you use the least powerful
advice type that can implement the required behavior. For example, if you need only to
update a cache with the return value of a method, you are better off implementing an
after returning advice than an around advice, although an around advice can accomplish
the same thing. Using the most specific advice type provides a simpler programming model
with less potential for errors. For example, you do not need to invoke the <code class="literal">proceed()</code>
method on the <code class="literal">JoinPoint</code> used for around advice, and hence cannot fail to invoke it.</p>
<p>In Spring 2.0, all advice parameters are statically typed, so that you work with advice
parameters of the appropriate type (the type of the return value from a method execution
for example) rather than <code class="literal">Object</code> arrays.</p>
<p>The concept of join points, matched by pointcuts, is the key to AOP which distinguishes
it from older technologies offering only interception. Pointcuts enable advice to be
targeted independently of the Object-Oriented hierarchy. For example, an around advice
providing declarative transaction management can be applied to a set of methods spanning
multiple objects (such as all business operations in the service layer).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introduction-spring-defn" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction-spring-defn"></a>11.1.2&nbsp;Spring AOP capabilities and goals</h3></div></div></div>

<p>Spring AOP is implemented in pure Java. There is no need for a special compilation
process. Spring AOP does not need to control the class loader hierarchy, and is thus
suitable for use in a Servlet container or application server.</p>
<p>Spring AOP currently supports only method execution join points (advising the execution
of methods on Spring beans). Field interception is not implemented, although support for
field interception could be added without breaking the core Spring AOP APIs. If you need
to advise field access and update join points, consider a language such as AspectJ.</p>
<p>Spring AOP’s approach to AOP differs from that of most other AOP frameworks. The aim is
not to provide the most complete AOP implementation (although Spring AOP is quite
capable); it is rather to provide a close integration between AOP implementation and
Spring IoC to help solve common problems in enterprise applications.</p>
<p>Thus, for example, the Spring Framework’s AOP functionality is normally used in
conjunction with the Spring IoC container. Aspects are configured using normal bean
definition syntax (although this allows powerful "autoproxying" capabilities): this is a
crucial difference from other AOP implementations. There are some things you cannot do
easily or efficiently with Spring AOP, such as advise very fine-grained objects (such as
domain objects typically): AspectJ is the best choice in such cases. However, our
experience is that Spring AOP provides an excellent solution to most problems in
enterprise Java applications that are amenable to AOP.</p>
<p>Spring AOP will never strive to compete with AspectJ to provide a comprehensive AOP
solution. We believe that both proxy-based frameworks like Spring AOP and full-blown
frameworks such as AspectJ are valuable, and that they are complementary, rather than in
competition. Spring seamlessly integrates Spring AOP and IoC with AspectJ, to enable
all uses of AOP to be catered for within a consistent Spring-based application
architecture. This integration does not affect the Spring AOP API or the AOP Alliance
API: Spring AOP remains backward-compatible. See <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api" title="12. Spring AOP APIs">the following chapter</a> for a
discussion of the Spring AOP APIs.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>One of the central tenets of the Spring Framework is that of <span class="emphasis"><em>non-invasiveness</em></span>; this
is the idea that you should not be forced to introduce framework-specific classes and
interfaces into your business/domain model. However, in some places the Spring Framework
does give you the option to introduce Spring Framework-specific dependencies into your
codebase: the rationale in giving you such options is because in certain scenarios it
might be just plain easier to read or code some specific piece of functionality in such
a way. The Spring Framework (almost) always offers you the choice though: you have the
freedom to make an informed decision as to which option best suits your particular use
case or scenario.</p>
<p>One such choice that is relevant to this chapter is that of which AOP framework (and
which AOP style) to choose. You have the choice of AspectJ and/or Spring AOP, and you
also have the choice of either the @AspectJ annotation-style approach or the Spring XML
configuration-style approach. The fact that this chapter chooses to introduce the
@AspectJ-style approach first should not be taken as an indication that the Spring team
favors the @AspectJ annotation-style approach over the Spring XML configuration-style.</p>
<p>See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-choosing" title="11.4 Choosing which AOP declaration style to use">Section&nbsp;11.4, “Choosing which AOP declaration style to use”</a> for a more complete discussion of the whys and wherefores of each
style.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introduction-proxies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introduction-proxies"></a>11.1.3&nbsp;AOP Proxies</h3></div></div></div>

<p>Spring AOP defaults to using standard JDK <span class="emphasis"><em>dynamic proxies</em></span> for AOP proxies. This
enables any interface (or set of interfaces) to be proxied.</p>
<p>Spring AOP can also use CGLIB proxies. This is necessary to proxy classes rather than
interfaces. CGLIB is used by default if a business object does not implement an
interface. As it is good practice to program to interfaces rather than classes; business
classes normally will implement one or more business interfaces. It is possible to
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-proxying" title="11.6 Proxying mechanisms">force the use of CGLIB</a>, in those (hopefully rare) cases where you
need to advise a method that is not declared on an interface, or where you need to
pass a proxied object to a method as a concrete type.</p>
<p>It is important to grasp the fact that Spring AOP is <span class="emphasis"><em>proxy-based</em></span>. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-understanding-aop-proxies" title="11.6.1 Understanding AOP proxies">Section&nbsp;11.6.1, “Understanding AOP proxies”</a> for a thorough examination of exactly what this
implementation detail actually means.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-ataspectj" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj"></a>11.2&nbsp;@AspectJ support</h2></div></div></div>

<p>@AspectJ refers to a style of declaring aspects as regular Java classes annotated with
annotations. The @AspectJ style was introduced by the
<a class="ulink" href="https://www.eclipse.org/aspectj" target="_top">AspectJ project</a> as part of the AspectJ 5 release. Spring
interprets the same annotations as AspectJ 5, using a library supplied by AspectJ
for pointcut parsing and matching. The AOP runtime is still pure Spring AOP though, and
there is no dependency on the AspectJ compiler or weaver.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Using the AspectJ compiler and weaver enables use of the full AspectJ language, and is
discussed in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-using-aspectj" title="11.8 Using AspectJ with Spring applications">Section&nbsp;11.8, “Using AspectJ with Spring applications”</a>.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-aspectj-support" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aspectj-support"></a>11.2.1&nbsp;Enabling @AspectJ Support</h3></div></div></div>

<p>To use @AspectJ aspects in a Spring configuration you need to enable Spring support for
configuring Spring AOP based on @AspectJ aspects, and <span class="emphasis"><em>autoproxying</em></span> beans based on
whether or not they are advised by those aspects. By autoproxying we mean that if Spring
determines that a bean is advised by one or more aspects, it will automatically generate
a proxy for that bean to intercept method invocations and ensure that advice is executed
as needed.</p>
<p>The @AspectJ support can be enabled with XML or Java style configuration. In either
case you will also need to ensure that AspectJ’s <code class="literal">aspectjweaver.jar</code> library is on the
classpath of your application (version 1.6.8 or later). This library is available in the
<code class="literal">'lib'</code> directory of an AspectJ distribution or via the Maven Central repository.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-enable-aspectj-java" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-enable-aspectj-java"></a>Enabling @AspectJ Support with Java configuration</h4></div></div></div>

<p>To enable @AspectJ support with Java <code class="literal">@Configuration</code> add the <code class="literal">@EnableAspectJAutoProxy</code>
annotation:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableAspectJAutoProxy</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-enable-aspectj-xml" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-enable-aspectj-xml"></a>Enabling @AspectJ Support with XML configuration</h4></div></div></div>

<p>To enable @AspectJ support with XML based configuration use the <code class="literal">aop:aspectj-autoproxy</code>
element:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspectj-autoproxy/&gt;</span></pre>
<p>This assumes that you are using schema support as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-configuration" title="41. XML Schema-based configuration">Chapter&nbsp;41, <i>XML Schema-based configuration</i></a>. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-aop" title="41.2.7 the aop schema">Section&nbsp;41.2.7, “the aop schema”</a> for how to import the tags in the <code class="literal">aop</code> namespace.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-at-aspectj" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-at-aspectj"></a>11.2.2&nbsp;Declaring an aspect</h3></div></div></div>

<p>With the @AspectJ support enabled, any bean defined in your application context with a
class that is an @AspectJ aspect (has the <code class="literal">@Aspect</code> annotation) will be automatically
detected by Spring and used to configure Spring AOP. The following example shows the
minimal definition required for a not-very-useful aspect:</p>
<p>A regular bean definition in the application context, pointing to a bean class that has
the <code class="literal">@Aspect</code> annotation:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.xyz.NotVeryUsefulAspect"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- configure properties of aspect here as normal --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>And the <code class="literal">NotVeryUsefulAspect</code> class definition, annotated with
<code class="literal">org.aspectj.lang.annotation.Aspect</code> annotation;</p>
<pre class="programlisting"><span class="hl-keyword">package</span> org.xyz;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> NotVeryUsefulAspect {

}</pre>
<p>Aspects (classes annotated with <code class="literal">@Aspect</code>) may have methods and fields just like any
other class. They may also contain pointcut, advice, and introduction (inter-type)
declarations.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Autodetecting aspects through component scanning"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Autodetecting aspects through component scanning</th></tr><tr><td align="left" valign="top">

<p>You may register aspect classes as regular beans in your Spring XML configuration, or
autodetect them through classpath scanning - just like any other Spring-managed bean.
However, note that the <span class="emphasis"><em>@Aspect</em></span> annotation is <span class="emphasis"><em>not</em></span> sufficient for autodetection in
the classpath: For that purpose, you need to add a separate <span class="emphasis"><em>@Component</em></span> annotation
(or alternatively a custom stereotype annotation that qualifies, as per the rules of
Spring’s component scanner).</p>
</td></tr></tbody></table></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Advising aspects with other aspects?"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Advising aspects with other aspects?</th></tr><tr><td align="left" valign="top">

<p>In Spring AOP, it is <span class="emphasis"><em>not</em></span> possible to have aspects themselves be the target of advice
from other aspects. The <span class="emphasis"><em>@Aspect</em></span> annotation on a class marks it as an aspect, and
hence excludes it from auto-proxying.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pointcuts" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pointcuts"></a>11.2.3&nbsp;Declaring a pointcut</h3></div></div></div>

<p>Recall that pointcuts determine join points of interest, and thus enable us to control
when advice executes. <span class="emphasis"><em>Spring AOP only supports method execution join points for Spring
beans</em></span>, so you can think of a pointcut as matching the execution of methods on Spring
beans. A pointcut declaration has two parts: a signature comprising a name and any
parameters, and a pointcut expression that determines <span class="emphasis"><em>exactly</em></span> which method
executions we are interested in. In the @AspectJ annotation-style of AOP, a pointcut
signature is provided by a regular method definition, and the pointcut expression is
indicated using the <code class="literal">@Pointcut</code> annotation (the method serving as the pointcut signature
<span class="emphasis"><em>must</em></span> have a <code class="literal">void</code> return type).</p>
<p>An example will help make this distinction between a pointcut signature and a pointcut
expression clear. The following example defines a pointcut named <code class="literal">'anyOldTransfer'</code> that
will match the execution of any method named <code class="literal">'transfer'</code>:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Pointcut("execution(* transfer(..))")//</span></em> the pointcut expression
<span class="hl-keyword">private</span> <span class="hl-keyword">void</span> anyOldTransfer() {}<span class="hl-comment">// the pointcut signature</span></pre>
<p>The pointcut expression that forms the value of the <code class="literal">@Pointcut</code> annotation is a regular
AspectJ 5 pointcut expression. For a full discussion of AspectJ’s pointcut language, see
the <a class="ulink" href="https://www.eclipse.org/aspectj/doc/released/progguide/index.html" target="_top">AspectJ
Programming Guide</a> (and for extensions, the
<a class="ulink" href="https://www.eclipse.org/aspectj/doc/released/adk15notebook/index.html" target="_top">AspectJ 5
Developers Notebook</a>) or one of the books on AspectJ such as "Eclipse AspectJ" by Colyer
et. al. or "AspectJ in Action" by Ramnivas Laddad.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-pointcuts-designators" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pointcuts-designators"></a>Supported Pointcut Designators</h4></div></div></div>

<p>Spring AOP supports the following AspectJ pointcut designators (PCD) for use in pointcut
expressions:</p>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Other pointcut types</b></p></div></div></div>

<p>The full AspectJ pointcut language supports additional pointcut designators that are not
supported in Spring. These are: <code class="literal">call, get, set, preinitialization,
staticinitialization, initialization, handler, adviceexecution, withincode, cflow,
cflowbelow, if, @this</code>, and <code class="literal">@withincode</code>. Use of these pointcut designators in pointcut
expressions interpreted by Spring AOP will result in an <code class="literal">IllegalArgumentException</code> being
thrown.</p>
<p>The set of pointcut designators supported by Spring AOP may be extended in future
releases to support more of the AspectJ pointcut designators.</p>
</div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>execution</em></span> - for matching method execution join points, this is the primary
pointcut designator you will use when working with Spring AOP
</li><li class="listitem">
<span class="emphasis"><em>within</em></span> - limits matching to join points within certain types (simply the execution
of a method declared within a matching type when using Spring AOP)
</li><li class="listitem">
<span class="emphasis"><em>this</em></span> - limits matching to join points (the execution of methods when using Spring
AOP) where the bean reference (Spring AOP proxy) is an instance of the given type
</li><li class="listitem">
<span class="emphasis"><em>target</em></span> - limits matching to join points (the execution of methods when using
Spring AOP) where the target object (application object being proxied) is an instance
of the given type
</li><li class="listitem">
<span class="emphasis"><em>args</em></span> - limits matching to join points (the execution of methods when using Spring
AOP) where the arguments are instances of the given types
</li><li class="listitem">
<span class="emphasis"><em>@target</em></span> - limits matching to join points (the execution of methods when using
Spring AOP) where the class of the executing object has an annotation of the given type
</li><li class="listitem">
<span class="emphasis"><em>@args</em></span> - limits matching to join points (the execution of methods when using Spring
AOP) where the runtime type of the actual arguments passed have annotations of the
given type(s)
</li><li class="listitem">
<span class="emphasis"><em>@within</em></span> - limits matching to join points within types that have the given
annotation (the execution of methods declared in types with the given annotation when
using Spring AOP)
</li><li class="listitem">
<span class="emphasis"><em>@annotation</em></span> - limits matching to join points where the subject of the join point
(method being executed in Spring AOP) has the given annotation
</li></ul></div>
<p>Because Spring AOP limits matching to only method execution join points, the discussion
of the pointcut designators above gives a narrower definition than you will find in the
AspectJ programming guide. In addition, AspectJ itself has type-based semantics and at
an execution join point both <code class="literal">this</code> and <code class="literal">target</code> refer to the same object - the
object executing the method. Spring AOP is a proxy-based system and differentiates
between the proxy object itself (bound to <code class="literal">this</code>) and the target object behind the
proxy (bound to <code class="literal">target</code>).</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Due to the proxy-based nature of Spring’s AOP framework, calls within the target object
are by definition <span class="emphasis"><em>not</em></span> intercepted. For JDK proxies, only public interface method
calls on the proxy can be intercepted. With CGLIB, public and protected method calls on
the proxy will be intercepted, and even package-visible methods if necessary. However,
common interactions through proxies should always be designed through public signatures.</p>
<p>Note that pointcut definitions are generally matched against any intercepted method.
If a pointcut is strictly meant to be public-only, even in a CGLIB proxy scenario with
potential non-public interactions through proxies, it needs to be defined accordingly.</p>
<p>If your interception needs include method calls or even constructors within the target
class, consider the use of Spring-driven <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="11.8.4 Load-time weaving with AspectJ in the Spring Framework">native AspectJ weaving</a> instead
of Spring’s proxy-based AOP framework. This constitutes a different mode of AOP usage
with different characteristics, so be sure to make yourself familiar with weaving first
before making a decision.</p>
</td></tr></tbody></table></div>
<p>Spring AOP also supports an additional PCD named <code class="literal">bean</code>. This PCD allows you to limit
the matching of join points to a particular named Spring bean, or to a set of named
Spring beans (when using wildcards). The <code class="literal">bean</code> PCD has the following form:</p>
<pre class="programlisting">bean(idOrNameOfBean)</pre>
<p>The <code class="literal">idOrNameOfBean</code> token can be the name of any Spring bean: limited wildcard
support using the <code class="literal">*</code> character is provided, so if you establish some naming
conventions for your Spring beans you can quite easily write a <code class="literal">bean</code> PCD expression
to pick them out. As is the case with other pointcut designators, the <code class="literal">bean</code> PCD can
be &amp;&amp;'ed, ||'ed, and ! (negated) too.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Please note that the <code class="literal">bean</code> PCD is <span class="emphasis"><em>only</em></span> supported in Spring AOP - and <span class="emphasis"><em>not</em></span> in
native AspectJ weaving. It is a Spring-specific extension to the standard PCDs that
AspectJ defines and therefore not available for aspects declared in the <code class="literal">@Aspect</code> model.</p>
<p>The <code class="literal">bean</code> PCD operates at the <span class="emphasis"><em>instance</em></span> level (building on the Spring bean name
concept) rather than at the type level only (which is what weaving-based AOP is limited
to). Instance-based pointcut designators are a special capability of Spring’s
proxy-based AOP framework and its close integration with the Spring bean factory, where
it is natural and straightforward to identify specific beans by name.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-pointcuts-combining" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pointcuts-combining"></a>Combining pointcut expressions</h4></div></div></div>

<p>Pointcut expressions can be combined using '&amp;&amp;', '||' and '!'. It is also possible to
refer to pointcut expressions by name. The following example shows three pointcut
expressions: <code class="literal">anyPublicOperation</code> (which matches if a method execution join point
represents the execution of any public method); <code class="literal">inTrading</code> (which matches if a method
execution is in the trading module), and <code class="literal">tradingOperation</code> (which matches if a method
execution represents any public method in the trading module).</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Pointcut("execution(public * *(..))")</span></em>
<span class="hl-keyword">private</span> <span class="hl-keyword">void</span> anyPublicOperation() {}

<em><span class="hl-annotation" style="color: gray">@Pointcut("within(com.xyz.someapp.trading..*)")</span></em>
<span class="hl-keyword">private</span> <span class="hl-keyword">void</span> inTrading() {}

<em><span class="hl-annotation" style="color: gray">@Pointcut("anyPublicOperation() &amp;&amp; inTrading()")</span></em>
<span class="hl-keyword">private</span> <span class="hl-keyword">void</span> tradingOperation() {}</pre>
<p>It is a best practice to build more complex pointcut expressions out of smaller named
components as shown above. When referring to pointcuts by name, normal Java visibility
rules apply (you can see private pointcuts in the same type, protected pointcuts in the
hierarchy, public pointcuts anywhere and so on). Visibility does not affect pointcut
<span class="emphasis"><em>matching</em></span>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-common-pointcuts" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-common-pointcuts"></a>Sharing common pointcut definitions</h4></div></div></div>

<p>When working with enterprise applications, you often want to refer to modules of the
application and particular sets of operations from within several aspects. We recommend
defining a "SystemArchitecture" aspect that captures common pointcut expressions for
this purpose. A typical such aspect would look as follows:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> com.xyz.someapp;

<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Pointcut;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemArchitecture {

    <strong class="hl-tag" style="color: blue">/**
     * A join point is in the web layer if the method is defined
     * in a type in the com.xyz.someapp.web package or any sub-package
     * under that.
     */</strong>
    <em><span class="hl-annotation" style="color: gray">@Pointcut("within(com.xyz.someapp.web..*)")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> inWebLayer() {}

    <strong class="hl-tag" style="color: blue">/**
     * A join point is in the service layer if the method is defined
     * in a type in the com.xyz.someapp.service package or any sub-package
     * under that.
     */</strong>
    <em><span class="hl-annotation" style="color: gray">@Pointcut("within(com.xyz.someapp.service..*)")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> inServiceLayer() {}

    <strong class="hl-tag" style="color: blue">/**
     * A join point is in the data access layer if the method is defined
     * in a type in the com.xyz.someapp.dao package or any sub-package
     * under that.
     */</strong>
    <em><span class="hl-annotation" style="color: gray">@Pointcut("within(com.xyz.someapp.dao..*)")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> inDataAccessLayer() {}

    <strong class="hl-tag" style="color: blue">/**
     * A business service is the execution of any method defined on a service
     * interface. This definition assumes that interfaces are placed in the
     * "service" package, and that implementation types are in sub-packages.
     *
     * If you group service interfaces by functional area (for example,
     * in packages com.xyz.someapp.abc.service and com.xyz.someapp.def.service) then
     * the pointcut expression "execution(* com.xyz.someapp..service.*.*(..))"
     * could be used instead.
     *
     * Alternatively, you can write the expression using the 'bean'
     * PCD, like so "bean(*Service)". (This assumes that you have
     * named your Spring service beans in a consistent fashion.)
     */</strong>
    <em><span class="hl-annotation" style="color: gray">@Pointcut("execution(* com.xyz.someapp..service.*.*(..))")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> businessService() {}

    <strong class="hl-tag" style="color: blue">/**
     * A data access operation is the execution of any method defined on a
     * dao interface. This definition assumes that interfaces are placed in the
     * "dao" package, and that implementation types are in sub-packages.
     */</strong>
    <em><span class="hl-annotation" style="color: gray">@Pointcut("execution(* com.xyz.someapp.dao.*.*(..))")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> dataAccessOperation() {}

}</pre>
<p>The pointcuts defined in such an aspect can be referred to anywhere that you need a
pointcut expression. For example, to make the service layer transactional, you could
write:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>
    <span class="hl-tag">&lt;aop:advisor</span>
        <span class="hl-attribute">pointcut</span>=<span class="hl-value">"com.xyz.someapp.SystemArchitecture.businessService()"</span>
        <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"tx-advice"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tx-advice"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
        <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRED"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre>
<p>The <code class="literal">&lt;aop:config&gt;</code> and <code class="literal">&lt;aop:advisor&gt;</code> elements are discussed in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema" title="11.3 Schema-based AOP support">Section&nbsp;11.3, “Schema-based AOP support”</a>. The
transaction elements are discussed in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction" title="17. Transaction Management">Chapter&nbsp;17, <i>Transaction Management</i></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-pointcuts-examples" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pointcuts-examples"></a>Examples</h4></div></div></div>

<p>Spring AOP users are likely to use the <code class="literal">execution</code> pointcut designator the most often.
The format of an execution expression is:</p>
<pre class="programlisting">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern)
            <span class="hl-keyword">throws</span>-pattern?)</pre>
<p>All parts except the returning type pattern (ret-type-pattern in the snippet above),
name pattern, and parameters pattern are optional. The returning type pattern determines
what the return type of the method must be in order for a join point to be matched. Most
frequently you will use <code class="literal">*</code> as the returning type pattern, which matches any return
type. A fully-qualified type name will match only when the method returns the given
type. The name pattern matches the method name. You can use the <code class="literal">*</code> wildcard as all or
part of a name pattern. If specifying a declaring type pattern
then include a trailing <code class="literal">.</code> to join it to the name pattern component.
The parameters pattern is slightly more complex: <code class="literal">()</code> matches a
method that takes no parameters, whereas <code class="literal">(..)</code> matches any number of parameters (zero
or more). The pattern <code class="literal">(*)</code> matches a method taking one parameter of any type,
<code class="literal">(*,String)</code> matches a method taking two parameters, the first can be of any type, the
second must be a String. Consult the
<a class="ulink" href="https://www.eclipse.org/aspectj/doc/released/progguide/semantics-pointcuts.html" target="_top">Language
Semantics</a> section of the AspectJ Programming Guide for more information.</p>
<p>Some examples of common pointcut expressions are given below.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
the execution of any public method:
</li></ul></div>
<pre class="programlisting">execution(<span class="hl-keyword">public</span> * *(..))</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
the execution of any method with a name beginning with "set":
</li></ul></div>
<pre class="programlisting">execution(* set*(..))</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
the execution of any method defined by the <code class="literal">AccountService</code> interface:
</li></ul></div>
<pre class="programlisting">execution(* com.xyz.service.AccountService.*(..))</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
the execution of any method defined in the service package:
</li></ul></div>
<pre class="programlisting">execution(* com.xyz.service.*.*(..))</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
the execution of any method defined in the service package or a sub-package:
</li></ul></div>
<pre class="programlisting">execution(* com.xyz.service..*.*(..))</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) within the service package:
</li></ul></div>
<pre class="programlisting">within(com.xyz.service.*)</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) within the service package or a
sub-package:
</li></ul></div>
<pre class="programlisting">within(com.xyz.service..*)</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) where the proxy implements the
<code class="literal">AccountService</code> interface:
</li></ul></div>
<pre class="programlisting"><span class="hl-keyword">this</span>(com.xyz.service.AccountService)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>'this' is more commonly used in a binding form :- see the following section on advice
for how to make the proxy object available in the advice body.</p>
</td></tr></tbody></table></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) where the target object
implements the <code class="literal">AccountService</code> interface:
</li></ul></div>
<pre class="programlisting">target(com.xyz.service.AccountService)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>'target' is more commonly used in a binding form :- see the following section on advice
for how to make the target object available in the advice body.</p>
</td></tr></tbody></table></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) which takes a single parameter,
and where the argument passed at runtime is <code class="literal">Serializable</code>:
</li></ul></div>
<pre class="programlisting">args(java.io.Serializable)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>'args' is more commonly used in a binding form :- see the following section on advice
for how to make the method arguments available in the advice body.</p>
</td></tr></tbody></table></div>
<p>Note that the pointcut given in this example is different to <code class="literal">execution(*
*(java.io.Serializable))</code>: the args version matches if the argument passed at runtime is
Serializable, the execution version matches if the method signature declares a single
parameter of type <code class="literal">Serializable</code>.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) where the target object has an
<code class="literal">@Transactional</code> annotation:
</li></ul></div>
<pre class="programlisting">@target(org.springframework.transaction.annotation.Transactional)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>'@target' can also be used in a binding form :- see the following section on advice for
how to make the annotation object available in the advice body.</p>
</td></tr></tbody></table></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) where the declared type of the
target object has an <code class="literal">@Transactional</code> annotation:
</li></ul></div>
<pre class="programlisting">@within(org.springframework.transaction.annotation.Transactional)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>'@within' can also be used in a binding form :- see the following section on advice for
how to make the annotation object available in the advice body.</p>
</td></tr></tbody></table></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) where the executing method has an
<code class="literal">@Transactional</code> annotation:
</li></ul></div>
<pre class="programlisting">@annotation(org.springframework.transaction.annotation.Transactional)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>'@annotation' can also be used in a binding form :- see the following section on advice
for how to make the annotation object available in the advice body.</p>
</td></tr></tbody></table></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) which takes a single parameter,
and where the runtime type of the argument passed has the <code class="literal">@Classified</code> annotation:
</li></ul></div>
<pre class="programlisting">@args(com.xyz.security.Classified)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>'@args' can also be used in a binding form :- see the following section on advice for
how to make the annotation object(s) available in the advice body.</p>
</td></tr></tbody></table></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) on a Spring bean named
<code class="literal">tradeService</code>:
</li></ul></div>
<pre class="programlisting">bean(tradeService)</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
any join point (method execution only in Spring AOP) on Spring beans having names that
match the wildcard expression <code class="literal">*Service</code>:
</li></ul></div>
<pre class="programlisting">bean(*Service)</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="writing-good-pointcuts" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#writing-good-pointcuts"></a>Writing good pointcuts</h4></div></div></div>

<p>During compilation, AspectJ processes pointcuts in order to try and optimize matching
performance. Examining code and determining if each join point matches (statically or
dynamically) a given pointcut is a costly process. (A dynamic match means the match
cannot be fully determined from static analysis and a test will be placed in the code to
determine if there is an actual match when the code is running). On first encountering a
pointcut declaration, AspectJ will rewrite it into an optimal form for the matching
process. What does this mean? Basically pointcuts are rewritten in DNF (Disjunctive
Normal Form) and the components of the pointcut are sorted such that those components
that are cheaper to evaluate are checked first. This means you do not have to worry
about understanding the performance of various pointcut designators and may supply them
in any order in a pointcut declaration.</p>
<p>However, AspectJ can only work with what it is told, and for optimal performance of
matching you should think about what they are trying to achieve and narrow the search
space for matches as much as possible in the definition. The existing designators
naturally fall into one of three groups: kinded, scoping and context:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Kinded designators are those which select a particular kind of join point. For
example: execution, get, set, call, handler
</li><li class="listitem">
Scoping designators are those which select a group of join points of interest (of
probably many kinds). For example: within, withincode
</li><li class="listitem">
Contextual designators are those that match (and optionally bind) based on context.
For example: this, target, @annotation
</li></ul></div>
<p>A well written pointcut should try and include at least the first two types (kinded and
scoping), whilst the contextual designators may be included if wishing to match based on
join point context, or bind that context for use in the advice. Supplying either just a
kinded designator or just a contextual designator will work but could affect weaving
performance (time and memory used) due to all the extra processing and analysis. Scoping
designators are very fast to match and their usage means AspectJ can very quickly
dismiss groups of join points that should not be further processed - that is why a good
pointcut should always include one if possible.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-advice" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice"></a>11.2.4&nbsp;Declaring advice</h3></div></div></div>

<p>Advice is associated with a pointcut expression, and runs before, after, or around
method executions matched by the pointcut. The pointcut expression may be either a
simple reference to a named pointcut, or a pointcut expression declared in place.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-before" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice-before"></a>Before advice</h4></div></div></div>

<p>Before advice is declared in an aspect using the <code class="literal">@Before</code> annotation:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Before;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BeforeExample {

    <em><span class="hl-annotation" style="color: gray">@Before("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck() {
        <span class="hl-comment">// ...</span>
    }

}</pre>
<p>If using an in-place pointcut expression we could rewrite the above example as:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Before;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BeforeExample {

    <em><span class="hl-annotation" style="color: gray">@Before("execution(* com.xyz.myapp.dao.*.*(..))")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck() {
        <span class="hl-comment">// ...</span>
    }

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-after-returning" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice-after-returning"></a>After returning advice</h4></div></div></div>

<p>After returning advice runs when a matched method execution returns normally. It is
declared using the <code class="literal">@AfterReturning</code> annotation:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterReturningExample {

    <em><span class="hl-annotation" style="color: gray">@AfterReturning("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck() {
        <span class="hl-comment">// ...</span>
    }

}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Note: it is of course possible to have multiple advice declarations, and other members
as well, all inside the same aspect. We’re just showing a single advice declaration in
these examples to focus on the issue under discussion at the time.</p>
</td></tr></tbody></table></div>
<p>Sometimes you need access in the advice body to the actual value that was returned. You
can use the form of <code class="literal">@AfterReturning</code> that binds the return value for this:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterReturningExample {

    <em><span class="hl-annotation" style="color: gray">@AfterReturning(
        pointcut="com.xyz.myapp.SystemArchitecture.dataAccessOperation()",
        returning="retVal")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck(Object retVal) {
        <span class="hl-comment">// ...</span>
    }

}</pre>
<p>The name used in the <code class="literal">returning</code> attribute must correspond to the name of a parameter in
the advice method. When a method execution returns, the return value will be passed to
the advice method as the corresponding argument value. A <code class="literal">returning</code> clause also
restricts matching to only those method executions that return a value of the specified
type ( <code class="literal">Object</code> in this case, which will match any return value).</p>
<p>Please note that it is <span class="emphasis"><em>not</em></span> possible to return a totally different reference when
using after-returning advice.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-after-throwing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice-after-throwing"></a>After throwing advice</h4></div></div></div>

<p>After throwing advice runs when a matched method execution exits by throwing an
exception. It is declared using the <code class="literal">@AfterThrowing</code> annotation:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterThrowingExample {

    <em><span class="hl-annotation" style="color: gray">@AfterThrowing("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doRecoveryActions() {
        <span class="hl-comment">// ...</span>
    }

}</pre>
<p>Often you want the advice to run only when exceptions of a given type are thrown, and
you also often need access to the thrown exception in the advice body. Use the
<code class="literal">throwing</code> attribute to both restrict matching (if desired, use <code class="literal">Throwable</code> as the
exception type otherwise) and bind the thrown exception to an advice parameter.</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterThrowingExample {

    <em><span class="hl-annotation" style="color: gray">@AfterThrowing(
        pointcut="com.xyz.myapp.SystemArchitecture.dataAccessOperation()",
        throwing="ex")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doRecoveryActions(DataAccessException ex) {
        <span class="hl-comment">// ...</span>
    }

}</pre>
<p>The name used in the <code class="literal">throwing</code> attribute must correspond to the name of a parameter in
the advice method. When a method execution exits by throwing an exception, the exception
will be passed to the advice method as the corresponding argument value. A <code class="literal">throwing</code>
clause also restricts matching to only those method executions that throw an exception
of the specified type ( <code class="literal">DataAccessException</code> in this case).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-advice-after-finally" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-advice-after-finally"></a>After (finally) advice</h4></div></div></div>

<p>After (finally) advice runs however a matched method execution exits. It is declared
using the <code class="literal">@After</code> annotation. After advice must be prepared to handle both normal and
exception return conditions. It is typically used for releasing resources, etc.</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.After;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterFinallyExample {

    <em><span class="hl-annotation" style="color: gray">@After("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doReleaseLock() {
        <span class="hl-comment">// ...</span>
    }

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ataspectj-around-advice" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-around-advice"></a>Around advice</h4></div></div></div>

<p>The final kind of advice is around advice. Around advice runs "around" a matched method
execution. It has the opportunity to do work both before and after the method executes,
and to determine when, how, and even if, the method actually gets to execute at all.
Around advice is often used if you need to share state before and after a method
execution in a thread-safe manner (starting and stopping a timer for example). Always
use the least powerful form of advice that meets your requirements (i.e. don’t use
around advice if simple before advice would do).</p>
<p>Around advice is declared using the <code class="literal">@Around</code> annotation. The first parameter of the
advice method must be of type <code class="literal">ProceedingJoinPoint</code>. Within the body of the advice,
calling <code class="literal">proceed()</code> on the <code class="literal">ProceedingJoinPoint</code> causes the underlying method to
execute. The <code class="literal">proceed</code> method may also be called passing in an <code class="literal">Object[]</code> - the values
in the array will be used as the arguments to the method execution when it proceeds.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The behavior of proceed when called with an Object[] is a little different than the
behavior of proceed for around advice compiled by the AspectJ compiler. For around
advice written using the traditional AspectJ language, the number of arguments passed to
proceed must match the number of arguments passed to the around advice (not the number
of arguments taken by the underlying join point), and the value passed to proceed in a
given argument position supplants the original value at the join point for the entity
the value was bound to (Don’t worry if this doesn’t make sense right now!). The approach
taken by Spring is simpler and a better match to its proxy-based, execution only
semantics. You only need to be aware of this difference if you are compiling @AspectJ
aspects written for Spring and using proceed with arguments with the AspectJ compiler
and weaver. There is a way to write such aspects that is 100% compatible across both
Spring AOP and AspectJ, and this is discussed in the following section on advice
parameters.</p>
</td></tr></tbody></table></div>
<pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Around;
<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AroundExample {

    <em><span class="hl-annotation" style="color: gray">@Around("com.xyz.myapp.SystemArchitecture.businessService()")</span></em>
    <span class="hl-keyword">public</span> Object doBasicProfiling(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// start stopwatch</span>
        Object retVal = pjp.proceed();
        <span class="hl-comment">// stop stopwatch</span>
        <span class="hl-keyword">return</span> retVal;
    }

}</pre>
<p>The value returned by the around advice will be the return value seen by the caller of
the method. A simple caching aspect for example could return a value from a cache if it
has one, and invoke proceed() if it does not. Note that proceed may be invoked once,
many times, or not at all within the body of the around advice, all of these are quite
legal.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ataspectj-advice-params" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params"></a>Advice parameters</h4></div></div></div>

<p>Spring offers fully typed advice - meaning that you declare the parameters you need
in the advice signature (as we saw for the returning and throwing examples above) rather
than work with <code class="literal">Object[]</code> arrays all the time. We’ll see how to make argument and other
contextual values available to the advice body in a moment. First let’s take a look at
how to write generic advice that can find out about the method the advice is currently
advising.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-the-joinpoint" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params-the-joinpoint"></a>Access to the current JoinPoint</h5></div></div></div>

<p>Any advice method may declare as its first parameter, a parameter of type
<code class="literal">org.aspectj.lang.JoinPoint</code> (please note that around advice is <span class="emphasis"><em>required</em></span> to declare
a first parameter of type <code class="literal">ProceedingJoinPoint</code>, which is a subclass of <code class="literal">JoinPoint</code>. The
<code class="literal">JoinPoint</code> interface provides a number of useful methods such as <code class="literal">getArgs()</code> (returns
the method arguments), <code class="literal">getThis()</code> (returns the proxy object), <code class="literal">getTarget()</code> (returns
the target object), <code class="literal">getSignature()</code> (returns a description of the method that is being
advised) and <code class="literal">toString()</code> (prints a useful description of the method being advised).
Please do consult the javadocs for full details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-passing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params-passing"></a>Passing parameters to advice</h5></div></div></div>

<p>We’ve already seen how to bind the returned value or exception value (using after
returning and after throwing advice). To make argument values available to the advice
body, you can use the binding form of <code class="literal">args</code>. If a parameter name is used in place of a
type name in an args expression, then the value of the corresponding argument will be
passed as the parameter value when the advice is invoked. An example should make this
clearer. Suppose you want to advise the execution of dao operations that take an Account
object as the first parameter, and you need access to the account in the advice body.
You could write the following:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Before("com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateAccount(Account account) {
    <span class="hl-comment">// ...</span>
}</pre>
<p>The <code class="literal">args(account,..)</code> part of the pointcut expression serves two purposes: firstly, it
restricts matching to only those method executions where the method takes at least one
parameter, and the argument passed to that parameter is an instance of <code class="literal">Account</code>;
secondly, it makes the actual <code class="literal">Account</code> object available to the advice via the <code class="literal">account</code>
parameter.</p>
<p>Another way of writing this is to declare a pointcut that "provides" the <code class="literal">Account</code>
object value when it matches a join point, and then just refer to the named pointcut
from the advice. This would look as follows:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Pointcut("com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)")</span></em>
<span class="hl-keyword">private</span> <span class="hl-keyword">void</span> accountDataAccessOperation(Account account) {}

<em><span class="hl-annotation" style="color: gray">@Before("accountDataAccessOperation(account)")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateAccount(Account account) {
    <span class="hl-comment">// ...</span>
}</pre>
<p>The interested reader is once more referred to the AspectJ programming guide for more
details.</p>
<p>The proxy object ( <code class="literal">this</code>), target object ( <code class="literal">target</code>), and annotations ( <code class="literal">@within,
@target, @annotation, @args</code>) can all be bound in a similar fashion. The following
example shows how you could match the execution of methods annotated with an
<code class="literal">@Auditable</code> annotation, and extract the audit code.</p>
<p>First the definition of the <code class="literal">@Auditable</code> annotation:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Target(ElementType.METHOD)</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Auditable {
    AuditCode value();
}</pre>
<p>And then the advice that matches the execution of <code class="literal">@Auditable</code> methods:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Before("com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; @annotation(auditable)")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="hl-comment">// ...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-generics" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params-generics"></a>Advice parameters and generics</h5></div></div></div>

<p>Spring AOP can handle generics used in class declarations and method parameters. Suppose
you have a generic type like this:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Sample&lt;T&gt; {
    <span class="hl-keyword">void</span> sampleGenericMethod(T param);
    <span class="hl-keyword">void</span> sampleGenericCollectionMethod(Collection&lt;T&gt; param);
}</pre>
<p>You can restrict interception of method types to certain parameter types by simply
typing the advice parameter to the parameter type you want to intercept the method for:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Before("execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> beforeSampleMethod(MyType param) {
    <span class="hl-comment">// Advice implementation</span>
}</pre>
<p>That this works is pretty obvious as we already discussed above. However, it’s worth
pointing out that this won’t work for generic collections. So you cannot define a
pointcut like this:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Before("execution(* ..Sample+.sampleGenericCollectionMethod(*)) &amp;&amp; args(param)")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> beforeSampleMethod(Collection&lt;MyType&gt; param) {
    <span class="hl-comment">// Advice implementation</span>
}</pre>
<p>To make this work we would have to inspect every element of the collection, which is not
reasonable as we also cannot decide how to treat <code class="literal">null</code> values in general. To achieve
something similar to this you have to type the parameter to <code class="literal">Collection&lt;?&gt;</code> and manually
check the type of the elements.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-params-names" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params-names"></a>Determining argument names</h5></div></div></div>

<p>The parameter binding in advice invocations relies on matching names used in pointcut
expressions to declared parameter names in (advice and pointcut) method signatures.
Parameter names are <span class="emphasis"><em>not</em></span> available through Java reflection, so Spring AOP uses the
following strategies to determine parameter names:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
If the parameter names have been specified by the user explicitly, then the specified
parameter names are used: both the advice and the pointcut annotations have
an optional "argNames" attribute which can be used to specify the argument names of
the annotated method - these argument names <span class="emphasis"><em>are</em></span> available at runtime. For example:
</li></ul></div>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Before(value="com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)",
        argNames="bean,auditable")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(Object bean, Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="hl-comment">// ... use code and bean</span>
}</pre>
<p>If the first parameter is of the <code class="literal">JoinPoint</code>, <code class="literal">ProceedingJoinPoint</code>, or
<code class="literal">JoinPoint.StaticPart</code> type, you may leave out the name of the parameter from the value
of the "argNames" attribute. For example, if you modify the preceding advice to receive
the join point object, the "argNames" attribute need not include it:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Before(value="com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)",
        argNames="bean,auditable")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(JoinPoint jp, Object bean, Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="hl-comment">// ... use code, bean, and jp</span>
}</pre>
<p>The special treatment given to the first parameter of the <code class="literal">JoinPoint</code>,
<code class="literal">ProceedingJoinPoint</code>, and <code class="literal">JoinPoint.StaticPart</code> types is particularly convenient for
advice that do not collect any other join point context. In such situations, you may
simply omit the "argNames" attribute. For example, the following advice need not declare
the "argNames" attribute:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Before("com.xyz.lib.Pointcuts.anyPublicMethod()")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(JoinPoint jp) {
    <span class="hl-comment">// ... use jp</span>
}</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Using the <code class="literal">'argNames'</code> attribute is a little clumsy, so if the <code class="literal">'argNames'</code> attribute
has not been specified, then Spring AOP will look at the debug information for the
class and try to determine the parameter names from the local variable table. This
information will be present as long as the classes have been compiled with debug
information ( <code class="literal">'-g:vars'</code> at a minimum). The consequences of compiling with this flag
on are: (1) your code will be slightly easier to understand (reverse engineer), (2)
the class file sizes will be very slightly bigger (typically inconsequential), (3) the
optimization to remove unused local variables will not be applied by your compiler. In
other words, you should encounter no difficulties building with this flag on.
</li></ul></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If an @AspectJ aspect has been compiled by the AspectJ compiler (ajc) even without the
debug information then there is no need to add the argNames attribute as the compiler
will retain the needed information.</p>
</td></tr></tbody></table></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
If the code has been compiled without the necessary debug information, then Spring AOP
will attempt to deduce the pairing of binding variables to parameters (for example, if
only one variable is bound in the pointcut expression, and the advice method only
takes one parameter, the pairing is obvious!). If the binding of variables is
ambiguous given the available information, then an <code class="literal">AmbiguousBindingException</code> will be
thrown.
</li><li class="listitem">
If all of the above strategies fail then an <code class="literal">IllegalArgumentException</code> will be thrown.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-ataspectj-advice-proceeding-with-the-call" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-proceeding-with-the-call"></a>Proceeding with arguments</h5></div></div></div>

<p>We remarked earlier that we would describe how to write a proceed call <span class="emphasis"><em>with
arguments</em></span> that works consistently across Spring AOP and AspectJ. The solution is
simply to ensure that the advice signature binds each of the method parameters in order.
For example:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Around("execution(List&lt;Account&gt; find*(..)) &amp;&amp; " +
        "com.xyz.myapp.SystemArchitecture.inDataAccessLayer() &amp;&amp; " +
        "args(accountHolderNamePattern)")</span></em>
<span class="hl-keyword">public</span> Object preProcessQueryPattern(ProceedingJoinPoint pjp,
        String accountHolderNamePattern) <span class="hl-keyword">throws</span> Throwable {
    String newPattern = preProcess(accountHolderNamePattern);
    <span class="hl-keyword">return</span> pjp.proceed(<span class="hl-keyword">new</span> Object[] {newPattern});
}</pre>
<p>In many cases you will be doing this binding anyway (as in the example above).</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ataspectj-advice-ordering" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-ordering"></a>Advice ordering</h4></div></div></div>

<p>What happens when multiple pieces of advice all want to run at the same join point?
Spring AOP follows the same precedence rules as AspectJ to determine the order of advice
execution. The highest precedence advice runs first "on the way in" (so given two pieces
of before advice, the one with highest precedence runs first). "On the way out" from a
join point, the highest precedence advice runs last (so given two pieces of after
advice, the one with the highest precedence will run second).</p>
<p>When two pieces of advice defined in <span class="emphasis"><em>different</em></span> aspects both need to run at the same
join point, unless you specify otherwise the order of execution is undefined. You can
control the order of execution by specifying precedence. This is done in the normal
Spring way by either implementing the <code class="literal">org.springframework.core.Ordered</code> interface in
the aspect class or annotating it with the <code class="literal">Order</code> annotation. Given two aspects, the
aspect returning the lower value from <code class="literal">Ordered.getValue()</code> (or the annotation value) has
the higher precedence.</p>
<p>When two pieces of advice defined in <span class="emphasis"><em>the same</em></span> aspect both need to run at the same
join point, the ordering is undefined (since there is no way to retrieve the declaration
order via reflection for javac-compiled classes). Consider collapsing such advice
methods into one advice method per join point in each aspect class, or refactor the
pieces of advice into separate aspect classes - which can be ordered at the aspect level.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-introductions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-introductions"></a>11.2.5&nbsp;Introductions</h3></div></div></div>

<p>Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare
that advised objects implement a given interface, and to provide an implementation of
that interface on behalf of those objects.</p>
<p>An introduction is made using the <code class="literal">@DeclareParents</code> annotation. This annotation is used
to declare that matching types have a new parent (hence the name). For example, given an
interface <code class="literal">UsageTracked</code>, and an implementation of that interface <code class="literal">DefaultUsageTracked</code>,
the following aspect declares that all implementors of service interfaces also implement
the <code class="literal">UsageTracked</code> interface. (In order to expose statistics via JMX for example.)</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UsageTracking {

    <em><span class="hl-annotation" style="color: gray">@DeclareParents(value="com.xzy.myapp.service.*+", defaultImpl=DefaultUsageTracked.class)</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> UsageTracked mixin;

    <em><span class="hl-annotation" style="color: gray">@Before("com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; this(usageTracked)")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> recordUsage(UsageTracked usageTracked) {
        usageTracked.incrementUseCount();
    }

}</pre>
<p>The interface to be implemented is determined by the type of the annotated field. The
<code class="literal">value</code> attribute of the <code class="literal">@DeclareParents</code> annotation is an AspectJ type pattern :- any
bean of a matching type will implement the UsageTracked interface. Note that in the
before advice of the above example, service beans can be directly used as
implementations of the <code class="literal">UsageTracked</code> interface. If accessing a bean programmatically
you would write the following:</p>
<pre class="programlisting">UsageTracked usageTracked = (UsageTracked) context.getBean(<span class="hl-string">"myService"</span>);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-instantiation-models" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-instantiation-models"></a>11.2.6&nbsp;Aspect instantiation models</h3></div></div></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>(This is an advanced topic, so if you are just starting out with AOP you can safely skip
it until later.)</p>
</td></tr></tbody></table></div>
<p>By default there will be a single instance of each aspect within the application
context. AspectJ calls this the singleton instantiation model. It is possible to define
aspects with alternate lifecycles :- Spring supports AspectJ’s <code class="literal">perthis</code> and <code class="literal">pertarget</code>
instantiation models ( <code class="literal">percflow, percflowbelow,</code> and <code class="literal">pertypewithin</code> are not currently
supported).</p>
<p>A "perthis" aspect is declared by specifying a <code class="literal">perthis</code> clause in the <code class="literal">@Aspect</code>
annotation. Let’s look at an example, and then we’ll explain how it works.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Aspect("perthis(com.xyz.myapp.SystemArchitecture.businessService())")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyAspect {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> someState;

    <em><span class="hl-annotation" style="color: gray">@Before(com.xyz.myapp.SystemArchitecture.businessService())</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> recordServiceUsage() {
        <span class="hl-comment">// ...</span>
    }

}</pre>
<p>The effect of the <code class="literal">'perthis'</code> clause is that one aspect instance will be created for
each unique service object executing a business service (each unique object bound to
'this' at join points matched by the pointcut expression). The aspect instance is
created the first time that a method is invoked on the service object. The aspect goes
out of scope when the service object goes out of scope. Before the aspect instance is
created, none of the advice within it executes. As soon as the aspect instance has been
created, the advice declared within it will execute at matched join points, but only
when the service object is the one this aspect is associated with. See the AspectJ
programming guide for more information on per-clauses.</p>
<p>The <code class="literal">'pertarget'</code> instantiation model works in exactly the same way as perthis, but
creates one aspect instance for each unique target object at matched join points.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ataspectj-example" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-example"></a>11.2.7&nbsp;Example</h3></div></div></div>

<p>Now that you have seen how all the constituent parts work, let’s put them together to do
something useful!</p>
<p>The execution of business services can sometimes fail due to concurrency issues (for
example, deadlock loser). If the operation is retried, it is quite likely to succeed
next time round. For business services where it is appropriate to retry in such
conditions (idempotent operations that don’t need to go back to the user for conflict
resolution), we’d like to transparently retry the operation to avoid the client seeing a
<code class="literal">PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across
multiple services in the service layer, and hence is ideal for implementing via an
aspect.</p>
<p>Because we want to retry the operation, we will need to use around advice so that we can
call proceed multiple times. Here’s how the basic aspect implementation looks:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConcurrentOperationExecutor <span class="hl-keyword">implements</span> Ordered {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> <span class="hl-keyword">int</span> DEFAULT_MAX_RETRIES = <span class="hl-number">2</span>;

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> maxRetries = DEFAULT_MAX_RETRIES;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> order = <span class="hl-number">1</span>;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMaxRetries(<span class="hl-keyword">int</span> maxRetries) {
        <span class="hl-keyword">this</span>.maxRetries = maxRetries;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getOrder() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.order;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOrder(<span class="hl-keyword">int</span> order) {
        <span class="hl-keyword">this</span>.order = order;
    }

    <em><span class="hl-annotation" style="color: gray">@Around("com.xyz.myapp.SystemArchitecture.businessService()")</span></em>
    <span class="hl-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-keyword">int</span> numAttempts = <span class="hl-number">0</span>;
        PessimisticLockingFailureException lockFailureException;
        <span class="hl-keyword">do</span> {
            numAttempts++;
            <span class="hl-keyword">try</span> {
                <span class="hl-keyword">return</span> pjp.proceed();
            }
            <span class="hl-keyword">catch</span>(PessimisticLockingFailureException ex) {
                lockFailureException = ex;
            }
        } <span class="hl-keyword">while</span>(numAttempts &lt;= <span class="hl-keyword">this</span>.maxRetries);
        <span class="hl-keyword">throw</span> lockFailureException;
    }

}</pre>
<p>Note that the aspect implements the <code class="literal">Ordered</code> interface so we can set the precedence of
the aspect higher than the transaction advice (we want a fresh transaction each time we
retry). The <code class="literal">maxRetries</code> and <code class="literal">order</code> properties will both be configured by Spring. The
main action happens in the <code class="literal">doConcurrentOperation</code> around advice. Notice that for the
moment we’re applying the retry logic to all <code class="literal">businessService()s</code>. We try to proceed,
and if we fail with an <code class="literal">PessimisticLockingFailureException</code> we simply try again unless
we have exhausted all of our retry attempts.</p>
<p>The corresponding Spring configuration is:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspectj-autoproxy/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"concurrentOperationExecutor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.xyz.myapp.service.impl.ConcurrentOperationExecutor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxRetries"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"3"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>To refine the aspect so that it only retries idempotent operations, we might define an
<code class="literal">Idempotent</code> annotation:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Idempotent {
    <span class="hl-comment">// marker annotation</span>
}</pre>
<p>and use the annotation to annotate the implementation of service operations. The change
to the aspect to only retry idempotent operations simply involves refining the pointcut
expression so that only <code class="literal">@Idempotent</code> operations match:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Around("com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; " +
        "@annotation(com.xyz.myapp.service.Idempotent)")</span></em>
<span class="hl-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
    ...
}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-schema" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema"></a>11.3&nbsp;Schema-based AOP support</h2></div></div></div>

<p>If you prefer an XML-based format, then Spring also offers support for defining aspects
using the new "aop" namespace tags. The exact same pointcut expressions and advice kinds
are supported as when using the @AspectJ style, hence in this section we will focus on
the new <span class="emphasis"><em>syntax</em></span> and refer the reader to the discussion in the previous section
(<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj" title="11.2 @AspectJ support">Section&nbsp;11.2, “@AspectJ support”</a>) for an understanding of writing pointcut expressions and the binding
of advice parameters.</p>
<p>To use the aop namespace tags described in this section, you need to import the
<code class="literal">spring-aop</code> schema as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-configuration" title="41. XML Schema-based configuration">Chapter&nbsp;41, <i>XML Schema-based configuration</i></a>. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-aop" title="41.2.7 the aop schema">Section&nbsp;41.2.7, “the aop schema”</a>
for how to import the tags in the <code class="literal">aop</code> namespace.</p>
<p>Within your Spring configurations, all aspect and advisor elements must be placed within
an <code class="literal">&lt;aop:config&gt;</code> element (you can have more than one <code class="literal">&lt;aop:config&gt;</code> element in an
application context configuration). An <code class="literal">&lt;aop:config&gt;</code> element can contain pointcut,
advisor, and aspect elements (note these must be declared in that order).</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="./Spring Framework Reference Documentation_files/warning.png.pagespeed.ce.aG27Rp2bJY.png"></td><th align="left">Warning</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">&lt;aop:config&gt;</code> style of configuration makes heavy use of Spring’s
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-autoproxy" title="12.9 Using the &quot;auto-proxy&quot; facility">auto-proxying</a> mechanism. This can cause issues (such as advice not
being woven) if you are already using explicit auto-proxying via the use of
<code class="literal">BeanNameAutoProxyCreator</code> or suchlike. The recommended usage pattern is to use either
just the <code class="literal">&lt;aop:config&gt;</code> style, or just the <code class="literal">AutoProxyCreator</code> style.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-declaring-an-aspect" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-declaring-an-aspect"></a>11.3.1&nbsp;Declaring an aspect</h3></div></div></div>

<p>Using the schema support, an aspect is simply a regular Java object defined as a bean in
your Spring application context. The state and behavior is captured in the fields and
methods of the object, and the pointcut and advice information is captured in the XML.</p>
<p>An aspect is declared using the &lt;aop:aspect&gt; element, and the backing bean is referenced
using the <code class="literal">ref</code> attribute:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>
    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>
        ...
    <span class="hl-tag">&lt;/aop:aspect&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"aBean"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>
    ...
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The bean backing the aspect (" `aBean`" in this case) can of course be configured and
dependency injected just like any other Spring bean.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-pointcuts" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-pointcuts"></a>11.3.2&nbsp;Declaring a pointcut</h3></div></div></div>

<p>A named pointcut can be declared inside an &lt;aop:config&gt; element, enabling the pointcut
definition to be shared across several aspects and advisors.</p>
<p>A pointcut representing the execution of any business service in the service layer could
be defined as follows:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..))"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span></pre>
<p>Note that the pointcut expression itself is using the same AspectJ pointcut expression
language as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj" title="11.2 @AspectJ support">Section&nbsp;11.2, “@AspectJ support”</a>. If you are using the schema based
declaration style, you can refer to named pointcuts defined in types
(@Aspects) within the pointcut expression. Another way of defining the above pointcut
would be:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">"com.xyz.myapp.SystemArchitecture.businessService()"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span></pre>
<p>Assuming you have a <code class="literal">SystemArchitecture</code> aspect as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-common-pointcuts" title="Sharing common pointcut definitions">the section called “Sharing common pointcut definitions”</a>.</p>
<p>Declaring a pointcut inside an aspect is very similar to declaring a top-level pointcut:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span>
            <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..))"</span><span class="hl-tag">/&gt;</span>

        ...

    <span class="hl-tag">&lt;/aop:aspect&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span></pre>
<p>Much the same way in an @AspectJ aspect, pointcuts declared using the schema based
definition style may collect join point context. For example, the following pointcut
collects the 'this' object as the join point context and passes it to advice:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span>
            <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..)) &amp;amp;&amp;amp; this(service)"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:before</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"businessService"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"monitor"</span><span class="hl-tag">/&gt;</span>

        ...

    <span class="hl-tag">&lt;/aop:aspect&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span></pre>
<p>The advice must be declared to receive the collected join point context by including
parameters of the matching names:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> monitor(Object service) {
    ...
}</pre>
<p>When combining pointcut sub-expressions, '&amp;&amp;' is awkward within an XML document, and so
the keywords 'and', 'or' and 'not' can be used in place of '&amp;&amp;', '||' and '!'
respectively. For example, the previous pointcut may be better written as:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span>
            <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..)) **and** this(service)"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:before</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"businessService"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"monitor"</span><span class="hl-tag">/&gt;</span>

        ...
    <span class="hl-tag">&lt;/aop:aspect&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span></pre>
<p>Note that pointcuts defined in this way are referred to by their XML id and cannot be
used as named pointcuts to form composite pointcuts. The named pointcut support in the
schema based definition style is thus more limited than that offered by the @AspectJ
style.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-advice" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice"></a>11.3.3&nbsp;Declaring advice</h3></div></div></div>

<p>The same five advice kinds are supported as for the @AspectJ style, and they have
exactly the same semantics.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-before" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-before"></a>Before advice</h4></div></div></div>

<p>Before advice runs before a matched method execution. It is declared inside an
<code class="literal">&lt;aop:aspect&gt;</code> using the &lt;aop:before&gt; element.</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beforeExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:before</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">"doAccessCheck"</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre>
<p>Here <code class="literal">dataAccessOperation</code> is the id of a pointcut defined at the top ( <code class="literal">&lt;aop:config&gt;</code>)
level. To define the pointcut inline instead, replace the <code class="literal">pointcut-ref</code> attribute with
a <code class="literal">pointcut</code> attribute:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"beforeExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:before</span>
        <span class="hl-attribute">pointcut</span>=<span class="hl-value">"execution(* com.xyz.myapp.dao.*.*(..))"</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">"doAccessCheck"</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre>
<p>As we noted in the discussion of the @AspectJ style, using named pointcuts can
significantly improve the readability of your code.</p>
<p>The method attribute identifies a method ( <code class="literal">doAccessCheck</code>) that provides the body of
the advice. This method must be defined for the bean referenced by the aspect element
containing the advice. Before a data access operation is executed (a method execution
join point matched by the pointcut expression), the "doAccessCheck" method on the aspect
bean will be invoked.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-after-returning" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-after-returning"></a>After returning advice</h4></div></div></div>

<p>After returning advice runs when a matched method execution completes normally. It is
declared inside an <code class="literal">&lt;aop:aspect&gt;</code> in the same way as before advice. For example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterReturningExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after-returning</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">"doAccessCheck"</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre>
<p>Just as in the @AspectJ style, it is possible to get hold of the return value within the
advice body. Use the returning attribute to specify the name of the parameter to which
the return value should be passed:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterReturningExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after-returning</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span>
        <span class="hl-attribute">returning</span>=<span class="hl-value">"retVal"</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">"doAccessCheck"</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre>
<p>The doAccessCheck method must declare a parameter named <code class="literal">retVal</code>. The type of this
parameter constrains matching in the same way as described for @AfterReturning. For
example, the method signature may be declared as:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck(Object retVal) {...</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-after-throwing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-after-throwing"></a>After throwing advice</h4></div></div></div>

<p>After throwing advice executes when a matched method execution exits by throwing an
exception. It is declared inside an <code class="literal">&lt;aop:aspect&gt;</code> using the after-throwing element:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterThrowingExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after-throwing</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">"doRecoveryActions"</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre>
<p>Just as in the @AspectJ style, it is possible to get hold of the thrown exception within
the advice body. Use the throwing attribute to specify the name of the parameter to
which the exception should be passed:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterThrowingExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after-throwing</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span>
        <span class="hl-attribute">throwing</span>=<span class="hl-value">"dataAccessEx"</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">"doRecoveryActions"</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre>
<p>The doRecoveryActions method must declare a parameter named <code class="literal">dataAccessEx</code>. The type of
this parameter constrains matching in the same way as described for @AfterThrowing. For
example, the method signature may be declared as:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doRecoveryActions(DataAccessException dataAccessEx) {...</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-after-finally" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-after-finally"></a>After (finally) advice</h4></div></div></div>

<p>After (finally) advice runs however a matched method execution exits. It is declared
using the <code class="literal">after</code> element:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"afterFinallyExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"dataAccessOperation"</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">"doReleaseLock"</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-advice-around" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advice-around"></a>Around advice</h4></div></div></div>

<p>The final kind of advice is around advice. Around advice runs "around" a matched method
execution. It has the opportunity to do work both before and after the method executes,
and to determine when, how, and even if, the method actually gets to execute at all.
Around advice is often used if you need to share state before and after a method
execution in a thread-safe manner (starting and stopping a timer for example). Always
use the least powerful form of advice that meets your requirements; don’t use around
advice if simple before advice would do.</p>
<p>Around advice is declared using the <code class="literal">aop:around</code> element. The first parameter of the
advice method must be of type <code class="literal">ProceedingJoinPoint</code>. Within the body of the advice,
calling <code class="literal">proceed()</code> on the <code class="literal">ProceedingJoinPoint</code> causes the underlying method to
execute. The <code class="literal">proceed</code> method may also be calling passing in an <code class="literal">Object[]</code> - the values
in the array will be used as the arguments to the method execution when it proceeds. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-around-advice" title="Around advice">the section called “Around advice”</a> for notes on calling proceed with an <code class="literal">Object[]</code>.</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"aroundExample"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"aBean"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:around</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"businessService"</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">"doBasicProfiling"</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre>
<p>The implementation of the <code class="literal">doBasicProfiling</code> advice would be exactly the same as in the
@AspectJ example (minus the annotation of course):</p>
<pre class="programlisting"><span class="hl-keyword">public</span> Object doBasicProfiling(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
    <span class="hl-comment">// start stopwatch</span>
    Object retVal = pjp.proceed();
    <span class="hl-comment">// stop stopwatch</span>
    <span class="hl-keyword">return</span> retVal;
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-schema-params" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-params"></a>Advice parameters</h4></div></div></div>

<p>The schema based declaration style supports fully typed advice in the same way as
described for the @AspectJ support - by matching pointcut parameters by name against
advice method parameters. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params" title="Advice parameters">the section called “Advice parameters”</a> for details. If you wish
to explicitly specify argument names for the advice methods (not relying on the
detection strategies previously described) then this is done using the <code class="literal">arg-names</code>
attribute of the advice element, which is treated in the same manner to the "argNames"
attribute in an advice annotation as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params-names" title="Determining argument names">the section called “Determining argument names”</a>.
For example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:before</span>
    <span class="hl-attribute">pointcut</span>=<span class="hl-value">"com.xyz.lib.Pointcuts.anyPublicMethod() and @annotation(auditable)"</span>
    <span class="hl-attribute">method</span>=<span class="hl-value">"audit"</span>
    <span class="hl-attribute">arg-names</span>=<span class="hl-value">"auditable"</span><span class="hl-tag">/&gt;</span></pre>
<p>The <code class="literal">arg-names</code> attribute accepts a comma-delimited list of parameter names.</p>
<p>Find below a slightly more involved example of the XSD-based approach that illustrates
some around advice used in conjunction with a number of strongly typed parameters.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> x.y.service;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FooService {

    Foo getFoo(String fooName, <span class="hl-keyword">int</span> age);
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

    <span class="hl-keyword">public</span> Foo getFoo(String name, <span class="hl-keyword">int</span> age) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo(name, age);
    }
}</pre>
<p>Next up is the aspect. Notice the fact that the <code class="literal">profile(..)</code> method accepts a number of
strongly-typed parameters, the first of which happens to be the join point used to
proceed with the method call: the presence of this parameter is an indication that the
<code class="literal">profile(..)</code> is to be used as <code class="literal">around</code> advice:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> x.y;

<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hl-keyword">import</span> org.springframework.util.StopWatch;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleProfiler {

    <span class="hl-keyword">public</span> Object profile(ProceedingJoinPoint call, String name, <span class="hl-keyword">int</span> age) <span class="hl-keyword">throws</span> Throwable {
        StopWatch clock = <span class="hl-keyword">new</span> StopWatch(<span class="hl-string">"Profiling for '"</span> + name + <span class="hl-string">"' and '"</span> + age + <span class="hl-string">"'"</span>);
        <span class="hl-keyword">try</span> {
            clock.start(call.toShortString());
            <span class="hl-keyword">return</span> call.proceed();
        } <span class="hl-keyword">finally</span> {
            clock.stop();
            System.out.println(clock.prettyPrint());
        }
    }
}</pre>
<p>Finally, here is the XML configuration that is required to effect the execution of the
above advice for a particular join point:</p>
<pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- this is the object that will be proxied by Spring's AOP infrastructure --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- this is the actual advice itself --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.SimpleProfiler"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;aop:config&gt;</span>
        <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"profiler"</span><span class="hl-tag">&gt;</span>

            <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"theExecutionOfSomeFooServiceMethod"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.FooService.getFoo(String,int))
                and args(name, age)"</span><span class="hl-tag">/&gt;</span>

            <span class="hl-tag">&lt;aop:around</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"theExecutionOfSomeFooServiceMethod"</span>
                <span class="hl-attribute">method</span>=<span class="hl-value">"profile"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;/aop:aspect&gt;</span>
    <span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>If we had the following driver script, we would get output something like this on
standard output:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.beans.factory.BeanFactory;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;
<span class="hl-keyword">import</span> x.y.service.FooService;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
        BeanFactory ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"x/y/plain.xml"</span>);
        FooService foo = (FooService) ctx.getBean(<span class="hl-string">"fooService"</span>);
        foo.getFoo(<span class="hl-string">"Pengo"</span>, <span class="hl-number">12</span>);
    }
}</pre>
<pre class="literallayout">StopWatch 'Profiling for 'Pengo' and '12'': running time (millis) = 0
-----------------------------------------
ms     %     Task name
-----------------------------------------
00000  ?  execution(getFoo)</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-ordering" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ordering"></a>Advice ordering</h4></div></div></div>

<p>When multiple advice needs to execute at the same join point (executing method) the
ordering rules are as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-ordering" title="Advice ordering">the section called “Advice ordering”</a>. The precedence
between aspects is determined by either adding the <code class="literal">Order</code> annotation to the bean
backing the aspect or by having the bean implement the <code class="literal">Ordered</code> interface.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-introductions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-introductions"></a>11.3.4&nbsp;Introductions</h3></div></div></div>

<p>Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare
that advised objects implement a given interface, and to provide an implementation of
that interface on behalf of those objects.</p>
<p>An introduction is made using the <code class="literal">aop:declare-parents</code> element inside an <code class="literal">aop:aspect</code>
This element is used to declare that matching types have a new parent (hence the name).
For example, given an interface <code class="literal">UsageTracked</code>, and an implementation of that interface
<code class="literal">DefaultUsageTracked</code>, the following aspect declares that all implementors of service
interfaces also implement the <code class="literal">UsageTracked</code> interface. (In order to expose statistics
via JMX for example.)</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"usageTrackerAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"usageTracking"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:declare-parents</span>
        <span class="hl-attribute">types-matching</span>=<span class="hl-value">"com.xzy.myapp.service.*+"</span>
        <span class="hl-attribute">implement-interface</span>=<span class="hl-value">"com.xyz.myapp.service.tracking.UsageTracked"</span>
        <span class="hl-attribute">default-impl</span>=<span class="hl-value">"com.xyz.myapp.service.tracking.DefaultUsageTracked"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;aop:before</span>
        <span class="hl-attribute">pointcut</span>=<span class="hl-value">"com.xyz.myapp.SystemArchitecture.businessService()
            and this(usageTracked)"</span>
            <span class="hl-attribute">method</span>=<span class="hl-value">"recordUsage"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre>
<p>The class backing the <code class="literal">usageTracking</code> bean would contain the method:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> recordUsage(UsageTracked usageTracked) {
    usageTracked.incrementUseCount();
}</pre>
<p>The interface to be implemented is determined by <code class="literal">implement-interface</code> attribute. The
value of the <code class="literal">types-matching</code> attribute is an AspectJ type pattern :- any bean of a
matching type will implement the <code class="literal">UsageTracked</code> interface. Note that in the before
advice of the above example, service beans can be directly used as implementations of
the <code class="literal">UsageTracked</code> interface. If accessing a bean programmatically you would write the
following:</p>
<pre class="programlisting">UsageTracked usageTracked = (UsageTracked) context.getBean(<span class="hl-string">"myService"</span>);</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-instatiation-models" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-instatiation-models"></a>11.3.5&nbsp;Aspect instantiation models</h3></div></div></div>

<p>The only supported instantiation model for schema-defined aspects is the singleton
model. Other instantiation models may be supported in future releases.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-advisors" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-advisors"></a>11.3.6&nbsp;Advisors</h3></div></div></div>

<p>The concept of "advisors" is brought forward from the AOP support defined in Spring 1.2
and does not have a direct equivalent in AspectJ. An advisor is like a small
self-contained aspect that has a single piece of advice. The advice itself is
represented by a bean, and must implement one of the advice interfaces described in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-types" title="12.3.2 Advice types in Spring">Section&nbsp;12.3.2, “Advice types in Spring”</a>. Advisors can take advantage of AspectJ pointcut expressions
though.</p>
<p>Spring supports the advisor concept with the <code class="literal">&lt;aop:advisor&gt;</code> element. You will most
commonly see it used in conjunction with transactional advice, which also has its own
namespace support in Spring. Here’s how it looks:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessService"</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..))"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;aop:advisor</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"businessService"</span>
        <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"tx-advice"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tx-advice"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
        <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"REQUIRED"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre>
<p>As well as the <code class="literal">pointcut-ref</code> attribute used in the above example, you can also use the
<code class="literal">pointcut</code> attribute to define a pointcut expression inline.</p>
<p>To define the precedence of an advisor so that the advice can participate in ordering,
use the <code class="literal">order</code> attribute to define the <code class="literal">Ordered</code> value of the advisor.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-schema-example" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-schema-example"></a>11.3.7&nbsp;Example</h3></div></div></div>

<p>Let’s see how the concurrent locking failure retry example from
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-example" title="11.2.7 Example">Section&nbsp;11.2.7, “Example”</a> looks when rewritten using the schema support.</p>
<p>The execution of business services can sometimes fail due to concurrency issues (for
example, deadlock loser). If the operation is retried, it is quite likely it will
succeed next time round. For business services where it is appropriate to retry in such
conditions (idempotent operations that don’t need to go back to the user for conflict
resolution), we’d like to transparently retry the operation to avoid the client seeing a
<code class="literal">PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across
multiple services in the service layer, and hence is ideal for implementing via an
aspect.</p>
<p>Because we want to retry the operation, we’ll need to use around advice so that we can
call proceed multiple times. Here’s how the basic aspect implementation looks (it’s just
a regular Java class using the schema support):</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConcurrentOperationExecutor <span class="hl-keyword">implements</span> Ordered {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> <span class="hl-keyword">int</span> DEFAULT_MAX_RETRIES = <span class="hl-number">2</span>;

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> maxRetries = DEFAULT_MAX_RETRIES;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> order = <span class="hl-number">1</span>;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMaxRetries(<span class="hl-keyword">int</span> maxRetries) {
        <span class="hl-keyword">this</span>.maxRetries = maxRetries;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getOrder() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.order;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOrder(<span class="hl-keyword">int</span> order) {
        <span class="hl-keyword">this</span>.order = order;
    }

    <span class="hl-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-keyword">int</span> numAttempts = <span class="hl-number">0</span>;
        PessimisticLockingFailureException lockFailureException;
        <span class="hl-keyword">do</span> {
            numAttempts++;
            <span class="hl-keyword">try</span> {
                <span class="hl-keyword">return</span> pjp.proceed();
            }
            <span class="hl-keyword">catch</span>(PessimisticLockingFailureException ex) {
                lockFailureException = ex;
            }
        } <span class="hl-keyword">while</span>(numAttempts &lt;= <span class="hl-keyword">this</span>.maxRetries);
        <span class="hl-keyword">throw</span> lockFailureException;
    }

}</pre>
<p>Note that the aspect implements the <code class="literal">Ordered</code> interface so we can set the precedence of
the aspect higher than the transaction advice (we want a fresh transaction each time we
retry). The <code class="literal">maxRetries</code> and <code class="literal">order</code> properties will both be configured by Spring. The
main action happens in the <code class="literal">doConcurrentOperation</code> around advice method. We try to
proceed, and if we fail with a <code class="literal">PessimisticLockingFailureException</code> we simply try again
unless we have exhausted all of our retry attempts.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>This class is identical to the one used in the @AspectJ example, but with the
annotations removed.</p>
</td></tr></tbody></table></div>
<p>The corresponding Spring configuration is:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"concurrentOperationRetry"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"concurrentOperationExecutor"</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"idempotentOperation"</span>
            <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..))"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:around</span>
            <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"idempotentOperation"</span>
            <span class="hl-attribute">method</span>=<span class="hl-value">"doConcurrentOperation"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;/aop:aspect&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"concurrentOperationExecutor"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"com.xyz.myapp.service.impl.ConcurrentOperationExecutor"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxRetries"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"3"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"100"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Notice that for the time being we assume that all business services are idempotent. If
this is not the case we can refine the aspect so that it only retries genuinely
idempotent operations, by introducing an <code class="literal">Idempotent</code> annotation:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> Idempotent {
    <span class="hl-comment">// marker annotation</span>
}</pre>
<p>and using the annotation to annotate the implementation of service operations. The
change to the aspect to retry only idempotent operations simply involves refining the
pointcut expression so that only <code class="literal">@Idempotent</code> operations match:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"idempotentOperation"</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* com.xyz.myapp.service.*.*(..)) and
        @annotation(com.xyz.myapp.service.Idempotent)"</span><span class="hl-tag">/&gt;</span></pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-choosing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-choosing"></a>11.4&nbsp;Choosing which AOP declaration style to use</h2></div></div></div>

<p>Once you have decided that an aspect is the best approach for implementing a given
requirement, how do you decide between using Spring AOP or AspectJ, and between the
Aspect language (code) style, @AspectJ annotation style, or the Spring XML style? These
decisions are influenced by a number of factors including application requirements,
development tools, and team familiarity with AOP.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-spring-or-aspectj" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-spring-or-aspectj"></a>11.4.1&nbsp;Spring AOP or full AspectJ?</h3></div></div></div>

<p>Use the simplest thing that can work. Spring AOP is simpler than using full AspectJ as
there is no requirement to introduce the AspectJ compiler / weaver into your development
and build processes. If you only need to advise the execution of operations on Spring
beans, then Spring AOP is the right choice. If you need to advise objects not managed by
the Spring container (such as domain objects typically), then you will need to use
AspectJ. You will also need to use AspectJ if you wish to advise join points other than
simple method executions (for example, field get or set join points, and so on).</p>
<p>When using AspectJ, you have the choice of the AspectJ language syntax (also known as
the "code style") or the @AspectJ annotation style. Clearly, if you are not using Java
5+ then the choice has been made for you…&#8203; use the code style. If aspects play a large
role in your design, and you are able to use the <a class="ulink" href="https://www.eclipse.org/ajdt/" target="_top">AspectJ
Development Tools (AJDT)</a> plugin for Eclipse, then the AspectJ language syntax is the
preferred option: it is cleaner and simpler because the language was purposefully
designed for writing aspects. If you are not using Eclipse, or have only a few aspects
that do not play a major role in your application, then you may want to consider using
the @AspectJ style and sticking with a regular Java compilation in your IDE, and adding
an aspect weaving phase to your build script.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ataspectj-or-xml" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-or-xml"></a>11.4.2&nbsp;@AspectJ or XML for Spring AOP?</h3></div></div></div>

<p>If you have chosen to use Spring AOP, then you have a choice of @AspectJ or XML style.
There are various tradeoffs to consider.</p>
<p>The XML style will be most familiar to existing Spring users and it is backed by genuine
POJOs. When using AOP as a tool to configure enterprise services then XML can be a good
choice (a good test is whether you consider the pointcut expression to be a part of your
configuration you might want to change independently). With the XML style arguably it is
clearer from your configuration what aspects are present in the system.</p>
<p>The XML style has two disadvantages. Firstly it does not fully encapsulate the
implementation of the requirement it addresses in a single place. The DRY principle says
that there should be a single, unambiguous, authoritative representation of any piece of
knowledge within a system. When using the XML style, the knowledge of <span class="emphasis"><em>how</em></span> a
requirement is implemented is split across the declaration of the backing bean class,
and the XML in the configuration file. When using the @AspectJ style there is a single
module - the aspect - in which this information is encapsulated. Secondly, the XML style
is slightly more limited in what it can express than the @AspectJ style: only the
"singleton" aspect instantiation model is supported, and it is not possible to combine
named pointcuts declared in XML. For example, in the @AspectJ style you can write
something like:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Pointcut(execution(* get*()))</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> propertyAccess() {}

@Pointcut(execution(org.xyz.Account+ *(..))
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> operationReturningAnAccount() {}

<em><span class="hl-annotation" style="color: gray">@Pointcut(propertyAccess() &amp;&amp; operationReturningAnAccount())</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> accountPropertyAccess() {}</pre>
<p>In the XML style I can declare the first two pointcuts:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"propertyAccess"</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* get*())"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"operationReturningAnAccount"</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(org.xyz.Account+ *(..))"</span><span class="hl-tag">/&gt;</span></pre>
<p>The downside of the XML approach is that you cannot define the
<code class="literal">accountPropertyAccess</code> pointcut by combining these definitions.</p>
<p>The @AspectJ style supports additional instantiation models, and richer pointcut
composition. It has the advantage of keeping the aspect as a modular unit. It also has
the advantage the @AspectJ aspects can be understood (and thus consumed) both by Spring
AOP and by AspectJ - so if you later decide you need the capabilities of AspectJ to
implement additional requirements then it is very easy to migrate to an AspectJ-based
approach. On balance the Spring team prefer the @AspectJ style whenever you have aspects
that do more than simple "configuration" of enterprise services.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-mixing-styles" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-mixing-styles"></a>11.5&nbsp;Mixing aspect types</h2></div></div></div>

<p>It is perfectly possible to mix @AspectJ style aspects using the autoproxying support,
schema-defined <code class="literal">&lt;aop:aspect&gt;</code> aspects, <code class="literal">&lt;aop:advisor&gt;</code> declared advisors and even
proxies and interceptors defined using the Spring 1.2 style in the same configuration.
All of these are implemented using the same underlying support mechanism and will
co-exist without any difficulty.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-proxying" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-proxying"></a>11.6&nbsp;Proxying mechanisms</h2></div></div></div>

<p>Spring AOP uses either JDK dynamic proxies or CGLIB to create the proxy for a given
target object. (JDK dynamic proxies are preferred whenever you have a choice).</p>
<p>If the target object to be proxied implements at least one interface then a JDK dynamic
proxy will be used. All of the interfaces implemented by the target type will be
proxied. If the target object does not implement any interfaces then a CGLIB proxy will
be created.</p>
<p>If you want to force the use of CGLIB proxying (for example, to proxy every method
defined for the target object, not just those implemented by its interfaces) you can do
so. However, there are some issues to consider:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">final</code> methods cannot be advised, as they cannot be overridden.
</li><li class="listitem">
As of Spring 3.2, it is no longer necessary to add CGLIB to your project classpath, as
CGLIB classes are repackaged under org.springframework and included directly in the
spring-core JAR. This means that CGLIB-based proxy support 'just works' in the same
way that JDK dynamic proxies always have.
</li><li class="listitem">
As of Spring 4.0, the constructor of your proxied object will NOT be called twice
anymore since the CGLIB proxy instance will be created via Objenesis. Only if your
JVM does not allow for constructor bypassing, you might see double invocations and
corresponding debug log entries from Spring’s AOP support.
</li></ul></div>
<p>To force the use of CGLIB proxies set the value of the <code class="literal">proxy-target-class</code> attribute of
the <code class="literal">&lt;aop:config&gt;</code> element to true:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config</span> <span class="hl-attribute">proxy-target-class</span>=<span class="hl-value">"true"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- other beans defined here... --&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span></pre>
<p>To force CGLIB proxying when using the @AspectJ autoproxy support, set the
<code class="literal">'proxy-target-class'</code> attribute of the <code class="literal">&lt;aop:aspectj-autoproxy&gt;</code> element to <code class="literal">true</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspectj-autoproxy</span> <span class="hl-attribute">proxy-target-class</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Multiple <code class="literal">&lt;aop:config/&gt;</code> sections are collapsed into a single unified auto-proxy creator
at runtime, which applies the <span class="emphasis"><em>strongest</em></span> proxy settings that any of the
<code class="literal">&lt;aop:config/&gt;</code> sections (typically from different XML bean definition files) specified.
This also applies to the <code class="literal">&lt;tx:annotation-driven/&gt;</code> and <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code>
elements.</p>
<p>To be clear: using <code class="literal">proxy-target-class="true"</code> on <code class="literal">&lt;tx:annotation-driven/&gt;</code>,
<code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> or <code class="literal">&lt;aop:config/&gt;</code> elements will force the use of CGLIB
proxies <span class="emphasis"><em>for all three of them</em></span>.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-understanding-aop-proxies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-understanding-aop-proxies"></a>11.6.1&nbsp;Understanding AOP proxies</h3></div></div></div>

<p>Spring AOP is <span class="emphasis"><em>proxy-based</em></span>. It is vitally important that you grasp the semantics of
what that last statement actually means before you write your own aspects or use any of
the Spring AOP-based aspects supplied with the Spring Framework.</p>
<p>Consider first the scenario where you have a plain-vanilla, un-proxied,
nothing-special-about-it, straight object reference, as illustrated by the following
code snippet.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimplePojo <span class="hl-keyword">implements</span> Pojo {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
        <span class="hl-comment">// this next method invocation is a direct call on the 'this' reference</span>
        <span class="hl-keyword">this</span>.bar();
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> bar() {
        <span class="hl-comment">// some logic...</span>
    }
}</pre>
<p>If you invoke a method on an object reference, the method is invoked <span class="emphasis"><em>directly</em></span> on
that object reference, as can be seen below.</p>
<div class="informalfigure">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/aop-proxy-plain-pojo-call.png.pagespeed.ce.5LqGEJRbKm.png" alt="aop proxy plain pojo call"></div>
</div>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        Pojo pojo = <span class="hl-keyword">new</span> SimplePojo();

        <span class="hl-comment">// this is a direct method call on the 'pojo' reference</span>
        pojo.foo();
    }
}</pre>
<p>Things change slightly when the reference that client code has is a proxy. Consider the
following diagram and code snippet.</p>
<div class="informalfigure">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/aop-proxy-call.png.pagespeed.ce.bc2Yb_ag8j.png" alt="aop proxy call"></div>
</div>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(<span class="hl-keyword">new</span> SimplePojo());
        factory.addInterface(Pojo.<span class="hl-keyword">class</span>);
        factory.addAdvice(<span class="hl-keyword">new</span> RetryAdvice());

        Pojo pojo = (Pojo) factory.getProxy();

        <span class="hl-comment">// this is a method call on the proxy!</span>
        pojo.foo();
    }
}</pre>
<p>The key thing to understand here is that the client code inside the <code class="literal">main(..)</code> of the
<code class="literal">Main</code> class <span class="emphasis"><em>has a reference to the proxy</em></span>. This means that method calls on that
object reference will be calls on the proxy, and as such the proxy will be able to
delegate to all of the interceptors (advice) that are relevant to that particular method
call. However, once the call has finally reached the target object, the <code class="literal">SimplePojo</code>
reference in this case, any method calls that it may make on itself, such as
<code class="literal">this.bar()</code> or <code class="literal">this.foo()</code>, are going to be invoked against the <span class="emphasis"><em>this</em></span> reference,
and <span class="emphasis"><em>not</em></span> the proxy. This has important implications. It means that self-invocation is
<span class="emphasis"><em>not</em></span> going to result in the advice associated with a method invocation getting a
chance to execute.</p>
<p>Okay, so what is to be done about this? The best approach (the term best is used loosely
here) is to refactor your code such that the self-invocation does not happen. For sure,
this does entail some work on your part, but it is the best, least-invasive approach.
The next approach is absolutely horrendous, and I am almost reticent to point it out
precisely because it is so horrendous. You can (choke!) totally tie the logic within
your class to Spring AOP by doing this:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimplePojo <span class="hl-keyword">implements</span> Pojo {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
        <span class="hl-comment">// this works, but... gah!</span>
        ((Pojo) AopContext.currentProxy()).bar();
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> bar() {
        <span class="hl-comment">// some logic...</span>
    }
}</pre>
<p>This totally couples your code to Spring AOP, <span class="emphasis"><em>and</em></span> it makes the class itself aware of
the fact that it is being used in an AOP context, which flies in the face of AOP. It
also requires some additional configuration when the proxy is being created:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(<span class="hl-keyword">new</span> SimplePojo());
        factory.adddInterface(Pojo.<span class="hl-keyword">class</span>);
        factory.addAdvice(<span class="hl-keyword">new</span> RetryAdvice());
        factory.setExposeProxy(true);

        Pojo pojo = (Pojo) factory.getProxy();

        <span class="hl-comment">// this is a method call on the proxy!</span>
        pojo.foo();
    }
}</pre>
<p>Finally, it must be noted that AspectJ does not have this self-invocation issue because
it is not a proxy-based AOP framework.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-aspectj-programmatic" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aspectj-programmatic"></a>11.7&nbsp;Programmatic creation of @AspectJ Proxies</h2></div></div></div>

<p>In addition to declaring aspects in your configuration using either <code class="literal">&lt;aop:config&gt;</code> or
<code class="literal">&lt;aop:aspectj-autoproxy&gt;</code>, it is also possible programmatically to create proxies that
advise target objects. For the full details of Spring’s AOP API, see the next chapter.
Here we want to focus on the ability to automatically create proxies using @AspectJ
aspects.</p>
<p>The class <code class="literal">org.springframework.aop.aspectj.annotation.AspectJProxyFactory</code> can be used
to create a proxy for a target object that is advised by one or more @AspectJ aspects.
Basic usage for this class is very simple, as illustrated below. See the javadocs for
full information.</p>
<pre class="programlisting"><span class="hl-comment">// create a factory that can generate a proxy for the given target object</span>
AspectJProxyFactory factory = <span class="hl-keyword">new</span> AspectJProxyFactory(targetObject);

<span class="hl-comment">// add an aspect, the class must be an @AspectJ aspect</span>
<span class="hl-comment">// you can call this as many times as you need with different aspects</span>
factory.addAspect(SecurityManager.<span class="hl-keyword">class</span>);

<span class="hl-comment">// you can also add existing aspect instances, the type of the object supplied must be an @AspectJ aspect</span>
factory.addAspect(usageTracker);

<span class="hl-comment">// now get the proxy object...</span>
MyInterfaceType proxy = factory.getProxy();</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-using-aspectj" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-using-aspectj"></a>11.8&nbsp;Using AspectJ with Spring applications</h2></div></div></div>

<p>Everything we’ve covered so far in this chapter is pure Spring AOP. In this section,
we’re going to look at how you can use the AspectJ compiler/weaver instead of, or in
addition to, Spring AOP if your needs go beyond the facilities offered by Spring AOP
alone.</p>
<p>Spring ships with a small AspectJ aspect library, which is available standalone in your
distribution as <code class="literal">spring-aspects.jar</code>; you’ll need to add this to your classpath in order
to use the aspects in it. <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-atconfigurable" title="11.8.1 Using AspectJ to dependency inject domain objects with Spring">Section&nbsp;11.8.1, “Using AspectJ to dependency inject domain objects with Spring”</a> and <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ajlib-other" title="11.8.2 Other Spring aspects for AspectJ">Section&nbsp;11.8.2, “Other Spring aspects for AspectJ”</a> discuss the
content of this library and how you can use it. <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-configure" title="11.8.3 Configuring AspectJ aspects using Spring IoC">Section&nbsp;11.8.3, “Configuring AspectJ aspects using Spring IoC”</a> discusses how to
dependency inject AspectJ aspects that are woven using the AspectJ compiler. Finally,
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="11.8.4 Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;11.8.4, “Load-time weaving with AspectJ in the Spring Framework”</a> provides an introduction to load-time weaving for Spring applications
using AspectJ.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-atconfigurable" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-atconfigurable"></a>11.8.1&nbsp;Using AspectJ to dependency inject domain objects with Spring</h3></div></div></div>

<p>The Spring container instantiates and configures beans defined in your application
context. It is also possible to ask a bean factory to configure a <span class="emphasis"><em>pre-existing</em></span>
object given the name of a bean definition containing the configuration to be applied.
The <code class="literal">spring-aspects.jar</code> contains an annotation-driven aspect that exploits this
capability to allow dependency injection of <span class="emphasis"><em>any object</em></span>. The support is intended to
be used for objects created <span class="emphasis"><em>outside of the control of any container</em></span>. Domain objects
often fall into this category because they are often created programmatically using the
<code class="literal">new</code> operator, or by an ORM tool as a result of a database query.</p>
<p>The <code class="literal">@Configurable</code> annotation marks a class as eligible for Spring-driven
configuration. In the simplest case it can be used just as a marker annotation:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> com.xyz.myapp.domain;

<span class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Configurable;

<em><span class="hl-annotation" style="color: gray">@Configurable</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
    <span class="hl-comment">// ...</span>
}</pre>
<p>When used as a marker interface in this way, Spring will configure new instances of the
annotated type ( <code class="literal">Account</code> in this case) using a bean definition (typically
prototype-scoped) with the same name as the fully-qualified type name (
<code class="literal">com.xyz.myapp.domain.Account</code>). Since the default name for a bean is the
fully-qualified name of its type, a convenient way to declare the prototype definition
is simply to omit the <code class="literal">id</code> attribute:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.xyz.myapp.domain.Account"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"fundsTransferService"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"fundsTransferService"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>If you want to explicitly specify the name of the prototype bean definition to use, you
can do so directly in the annotation:</p>
<pre class="programlisting"><span class="hl-keyword">package</span> com.xyz.myapp.domain;

<span class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Configurable;

<em><span class="hl-annotation" style="color: gray">@Configurable("account")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
    <span class="hl-comment">// ...</span>
}</pre>
<p>Spring will now look for a bean definition named "account" and use that as the
definition to configure new <code class="literal">Account</code> instances.</p>
<p>You can also use autowiring to avoid having to specify a dedicated bean definition at
all. To have Spring apply autowiring use the <code class="literal">autowire</code> property of the
<code class="literal">@Configurable</code> annotation: specify either <code class="literal">@Configurable(autowire=Autowire.BY_TYPE)</code> or
<code class="literal">@Configurable(autowire=Autowire.BY_NAME</code> for autowiring by type or by name
respectively. As an alternative, as of Spring 2.5 it is preferable to specify explicit,
annotation-driven dependency injection for your <code class="literal">@Configurable</code> beans by using
<code class="literal">@Autowired</code> or <code class="literal">@Inject</code> at the field or method level (see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-annotation-config" title="7.9 Annotation-based container configuration">Section&nbsp;7.9, “Annotation-based container configuration”</a>
for further details).</p>
<p>Finally you can enable Spring dependency checking for the object references in the newly
created and configured object by using the <code class="literal">dependencyCheck</code> attribute (for example:
<code class="literal">@Configurable(autowire=Autowire.BY_NAME,dependencyCheck=true)</code>). If this attribute is
set to true, then Spring will validate after configuration that all properties (<span class="emphasis"><em>which
are not primitives or collections</em></span>) have been set.</p>
<p>Using the annotation on its own does nothing of course. It is the
<code class="literal">AnnotationBeanConfigurerAspect</code> in <code class="literal">spring-aspects.jar</code> that acts on the presence of
the annotation. In essence the aspect says "after returning from the initialization of a
new object of a type annotated with <code class="literal">@Configurable</code>, configure the newly created object
using Spring in accordance with the properties of the annotation". In this context,
<span class="emphasis"><em>initialization</em></span> refers to newly instantiated objects (e.g., objects instantiated with
the <code class="literal">new</code> operator) as well as to <code class="literal">Serializable</code> objects that are undergoing
deserialization (e.g., via
<a class="ulink" href="https://docs.oracle.com/javase/6/docs/api/java/io/Serializable.html" target="_top">readResolve()</a>).</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>One of the key phrases in the above paragraph is '<span class="emphasis"><em>in essence</em></span>'. For most cases, the
exact semantics of '<span class="emphasis"><em>after returning from the initialization of a new object</em></span>' will be
fine…&#8203; in this context, '<span class="emphasis"><em>after initialization</em></span>' means that the dependencies will be
injected <span class="emphasis"><em>after</em></span> the object has been constructed - this means that the dependencies
will not be available for use in the constructor bodies of the class. If you want the
dependencies to be injected <span class="emphasis"><em>before</em></span> the constructor bodies execute, and thus be
available for use in the body of the constructors, then you need to define this on the
<code class="literal">@Configurable</code> declaration like so:</p>
<pre class="programlisting">@Configurable(preConstruction=true)</pre>
<p>You can find out more information about the language semantics of the various pointcut
types in AspectJ
<a class="ulink" href="https://www.eclipse.org/aspectj/doc/next/progguide/semantics-joinPoints.html" target="_top">in this
appendix</a> of the <a class="ulink" href="https://www.eclipse.org/aspectj/doc/next/progguide/index.html" target="_top">AspectJ
Programming Guide</a>.</p>
</td></tr></tbody></table></div>
<p>For this to work the annotated types must be woven with the AspectJ weaver - you can
either use a build-time Ant or Maven task to do this (see for example the
<a class="ulink" href="https://www.eclipse.org/aspectj/doc/released/devguide/antTasks.html" target="_top">AspectJ Development
Environment Guide</a>) or load-time weaving (see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="11.8.4 Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;11.8.4, “Load-time weaving with AspectJ in the Spring Framework”</a>). The
<code class="literal">AnnotationBeanConfigurerAspect</code> itself needs configuring by Spring (in order to obtain
a reference to the bean factory that is to be used to configure new objects). If you are
using Java based configuration simply add <code class="literal">@EnableSpringConfigured</code> to any
<code class="literal">@Configuration</code> class.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableSpringConfigured</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

}</pre>
<p>If you prefer XML based configuration, the Spring <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-context" title="41.2.8 the context schema"><code class="literal">context</code> namespace</a> defines a convenient <code class="literal">context:spring-configured</code> element:</p>
<pre class="programlisting"><span class="hl-tag">&lt;context:spring-configured/&gt;</span></pre>
<p>Instances of <code class="literal">@Configurable</code> objects created <span class="emphasis"><em>before</em></span> the aspect has been configured
will result in a message being issued to the debug log and no configuration of the
object taking place. An example might be a bean in the Spring configuration that creates
domain objects when it is initialized by Spring. In this case you can use the
"depends-on" bean attribute to manually specify that the bean depends on the
configuration aspect.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myService"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"com.xzy.myapp.service.MyService"</span>
        <span class="hl-attribute">depends-on</span>=<span class="hl-value">"org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- ... --&gt;</span>

<span class="hl-tag">&lt;/bean&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Do not activate <code class="literal">@Configurable</code> processing through the bean configurer aspect unless you
really mean to rely on its semantics at runtime. In particular, make sure that you do
not use <code class="literal">@Configurable</code> on bean classes which are registered as regular Spring beans
with the container: You would get double initialization otherwise, once through the
container and once through the aspect.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-configurable-testing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-configurable-testing"></a>Unit testing @Configurable objects</h4></div></div></div>

<p>One of the goals of the <code class="literal">@Configurable</code> support is to enable independent unit testing of
domain objects without the difficulties associated with hard-coded lookups. If
<code class="literal">@Configurable</code> types have not been woven by AspectJ then the annotation has no affect
during unit testing, and you can simply set mock or stub property references in the
object under test and proceed as normal. If <code class="literal">@Configurable</code> types <span class="emphasis"><em>have</em></span> been woven by
AspectJ then you can still unit test outside of the container as normal, but you will
see a warning message each time that you construct an <code class="literal">@Configurable</code> object indicating
that it has not been configured by Spring.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-configurable-container" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-configurable-container"></a>Working with multiple application contexts</h4></div></div></div>

<p>The <code class="literal">AnnotationBeanConfigurerAspect</code> used to implement the <code class="literal">@Configurable</code> support is an
AspectJ singleton aspect. The scope of a singleton aspect is the same as the scope of
<code class="literal">static</code> members, that is to say there is one aspect instance per classloader that
defines the type. This means that if you define multiple application contexts within the
same classloader hierarchy you need to consider where to define the
<code class="literal">@EnableSpringConfigured</code> bean and where to place <code class="literal">spring-aspects.jar</code> on the classpath.</p>
<p>Consider a typical Spring web-app configuration with a shared parent application context
defining common business services and everything needed to support them, and one child
application context per servlet containing definitions particular to that servlet. All
of these contexts will co-exist within the same classloader hierarchy, and so the
<code class="literal">AnnotationBeanConfigurerAspect</code> can only hold a reference to one of them. In this case
we recommend defining the <code class="literal">@EnableSpringConfigured</code> bean in the shared (parent)
application context: this defines the services that you are likely to want to inject
into domain objects. A consequence is that you cannot configure domain objects with
references to beans defined in the child (servlet-specific) contexts using the
@Configurable mechanism (probably not something you want to do anyway!).</p>
<p>When deploying multiple web-apps within the same container, ensure that each
web-application loads the types in <code class="literal">spring-aspects.jar</code> using its own classloader (for
example, by placing <code class="literal">spring-aspects.jar</code> in <code class="literal">'WEB-INF/lib'</code>). If <code class="literal">spring-aspects.jar</code> is
only added to the container wide classpath (and hence loaded by the shared parent
classloader), all web applications will share the same aspect instance which is probably
not what you want.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ajlib-other" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ajlib-other"></a>11.8.2&nbsp;Other Spring aspects for AspectJ</h3></div></div></div>

<p>In addition to the <code class="literal">@Configurable</code> aspect, <code class="literal">spring-aspects.jar</code> contains an AspectJ
aspect that can be used to drive Spring’s transaction management for types and methods
annotated with the <code class="literal">@Transactional</code> annotation. This is primarily intended for users who
want to use the Spring Framework’s transaction support outside of the Spring container.</p>
<p>The aspect that interprets <code class="literal">@Transactional</code> annotations is the
<code class="literal">AnnotationTransactionAspect</code>. When using this aspect, you must annotate the
<span class="emphasis"><em>implementation</em></span> class (and/or methods within that class), <span class="emphasis"><em>not</em></span> the interface (if
any) that the class implements. AspectJ follows Java’s rule that annotations on
interfaces are <span class="emphasis"><em>not inherited</em></span>.</p>
<p>A <code class="literal">@Transactional</code> annotation on a class specifies the default transaction semantics for
the execution of any <span class="emphasis"><em>public</em></span> operation in the class.</p>
<p>A <code class="literal">@Transactional</code> annotation on a method within the class overrides the default
transaction semantics given by the class annotation (if present). Methods of any
visibility may be annotated, including private methods. Annotating non-public methods
directly is the only way to get transaction demarcation for the execution of such methods.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Since Spring Framework 4.2, <code class="literal">spring-aspects</code> provides a similar aspect that offers the
exact same features for the standard <code class="literal">javax.transaction.Transactional</code> annotation. Check
<code class="literal">JtaAnnotationTransactionAspect</code> for more details.</p>
</td></tr></tbody></table></div>
<p>For AspectJ programmers that want to use the Spring configuration and transaction
management support but don’t want to (or cannot) use annotations, <code class="literal">spring-aspects.jar</code>
also contains <code class="literal">abstract</code> aspects you can extend to provide your own pointcut
definitions. See the sources for the <code class="literal">AbstractBeanConfigurerAspect</code> and
<code class="literal">AbstractTransactionAspect</code> aspects for more information. As an example, the following
excerpt shows how you could write an aspect to configure all instances of objects
defined in the domain model using prototype bean definitions that match the
fully-qualified class names:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> aspect DomainObjectConfiguration <span class="hl-keyword">extends</span> AbstractBeanConfigurerAspect {

    <span class="hl-keyword">public</span> DomainObjectConfiguration() {
        setBeanWiringInfoResolver(<span class="hl-keyword">new</span> ClassNameBeanWiringInfoResolver());
    }

    <span class="hl-comment">// the creation of a new bean (any object in the domain model)</span>
    <span class="hl-keyword">protected</span> pointcut beanCreation(Object beanInstance) :
        initialization(<span class="hl-keyword">new</span>(..)) &amp;&amp;
        SystemArchitecture.inDomainModel() &amp;&amp;
        <span class="hl-keyword">this</span>(beanInstance);

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-aj-configure" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-configure"></a>11.8.3&nbsp;Configuring AspectJ aspects using Spring IoC</h3></div></div></div>

<p>When using AspectJ aspects with Spring applications, it is natural to both want and
expect to be able to configure such aspects using Spring. The AspectJ runtime itself is
responsible for aspect creation, and the means of configuring the AspectJ created
aspects via Spring depends on the AspectJ instantiation model (the <code class="literal">per-xxx</code> clause)
used by the aspect.</p>
<p>The majority of AspectJ aspects are <span class="emphasis"><em>singleton</em></span> aspects. Configuration of these
aspects is very easy: simply create a bean definition referencing the aspect type as
normal, and include the bean attribute <code class="literal">'factory-method="aspectOf"'</code>. This ensures that
Spring obtains the aspect instance by asking AspectJ for it rather than trying to create
an instance itself. For example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.xyz.profiler.Profiler"</span>
        <span class="strong"><strong>factory-method="aspectOf"</strong></span>&gt;

    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"profilingStrategy"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"jamonProfilingStrategy"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Non-singleton aspects are harder to configure: however it is possible to do so by
creating prototype bean definitions and using the <code class="literal">@Configurable</code> support from
<code class="literal">spring-aspects.jar</code> to configure the aspect instances once they have bean created by
the AspectJ runtime.</p>
<p>If you have some @AspectJ aspects that you want to weave with AspectJ (for example,
using load-time weaving for domain model types) and other @AspectJ aspects that you want
to use with Spring AOP, and these aspects are all configured using Spring, then you will
need to tell the Spring AOP @AspectJ autoproxying support which exact subset of the
@AspectJ aspects defined in the configuration should be used for autoproxying. You can
do this by using one or more <code class="literal">&lt;include/&gt;</code> elements inside the <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code>
declaration. Each <code class="literal">&lt;include/&gt;</code> element specifies a name pattern, and only beans with
names matched by at least one of the patterns will be used for Spring AOP autoproxy
configuration:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:aspectj-autoproxy&gt;</span>
    <span class="hl-tag">&lt;aop:include</span> <span class="hl-attribute">name</span>=<span class="hl-value">"thisBean"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;aop:include</span> <span class="hl-attribute">name</span>=<span class="hl-value">"thatBean"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/aop:aspectj-autoproxy&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Do not be misled by the name of the <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> element: using it will
result in the creation of <span class="emphasis"><em>Spring AOP proxies</em></span>. The @AspectJ style of aspect
declaration is just being used here, but the AspectJ runtime is <span class="emphasis"><em>not</em></span> involved.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-aj-ltw" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw"></a>11.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework</h3></div></div></div>

<p>Load-time weaving (LTW) refers to the process of weaving AspectJ aspects into an
application’s class files as they are being loaded into the Java virtual machine (JVM).
The focus of this section is on configuring and using LTW in the specific context of the
Spring Framework: this section is not an introduction to LTW though. For full details on
the specifics of LTW and configuring LTW with just AspectJ (with Spring not being
involved at all), see the
<a class="ulink" href="https://www.eclipse.org/aspectj/doc/released/devguide/ltw.html" target="_top">LTW section of the AspectJ
Development Environment Guide</a>.</p>
<p>The value-add that the Spring Framework brings to AspectJ LTW is in enabling much
finer-grained control over the weaving process. 'Vanilla' AspectJ LTW is effected using
a Java (5+) agent, which is switched on by specifying a VM argument when starting up a
JVM. It is thus a JVM-wide setting, which may be fine in some situations, but often is a
little too coarse. Spring-enabled LTW enables you to switch on LTW on a
<span class="emphasis"><em>per-ClassLoader</em></span> basis, which obviously is more fine-grained and which can make more
sense in a 'single-JVM-multiple-application' environment (such as is found in a typical
application server environment).</p>
<p>Further, <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-environments" title="Environment-specific configuration">in certain environments</a>, this support enables
load-time weaving <span class="emphasis"><em>without making any modifications to the application server’s launch
script</em></span> that will be needed to add <code class="literal">-javaagent:path/to/aspectjweaver.jar</code> or (as we
describe later in this section)
<code class="literal">-javaagent:path/to/org.springframework.instrument-{version}.jar</code> (previously named
<code class="literal">spring-agent.jar</code>). Developers simply modify one or more files that form the
application context to enable load-time weaving instead of relying on administrators who
typically are in charge of the deployment configuration such as the launch script.</p>
<p>Now that the sales pitch is over, let us first walk through a quick example of AspectJ
LTW using Spring, followed by detailed specifics about elements introduced in the
following example. For a complete example, please see the
<a class="ulink" href="https://github.com/spring-projects/spring-petclinic" target="_top">Petclinic sample application</a>.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-first-example" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-first-example"></a>A first example</h4></div></div></div>

<p>Let us assume that you are an application developer who has been tasked with diagnosing
the cause of some performance problems in a system. Rather than break out a profiling
tool, what we are going to do is switch on a simple profiling aspect that will enable us
to very quickly get some performance metrics, so that we can then apply a finer-grained
profiling tool to that specific area immediately afterwards.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The example presented here uses XML style configuration, it is also possible to
configure and use @AspectJ with <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java" title="7.12 Java-based container configuration">Java Configuration</a>. Specifically the
<code class="literal">@EnableLoadTimeWeaving</code> annotation can be used as an alternative to
<code class="literal">&lt;context:load-time-weaver/&gt;</code> (see <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-spring" title="Spring configuration">below</a> for details).</p>
</td></tr></tbody></table></div>
<p>Here is the profiling aspect. Nothing too fancy, just a quick-and-dirty time-based
profiler, using the @AspectJ-style of aspect declaration.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> foo;

<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Around;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Pointcut;
<span class="hl-keyword">import</span> org.springframework.util.StopWatch;
<span class="hl-keyword">import</span> org.springframework.core.annotation.Order;

<em><span class="hl-annotation" style="color: gray">@Aspect</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProfilingAspect {

    <em><span class="hl-annotation" style="color: gray">@Around("methodsToBeProfiled()")</span></em>
    <span class="hl-keyword">public</span> Object profile(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
        StopWatch sw = <span class="hl-keyword">new</span> StopWatch(getClass().getSimpleName());
        <span class="hl-keyword">try</span> {
            sw.start(pjp.getSignature().getName());
            <span class="hl-keyword">return</span> pjp.proceed();
        } <span class="hl-keyword">finally</span> {
            sw.stop();
            System.out.println(sw.prettyPrint());
        }
    }

    <em><span class="hl-annotation" style="color: gray">@Pointcut("execution(public * foo..*.*(..))")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> methodsToBeProfiled(){}
}</pre>
<p>We will also need to create an <code class="literal">META-INF/aop.xml</code> file, to inform the AspectJ weaver
that we want to weave our <code class="literal">ProfilingAspect</code> into our classes. This file convention,
namely the presence of a file (or files) on the Java classpath called
<code class="literal">META-INF/aop.xml</code> is standard AspectJ.</p>
<pre class="programlisting"><strong class="hl-tag" style="color: blue">&lt;!DOCTYPE aspectj PUBLIC "-//AspectJ//DTD//EN" "http://www.eclipse.org/aspectj/dtd/aspectj.dtd"&gt;</strong>
<span class="hl-tag">&lt;aspectj&gt;</span>

    <span class="hl-tag">&lt;weaver&gt;</span>
        <span class="hl-comment">&lt;!-- only weave classes in our application-specific packages --&gt;</span>
        <span class="hl-tag">&lt;include</span> <span class="hl-attribute">within</span>=<span class="hl-value">"foo.*"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/weaver&gt;</span>

    <span class="hl-tag">&lt;aspects&gt;</span>
        <span class="hl-comment">&lt;!-- weave in just this aspect --&gt;</span>
        <span class="hl-tag">&lt;aspect</span> <span class="hl-attribute">name</span>=<span class="hl-value">"foo.ProfilingAspect"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/aspects&gt;</span>

<span class="hl-tag">&lt;/aspectj&gt;</span></pre>
<p>Now to the Spring-specific portion of the configuration. We need to configure a
<code class="literal">LoadTimeWeaver</code> (all explained later, just take it on trust for now). This load-time
weaver is the essential component responsible for weaving the aspect configuration in
one or more <code class="literal">META-INF/aop.xml</code> files into the classes in your application. The good
thing is that it does not require a lot of configuration, as can be seen below (there
are some more options that you can specify, but these are detailed later).</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- a service object; we will be profiling its methods --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"entitlementCalculationService"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"foo.StubEntitlementCalculationService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- this switches on the load-time weaving --&gt;</span>
    <span class="strong"><strong>&lt;context:load-time-weaver/&gt;</strong></span>
<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>Now that all the required artifacts are in place - the aspect, the <code class="literal">META-INF/aop.xml</code>
file, and the Spring configuration -, let us create a simple driver class with a
<code class="literal">main(..)</code> method to demonstrate the LTW in action.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> foo;

<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"beans.xml"</span>, Main.<span class="hl-keyword">class</span>);

        EntitlementCalculationService entitlementCalculationService
            = (EntitlementCalculationService) ctx.getBean(<span class="hl-string">"entitlementCalculationService"</span>);

        <span class="hl-comment">// the profiling aspect is 'woven' around this method execution</span>
        entitlementCalculationService.calculateEntitlement();
    }
}</pre>
<p>There is one last thing to do. The introduction to this section did say that one could
switch on LTW selectively on a per- <code class="literal">ClassLoader</code> basis with Spring, and this is true.
However, just for this example, we are going to use a Java agent (supplied with Spring)
to switch on the LTW. This is the command line we will use to run the above <code class="literal">Main</code> class:</p>
<pre class="literallayout">java -javaagent:C:/projects/foo/lib/global/spring-instrument.jar foo.Main</pre>
<p>The <code class="literal">-javaagent</code> is a flag for specifying and enabling
<a class="ulink" href="https://docs.oracle.com/javase/6/docs/api/java/lang/instrument/package-summary.html" target="_top">agents
to instrument programs running on the JVM</a>. The Spring Framework ships with such an
agent, the <code class="literal">InstrumentationSavingAgent</code>, which is packaged in the
<code class="literal">spring-instrument.jar</code> that was supplied as the value of the <code class="literal">-javaagent</code> argument in
the above example.</p>
<p>The output from the execution of the <code class="literal">Main</code> program will look something like that below.
(I have introduced a <code class="literal">Thread.sleep(..)</code> statement into the <code class="literal">calculateEntitlement()</code>
implementation so that the profiler actually captures something other than 0
milliseconds - the <code class="literal">01234</code> milliseconds is <span class="emphasis"><em>not</em></span> an overhead introduced by the AOP :) )</p>
<pre class="literallayout">Calculating entitlement

StopWatch 'ProfilingAspect': running time (millis) = 1234
------ ----- ----------------------------
ms     %     Task name
------ ----- ----------------------------
01234  100%  calculateEntitlement</pre>
<p>Since this LTW is effected using full-blown AspectJ, we are not just limited to advising
Spring beans; the following slight variation on the <code class="literal">Main</code> program will yield the same
result.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> foo;

<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"beans.xml"</span>, Main.<span class="hl-keyword">class</span>);

        EntitlementCalculationService entitlementCalculationService =
            <span class="hl-keyword">new</span> StubEntitlementCalculationService();

        <span class="hl-comment">// the profiling aspect will be 'woven' around this method execution</span>
        entitlementCalculationService.calculateEntitlement();
    }
}</pre>
<p>Notice how in the above program we are simply bootstrapping the Spring container, and
then creating a new instance of the <code class="literal">StubEntitlementCalculationService</code> totally outside
the context of Spring…&#8203; the profiling advice still gets woven in.</p>
<p>The example admittedly is simplistic…&#8203; however the basics of the LTW support in Spring
have all been introduced in the above example, and the rest of this section will explain
the 'why' behind each bit of configuration and usage in detail.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">ProfilingAspect</code> used in this example may be basic, but it is quite useful. It is a
nice example of a development-time aspect that developers can use during development (of
course), and then quite easily exclude from builds of the application being deployed
into UAT or production.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-the-aspects" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-the-aspects"></a>Aspects</h4></div></div></div>

<p>The aspects that you use in LTW have to be AspectJ aspects. They can be written in
either the AspectJ language itself or you can write your aspects in the @AspectJ-style.
It means that your aspects are then both valid AspectJ <span class="emphasis"><em>and</em></span> Spring AOP aspects.
Furthermore, the compiled aspect classes need to be available on the classpath.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-aop_dot_xml" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-aop_dot_xml"></a>'META-INF/aop.xml'</h4></div></div></div>

<p>The AspectJ LTW infrastructure is configured using one or more <code class="literal">META-INF/aop.xml</code>
files, that are on the Java classpath (either directly, or more typically in jar files).</p>
<p>The structure and contents of this file is detailed in the main AspectJ reference
documentation, and the interested reader is
<a class="ulink" href="https://www.eclipse.org/aspectj/doc/released/devguide/ltw-configuration.html" target="_top">referred to
that resource</a>. (I appreciate that this section is brief, but the <code class="literal">aop.xml</code> file is
100% AspectJ - there is no Spring-specific information or semantics that apply to it,
and so there is no extra value that I can contribute either as a result), so rather than
rehash the quite satisfactory section that the AspectJ developers wrote, I am just
directing you there.)</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-libraries" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-libraries"></a>Required libraries (JARS)</h4></div></div></div>

<p>At a minimum you will need the following libraries to use the Spring Framework’s support
for AspectJ LTW:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">spring-aop.jar</code> (version 2.5 or later, plus all mandatory dependencies)
</li><li class="listitem">
<code class="literal">aspectjweaver.jar</code> (version 1.6.8 or later)
</li></ul></div>
<p>If you are using the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-environment-generic" title="Generic Java applications">Spring-provided agent to enable
instrumentation</a>, you will also need:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">spring-instrument.jar</code>
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-spring" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-spring"></a>Spring configuration</h4></div></div></div>

<p>The key component in Spring’s LTW support is the <code class="literal">LoadTimeWeaver</code> interface (in the
<code class="literal">org.springframework.instrument.classloading</code> package), and the numerous implementations
of it that ship with the Spring distribution. A <code class="literal">LoadTimeWeaver</code> is responsible for
adding one or more <code class="literal">java.lang.instrument.ClassFileTransformers</code> to a <code class="literal">ClassLoader</code> at
runtime, which opens the door to all manner of interesting applications, one of which
happens to be the LTW of aspects.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>If you are unfamiliar with the idea of runtime class file transformation, you are
encouraged to read the javadoc API documentation for the <code class="literal">java.lang.instrument</code> package
before continuing. This is not a huge chore because there is - rather annoyingly -
precious little documentation there…&#8203; the key interfaces and classes will at least be
laid out in front of you for reference as you read through this section.</p>
</td></tr></tbody></table></div>
<p>Configuring a <code class="literal">LoadTimeWeaver</code> for a particular <code class="literal">ApplicationContext</code> can be as easy as
adding one line. (Please note that you almost certainly will need to be using an
<code class="literal">ApplicationContext</code> as your Spring container - typically a <code class="literal">BeanFactory</code> will not be
enough because the LTW support makes use of <code class="literal">BeanFactoryPostProcessors</code>.)</p>
<p>To enable the Spring Framework’s LTW support, you need to configure a <code class="literal">LoadTimeWeaver</code>,
which typically is done using the <code class="literal">@EnableLoadTimeWeaving</code> annotation.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableLoadTimeWeaving</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

}</pre>
<p>Alternatively, if you prefer XML based configuration, use the
<code class="literal">&lt;context:load-time-weaver/&gt;</code> element. Note that the element is defined in the
<code class="literal">context</code> namespace.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:load-time-weaver/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The above configuration will define and register a number of LTW-specific infrastructure
beans for you automatically, such as a <code class="literal">LoadTimeWeaver</code> and an <code class="literal">AspectJWeavingEnabler</code>.
The default <code class="literal">LoadTimeWeaver</code> is the <code class="literal">DefaultContextLoadTimeWeaver</code> class, which attempts
to decorate an automatically detected <code class="literal">LoadTimeWeaver</code>: the exact type of
<code class="literal">LoadTimeWeaver</code> that will be 'automatically detected' is dependent upon your runtime
environment (summarized in the following table).</p>
<div class="table"><a name="aop-aj-ltw-spring-env-impls" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-spring-env-impls"></a><p class="title"><b>Table&nbsp;11.1.&nbsp;DefaultContextLoadTimeWeaver LoadTimeWeavers</b></p><div class="table-contents">

<table summary="DefaultContextLoadTimeWeaver LoadTimeWeavers" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Runtime Environment</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top"><code class="literal">LoadTimeWeaver</code> implementation</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Running in Oracle’s
  <a class="ulink" href="http://www.oracle.com/technetwork/middleware/weblogic/overview/index-085209.html" target="_top">WebLogic</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">WebLogicLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Running in Oracle’s <a class="ulink" href="http://glassfish.dev.java.net/" target="_top">GlassFish</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">GlassFishLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Running in <a class="ulink" href="https://tomcat.apache.org/" target="_top">Apache Tomcat</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">TomcatLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Running in Red Hat’s <a class="ulink" href="https://www.jboss.org/jbossas/" target="_top">JBoss AS</a> or <a class="ulink" href="http://www.wildfly.org/" target="_top">WildFly</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JBossLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Running in IBM’s <a class="ulink" href="https://www-01.ibm.com/software/webservers/appserv/was/" target="_top">WebSphere</a></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">WebSphereLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>JVM started with Spring <code class="literal">InstrumentationSavingAgent</code> <span class="emphasis"><em>(java
  -javaagent:path/to/spring-instrument.jar)</em></span></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">InstrumentationLoadTimeWeaver</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Fallback, expecting the underlying ClassLoader to follow common conventions (e.g.
  applicable to <code class="literal">TomcatInstrumentableClassLoader</code> and <a class="ulink" href="http://www.caucho.com/" target="_top">Resin</a>)</p></td><td style="" align="left" valign="top"><p><code class="literal">ReflectiveLoadTimeWeaver</code></p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>Note that these are just the <code class="literal">LoadTimeWeavers</code> that are autodetected when using the
<code class="literal">DefaultContextLoadTimeWeaver</code>: it is of course possible to specify exactly which
<code class="literal">LoadTimeWeaver</code> implementation that you wish to use.</p>
<p>To specify a specific <code class="literal">LoadTimeWeaver</code> with Java configuration implement the
<code class="literal">LoadTimeWeavingConfigurer</code> interface and override the <code class="literal">getLoadTimeWeaver()</code> method:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@EnableLoadTimeWeaving</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig <span class="hl-keyword">implements</span> LoadTimeWeavingConfigurer {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> LoadTimeWeaver getLoadTimeWeaver() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ReflectiveLoadTimeWeaver();
    }
}</pre>
<p>If you are using XML based configuration you can specify the fully-qualified classname
as the value of the <code class="literal">weaver-class</code> attribute on the <code class="literal">&lt;context:load-time-weaver/&gt;</code>
element:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:load-time-weaver</span>
            <span class="hl-attribute">weaver-class</span>=<span class="hl-value">"org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The <code class="literal">LoadTimeWeaver</code> that is defined and registered by the configuration can be later
retrieved from the Spring container using the well-known name <code class="literal">loadTimeWeaver</code>.
Remember that the <code class="literal">LoadTimeWeaver</code> exists just as a mechanism for Spring’s LTW
infrastructure to add one or more <code class="literal">ClassFileTransformers</code>. The actual
<code class="literal">ClassFileTransformer</code> that does the LTW is the <code class="literal">ClassPreProcessorAgentAdapter</code> (from
the <code class="literal">org.aspectj.weaver.loadtime</code> package) class. See the class-level javadocs of the
<code class="literal">ClassPreProcessorAgentAdapter</code> class for further details, because the specifics of how
the weaving is actually effected is beyond the scope of this section.</p>
<p>There is one final attribute of the configuration left to discuss: the
<code class="literal">aspectjWeaving</code> attribute (or <code class="literal">aspectj-weaving</code> if you are using XML). This is a
simple attribute that controls whether LTW is enabled or not; it is as simple as that.
It accepts one of three possible values, summarized below, with the default value being
<code class="literal">autodetect</code> if the attribute is not present.</p>
<div class="table"><a name="aop-aj-ltw-ltw-tag-attrs" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-ltw-tag-attrs"></a><p class="title"><b>Table&nbsp;11.2.&nbsp;AspectJ weaving attribute values</b></p><div class="table-contents">

<table summary="AspectJ weaving attribute values" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Annotation Value</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">XML Value</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ENABLED</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">on</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>AspectJ weaving is on, and aspects will be woven at load-time as appropriate.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">DISABLED</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">off</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>LTW is off…&#8203; no aspect will be woven at load-time.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">AUTODETECT</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">autodetect</code></p></td><td style="" align="left" valign="top"><p>If the Spring LTW infrastructure can find at least one <code class="literal">META-INF/aop.xml</code> file,
  then AspectJ weaving is on, else it is off. This is the default value.</p></td></tr></tbody></table>
</div></div><br class="table-break">
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-aj-ltw-environments" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-environments"></a>Environment-specific configuration</h4></div></div></div>

<p>This last section contains any additional settings and configuration that you will need
when using Spring’s LTW support in environments such as application servers and web
containers.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-aj-ltw-environment-tomcat" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-environment-tomcat"></a>Tomcat</h5></div></div></div>

<p>Historically, <a class="ulink" href="https://tomcat.apache.org/" target="_top">Apache Tomcat</a>'s default class loader did not
support class transformation which is why Spring provides an enhanced implementation
that addresses this need. Named <code class="literal">TomcatInstrumentableClassLoader</code>, the loader works on
Tomcat 6.0 and above.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Do not define <code class="literal">TomcatInstrumentableClassLoader</code> anymore on Tomcat 8.0 and higher.
Instead, let Spring automatically use Tomcat’s new native <code class="literal">InstrumentableClassLoader</code>
facility through the <code class="literal">TomcatLoadTimeWeaver</code> strategy.</p>
</td></tr></tbody></table></div>
<p>If you still need to use <code class="literal">TomcatInstrumentableClassLoader</code>, it can be registered
individually for <span class="emphasis"><em>each</em></span> web application as follows:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Copy <code class="literal">org.springframework.instrument.tomcat.jar</code> into <span class="emphasis"><em>$CATALINA_HOME</em></span>/lib, where
<span class="emphasis"><em>$CATALINA_HOME</em></span> represents the root of the Tomcat installation)
</li><li class="listitem">
Instruct Tomcat to use the custom class loader (instead of the default) by editing the
web application context file:
</li></ul></div>
<pre class="programlisting"><span class="hl-tag">&lt;Context</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/myWebApp"</span> <span class="hl-attribute">docBase</span>=<span class="hl-value">"/my/webApp/location"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;Loader</span>
        <span class="hl-attribute">loaderClass</span>=<span class="hl-value">"org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/Context&gt;</span></pre>
<p>Apache Tomcat (6.0+) supports several context locations:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
server configuration file - <span class="emphasis"><em>$CATALINA_HOME/conf/server.xml</em></span>
</li><li class="listitem">
default context configuration - <span class="emphasis"><em>$CATALINA_HOME/conf/context.xml</em></span> - that affects all
deployed web applications
</li><li class="listitem">
per-web application configuration which can be deployed either on the server-side at
<span class="emphasis"><em>$CATALINA_HOME/conf/[enginename]/[hostname]/[webapp]-context.xml</em></span> or embedded
inside the web-app archive at <span class="emphasis"><em>META-INF/context.xml</em></span>
</li></ul></div>
<p>For efficiency, the embedded per-web-app configuration style is recommended because it
will impact only applications that use the custom class loader and does not require any
changes to the server configuration. See the Tomcat 6.0.x
<a class="ulink" href="https://tomcat.apache.org/tomcat-6.0-doc/config/context.html" target="_top">documentation</a> for more
details about available context locations.</p>
<p>Alternatively, consider the use of the Spring-provided generic VM agent, to be specified
in Tomcat’s launch script (see above). This will make instrumentation available to all
deployed web applications, no matter what ClassLoader they happen to run on.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-aj-ltw-environments-weblogic-oc4j-resin-glassfish-jboss" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-environments-weblogic-oc4j-resin-glassfish-jboss"></a>WebLogic, WebSphere, Resin, GlassFish, JBoss</h5></div></div></div>

<p>Recent versions of WebLogic Server (version 10 and above), IBM WebSphere Application
Server (version 7 and above), Resin (3.1 and above) and JBoss (6.x or above) provide a
ClassLoader that is capable of local instrumentation. Spring’s native LTW leverages such
ClassLoaders to enable AspectJ weaving. You can enable LTW by simply activating
load-time weaving as described earlier. Specifically, you do <span class="emphasis"><em>not</em></span> need to modify the
launch script to add <code class="literal">-javaagent:path/to/spring-instrument.jar</code>.</p>
<p>Note that GlassFish instrumentation-capable ClassLoader is available only in its EAR
environment. For GlassFish web applications, follow the Tomcat setup instructions as
outlined above.</p>
<p>Note that on JBoss 6.x, the app server scanning needs to be disabled to prevent it from
loading the classes before the application actually starts. A quick workaround is to add
to your artifact a file named <code class="literal">WEB-INF/jboss-scanning.xml</code> with the following content:</p>
<pre class="programlisting"><span class="hl-tag">&lt;scanning</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"urn:jboss:scanning:1.0"</span><span class="hl-tag">/&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-aj-ltw-environment-generic" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-environment-generic"></a>Generic Java applications</h5></div></div></div>

<p>When class instrumentation is required in environments that do not support or are not
supported by the existing <code class="literal">LoadTimeWeaver</code> implementations, a JDK agent can be the only
solution. For such cases, Spring provides <code class="literal">InstrumentationLoadTimeWeaver</code>, which
requires a Spring-specific (but very general) VM agent,
<code class="literal">org.springframework.instrument-{version}.jar</code> (previously named <code class="literal">spring-agent.jar</code>).</p>
<p>To use it, you must start the virtual machine with the Spring agent, by supplying the
following JVM options:</p>
<pre class="literallayout">-javaagent:/path/to/org.springframework.instrument-{version}.jar</pre>
<p>Note that this requires modification of the VM launch script which may prevent you from
using this in application server environments (depending on your operation policies).
Additionally, the JDK agent will instrument the <span class="emphasis"><em>entire</em></span> VM which can prove expensive.</p>
<p>For performance reasons, it is recommended to use this configuration only if your target
environment (such as <a class="ulink" href="https://www.eclipse.org/jetty/" target="_top">Jetty</a>) does not have (or does not
support) a dedicated LTW.</p>
</div>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-resources" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-resources"></a>11.9&nbsp;Further Resources</h2></div></div></div>

<p>More information on AspectJ can be found on the <a class="ulink" href="https://www.eclipse.org/aspectj" target="_top">AspectJ
website</a>.</p>
<p>The book <span class="emphasis"><em>Eclipse AspectJ</em></span> by Adrian Colyer et. al. (Addison-Wesley, 2005) provides a
comprehensive introduction and reference for the AspectJ language.</p>
<p>The book <span class="emphasis"><em>AspectJ in Action, Second Edition</em></span> by Ramnivas Laddad (Manning, 2009) comes highly
recommended; the focus of the book is on AspectJ, but a lot of general AOP themes are
explored (in some depth).</p>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="aop-api" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api"></a>12.&nbsp;Spring AOP APIs</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-introduction"></a>12.1&nbsp;Introduction</h2></div></div></div>

<p>The previous chapter described the Spring’s support for AOP using
@AspectJ and schema-based aspect definitions. In this chapter we discuss the lower-level
Spring AOP APIs and the AOP support used in Spring 1.2 applications. For new
applications, we recommend the use of the Spring 2.0 and later AOP support described in
the previous chapter, but when working with existing applications, or when reading books
and articles, you may come across Spring 1.2 style examples. Spring 4.0 is backwards
compatible with Spring 1.2 and everything described in this chapter is fully supported
in Spring 4.0.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-pointcuts" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts"></a>12.2&nbsp;Pointcut API in Spring</h2></div></div></div>

<p>Let’s look at how Spring handles the crucial pointcut concept.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-concepts" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-concepts"></a>12.2.1&nbsp;Concepts</h3></div></div></div>

<p>Spring’s pointcut model enables pointcut reuse independent of advice types. It’s
possible to target different advice using the same pointcut.</p>
<p>The <code class="literal">org.springframework.aop.Pointcut</code> interface is the central interface, used to
target advices to particular classes and methods. The complete interface is shown below:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Pointcut {

    ClassFilter getClassFilter();

    MethodMatcher getMethodMatcher();

}</pre>
<p>Splitting the <code class="literal">Pointcut</code> interface into two parts allows reuse of class and method
matching parts, and fine-grained composition operations (such as performing a "union"
with another method matcher).</p>
<p>The <code class="literal">ClassFilter</code> interface is used to restrict the pointcut to a given set of target
classes. If the <code class="literal">matches()</code> method always returns true, all target classes will be
matched:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ClassFilter {

    <span class="hl-keyword">boolean</span> matches(Class clazz);
}</pre>
<p>The <code class="literal">MethodMatcher</code> interface is normally more important. The complete interface is
shown below:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodMatcher {

    <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass);

    <span class="hl-keyword">boolean</span> isRuntime();

    <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass, Object[] args);
}</pre>
<p>The <code class="literal">matches(Method, Class)</code> method is used to test whether this pointcut will ever
match a given method on a target class. This evaluation can be performed when an AOP
proxy is created, to avoid the need for a test on every method invocation. If the
2-argument matches method returns true for a given method, and the <code class="literal">isRuntime()</code> method
for the MethodMatcher returns true, the 3-argument matches method will be invoked on
every method invocation. This enables a pointcut to look at the arguments passed to the
method invocation immediately before the target advice is to execute.</p>
<p>Most MethodMatchers are static, meaning that their <code class="literal">isRuntime()</code> method returns false.
In this case, the 3-argument matches method will never be invoked.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>If possible, try to make pointcuts static, allowing the AOP framework to cache the
results of pointcut evaluation when an AOP proxy is created.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcut-ops" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcut-ops"></a>12.2.2&nbsp;Operations on pointcuts</h3></div></div></div>

<p>Spring supports operations on pointcuts: notably, <span class="emphasis"><em>union</em></span> and <span class="emphasis"><em>intersection</em></span>.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Union means the methods that either pointcut matches.
</li><li class="listitem">
Intersection means the methods that both pointcuts match.
</li><li class="listitem">
Union is usually more useful.
</li><li class="listitem">
Pointcuts can be composed using the static methods in the
<span class="emphasis"><em>org.springframework.aop.support.Pointcuts</em></span> class, or using the
<span class="emphasis"><em>ComposablePointcut</em></span> class in the same package. However, using AspectJ pointcut
expressions is usually a simpler approach.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-aspectj" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-aspectj"></a>12.2.3&nbsp;AspectJ expression pointcuts</h3></div></div></div>

<p>Since 2.0, the most important type of pointcut used by Spring is
<code class="literal">org.springframework.aop.aspectj.AspectJExpressionPointcut</code>. This is a pointcut that
uses an AspectJ supplied library to parse an AspectJ pointcut expression string.</p>
<p>See the previous chapter for a discussion of supported AspectJ pointcut primitives.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-impls" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-impls"></a>12.2.4&nbsp;Convenience pointcut implementations</h3></div></div></div>

<p>Spring provides several convenient pointcut implementations. Some can be used out of the
box; others are intended to be subclassed in application-specific pointcuts.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-pointcuts-static" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-static"></a>Static pointcuts</h4></div></div></div>

<p>Static pointcuts are based on method and target class, and cannot take into account the
method’s arguments. Static pointcuts are sufficient - <span class="emphasis"><em>and best</em></span> - for most usages.
It’s possible for Spring to evaluate a static pointcut only once, when a method is first
invoked: after that, there is no need to evaluate the pointcut again with each method
invocation.</p>
<p>Let’s consider some static pointcut implementations included with Spring.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-api-pointcuts-regex" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-regex"></a>Regular expression pointcuts</h5></div></div></div>

<p>One obvious way to specify static pointcuts is regular expressions. Several AOP
frameworks besides Spring make this possible.
<code class="literal">org.springframework.aop.support.JdkRegexpMethodPointcut</code> is a generic regular
expression pointcut, using the regular expression support in JDK 1.4+.</p>
<p>Using the <code class="literal">JdkRegexpMethodPointcut</code> class, you can provide a list of pattern Strings. If
any of these is a match, the pointcut will evaluate to true. (So the result is
effectively the union of these pointcuts.)</p>
<p>The usage is shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"settersAndAbsquatulatePointcut"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.support.JdkRegexpMethodPointcut"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"patterns"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>.*set.*<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>.*absquatulate<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Spring provides a convenience class, <code class="literal">RegexpMethodPointcutAdvisor</code>, that allows us to
also reference an Advice (remember that an Advice can be an interceptor, before advice,
throws advice etc.). Behind the scenes, Spring will use a <code class="literal">JdkRegexpMethodPointcut</code>.
Using <code class="literal">RegexpMethodPointcutAdvisor</code> simplifies wiring, as the one bean encapsulates both
pointcut and advice, as shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"settersAndAbsquatulateAdvisor"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.support.RegexpMethodPointcutAdvisor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"advice"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"beanNameOfAopAllianceInterceptor"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"patterns"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>.*set.*<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>.*absquatulate<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p><span class="emphasis"><em>RegexpMethodPointcutAdvisor</em></span> can be used with any Advice type.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-api-pointcuts-attribute-driven" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-attribute-driven"></a>Attribute-driven pointcuts</h5></div></div></div>

<p>An important type of static pointcut is a <span class="emphasis"><em>metadata-driven</em></span> pointcut. This uses the
values of metadata attributes: typically, source-level metadata.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-pointcuts-dynamic" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-dynamic"></a>Dynamic pointcuts</h4></div></div></div>

<p>Dynamic pointcuts are costlier to evaluate than static pointcuts. They take into account
method <span class="emphasis"><em>arguments</em></span>, as well as static information. This means that they must be
evaluated with every method invocation; the result cannot be cached, as arguments will
vary.</p>
<p>The main example is the <code class="literal">control flow</code> pointcut.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="aop-api-pointcuts-cflow" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-cflow"></a>Control flow pointcuts</h5></div></div></div>

<p>Spring control flow pointcuts are conceptually similar to AspectJ <span class="emphasis"><em>cflow</em></span> pointcuts,
although less powerful. (There is currently no way to specify that a pointcut executes
below a join point matched by another pointcut.) A control flow pointcut matches the
current call stack. For example, it might fire if the join point was invoked by a method
in the <code class="literal">com.mycompany.web</code> package, or by the <code class="literal">SomeCaller</code> class. Control flow pointcuts
are specified using the <code class="literal">org.springframework.aop.support.ControlFlowPointcut</code> class.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Control flow pointcuts are significantly more expensive to evaluate at runtime than even
other dynamic pointcuts. In Java 1.4, the cost is about 5 times that of other dynamic
pointcuts.</p>
</td></tr></tbody></table></div>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-superclasses" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-superclasses"></a>12.2.5&nbsp;Pointcut superclasses</h3></div></div></div>

<p>Spring provides useful pointcut superclasses to help you to implement your own pointcuts.</p>
<p>Because static pointcuts are most useful, you’ll probably subclass
StaticMethodMatcherPointcut, as shown below. This requires implementing just one
abstract method (although it’s possible to override other methods to customize behavior):</p>
<pre class="programlisting"><span class="hl-keyword">class</span> TestStaticPointcut <span class="hl-keyword">extends</span> StaticMethodMatcherPointcut {

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass) {
        <span class="hl-comment">// return true if custom criteria match</span>
    }
}</pre>
<p>There are also superclasses for dynamic pointcuts.</p>
<p>You can use custom pointcuts with any advice type in Spring 1.0 RC2 and above.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-pointcuts-custom" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-pointcuts-custom"></a>12.2.6&nbsp;Custom pointcuts</h3></div></div></div>

<p>Because pointcuts in Spring AOP are Java classes, rather than language features (as in
AspectJ) it’s possible to declare custom pointcuts, whether static or dynamic. Custom
pointcuts in Spring can be arbitrarily complex. However, using the AspectJ pointcut
expression language is recommended if possible.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Later versions of Spring may offer support for "semantic pointcuts" as offered by JAC:
for example, "all methods that change instance variables in the target object."</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-advice" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice"></a>12.3&nbsp;Advice API in Spring</h2></div></div></div>

<p>Let’s now look at how Spring AOP handles advice.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-advice-lifecycle" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-lifecycle"></a>12.3.1&nbsp;Advice lifecycles</h3></div></div></div>

<p>Each advice is a Spring bean. An advice instance can be shared across all advised
objects, or unique to each advised object. This corresponds to <span class="emphasis"><em>per-class</em></span> or
<span class="emphasis"><em>per-instance</em></span> advice.</p>
<p>Per-class advice is used most often. It is appropriate for generic advice such as
transaction advisors. These do not depend on the state of the proxied object or add new
state; they merely act on the method and arguments.</p>
<p>Per-instance advice is appropriate for introductions, to support mixins. In this case,
the advice adds state to the proxied object.</p>
<p>It’s possible to use a mix of shared and per-instance advice in the same AOP proxy.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-advice-types" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-types"></a>12.3.2&nbsp;Advice types in Spring</h3></div></div></div>

<p>Spring provides several advice types out of the box, and is extensible to support
arbitrary advice types. Let us look at the basic concepts and standard advice types.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-around" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-around"></a>Interception around advice</h4></div></div></div>

<p>The most fundamental advice type in Spring is <span class="emphasis"><em>interception around advice</em></span>.</p>
<p>Spring is compliant with the AOP Alliance interface for around advice using method
interception. MethodInterceptors implementing around advice should implement the
following interface:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodInterceptor <span class="hl-keyword">extends</span> Interceptor {

    Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable;
}</pre>
<p>The <code class="literal">MethodInvocation</code> argument to the <code class="literal">invoke()</code> method exposes the method being
invoked; the target join point; the AOP proxy; and the arguments to the method. The
<code class="literal">invoke()</code> method should return the invocation’s result: the return value of the join
point.</p>
<p>A simple <code class="literal">MethodInterceptor</code> implementation looks as follows:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DebugInterceptor <span class="hl-keyword">implements</span> MethodInterceptor {

    <span class="hl-keyword">public</span> Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable {
        System.out.println(<span class="hl-string">"Before: invocation=["</span> + invocation + <span class="hl-string">"]"</span>);
        Object rval = invocation.proceed();
        System.out.println(<span class="hl-string">"Invocation returned"</span>);
        <span class="hl-keyword">return</span> rval;
    }
}</pre>
<p>Note the call to the MethodInvocation’s <code class="literal">proceed()</code> method. This proceeds down the
interceptor chain towards the join point. Most interceptors will invoke this method, and
return its return value. However, a MethodInterceptor, like any around advice, can
return a different value or throw an exception rather than invoke the proceed method.
However, you don’t want to do this without good reason!</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>MethodInterceptors offer interoperability with other AOP Alliance-compliant AOP
implementations. The other advice types discussed in the remainder of this section
implement common AOP concepts, but in a Spring-specific way. While there is an advantage
in using the most specific advice type, stick with MethodInterceptor around advice if
you are likely to want to run the aspect in another AOP framework. Note that pointcuts
are not currently interoperable between frameworks, and the AOP Alliance does not
currently define pointcut interfaces.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-before" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-before"></a>Before advice</h4></div></div></div>

<p>A simpler advice type is a <span class="emphasis"><em>before advice</em></span>. This does not need a <code class="literal">MethodInvocation</code>
object, since it will only be called before entering the method.</p>
<p>The main advantage of a before advice is that there is no need to invoke the <code class="literal">proceed()</code>
method, and therefore no possibility of inadvertently failing to proceed down the
interceptor chain.</p>
<p>The <code class="literal">MethodBeforeAdvice</code> interface is shown below. (Spring’s API design would allow for
field before advice, although the usual objects apply to field interception and it’s
unlikely that Spring will ever implement it).</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodBeforeAdvice <span class="hl-keyword">extends</span> BeforeAdvice {

    <span class="hl-keyword">void</span> before(Method m, Object[] args, Object target) <span class="hl-keyword">throws</span> Throwable;
}</pre>
<p>Note the return type is <code class="literal">void</code>. Before advice can insert custom behavior before the join
point executes, but cannot change the return value. If a before advice throws an
exception, this will abort further execution of the interceptor chain. The exception
will propagate back up the interceptor chain. If it is unchecked, or on the signature of
the invoked method, it will be passed directly to the client; otherwise it will be
wrapped in an unchecked exception by the AOP proxy.</p>
<p>An example of a before advice in Spring, which counts all method invocations:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CountingBeforeAdvice <span class="hl-keyword">implements</span> MethodBeforeAdvice {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> count;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> before(Method m, Object[] args, Object target) <span class="hl-keyword">throws</span> Throwable {
        ++count;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() {
        <span class="hl-keyword">return</span> count;
    }
}</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Before advice can be used with any pointcut.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-throws" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-throws"></a>Throws advice</h4></div></div></div>

<p><span class="emphasis"><em>Throws advice</em></span> is invoked after the return of the join point if the join point threw
an exception. Spring offers typed throws advice. Note that this means that the
<code class="literal">org.springframework.aop.ThrowsAdvice</code> interface does not contain any methods: It is a
tag interface identifying that the given object implements one or more typed throws
advice methods. These should be in the form of:</p>
<pre class="programlisting">afterThrowing([Method, args, target], subclassOfThrowable)</pre>
<p>Only the last argument is required. The method signatures may have either one or four
arguments, depending on whether the advice method is interested in the method and
arguments. The following classes are examples of throws advice.</p>
<p>The advice below is invoked if a <code class="literal">RemoteException</code> is thrown (including subclasses):</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RemoteThrowsAdvice <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(RemoteException ex) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// Do something with remote exception</span>
    }
}</pre>
<p>The following advice is invoked if a <code class="literal">ServletException</code> is thrown. Unlike the above
advice, it declares 4 arguments, so that it has access to the invoked method, method
arguments and target object:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServletThrowsAdviceWithArguments <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        <span class="hl-comment">// Do something with all arguments</span>
    }
}</pre>
<p>The final example illustrates how these two methods could be used in a single class,
which handles both <code class="literal">RemoteException</code> and <code class="literal">ServletException</code>. Any number of throws advice
methods can be combined in a single class.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> CombinedThrowsAdvice <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(RemoteException ex) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// Do something with remote exception</span>
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        <span class="hl-comment">// Do something with all arguments</span>
    }
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If a throws-advice method throws an exception itself, it will override the
original exception (i.e. change the exception thrown to the user). The overriding
exception will typically be a RuntimeException; this is compatible with any method
signature. However, if a throws-advice method throws a checked exception, it will have
to match the declared exceptions of the target method and is hence to some degree
coupled to specific target method signatures. <span class="emphasis"><em>Do not throw an undeclared checked
exception that is incompatible with the target method’s signature!</em></span></p>
</td></tr></tbody></table></div>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Throws advice can be used with any pointcut.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-after-returning" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-after-returning"></a>After Returning advice</h4></div></div></div>

<p>An after returning advice in Spring must implement the
<span class="emphasis"><em>org.springframework.aop.AfterReturningAdvice</em></span> interface, shown below:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> AfterReturningAdvice <span class="hl-keyword">extends</span> Advice {

    <span class="hl-keyword">void</span> afterReturning(Object returnValue, Method m, Object[] args, Object target)
            <span class="hl-keyword">throws</span> Throwable;
}</pre>
<p>An after returning advice has access to the return value (which it cannot modify),
invoked method, methods arguments and target.</p>
<p>The following after returning advice counts all successful method invocations that have
not thrown exceptions:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CountingAfterReturningAdvice <span class="hl-keyword">implements</span> AfterReturningAdvice {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> count;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterReturning(Object returnValue, Method m, Object[] args, Object target)
            <span class="hl-keyword">throws</span> Throwable {
        ++count;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() {
        <span class="hl-keyword">return</span> count;
    }
}</pre>
<p>This advice doesn’t change the execution path. If it throws an exception, this will be
thrown up the interceptor chain instead of the return value.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>After returning advice can be used with any pointcut.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-advice-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advice-introduction"></a>Introduction advice</h4></div></div></div>

<p>Spring treats introduction advice as a special kind of interception advice.</p>
<p>Introduction requires an <code class="literal">IntroductionAdvisor</code>, and an <code class="literal">IntroductionInterceptor</code>,
implementing the following interface:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionInterceptor <span class="hl-keyword">extends</span> MethodInterceptor {

    <span class="hl-keyword">boolean</span> implementsInterface(Class intf);
}</pre>
<p>The <code class="literal">invoke()</code> method inherited from the AOP Alliance <code class="literal">MethodInterceptor</code> interface must
implement the introduction: that is, if the invoked method is on an introduced
interface, the introduction interceptor is responsible for handling the method call - it
cannot invoke <code class="literal">proceed()</code>.</p>
<p>Introduction advice cannot be used with any pointcut, as it applies only at class,
rather than method, level. You can only use introduction advice with the
<code class="literal">IntroductionAdvisor</code>, which has the following methods:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionAdvisor <span class="hl-keyword">extends</span> Advisor, IntroductionInfo {

    ClassFilter getClassFilter();

    <span class="hl-keyword">void</span> validateInterfaces() <span class="hl-keyword">throws</span> IllegalArgumentException;
}

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionInfo {

    Class[] getInterfaces();
}</pre>
<p>There is no <code class="literal">MethodMatcher</code>, and hence no <code class="literal">Pointcut</code>, associated with introduction
advice. Only class filtering is logical.</p>
<p>The <code class="literal">getInterfaces()</code> method returns the interfaces introduced by this advisor.</p>
<p>The <code class="literal">validateInterfaces()</code> method is used internally to see whether or not the
introduced interfaces can be implemented by the configured <code class="literal">IntroductionInterceptor</code>.</p>
<p>Let’s look at a simple example from the Spring test suite. Let’s suppose we want to
introduce the following interface to one or more objects:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Lockable {
    <span class="hl-keyword">void</span> lock();
    <span class="hl-keyword">void</span> unlock();
    <span class="hl-keyword">boolean</span> locked();
}</pre>
<p>This illustrates a <span class="emphasis"><em>mixin</em></span>. We want to be able to cast advised objects to Lockable,
whatever their type, and call lock and unlock methods. If we call the lock() method, we
want all setter methods to throw a <code class="literal">LockedException</code>. Thus we can add an aspect that
provides the ability to make objects immutable, without them having any knowledge of it:
a good example of AOP.</p>
<p>Firstly, we’ll need an <code class="literal">IntroductionInterceptor</code> that does the heavy lifting. In this
case, we extend the <code class="literal">org.springframework.aop.support.DelegatingIntroductionInterceptor</code>
convenience class. We could implement IntroductionInterceptor directly, but using
<code class="literal">DelegatingIntroductionInterceptor</code> is best for most cases.</p>
<p>The <code class="literal">DelegatingIntroductionInterceptor</code> is designed to delegate an introduction to an
actual implementation of the introduced interface(s), concealing the use of interception
to do so. The delegate can be set to any object using a constructor argument; the
default delegate (when the no-arg constructor is used) is this. Thus in the example
below, the delegate is the <code class="literal">LockMixin</code> subclass of <code class="literal">DelegatingIntroductionInterceptor</code>.
Given a delegate (by default itself), a <code class="literal">DelegatingIntroductionInterceptor</code> instance
looks for all interfaces implemented by the delegate (other than
IntroductionInterceptor), and will support introductions against any of them. It’s
possible for subclasses such as <code class="literal">LockMixin</code> to call the <code class="literal">suppressInterface(Class intf)</code>
method to suppress interfaces that should not be exposed. However, no matter how many
interfaces an <code class="literal">IntroductionInterceptor</code> is prepared to support, the
<code class="literal">IntroductionAdvisor</code> used will control which interfaces are actually exposed. An
introduced interface will conceal any implementation of the same interface by the target.</p>
<p>Thus <code class="literal">LockMixin</code> extends <code class="literal">DelegatingIntroductionInterceptor</code> and implements <code class="literal">Lockable</code>
itself. The superclass automatically picks up that Lockable can be supported for
introduction, so we don’t need to specify that. We could introduce any number of
interfaces in this way.</p>
<p>Note the use of the <code class="literal">locked</code> instance variable. This effectively adds additional state
to that held in the target object.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LockMixin <span class="hl-keyword">extends</span> DelegatingIntroductionInterceptor <span class="hl-keyword">implements</span> Lockable {

    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> locked;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> lock() {
        <span class="hl-keyword">this</span>.locked = true;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> unlock() {
        <span class="hl-keyword">this</span>.locked = false;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> locked() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.locked;
    }

    <span class="hl-keyword">public</span> Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-keyword">if</span> (locked() &amp;&amp; invocation.getMethod().getName().indexOf(<span class="hl-string">"set"</span>) == <span class="hl-number">0</span>) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> LockedException();
        }
        <span class="hl-keyword">return</span> <span class="hl-keyword">super</span>.invoke(invocation);
    }

}</pre>
<p>Often it isn’t necessary to override the <code class="literal">invoke()</code> method: the
<code class="literal">DelegatingIntroductionInterceptor</code> implementation - which calls the delegate method if
the method is introduced, otherwise proceeds towards the join point - is usually
sufficient. In the present case, we need to add a check: no setter method can be invoked
if in locked mode.</p>
<p>The introduction advisor required is simple. All it needs to do is hold a distinct
<code class="literal">LockMixin</code> instance, and specify the introduced interfaces - in this case, just
<code class="literal">Lockable</code>. A more complex example might take a reference to the introduction
interceptor (which would be defined as a prototype): in this case, there’s no
configuration relevant for a <code class="literal">LockMixin</code>, so we simply create it using <code class="literal">new</code>.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LockMixinAdvisor <span class="hl-keyword">extends</span> DefaultIntroductionAdvisor {

    <span class="hl-keyword">public</span> LockMixinAdvisor() {
        <span class="hl-keyword">super</span>(<span class="hl-keyword">new</span> LockMixin(), Lockable.<span class="hl-keyword">class</span>);
    }
}</pre>
<p>We can apply this advisor very simply: it requires no configuration. (However, it <span class="emphasis"><em>is</em></span>
necessary: It’s impossible to use an <code class="literal">IntroductionInterceptor</code> without an
<span class="emphasis"><em>IntroductionAdvisor</em></span>.) As usual with introductions, the advisor must be per-instance,
as it is stateful. We need a different instance of <code class="literal">LockMixinAdvisor</code>, and hence
<code class="literal">LockMixin</code>, for each advised object. The advisor comprises part of the advised object’s
state.</p>
<p>We can apply this advisor programmatically, using the <code class="literal">Advised.addAdvisor()</code> method, or
(the recommended way) in XML configuration, like any other advisor. All proxy creation
choices discussed below, including "auto proxy creators," correctly handle introductions
and stateful mixins.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-advisor" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advisor"></a>12.4&nbsp;Advisor API in Spring</h2></div></div></div>

<p>In Spring, an Advisor is an aspect that contains just a single advice object associated
with a pointcut expression.</p>
<p>Apart from the special case of introductions, any advisor can be used with any advice.
<code class="literal">org.springframework.aop.support.DefaultPointcutAdvisor</code> is the most commonly used
advisor class. For example, it can be used with a <code class="literal">MethodInterceptor</code>, <code class="literal">BeforeAdvice</code> or
<code class="literal">ThrowsAdvice</code>.</p>
<p>It is possible to mix advisor and advice types in Spring in the same AOP proxy. For
example, you could use a interception around advice, throws advice and before advice in
one proxy configuration: Spring will automatically create the necessary interceptor
chain.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-pfb" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb"></a>12.5&nbsp;Using the ProxyFactoryBean to create AOP proxies</h2></div></div></div>

<p>If you’re using the Spring IoC container (an ApplicationContext or BeanFactory) for your
business objects - and you should be! - you will want to use one of Spring’s AOP
FactoryBeans. (Remember that a factory bean introduces a layer of indirection, enabling
it to create objects of a different type.)</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The Spring AOP support also uses factory beans under the covers.</p>
</td></tr></tbody></table></div>
<p>The basic way to create an AOP proxy in Spring is to use the
<span class="emphasis"><em>org.springframework.aop.framework.ProxyFactoryBean</em></span>. This gives complete control over
the pointcuts and advice that will apply, and their ordering. However, there are simpler
options that are preferable if you don’t need such control.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pfb-1" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-1"></a>12.5.1&nbsp;Basics</h3></div></div></div>

<p>The <code class="literal">ProxyFactoryBean</code>, like other Spring <code class="literal">FactoryBean</code> implementations, introduces a
level of indirection. If you define a <code class="literal">ProxyFactoryBean</code> with name <code class="literal">foo</code>, what objects
referencing <code class="literal">foo</code> see is not the <code class="literal">ProxyFactoryBean</code> instance itself, but an object
created by the <code class="literal">ProxyFactoryBean’s implementation of the `getObject()</code> method. This
method will create an AOP proxy wrapping a target object.</p>
<p>One of the most important benefits of using a <code class="literal">ProxyFactoryBean</code> or another IoC-aware
class to create AOP proxies, is that it means that advices and pointcuts can also be
managed by IoC. This is a powerful feature, enabling certain approaches that are hard to
achieve with other AOP frameworks. For example, an advice may itself reference
application objects (besides the target, which should be available in any AOP
framework), benefiting from all the pluggability provided by Dependency Injection.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pfb-2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-2"></a>12.5.2&nbsp;JavaBean properties</h3></div></div></div>

<p>In common with most <code class="literal">FactoryBean</code> implementations provided with Spring, the
<code class="literal">ProxyFactoryBean</code> class is itself a JavaBean. Its properties are used to:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Specify the target you want to proxy.
</li><li class="listitem">
Specify whether to use CGLIB (see below and also <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-proxy-types" title="12.5.3 JDK- and CGLIB-based proxies">Section&nbsp;12.5.3, “JDK- and CGLIB-based proxies”</a>).
</li></ul></div>
<p>Some key properties are inherited from <code class="literal">org.springframework.aop.framework.ProxyConfig</code>
(the superclass for all AOP proxy factories in Spring). These key properties include:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">proxyTargetClass</code>: <code class="literal">true</code> if the target class is to be proxied, rather than the
target class' interfaces. If this property value is set to <code class="literal">true</code>, then CGLIB proxies
will be created (but see also <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-proxy-types" title="12.5.3 JDK- and CGLIB-based proxies">Section&nbsp;12.5.3, “JDK- and CGLIB-based proxies”</a>).
</li><li class="listitem">
<code class="literal">optimize</code>: controls whether or not aggressive optimizations are applied to proxies
<span class="emphasis"><em>created via CGLIB</em></span>. One should not blithely use this setting unless one fully
understands how the relevant AOP proxy handles optimization. This is currently used
only for CGLIB proxies; it has no effect with JDK dynamic proxies.
</li><li class="listitem">
<code class="literal">frozen</code>: if a proxy configuration is <code class="literal">frozen</code>, then changes to the configuration are
no longer allowed. This is useful both as a slight optimization and for those cases
when you don’t want callers to be able to manipulate the proxy (via the <code class="literal">Advised</code>
interface) after the proxy has been created. The default value of this property is
<code class="literal">false</code>, so changes such as adding additional advice are allowed.
</li><li class="listitem">
<code class="literal">exposeProxy</code>: determines whether or not the current proxy should be exposed in a
<code class="literal">ThreadLocal</code> so that it can be accessed by the target. If a target needs to obtain
the proxy and the <code class="literal">exposeProxy</code> property is set to <code class="literal">true</code>, the target can use the
<code class="literal">AopContext.currentProxy()</code> method.
</li></ul></div>
<p>Other properties specific to <code class="literal">ProxyFactoryBean</code> include:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">proxyInterfaces</code>: array of String interface names. If this isn’t supplied, a CGLIB
proxy for the target class will be used (but see also <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-proxy-types" title="12.5.3 JDK- and CGLIB-based proxies">Section&nbsp;12.5.3, “JDK- and CGLIB-based proxies”</a>).
</li><li class="listitem">
<code class="literal">interceptorNames</code>: String array of <code class="literal">Advisor</code>, interceptor or other advice names to
apply. Ordering is significant, on a first come-first served basis. That is to say
that the first interceptor in the list will be the first to be able to intercept the
invocation.
</li></ul></div>
<p>The names are bean names in the current factory, including bean names from ancestor
factories. You can’t mention bean references here since doing so would result in the
<code class="literal">ProxyFactoryBean</code> ignoring the singleton setting of the advice.</p>
<p>You can append an interceptor name with an asterisk ( <code class="literal">*</code>). This will result in the
application of all advisor beans with names starting with the part before the asterisk
to be applied. An example of using this feature can be found in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-global-advisors" title="12.5.6 Using &#39;global&#39; advisors">Section&nbsp;12.5.6, “Using 'global' advisors”</a>.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
singleton: whether or not the factory should return a single object, no matter how
often the <code class="literal">getObject()</code> method is called. Several <code class="literal">FactoryBean</code> implementations offer
such a method. The default value is <code class="literal">true</code>. If you want to use stateful advice - for
example, for stateful mixins - use prototype advices along with a singleton value of
<code class="literal">false</code>.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-pfb-proxy-types" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-pfb-proxy-types"></a>12.5.3&nbsp;JDK- and CGLIB-based proxies</h3></div></div></div>

<p>This section serves as the definitive documentation on how the <code class="literal">ProxyFactoryBean</code>
chooses to create one of either a JDK- and CGLIB-based proxy for a particular target
object (that is to be proxied).</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The behavior of the <code class="literal">ProxyFactoryBean</code> with regard to creating JDK- or CGLIB-based
proxies changed between versions 1.2.x and 2.0 of Spring. The <code class="literal">ProxyFactoryBean</code> now
exhibits similar semantics with regard to auto-detecting interfaces as those of the
<code class="literal">TransactionProxyFactoryBean</code> class.</p>
</td></tr></tbody></table></div>
<p>If the class of a target object that is to be proxied (hereafter simply referred to as
the target class) doesn’t implement any interfaces, then a CGLIB-based proxy will be
created. This is the easiest scenario, because JDK proxies are interface based, and no
interfaces means JDK proxying isn’t even possible. One simply plugs in the target bean,
and specifies the list of interceptors via the <code class="literal">interceptorNames</code> property. Note that a
CGLIB-based proxy will be created even if the <code class="literal">proxyTargetClass</code> property of the
<code class="literal">ProxyFactoryBean</code> has been set to <code class="literal">false</code>. (Obviously this makes no sense, and is best
removed from the bean definition because it is at best redundant, and at worst
confusing.)</p>
<p>If the target class implements one (or more) interfaces, then the type of proxy that is
created depends on the configuration of the <code class="literal">ProxyFactoryBean</code>.</p>
<p>If the <code class="literal">proxyTargetClass</code> property of the <code class="literal">ProxyFactoryBean</code> has been set to <code class="literal">true</code>,
then a CGLIB-based proxy will be created. This makes sense, and is in keeping with the
principle of least surprise. Even if the <code class="literal">proxyInterfaces</code> property of the
<code class="literal">ProxyFactoryBean</code> has been set to one or more fully qualified interface names, the fact
that the <code class="literal">proxyTargetClass</code> property is set to <code class="literal">true</code> <span class="emphasis"><em>will</em></span> cause CGLIB-based
proxying to be in effect.</p>
<p>If the <code class="literal">proxyInterfaces</code> property of the <code class="literal">ProxyFactoryBean</code> has been set to one or more
fully qualified interface names, then a JDK-based proxy will be created. The created
proxy will implement all of the interfaces that were specified in the <code class="literal">proxyInterfaces</code>
property; if the target class happens to implement a whole lot more interfaces than
those specified in the <code class="literal">proxyInterfaces</code> property, that is all well and good but those
additional interfaces will not be implemented by the returned proxy.</p>
<p>If the <code class="literal">proxyInterfaces</code> property of the <code class="literal">ProxyFactoryBean</code> has <span class="emphasis"><em>not</em></span> been set, but
the target class <span class="emphasis"><em>does implement one (or more)</em></span> interfaces, then the
<code class="literal">ProxyFactoryBean</code> will auto-detect the fact that the target class does actually
implement at least one interface, and a JDK-based proxy will be created. The interfaces
that are actually proxied will be <span class="emphasis"><em>all</em></span> of the interfaces that the target class
implements; in effect, this is the same as simply supplying a list of each and every
interface that the target class implements to the <code class="literal">proxyInterfaces</code> property. However,
it is significantly less work, and less prone to typos.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-proxying-intf" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-proxying-intf"></a>12.5.4&nbsp;Proxying interfaces</h3></div></div></div>

<p>Let’s look at a simple example of <code class="literal">ProxyFactoryBean</code> in action. This example involves:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A <span class="emphasis"><em>target bean</em></span> that will be proxied. This is the "personTarget" bean definition in
the example below.
</li><li class="listitem">
An Advisor and an Interceptor used to provide advice.
</li><li class="listitem">
An AOP proxy bean definition specifying the target object (the personTarget bean) and
the interfaces to proxy, along with the advices to apply.
</li></ul></div>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"personTarget"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.PersonImpl"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Tony"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"51"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyAdvisor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someProperty"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Custom string property value"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"debugInterceptor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.DebugInterceptor"</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"person"</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterfaces"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.mycompany.Person"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"personTarget"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>myAdvisor<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>debugInterceptor<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Note that the <code class="literal">interceptorNames</code> property takes a list of String: the bean names of the
interceptor or advisors in the current factory. Advisors, interceptors, before, after
returning and throws advice objects can be used. The ordering of advisors is significant.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>You might be wondering why the list doesn’t hold bean references. The reason for this is
that if the ProxyFactoryBean’s singleton property is set to false, it must be able to
return independent proxy instances. If any of the advisors is itself a prototype, an
independent instance would need to be returned, so it’s necessary to be able to obtain
an instance of the prototype from the factory; holding a reference isn’t sufficient.</p>
</td></tr></tbody></table></div>
<p>The "person" bean definition above can be used in place of a Person implementation, as
follows:</p>
<pre class="programlisting">Person person = (Person) factory.getBean(<span class="hl-string">"person"</span>);</pre>
<p>Other beans in the same IoC context can express a strongly typed dependency on it, as
with an ordinary Java object:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"personUser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.PersonUser"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"person"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">"person"</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The <code class="literal">PersonUser</code> class in this example would expose a property of type Person. As far as
it’s concerned, the AOP proxy can be used transparently in place of a "real" person
implementation. However, its class would be a dynamic proxy class. It would be possible
to cast it to the <code class="literal">Advised</code> interface (discussed below).</p>
<p>It’s possible to conceal the distinction between target and proxy using an anonymous
<span class="emphasis"><em>inner bean</em></span>, as follows. Only the <code class="literal">ProxyFactoryBean</code> definition is different; the
advice is included only for completeness:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyAdvisor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"someProperty"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Custom string property value"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"debugInterceptor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.DebugInterceptor"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"person"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"proxyInterfaces"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"com.mycompany.Person"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-comment">&lt;!-- Use inner bean, not local reference to target --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.PersonImpl"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"name"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Tony"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"age"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"51"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>myAdvisor<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>debugInterceptor<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>This has the advantage that there’s only one object of type <code class="literal">Person</code>: useful if we want
to prevent users of the application context from obtaining a reference to the un-advised
object, or need to avoid any ambiguity with Spring IoC <span class="emphasis"><em>autowiring</em></span>. There’s also
arguably an advantage in that the ProxyFactoryBean definition is self-contained.
However, there are times when being able to obtain the un-advised target from the
factory might actually be an <span class="emphasis"><em>advantage</em></span>: for example, in certain test scenarios.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-api-proxying-class" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-proxying-class"></a>12.5.5&nbsp;Proxying classes</h3></div></div></div>

<p>What if you need to proxy a class, rather than one or more interfaces?</p>
<p>Imagine that in our example above, there was no <code class="literal">Person</code> interface: we needed to advise
a class called <code class="literal">Person</code> that didn’t implement any business interface. In this case, you
can configure Spring to use CGLIB proxying, rather than dynamic proxies. Simply set the
<code class="literal">proxyTargetClass</code> property on the ProxyFactoryBean above to true. While it’s best to
program to interfaces, rather than classes, the ability to advise classes that don’t
implement interfaces can be useful when working with legacy code. (In general, Spring
isn’t prescriptive. While it makes it easy to apply good practices, it avoids forcing a
particular approach.)</p>
<p>If you want to, you can force the use of CGLIB in any case, even if you do have
interfaces.</p>
<p>CGLIB proxying works by generating a subclass of the target class at runtime. Spring
configures this generated subclass to delegate method calls to the original target: the
subclass is used to implement the <span class="emphasis"><em>Decorator</em></span> pattern, weaving in the advice.</p>
<p>CGLIB proxying should generally be transparent to users. However, there are some issues
to consider:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">Final</code> methods can’t be advised, as they can’t be overridden.
</li><li class="listitem">
There is no need to add CGLIB to your classpath. As of Spring 3.2, CGLIB is repackaged
and included in the spring-core JAR. In other words, CGLIB-based AOP will work "out of
the box" just as do JDK dynamic proxies.
</li></ul></div>
<p>There’s little performance difference between CGLIB proxying and dynamic proxies. As of
Spring 1.0, dynamic proxies are slightly faster. However, this may change in the future.
Performance should not be a decisive consideration in this case.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-global-advisors" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-global-advisors"></a>12.5.6&nbsp;Using 'global' advisors</h3></div></div></div>

<p>By appending an asterisk to an interceptor name, all advisors with bean names matching
the part before the asterisk, will be added to the advisor chain. This can come in handy
if you need to add a standard set of 'global' advisors:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proxy"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"service"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>global*<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"global_debug"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.DebugInterceptor"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"global_performance"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.interceptor.PerformanceMonitorInterceptor"</span><span class="hl-tag">/&gt;</span></pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-concise-proxy" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-concise-proxy"></a>12.6&nbsp;Concise proxy definitions</h2></div></div></div>

<p>Especially when defining transactional proxies, you may end up with many similar proxy
definitions. The use of parent and child bean definitions, along with inner bean
definitions, can result in much cleaner and more concise proxy definitions.</p>
<p>First a parent, <span class="emphasis"><em>template</em></span>, bean definition is created for the proxy:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txProxyTemplate"</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionProxyFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributes"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;props&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"*"</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED<span class="hl-tag">&lt;/prop&gt;</span>
        <span class="hl-tag">&lt;/props&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>This will never be instantiated itself, so may actually be incomplete. Then each proxy
which needs to be created is just a child bean definition, which wraps the target of the
proxy as an inner bean definition, since the target will never be used on its own anyway.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"myService"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"txProxyTemplate"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.MyServiceImpl"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>It is of course possible to override properties from the parent template, such as in
this case, the transaction propagation settings:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mySpecialService"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"txProxyTemplate"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"target"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.samples.MySpecialServiceImpl"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributes"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;props&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"get*"</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"find*"</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"load*"</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">"store*"</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED<span class="hl-tag">&lt;/prop&gt;</span>
        <span class="hl-tag">&lt;/props&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Note that in the example above, we have explicitly marked the parent bean definition as
<span class="emphasis"><em>abstract</em></span> by using the <span class="emphasis"><em>abstract</em></span> attribute, as described
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-child-bean-definitions" title="7.7 Bean definition inheritance">previously</a>, so that it may not actually ever be
instantiated. Application contexts (but not simple bean factories) will by default
pre-instantiate all singletons. It is therefore important (at least for singleton beans)
that if you have a (parent) bean definition which you intend to use only as a template,
and this definition specifies a class, you must make sure to set the <span class="emphasis"><em>abstract</em></span>
attribute to <span class="emphasis"><em>true</em></span>, otherwise the application context will actually try to
pre-instantiate it.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-prog" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-prog"></a>12.7&nbsp;Creating AOP proxies programmatically with the ProxyFactory</h2></div></div></div>

<p>It’s easy to create AOP proxies programmatically using Spring. This enables you to use
Spring AOP without dependency on Spring IoC.</p>
<p>The following listing shows creation of a proxy for a target object, with one
interceptor and one advisor. The interfaces implemented by the target object will
automatically be proxied:</p>
<pre class="programlisting">ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(myBusinessInterfaceImpl);
factory.addAdvice(myMethodInterceptor);
factory.addAdvisor(myAdvisor);
MyBusinessInterface tb = (MyBusinessInterface) factory.getProxy();</pre>
<p>The first step is to construct an object of type
<code class="literal">org.springframework.aop.framework.ProxyFactory</code>. You can create this with a target
object, as in the above example, or specify the interfaces to be proxied in an alternate
constructor.</p>
<p>You can add advices (with interceptors as a specialized kind of advice) and/or advisors,
and manipulate them for the life of the ProxyFactory. If you add an
IntroductionInterceptionAroundAdvisor, you can cause the proxy to implement additional
interfaces.</p>
<p>There are also convenience methods on ProxyFactory (inherited from <code class="literal">AdvisedSupport</code>)
which allow you to add other advice types such as before and throws advice.
AdvisedSupport is the superclass of both ProxyFactory and ProxyFactoryBean.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Integrating AOP proxy creation with the IoC framework is best practice in most
applications. We recommend that you externalize configuration from Java code with AOP,
as in general.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-advised" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-advised"></a>12.8&nbsp;Manipulating advised objects</h2></div></div></div>

<p>However you create AOP proxies, you can manipulate them using the
<code class="literal">org.springframework.aop.framework.Advised</code> interface. Any AOP proxy can be cast to this
interface, whichever other interfaces it implements. This interface includes the
following methods:</p>
<pre class="programlisting">Advisor[] getAdvisors();

<span class="hl-keyword">void</span> addAdvice(Advice advice) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvice(<span class="hl-keyword">int</span> pos, Advice advice) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvisor(Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvisor(<span class="hl-keyword">int</span> pos, Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">int</span> indexOf(Advisor advisor);

<span class="hl-keyword">boolean</span> removeAdvisor(Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> removeAdvisor(<span class="hl-keyword">int</span> index) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">boolean</span> replaceAdvisor(Advisor a, Advisor b) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">boolean</span> isFrozen();</pre>
<p>The <code class="literal">getAdvisors()</code> method will return an Advisor for every advisor, interceptor or
other advice type that has been added to the factory. If you added an Advisor, the
returned advisor at this index will be the object that you added. If you added an
interceptor or other advice type, Spring will have wrapped this in an advisor with a
pointcut that always returns true. Thus if you added a <code class="literal">MethodInterceptor</code>, the advisor
returned for this index will be an <code class="literal">DefaultPointcutAdvisor</code> returning your
<code class="literal">MethodInterceptor</code> and a pointcut that matches all classes and methods.</p>
<p>The <code class="literal">addAdvisor()</code> methods can be used to add any Advisor. Usually the advisor holding
pointcut and advice will be the generic <code class="literal">DefaultPointcutAdvisor</code>, which can be used with
any advice or pointcut (but not for introductions).</p>
<p>By default, it’s possible to add or remove advisors or interceptors even once a proxy
has been created. The only restriction is that it’s impossible to add or remove an
introduction advisor, as existing proxies from the factory will not show the interface
change. (You can obtain a new proxy from the factory to avoid this problem.)</p>
<p>A simple example of casting an AOP proxy to the <code class="literal">Advised</code> interface and examining and
manipulating its advice:</p>
<pre class="programlisting">Advised advised = (Advised) myObject;
Advisor[] advisors = advised.getAdvisors();
<span class="hl-keyword">int</span> oldAdvisorCount = advisors.length;
System.out.println(oldAdvisorCount + <span class="hl-string">" advisors"</span>);

<span class="hl-comment">// Add an advice like an interceptor without a pointcut</span>
<span class="hl-comment">// Will match all proxied methods</span>
<span class="hl-comment">// Can use for interceptors, before, after returning or throws advice</span>
advised.addAdvice(<span class="hl-keyword">new</span> DebugInterceptor());

<span class="hl-comment">// Add selective advice using a pointcut</span>
advised.addAdvisor(<span class="hl-keyword">new</span> DefaultPointcutAdvisor(mySpecialPointcut, myAdvice));

assertEquals(<span class="hl-string">"Added two advisors"</span>, oldAdvisorCount + <span class="hl-number">2</span>, advised.getAdvisors().length);</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>It’s questionable whether it’s advisable (no pun intended) to modify advice on a
business object in production, although there are no doubt legitimate usage cases.
However, it can be very useful in development: for example, in tests. I have sometimes
found it very useful to be able to add test code in the form of an interceptor or other
advice, getting inside a method invocation I want to test. (For example, the advice can
get inside a transaction created for that method: for example, to run SQL to check that
a database was correctly updated, before marking the transaction for roll back.)</p>
</td></tr></tbody></table></div>
<p>Depending on how you created the proxy, you can usually set a <code class="literal">frozen</code> flag, in which
case the <code class="literal">Advised</code> <code class="literal">isFrozen()</code> method will return true, and any attempts to modify
advice through addition or removal will result in an <code class="literal">AopConfigException</code>. The ability
to freeze the state of an advised object is useful in some cases, for example, to
prevent calling code removing a security interceptor. It may also be used in Spring 1.1
to allow aggressive optimization if runtime advice modification is known not to be
required.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-autoproxy" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-autoproxy"></a>12.9&nbsp;Using the "auto-proxy" facility</h2></div></div></div>

<p>So far we’ve considered explicit creation of AOP proxies using a <code class="literal">ProxyFactoryBean</code> or
similar factory bean.</p>
<p>Spring also allows us to use "auto-proxy" bean definitions, which can automatically
proxy selected bean definitions. This is built on Spring "bean post processor"
infrastructure, which enables modification of any bean definition as the container loads.</p>
<p>In this model, you set up some special bean definitions in your XML bean definition file
to configure the auto proxy infrastructure. This allows you just to declare the targets
eligible for auto-proxying: you don’t need to use <code class="literal">ProxyFactoryBean</code>.</p>
<p>There are two ways to do this:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Using an auto-proxy creator that refers to specific beans in the current context.
</li><li class="listitem">
A special case of auto-proxy creation that deserves to be considered separately;
auto-proxy creation driven by source-level metadata attributes.
</li></ul></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-autoproxy-choices" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-autoproxy-choices"></a>12.9.1&nbsp;Autoproxy bean definitions</h3></div></div></div>

<p>The <code class="literal">org.springframework.aop.framework.autoproxy</code> package provides the following
standard auto-proxy creators.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-autoproxy" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-autoproxy"></a>BeanNameAutoProxyCreator</h4></div></div></div>

<p>The <code class="literal">BeanNameAutoProxyCreator</code> class is a <code class="literal">BeanPostProcessor</code> that automatically creates
AOP proxies for beans with names matching literal values or wildcards.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"beanNames"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdk*,onlyJdk"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>myInterceptor<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>As with <code class="literal">ProxyFactoryBean</code>, there is an <code class="literal">interceptorNames</code> property rather than a list
of interceptors, to allow correct behavior for prototype advisors. Named "interceptors"
can be advisors or any advice type.</p>
<p>As with auto proxying in general, the main point of using <code class="literal">BeanNameAutoProxyCreator</code> is
to apply the same configuration consistently to multiple objects, with minimal volume of
configuration. It is a popular choice for applying declarative transactions to multiple
objects.</p>
<p>Bean definitions whose names match, such as "jdkMyBean" and "onlyJdk" in the above
example, are plain old bean definitions with the target class. An AOP proxy will be
created automatically by the <code class="literal">BeanNameAutoProxyCreator</code>. The same advice will be applied
to all matching beans. Note that if advisors are used (rather than the interceptor in
the above example), the pointcuts may apply differently to different beans.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-autoproxy-default" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-autoproxy-default"></a>DefaultAdvisorAutoProxyCreator</h4></div></div></div>

<p>A more general and extremely powerful auto proxy creator is
<code class="literal">DefaultAdvisorAutoProxyCreator</code>. This will automagically apply eligible advisors in the
current context, without the need to include specific bean names in the auto-proxy
advisor’s bean definition. It offers the same merit of consistent configuration and
avoidance of duplication as <code class="literal">BeanNameAutoProxyCreator</code>.</p>
<p>Using this mechanism involves:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Specifying a <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean definition.
</li><li class="listitem">
Specifying any number of Advisors in the same or related contexts. Note that these
<span class="emphasis"><em>must</em></span> be Advisors, not just interceptors or other advices. This is necessary
because there must be a pointcut to evaluate, to check the eligibility of each advice
to candidate bean definitions.
</li></ul></div>
<p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> will automatically evaluate the pointcut contained
in each advisor, to see what (if any) advice it should apply to each business object
(such as "businessObject1" and "businessObject2" in the example).</p>
<p>This means that any number of advisors can be applied automatically to each business
object. If no pointcut in any of the advisors matches any method in a business object,
the object will not be proxied. As bean definitions are added for new business objects,
they will automatically be proxied if necessary.</p>
<p>Autoproxying in general has the advantage of making it impossible for callers or
dependencies to obtain an un-advised object. Calling getBean("businessObject1") on this
ApplicationContext will return an AOP proxy, not the target business object. (The "inner
bean" idiom shown earlier also offers this benefit.)</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionInterceptor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionInterceptor"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"customAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyAdvisor"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObject1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.BusinessObject1"</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- Properties omitted --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObject2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.BusinessObject2"</span><span class="hl-tag">/&gt;</span></pre>
<p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> is very useful if you want to apply the same advice
consistently to many business objects. Once the infrastructure definitions are in place,
you can simply add new business objects without including specific proxy configuration.
You can also drop in additional aspects very easily - for example, tracing or
performance monitoring aspects - with minimal change to configuration.</p>
<p>The DefaultAdvisorAutoProxyCreator offers support for filtering (using a naming
convention so that only certain advisors are evaluated, allowing use of multiple,
differently configured, AdvisorAutoProxyCreators in the same factory) and ordering.
Advisors can implement the <code class="literal">org.springframework.core.Ordered</code> interface to ensure
correct ordering if this is an issue. The TransactionAttributeSourceAdvisor used in the
above example has a configurable order value; the default setting is unordered.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="aop-api-autoproxy-abstract" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-autoproxy-abstract"></a>AbstractAdvisorAutoProxyCreator</h4></div></div></div>

<p>This is the superclass of DefaultAdvisorAutoProxyCreator. You can create your own
auto-proxy creators by subclassing this class, in the unlikely event that advisor
definitions offer insufficient customization to the behavior of the framework
<code class="literal">DefaultAdvisorAutoProxyCreator</code>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-autoproxy-metadata" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-autoproxy-metadata"></a>12.9.2&nbsp;Using metadata-driven auto-proxying</h3></div></div></div>

<p>A particularly important type of auto-proxying is driven by metadata. This produces a
similar programming model to .NET <code class="literal">ServicedComponents</code>. Instead of defining metadata in
XML descriptors, configuration for transaction management and other enterprise services
is held in source-level attributes.</p>
<p>In this case, you use the <code class="literal">DefaultAdvisorAutoProxyCreator</code>, in combination with Advisors
that understand metadata attributes. The metadata specifics are held in the pointcut
part of the candidate advisors, rather than in the auto-proxy creation class itself.</p>
<p>This is really a special case of the <code class="literal">DefaultAdvisorAutoProxyCreator</code>, but deserves
consideration on its own. (The metadata-aware code is in the pointcuts contained in the
advisors, not the AOP framework itself.)</p>
<p>The <code class="literal">/attributes</code> directory of the JPetStore sample application shows the use of
attribute-driven auto-proxying. In this case, there’s no need to use the
<code class="literal">TransactionProxyFactoryBean</code>. Simply defining transactional attributes on business
objects is sufficient, because of the use of metadata-aware pointcuts. The bean
definitions include the following code, in <code class="literal">/WEB-INF/declarativeServices.xml</code>. Note that
this is generic, and can be used outside the JPetStore:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionInterceptor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionInterceptor"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionInterceptor"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionInterceptor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributeSource"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.AttributesTransactionAttributeSource"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"attributes"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"attributes"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"attributes"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.metadata.commons.CommonsAttributes"</span><span class="hl-tag">/&gt;</span></pre>
<p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean definition (the name is not significant, hence
it can even be omitted) will pick up all eligible pointcuts in the current application
context. In this case, the "transactionAdvisor" bean definition, of type
<code class="literal">TransactionAttributeSourceAdvisor</code>, will apply to classes or methods carrying a
transaction attribute. The TransactionAttributeSourceAdvisor depends on a
TransactionInterceptor, via constructor dependency. The example resolves this via
autowiring. The <code class="literal">AttributesTransactionAttributeSource</code> depends on an implementation of
the <code class="literal">org.springframework.metadata.Attributes</code> interface. In this fragment, the
"attributes" bean satisfies this, using the Jakarta Commons Attributes API to obtain
attribute information. (The application code must have been compiled using the Commons
Attributes compilation task.)</p>
<p>The <code class="literal">/annotation</code> directory of the JPetStore sample application contains an analogous
example for auto-proxying driven by JDK 1.5+ annotations. The following configuration
enables automatic detection of Spring’s <code class="literal">Transactional</code> annotation, leading to implicit
proxies for beans containing that annotation:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionInterceptor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionInterceptor"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionInterceptor"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.interceptor.TransactionInterceptor"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"transactionAttributeSource"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.annotation.AnnotationTransactionAttributeSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The <code class="literal">TransactionInterceptor</code> defined here depends on a <code class="literal">PlatformTransactionManager</code>
definition, which is not included in this generic file (although it could be) because it
will be specific to the application’s transaction requirements (typically JTA, as in
this example, or Hibernate, JDO or JDBC):</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span><span class="hl-tag">/&gt;</span></pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>If you require only declarative transaction management, using these generic XML
definitions will result in Spring automatically proxying all classes or methods with
transaction attributes. You won’t need to work directly with AOP, and the programming
model is similar to that of .NET ServicedComponents.</p>
</td></tr></tbody></table></div>
<p>This mechanism is extensible. It’s possible to do auto-proxying based on custom
attributes. You need to:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Define your custom attribute.
</li><li class="listitem">
Specify an Advisor with the necessary advice, including a pointcut that is triggered
by the presence of the custom attribute on a class or method. You may be able to use
an existing advice, merely implementing a static pointcut that picks up the custom
attribute.
</li></ul></div>
<p>It’s possible for such advisors to be unique to each advised class (for example, mixins):
they simply need to be defined as prototype, rather than singleton, bean definitions.
For example, the <code class="literal">LockMixin</code> introduction interceptor from the Spring test suite,
shown above, could be used in conjunction with a generic <code class="literal">DefaultIntroductionAdvisor</code>:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lockMixin"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"test.mixin.LockMixin"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"lockableAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.support.DefaultIntroductionAdvisor"</span>
        <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"lockMixin"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Note that both <code class="literal">lockMixin</code> and <code class="literal">lockableAdvisor</code> are defined as prototypes.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-targetsource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-targetsource"></a>12.10&nbsp;Using TargetSources</h2></div></div></div>

<p>Spring offers the concept of a <span class="emphasis"><em>TargetSource</em></span>, expressed in the
<code class="literal">org.springframework.aop.TargetSource</code> interface. This interface is responsible for
returning the "target object" implementing the join point. The <code class="literal">TargetSource</code>
implementation is asked for a target instance each time the AOP proxy handles a method
invocation.</p>
<p>Developers using Spring AOP don’t normally need to work directly with TargetSources, but
this provides a powerful means of supporting pooling, hot swappable and other
sophisticated targets. For example, a pooling TargetSource can return a different target
instance for each invocation, using a pool to manage instances.</p>
<p>If you do not specify a TargetSource, a default implementation is used that wraps a
local object. The same target is returned for each invocation (as you would expect).</p>
<p>Let’s look at the standard target sources provided with Spring, and how you can use them.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>When using a custom target source, your target will usually need to be a prototype
rather than a singleton bean definition. This allows Spring to create a new target
instance when required.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-swap" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ts-swap"></a>12.10.1&nbsp;Hot swappable target sources</h3></div></div></div>

<p>The <code class="literal">org.springframework.aop.target.HotSwappableTargetSource</code> exists to allow the target
of an AOP proxy to be switched while allowing callers to keep their references to it.</p>
<p>Changing the target source’s target takes effect immediately. The
<code class="literal">HotSwappableTargetSource</code> is threadsafe.</p>
<p>You can change the target via the <code class="literal">swap()</code> method on HotSwappableTargetSource as follows:</p>
<pre class="programlisting">HotSwappableTargetSource swapper = (HotSwappableTargetSource) beanFactory.getBean(<span class="hl-string">"swapper"</span>);
Object oldTarget = swapper.swap(newTarget);</pre>
<p>The XML definitions required look as follows:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"initialTarget"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"mycompany.OldTarget"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"swapper"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.HotSwappableTargetSource"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"initialTarget"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"swappable"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"swapper"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The above <code class="literal">swap()</code> call changes the target of the swappable bean. Clients who hold a
reference to that bean will be unaware of the change, but will immediately start hitting
the new target.</p>
<p>Although this example doesn’t add any advice - and it’s not necessary to add advice to
use a <code class="literal">TargetSource</code> - of course any <code class="literal">TargetSource</code> can be used in conjunction with
arbitrary advice.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-pool" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ts-pool"></a>12.10.2&nbsp;Pooling target sources</h3></div></div></div>

<p>Using a pooling target source provides a similar programming model to stateless session
EJBs, in which a pool of identical instances is maintained, with method invocations
going to free objects in the pool.</p>
<p>A crucial difference between Spring pooling and SLSB pooling is that Spring pooling can
be applied to any POJO. As with Spring in general, this service can be applied in a
non-invasive way.</p>
<p>Spring provides out-of-the-box support for Commons Pool 2.2, which provides a
fairly efficient pooling implementation. You’ll need the commons-pool Jar on your
application’s classpath to use this feature. It’s also possible to subclass
<code class="literal">org.springframework.aop.target.AbstractPoolingTargetSource</code> to support any other
pooling API.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Commons Pool 1.5+ is also supported but deprecated as of Spring Framework 4.2.</p>
</td></tr></tbody></table></div>
<p>Sample configuration is shown below:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObjectTarget"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.MyBusinessObject"</span>
        <span class="hl-attribute">scope</span>=<span class="hl-value">"prototype"</span><span class="hl-tag">&gt;</span>
    ... properties omitted
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"poolTargetSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.CommonsPool2TargetSource"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"businessObjectTarget"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"maxSize"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"25"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"businessObject"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.framework.ProxyFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"poolTargetSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"interceptorNames"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"myInterceptor"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>Note that the target object - "businessObjectTarget" in the example - <span class="emphasis"><em>must</em></span> be a
prototype. This allows the <code class="literal">PoolingTargetSource</code> implementation to create new instances
of the target to grow the pool as necessary. See the javadocs of
<code class="literal">AbstractPoolingTargetSource</code> and the concrete subclass you wish to use for information
about its properties: "maxSize" is the most basic, and always guaranteed to be present.</p>
<p>In this case, "myInterceptor" is the name of an interceptor that would need to be
defined in the same IoC context. However, it isn’t necessary to specify interceptors to
use pooling. If you want only pooling, and no other advice, don’t set the
interceptorNames property at all.</p>
<p>It’s possible to configure Spring so as to be able to cast any pooled object to the
<code class="literal">org.springframework.aop.target.PoolingConfig</code> interface, which exposes information
about the configuration and current size of the pool through an introduction. You’ll
need to define an advisor like this:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"poolConfigAdvisor"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.beans.factory.config.MethodInvokingFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetObject"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"poolTargetSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetMethod"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"getPoolingConfigMixin"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>This advisor is obtained by calling a convenience method on the
<code class="literal">AbstractPoolingTargetSource</code> class, hence the use of MethodInvokingFactoryBean. This
advisor’s name ("poolConfigAdvisor" here) must be in the list of interceptors names in
the ProxyFactoryBean exposing the pooled object.</p>
<p>The cast will look as follows:</p>
<pre class="programlisting">PoolingConfig conf = (PoolingConfig) beanFactory.getBean(<span class="hl-string">"businessObject"</span>);
System.out.println(<span class="hl-string">"Max pool size is "</span> + conf.getMaxSize());</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Pooling stateless service objects is not usually necessary. We don’t believe it should
be the default choice, as most stateless objects are naturally thread safe, and instance
pooling is problematic if resources are cached.</p>
</td></tr></tbody></table></div>
<p>Simpler pooling is available using auto-proxying. It’s possible to set the TargetSources
used by any auto-proxy creator.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-prototype" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ts-prototype"></a>12.10.3&nbsp;Prototype target sources</h3></div></div></div>

<p>Setting up a "prototype" target source is similar to a pooling TargetSource. In this
case, a new instance of the target will be created on every method invocation. Although
the cost of creating a new object isn’t high in a modern JVM, the cost of wiring up the
new object (satisfying its IoC dependencies) may be more expensive. Thus you shouldn’t
use this approach without very good reason.</p>
<p>To do this, you could modify the <code class="literal">poolTargetSource</code> definition shown above as follows.
(I’ve also changed the name, for clarity.)</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"prototypeTargetSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.PrototypeTargetSource"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"businessObjectTarget"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>There’s only one property: the name of the target bean. Inheritance is used in the
TargetSource implementations to ensure consistent naming. As with the pooling target
source, the target bean must be a prototype bean definition.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="aop-ts-threadlocal" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ts-threadlocal"></a>12.10.4&nbsp;ThreadLocal target sources</h3></div></div></div>

<p><code class="literal">ThreadLocal</code> target sources are useful if you need an object to be created for each
incoming request (per thread that is). The concept of a <code class="literal">ThreadLocal</code> provide a JDK-wide
facility to transparently store resource alongside a thread. Setting up a
<code class="literal">ThreadLocalTargetSource</code> is pretty much the same as was explained for the other types
of target source:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"threadlocalTargetSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.aop.target.ThreadLocalTargetSource"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"targetBeanName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"businessObjectTarget"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>ThreadLocals come with serious issues (potentially resulting in memory leaks) when
incorrectly using them in a multi-threaded and multi-classloader environments. One
should always consider wrapping a threadlocal in some other class and never directly use
the <code class="literal">ThreadLocal</code> itself (except of course in the wrapper class). Also, one should
always remember to correctly set and unset (where the latter simply involved a call to
<code class="literal">ThreadLocal.set(null)</code>) the resource local to the thread. Unsetting should be done in
any case since not unsetting it might result in problematic behavior. Spring’s
ThreadLocal support does this for you and should always be considered in favor of using
ThreadLocals without other proper handling code.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-extensibility" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-extensibility"></a>12.11&nbsp;Defining new Advice types</h2></div></div></div>

<p>Spring AOP is designed to be extensible. While the interception implementation strategy
is presently used internally, it is possible to support arbitrary advice types in
addition to the out-of-the-box interception around advice, before, throws advice and
after returning advice.</p>
<p>The <code class="literal">org.springframework.aop.framework.adapter</code> package is an SPI package allowing
support for new custom advice types to be added without changing the core framework.
The only constraint on a custom <code class="literal">Advice</code> type is that it must implement the
<code class="literal">org.aopalliance.aop.Advice</code> marker interface.</p>
<p>Please refer to the <code class="literal">org.springframework.aop.framework.adapter</code> javadocs for further
information.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="aop-api-resources" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-api-resources"></a>12.12&nbsp;Further resources</h2></div></div></div>

<p>Please refer to the Spring sample applications for further examples of Spring AOP:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The JPetStore’s default configuration illustrates the use of the
<code class="literal">TransactionProxyFactoryBean</code> for declarative transaction management.
</li><li class="listitem">
The <code class="literal">/attributes</code> directory of the JPetStore illustrates the use of attribute-driven
declarative transaction management.
</li></ul></div>
</div>
</div>
</div>
<div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="testing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing"></a>Part&nbsp;IV.&nbsp;Testing</h1></div></div></div>

<div class="partintro"><div></div>
<p>The adoption of the test-driven-development (TDD) approach to software
development is certainly advocated by the Spring team, and so coverage of Spring’s
support for integration testing is covered (alongside best practices for unit testing).
The Spring team has found that the correct use of IoC certainly does make both unit and
integration testing easier (in that the presence of setter methods and appropriate
constructors on classes makes them easier to wire together in a test without having to
set up service locator registries and suchlike)…&#8203; the chapter dedicated solely to
testing will hopefully convince you of this as well.</p>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="testing-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-introduction"></a>13.&nbsp;Introduction to Spring Testing</h2></div></div></div>

<p>Testing is an integral part of enterprise software development. This chapter focuses on
the value-add of the IoC principle to <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing" title="14. Unit Testing">unit testing</a> and on the benefits
of the Spring Framework’s support for <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing" title="15. Integration Testing">integration testing</a>. <span class="emphasis"><em>(A
thorough treatment of testing in the enterprise is beyond the scope of this reference
manual.)</em></span></p>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="unit-testing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing"></a>14.&nbsp;Unit Testing</h2></div></div></div>

<p>Dependency Injection should make your code less dependent on the container than it would
be with traditional Java EE development. The POJOs that make up your application should
be testable in JUnit or TestNG tests, with objects simply instantiated using the <code class="literal">new</code>
operator, <span class="emphasis"><em>without Spring or any other container</em></span>. You can use <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects" title="14.1 Mock Objects">mock
objects</a> (in conjunction with other valuable testing techniques) to test your code in
isolation. If you follow the architecture recommendations for Spring, the resulting
clean layering and componentization of your codebase will facilitate easier unit
testing. For example, you can test service layer objects by stubbing or mocking DAO or
Repository interfaces, without needing to access persistent data while running unit
tests.</p>
<p>True unit tests typically run extremely quickly, as there is no runtime infrastructure
to set up. Emphasizing true unit tests as part of your development methodology will
boost your productivity. You may not need this section of the testing chapter to help
you write effective unit tests for your IoC-based applications. For certain unit testing
scenarios, however, the Spring Framework provides the following mock objects and testing
support classes.</p>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mock-objects" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects"></a>14.1&nbsp;Mock Objects</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mock-objects-env" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-env"></a>14.1.1&nbsp;Environment</h3></div></div></div>

<p>The <code class="literal">org.springframework.mock.env</code> package contains mock implementations of the
<code class="literal">Environment</code> and <code class="literal">PropertySource</code> abstractions (see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-definition-profiles" title="7.13.1 Bean definition profiles">Section&nbsp;7.13.1, “Bean definition profiles”</a>
and <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-property-source-abstraction" title="7.13.2 PropertySource abstraction">Section&nbsp;7.13.2, “PropertySource abstraction”</a>). <code class="literal">MockEnvironment</code> and
<code class="literal">MockPropertySource</code> are useful for developing <span class="emphasis"><em>out-of-container</em></span> tests for code that
depends on environment-specific properties.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mock-objects-jndi" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-jndi"></a>14.1.2&nbsp;JNDI</h3></div></div></div>

<p>The <code class="literal">org.springframework.mock.jndi</code> package contains an implementation of the JNDI SPI,
which you can use to set up a simple JNDI environment for test suites or stand-alone
applications. If, for example, JDBC <code class="literal">DataSource</code>s get bound to the same JNDI names in
test code as within a Java EE container, you can reuse both application code and
configuration in testing scenarios without modification.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mock-objects-servlet" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-servlet"></a>14.1.3&nbsp;Servlet API</h3></div></div></div>

<p>The <code class="literal">org.springframework.mock.web</code> package contains a comprehensive set of Servlet API
mock objects, which are useful for testing web contexts, controllers, and filters. These
mock objects are targeted at usage with Spring’s Web MVC framework and are generally more
convenient to use than dynamic mock objects such as <a class="ulink" href="http://www.easymock.org/" target="_top">EasyMock</a> or
alternative Servlet API mock objects such as <a class="ulink" href="http://www.mockobjects.com/" target="_top">MockObjects</a>. Since
Spring Framework 4.0, the set of mocks in the <code class="literal">org.springframework.mock.web</code> package is
based on the Servlet 3.0 API.</p>
<p>For thorough integration testing of your Spring MVC and REST <code class="literal">Controller</code>s in
conjunction with your <code class="literal">WebApplicationContext</code> configuration for Spring MVC, see the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-framework" title="15.6 Spring MVC Test Framework"><span class="emphasis"><em>Spring MVC Test Framework</em></span></a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="mock-objects-portlet" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-portlet"></a>14.1.4&nbsp;Portlet API</h3></div></div></div>

<p>The <code class="literal">org.springframework.mock.web.portlet</code> package contains a set of Portlet API mock
objects, targeted at usage with Spring’s Portlet MVC framework.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="unit-testing-support-classes" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing-support-classes"></a>14.2&nbsp;Unit Testing support Classes</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="unit-testing-utilities" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing-utilities"></a>14.2.1&nbsp;General testing utilities</h3></div></div></div>

<p>The <code class="literal">org.springframework.test.util</code> package contains several general purpose utilities
for use in unit and integration testing.</p>
<p><code class="literal">ReflectionTestUtils</code> is a collection of reflection-based utility methods. Developers use
these methods in testing scenarios where they need to change the value of a constant, set
a non-<code class="literal">public</code> field, invoke a non-<code class="literal">public</code> setter method, or invoke a non-<code class="literal">public</code>
<span class="emphasis"><em>configuration</em></span> or <span class="emphasis"><em>lifecycle</em></span> callback method when testing application code involving
use cases such as the following.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
ORM frameworks such as JPA and Hibernate that condone <code class="literal">private</code> or <code class="literal">protected</code> field
access as opposed to <code class="literal">public</code> setter methods for properties in a domain entity.
</li><li class="listitem">
Spring’s support for annotations such as <code class="literal">@Autowired</code>, <code class="literal">@Inject</code>, and <code class="literal">@Resource</code>,
which provides dependency injection for <code class="literal">private</code> or <code class="literal">protected</code> fields, setter
methods, and configuration methods.
</li><li class="listitem">
Use of annotations such as <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> for lifecycle callback
methods.
</li></ul></div>
<p><code class="literal">AopTestUtils</code> is a collection of AOP-related utility methods. These methods can be used
to obtain a reference to the underlying target object hidden behind one or more Spring
proxies. For example, if you have configured a bean as a dynamic mock using a library
like EasyMock or Mockito and the mock is wrapped in a Spring proxy, you may need direct
access to the underlying mock in order to configure expectations on it and perform
verifications. For Spring’s core AOP utilities, see <code class="literal">AopUtils</code> and <code class="literal">AopProxyUtils</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="unit-testing-spring-mvc" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#unit-testing-spring-mvc"></a>14.2.2&nbsp;Spring MVC</h3></div></div></div>

<p>The <code class="literal">org.springframework.test.web</code> package contains <code class="literal">ModelAndViewAssert</code>, which you can
use in combination with JUnit, TestNG, or any other testing framework for unit tests
dealing with Spring MVC <code class="literal">ModelAndView</code> objects.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Unit testing Spring MVC Controllers"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Unit testing Spring MVC Controllers</th></tr><tr><td align="left" valign="top">

<p>To unit test your Spring MVC <code class="literal">Controller</code>s as POJOs, use <code class="literal">ModelAndViewAssert</code> combined
with <code class="literal">MockHttpServletRequest</code>, <code class="literal">MockHttpSession</code>, and so on from Spring’s
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-servlet" title="14.1.3 Servlet API">Servlet API mocks</a>. For thorough integration testing of your
Spring MVC and REST <code class="literal">Controller</code>s in conjunction with your <code class="literal">WebApplicationContext</code>
configuration for Spring MVC, use the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-framework" title="15.6 Spring MVC Test Framework"><span class="emphasis"><em>Spring MVC Test
Framework</em></span></a> instead.</p>
</td></tr></tbody></table></div>
</div>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="integration-testing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing"></a>15.&nbsp;Integration Testing</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="integration-testing-overview" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-overview"></a>15.1&nbsp;Overview</h2></div></div></div>

<p>It is important to be able to perform some integration testing without requiring
deployment to your application server or connecting to other enterprise infrastructure.
This will enable you to test things such as:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The correct wiring of your Spring IoC container contexts.
</li><li class="listitem">
Data access using JDBC or an ORM tool. This would include such things as the
correctness of SQL statements, Hibernate queries, JPA entity mappings, etc.
</li></ul></div>
<p>The Spring Framework provides first-class support for integration testing in the
<code class="literal">spring-test</code> module. The name of the actual JAR file might include the release version
and might also be in the long <code class="literal">org.springframework.test</code> form, depending on where you
get it from (see the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dependency-management" title="2.3.1 Dependency Management and Naming Conventions">section on Dependency Management</a> for an
explanation). This library includes the <code class="literal">org.springframework.test</code> package, which
contains valuable classes for integration testing with a Spring container. This testing
does not rely on an application server or other deployment environment. Such tests are
slower to run than unit tests but much faster than the equivalent Selenium tests or remote
tests that rely on deployment to an application server.</p>
<p>In Spring 2.5 and later, unit and integration testing support is provided in the form of
the annotation-driven <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-framework" title="15.5 Spring TestContext Framework">Spring TestContext Framework</a>. The
TestContext framework is agnostic of the actual testing framework in use, thus allowing
instrumentation of tests in various environments including JUnit, TestNG, and so on.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="integration-testing-goals" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-goals"></a>15.2&nbsp;Goals of Integration Testing</h2></div></div></div>

<p>Spring’s integration testing support has the following primary goals:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
To manage <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-ctx-management" title="15.2.1 Context management and caching">Spring IoC container caching</a> between test
execution.
</li><li class="listitem">
To provide <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-fixture-di" title="15.2.2 Dependency Injection of test fixtures">Dependency Injection of test fixture instances</a>.
</li><li class="listitem">
To provide <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-tx" title="15.2.3 Transaction management">transaction management</a> appropriate to integration testing.
</li><li class="listitem">
To supply <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-support-classes" title="15.2.4 Support classes for integration testing">Spring-specific base classes</a> that assist
developers in writing integration tests.
</li></ul></div>
<p>The next few sections describe each goal and provide links to implementation and
configuration details.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testing-ctx-management" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-ctx-management"></a>15.2.1&nbsp;Context management and caching</h3></div></div></div>

<p>The Spring TestContext Framework provides consistent loading of Spring
<code class="literal">ApplicationContext</code>s and <code class="literal">WebApplicationContext</code>s as well as caching of those
contexts. Support for the caching of loaded contexts is important, because startup time
can become an issue&#8201;—&#8201;not because of the overhead of Spring itself, but because the
objects instantiated by the Spring container take time to instantiate. For example, a
project with 50 to 100 Hibernate mapping files might take 10 to 20 seconds to load the
mapping files, and incurring that cost before running every test in every test fixture
leads to slower overall test runs that reduce developer productivity.</p>
<p>Test classes typically declare either an array of <span class="emphasis"><em>resource locations</em></span> for XML or Groovy
configuration metadata&#8201;—&#8201;often in the classpath&#8201;—&#8201;or an array of <span class="emphasis"><em>annotated classes</em></span>
that is used to configure the application. These locations or classes are the same as or
similar to those specified in <code class="literal">web.xml</code> or other configuration files for production
deployments.</p>
<p>By default, once loaded, the configured <code class="literal">ApplicationContext</code> is reused for each test.
Thus the setup cost is incurred only once per test suite, and subsequent test execution
is much faster. In this context, the term <span class="emphasis"><em>test suite</em></span> means all tests run in the same
JVM&#8201;—&#8201;for example, all tests run from an Ant, Maven, or Gradle build for a given
project or module. In the unlikely case that a test corrupts the application context and
requires reloading&#8201;—&#8201;for example, by modifying a bean definition or the state of an
application object&#8201;—&#8201;the TestContext framework can be configured to reload the
configuration and rebuild the application context before executing the next test.</p>
<p>See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management" title="15.5.4 Context management">Section&nbsp;15.5.4, “Context management”</a> and <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-caching" title="Context caching">the section called “Context caching”</a> with the
TestContext framework.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testing-fixture-di" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-fixture-di"></a>15.2.2&nbsp;Dependency Injection of test fixtures</h3></div></div></div>

<p>When the TestContext framework loads your application context, it can optionally
configure instances of your test classes via Dependency Injection. This provides a
convenient mechanism for setting up test fixtures using preconfigured beans from your
application context. A strong benefit here is that you can reuse application contexts
across various testing scenarios (e.g., for configuring Spring-managed object graphs,
transactional proxies, <code class="literal">DataSource</code>s, etc.), thus avoiding the need to duplicate
complex test fixture setup for individual test cases.</p>
<p>As an example, consider the scenario where we have a class, <code class="literal">HibernateTitleRepository</code>,
that implements data access logic for a <code class="literal">Title</code> domain entity. We want to write
integration tests that test the following areas:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The Spring configuration: basically, is everything related to the configuration of the
<code class="literal">HibernateTitleRepository</code> bean correct and present?
</li><li class="listitem">
The Hibernate mapping file configuration: is everything mapped correctly, and are the
correct lazy-loading settings in place?
</li><li class="listitem">
The logic of the <code class="literal">HibernateTitleRepository</code>: does the configured instance of this
class perform as anticipated?
</li></ul></div>
<p>See dependency injection of test fixtures with the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-fixture-di" title="15.5.5 Dependency injection of test fixtures">TestContext
framework</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testing-tx" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-tx"></a>15.2.3&nbsp;Transaction management</h3></div></div></div>

<p>One common issue in tests that access a real database is their effect on the state of
the persistence store. Even when you’re using a development database, changes to the
state may affect future tests. Also, many operations&#8201;—&#8201;such as inserting or modifying
persistent data&#8201;—&#8201;cannot be performed (or verified) outside a transaction.</p>
<p>The TestContext framework addresses this issue. By default, the framework will create
and roll back a transaction for each test. You simply write code that can assume the
existence of a transaction. If you call transactionally proxied objects in your tests,
they will behave correctly, according to their configured transactional semantics. In
addition, if a test method deletes the contents of selected tables while running within
the transaction managed for the test, the transaction will roll back by default, and the
database will return to its state prior to execution of the test. Transactional support
is provided to a test via a <code class="literal">PlatformTransactionManager</code> bean defined in the test’s
application context.</p>
<p>If you want a transaction to commit&#8201;—&#8201;unusual, but occasionally useful when you want a
particular test to populate or modify the database&#8201;—&#8201;the TestContext framework can be
instructed to cause the transaction to commit instead of roll back via the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="15.4 Annotations"><code class="literal">@Commit</code></a> annotation.</p>
<p>See transaction management with the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx" title="15.5.7 Transaction management">TestContext framework</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testing-support-classes" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-support-classes"></a>15.2.4&nbsp;Support classes for integration testing</h3></div></div></div>

<p>The Spring TestContext Framework provides several <code class="literal">abstract</code> support classes that
simplify the writing of integration tests. These base test classes provide well-defined
hooks into the testing framework as well as convenient instance variables and methods,
which enable you to access:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The <code class="literal">ApplicationContext</code>, for performing explicit bean lookups or testing the state of
the context as a whole.
</li><li class="listitem">
A <code class="literal">JdbcTemplate</code>, for executing SQL statements to query the database. Such queries can
be used to confirm database state both <span class="emphasis"><em>prior to</em></span> and <span class="emphasis"><em>after</em></span> execution of
database-related application code, and Spring ensures that such queries run in the
scope of the same transaction as the application code. When used in conjunction with
an ORM tool, be sure to avoid <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-false-positives" title="Avoid false positives when testing ORM code">false positives</a>.
</li></ul></div>
<p>In addition, you may want to create your own custom, application-wide superclass with
instance variables and methods specific to your project.</p>
<p>See support classes for the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes" title="15.5.9 TestContext Framework support classes">TestContext framework</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="integration-testing-support-jdbc" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-support-jdbc"></a>15.3&nbsp;JDBC Testing Support</h2></div></div></div>

<p>The <code class="literal">org.springframework.test.jdbc</code> package contains <code class="literal">JdbcTestUtils</code>, which is a
collection of JDBC related utility functions intended to simplify standard database
testing scenarios. Specifically, <code class="literal">JdbcTestUtils</code> provides the following static utility
methods.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">countRowsInTable(..)</code>: counts the number of rows in the given table
</li><li class="listitem">
<code class="literal">countRowsInTableWhere(..)</code>: counts the number of rows in the given table, using
the provided <code class="literal">WHERE</code> clause
</li><li class="listitem">
<code class="literal">deleteFromTables(..)</code>: deletes all rows from the specified tables
</li><li class="listitem">
<code class="literal">deleteFromTableWhere(..)</code>: deletes rows from the given table, using the provided
<code class="literal">WHERE</code> clause
</li><li class="listitem">
<code class="literal">dropTables(..)</code>: drops the specified tables
</li></ul></div>
<p><span class="emphasis"><em>Note that <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-junit4" title="JUnit 4 support classes"><code class="literal">AbstractTransactionalJUnit4SpringContextTests</code></a> and
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-testng" title="TestNG support classes"><code class="literal">AbstractTransactionalTestNGSpringContextTests</code></a>
provide convenience methods which delegate to the aforementioned methods in
<code class="literal">JdbcTestUtils</code>.</em></span></p>
<p>The <code class="literal">spring-jdbc</code> module provides support for configuring and launching an embedded
database which can be used in integration tests that interact with a database. For
details, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-support" title="19.8 Embedded database support">Section&nbsp;19.8, “Embedded database support”</a> and
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-dao-testing" title="19.8.5 Testing data access logic with an embedded database">Section&nbsp;19.8.5, “Testing data access logic with an embedded database”</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="integration-testing-annotations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations"></a>15.4&nbsp;Annotations</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="integration-testing-annotations-spring" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-spring"></a>15.4.1&nbsp;Spring Testing Annotations</h3></div></div></div>

<p>The Spring Framework provides the following set of <span class="emphasis"><em>Spring-specific</em></span> annotations that
you can use in your unit and integration tests in conjunction with the TestContext
framework. Refer to the corresponding javadocs for further information, including
default attribute values, attribute aliases, and so on.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__bootstrapwith" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__bootstrapwith"></a>@BootstrapWith</h4></div></div></div>

<p><code class="literal">@BootstrapWith</code> is a class-level annotation that is used to configure how the <span class="emphasis"><em>Spring
TestContext Framework</em></span> is bootstrapped. Specifically, <code class="literal">@BootstrapWith</code> is used to specify
a custom <code class="literal">TestContextBootstrapper</code>. Consult the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-bootstrapping" title="15.5.2 Bootstrapping the TestContext framework">Bootstrapping
the TestContext framework</a> section for further details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__contextconfiguration" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__contextconfiguration"></a>@ContextConfiguration</h4></div></div></div>

<p><code class="literal">@ContextConfiguration</code> defines class-level metadata that is used to determine how to
load and configure an <code class="literal">ApplicationContext</code> for integration tests. Specifically,
<code class="literal">@ContextConfiguration</code> declares the application context resource <code class="literal">locations</code> or the
annotated <code class="literal">classes</code> that will be used to load the context.</p>
<p>Resource locations are typically XML configuration files or Groovy scripts located in
the classpath; whereas, annotated classes are typically <code class="literal">@Configuration</code> classes. However,
resource locations can also refer to files and scripts in the file system, and annotated
classes can be component classes, etc.</p>
<pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>(<span class="hl-string">"/test-config.xml"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> XmlApplicationContextTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>(<span class="strong"><strong>classes</strong></span> = TestConfig.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConfigClassApplicationContextTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>As an alternative or in addition to declaring resource locations or annotated classes,
<code class="literal">@ContextConfiguration</code> may be used to declare <code class="literal">ApplicationContextInitializer</code> classes.</p>
<pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>(<span class="strong"><strong>initializers</strong></span> = CustomContextIntializer.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextInitializerTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p><code class="literal">@ContextConfiguration</code> may optionally be used to declare the <code class="literal">ContextLoader</code> strategy
as well. Note, however, that you typically do not need to explicitly configure the
loader since the default loader supports either resource <code class="literal">locations</code> or annotated
<code class="literal">classes</code> as well as <code class="literal">initializers</code>.</p>
<pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>(<span class="strong"><strong>locations</strong></span> = <span class="hl-string">"/test-context.xml"</span>, <span class="strong"><strong>loader</strong></span> = CustomContextLoader.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomLoaderXmlApplicationContextTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">@ContextConfiguration</code> provides support for <span class="emphasis"><em>inheriting</em></span> resource locations or
configuration classes as well as context initializers declared by superclasses by
default.</p>
</td></tr></tbody></table></div>
<p>See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management" title="15.5.4 Context management">Section&nbsp;15.5.4, “Context management”</a> and the <code class="literal">@ContextConfiguration</code> javadocs for
further details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__webappconfiguration" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__webappconfiguration"></a>@WebAppConfiguration</h4></div></div></div>

<p><code class="literal">@WebAppConfiguration</code> is a class-level annotation that is used to declare that the
<code class="literal">ApplicationContext</code> loaded for an integration test should be a <code class="literal">WebApplicationContext</code>.
The mere presence of <code class="literal">@WebAppConfiguration</code> on a test class ensures that a
<code class="literal">WebApplicationContext</code> will be loaded for the test, using the default value of
<code class="literal">"file:src/main/webapp"</code> for the path to the root of the web application (i.e., the
<span class="emphasis"><em>resource base path</em></span>). The resource base path is used behind the scenes to create a
<code class="literal">MockServletContext</code> which serves as the <code class="literal">ServletContext</code> for the test’s
<code class="literal">WebApplicationContext</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="strong"><strong>@WebAppConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebAppTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>To override the default, specify a different base resource path via the <span class="emphasis"><em>implicit</em></span>
<code class="literal">value</code> attribute. Both <code class="literal">classpath:</code> and <code class="literal">file:</code> resource prefixes are supported. If no
resource prefix is supplied the path is assumed to be a file system resource.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="strong"><strong>@WebAppConfiguration("classpath:test-web-resources")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebAppTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>Note that <code class="literal">@WebAppConfiguration</code> must be used in conjunction with
<code class="literal">@ContextConfiguration</code>, either within a single test class or within a test class
hierarchy. See the <code class="literal">@WebAppConfiguration</code> javadocs for further details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__contexthierarchy" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__contexthierarchy"></a>@ContextHierarchy</h4></div></div></div>

<p><code class="literal">@ContextHierarchy</code> is a class-level annotation that is used to define a hierarchy of
<code class="literal">ApplicationContext</code>s for integration tests. <code class="literal">@ContextHierarchy</code> should be declared
with a list of one or more <code class="literal">@ContextConfiguration</code> instances, each of which defines a
level in the context hierarchy. The following examples demonstrate the use of
<code class="literal">@ContextHierarchy</code> within a single test class; however, <code class="literal">@ContextHierarchy</code> can also be
used within a test class hierarchy.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextHierarchy({
    @ContextConfiguration("/parent-config.xml"),
    @ContextConfiguration("/child-config.xml")
})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextHierarchyTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextHierarchy({
    @ContextConfiguration(classes = AppConfig.class),
    @ContextConfiguration(classes = WebConfig.class)
})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>If you need to merge or override the configuration for a given level of the context
hierarchy within a test class hierarchy, you must explicitly name that level by
supplying the same value to the <code class="literal">name</code> attribute in <code class="literal">@ContextConfiguration</code> at each
corresponding level in the class hierarchy. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-ctx-hierarchies" title="Context hierarchies">the section called “Context hierarchies”</a> and the <code class="literal">@ContextHierarchy</code> javadocs
for further examples.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__activeprofiles" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__activeprofiles"></a>@ActiveProfiles</h4></div></div></div>

<p><code class="literal">@ActiveProfiles</code> is a class-level annotation that is used to declare which <span class="emphasis"><em>bean
definition profiles</em></span> should be active when loading an <code class="literal">ApplicationContext</code> for an
integration test.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="strong"><strong>@ActiveProfiles</strong></span>(<span class="hl-string">"dev"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DeveloperTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="strong"><strong>@ActiveProfiles</strong></span>({<span class="hl-string">"dev"</span>, <span class="hl-string">"integration"</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DeveloperIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">@ActiveProfiles</code> provides support for <span class="emphasis"><em>inheriting</em></span> active bean definition profiles
declared by superclasses by default. It is also possible to resolve active bean
definition profiles programmatically by implementing a custom
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-env-profiles-ActiveProfilesResolver"><code class="literal">ActiveProfilesResolver</code></a>
and registering it via the <code class="literal">resolver</code> attribute of <code class="literal">@ActiveProfiles</code>.</p>
</td></tr></tbody></table></div>
<p>See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-env-profiles" title="Context configuration with environment profiles">the section called “Context configuration with environment profiles”</a> and the <code class="literal">@ActiveProfiles</code> javadocs
for examples and further details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__testpropertysource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__testpropertysource"></a>@TestPropertySource</h4></div></div></div>

<p><code class="literal">@TestPropertySource</code> is a class-level annotation that is used to configure the locations
of properties files and inlined properties to be added to the set of <code class="literal">PropertySources</code> in
the <code class="literal">Environment</code> for an <code class="literal">ApplicationContext</code> loaded for an integration test.</p>
<p>Test property sources have higher precedence than those loaded from the operating
system’s environment or Java system properties as well as property sources added by the
application declaratively via <code class="literal">@PropertySource</code> or programmatically. Thus, test property
sources can be used to selectively override properties defined in system and application
property sources. Furthermore, inlined properties have higher precedence than properties
loaded from resource locations.</p>
<p>The following example demonstrates how to declare a properties file from the classpath.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="strong"><strong>@TestPropertySource</strong></span>(<span class="hl-string">"/test.properties"</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>The following example demonstrates how to declare <span class="emphasis"><em>inlined</em></span> properties.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="strong"><strong>@TestPropertySource</strong></span>(properties = { <span class="hl-string">"timezone = GMT"</span>, <span class="hl-string">"port: 4242"</span> })
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__dirtiescontext" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__dirtiescontext"></a>@DirtiesContext</h4></div></div></div>

<p><code class="literal">@DirtiesContext</code> indicates that the underlying Spring <code class="literal">ApplicationContext</code> has been
<span class="emphasis"><em>dirtied</em></span> during the execution of a test (i.e., modified or corrupted in some manner&#8201;—&#8201;for example, by changing the state of a singleton bean) and should be closed. When an
application context is marked <span class="emphasis"><em>dirty</em></span>, it is removed from the testing framework’s cache
and closed. As a consequence, the underlying Spring container will be rebuilt for any
subsequent test that requires a context with the same configuration metadata.</p>
<p><code class="literal">@DirtiesContext</code> can be used as both a class-level and method-level annotation within
the same class or class hierarchy. In such scenarios, the <code class="literal">ApplicationContext</code> is marked
as <span class="emphasis"><em>dirty</em></span> before or after any such annotated method as well as before or after the
current test class, depending on the configured <code class="literal">methodMode</code> and <code class="literal">classMode</code>.</p>
<p>The following examples explain when the context would be dirtied for various
configuration scenarios:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p class="simpara">Before the current test class, when declared on a class with class mode set to
<code class="literal">BEFORE_CLASS</code>.</p>
<pre class="programlisting"><span class="strong"><strong>@DirtiesContext(classMode = BEFORE_CLASS)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FreshContextTests {
    <span class="hl-comment">// some tests that require a new Spring container</span>
}</pre>
</li><li class="listitem">
<p class="simpara">After the current test class, when declared on a class with class mode set to
<code class="literal">AFTER_CLASS</code> (i.e., the default class mode).</p>
<pre class="programlisting"><span class="strong"><strong>@DirtiesContext</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextDirtyingTests {
    <span class="hl-comment">// some tests that result in the Spring container being dirtied</span>
}</pre>
</li><li class="listitem">
<p class="simpara">Before each test method in the current test class, when declared on a class with class
mode set to <code class="literal">BEFORE_EACH_TEST_METHOD.</code></p>
<pre class="programlisting"><span class="strong"><strong>@DirtiesContext(classMode = BEFORE_EACH_TEST_METHOD)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FreshContextTests {
    <span class="hl-comment">// some tests that require a new Spring container</span>
}</pre>
</li><li class="listitem">
<p class="simpara">After each test method in the current test class, when declared on a class with class
mode set to <code class="literal">AFTER_EACH_TEST_METHOD.</code></p>
<pre class="programlisting"><span class="strong"><strong>@DirtiesContext(classMode = AFTER_EACH_TEST_METHOD)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextDirtyingTests {
    <span class="hl-comment">// some tests that result in the Spring container being dirtied</span>
}</pre>
</li><li class="listitem">
<p class="simpara">Before the current test, when declared on a method with the method mode set to
<code class="literal">BEFORE_METHOD</code>.</p>
<pre class="programlisting"><span class="strong"><strong>@DirtiesContext(methodMode = BEFORE_METHOD)</strong></span>
<em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichRequiresFreshAppCtx() {
    <span class="hl-comment">// some logic that requires a new Spring container</span>
}</pre>
</li><li class="listitem">
<p class="simpara">After the current test, when declared on a method with the method mode set to
<code class="literal">AFTER_METHOD</code> (i.e., the default method mode).</p>
<pre class="programlisting"><span class="strong"><strong>@DirtiesContext</strong></span>
<em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichDirtiesAppCtx() {
    <span class="hl-comment">// some logic that results in the Spring container being dirtied</span>
}</pre>
</li></ul></div>
<p>If <code class="literal">@DirtiesContext</code> is used in a test whose context is configured as part of a context
hierarchy via <code class="literal">@ContextHierarchy</code>, the <code class="literal">hierarchyMode</code> flag can be used to control how
the context cache is cleared. By default an <span class="emphasis"><em>exhaustive</em></span> algorithm will be used that
clears the context cache including not only the current level but also all other context
hierarchies that share an ancestor context common to the current test; all
<code class="literal">ApplicationContext</code>s that reside in a sub-hierarchy of the common ancestor context
will be removed from the context cache and closed. If the <span class="emphasis"><em>exhaustive</em></span> algorithm is
overkill for a particular use case, the simpler <span class="emphasis"><em>current level</em></span> algorithm can be
specified instead, as seen below.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextHierarchy({
    @ContextConfiguration("/parent-config.xml"),
    @ContextConfiguration("/child-config.xml")
})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTests {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTests <span class="hl-keyword">extends</span> BaseTests {

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    @DirtiesContext(<span class="strong"><strong>hierarchyMode = CURRENT_LEVEL</strong></span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> test() {
        <span class="hl-comment">// some logic that results in the child context being dirtied</span>
    }
}</pre>
<p>For further details regarding the <code class="literal">EXHAUSTIVE</code> and <code class="literal">CURRENT_LEVEL</code> algorithms see the
<code class="literal">DirtiesContext.HierarchyMode</code> javadocs.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__testexecutionlisteners" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__testexecutionlisteners"></a>@TestExecutionListeners</h4></div></div></div>

<p><code class="literal">@TestExecutionListeners</code> defines class-level metadata for configuring the
<code class="literal">TestExecutionListener</code> implementations that should be registered with the
<code class="literal">TestContextManager</code>. Typically, <code class="literal">@TestExecutionListeners</code> is used in conjunction with
<code class="literal">@ContextConfiguration</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="strong"><strong>@TestExecutionListeners</strong></span>({CustomTestExecutionListener.<span class="hl-keyword">class</span>, AnotherTestExecutionListener.<span class="hl-keyword">class</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomTestExecutionListenerTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p><code class="literal">@TestExecutionListeners</code> supports <span class="emphasis"><em>inherited</em></span> listeners by default. See the javadocs
for an example and further details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__commit" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__commit"></a>@Commit</h4></div></div></div>

<p><code class="literal">@Commit</code> indicates that the transaction for a transactional test method should be
<span class="emphasis"><em>committed</em></span> after the test method has completed. <code class="literal">@Commit</code> can be used as a direct
replacement for <code class="literal">@Rollback(false)</code> in order to more explicitly convey the intent of the
code. Analogous to <code class="literal">@Rollback</code>, <code class="literal">@Commit</code> may also be declared as a class-level or
method-level annotation.</p>
<pre class="programlisting"><span class="strong"><strong>@Commit</strong></span>
<em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWithoutRollback() {
    <span class="hl-comment">// ...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__rollback" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__rollback"></a>@Rollback</h4></div></div></div>

<p><code class="literal">@Rollback</code> indicates whether the transaction for a transactional test method should be
<span class="emphasis"><em>rolled back</em></span> after the test method has completed. If <code class="literal">true</code>, the transaction is rolled
back; otherwise, the transaction is committed (see also <code class="literal">@Commit</code>). Rollback semantics
for integration tests in the Spring TestContext Framework default to <code class="literal">true</code> even if
<code class="literal">@Rollback</code> is not explicitly declared.</p>
<p>When declared as a class-level annotation, <code class="literal">@Rollback</code> defines the default rollback
semantics for all test methods within the test class hierarchy. When declared as a
method-level annotation, <code class="literal">@Rollback</code> defines rollback semantics for the specific test
method, potentially overriding class-level <code class="literal">@Rollback</code> or <code class="literal">@Commit</code> semantics.</p>
<pre class="programlisting"><span class="strong"><strong>@Rollback</strong></span>(false)
<em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWithoutRollback() {
    <span class="hl-comment">// ...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__beforetransaction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__beforetransaction"></a>@BeforeTransaction</h4></div></div></div>

<p><code class="literal">@BeforeTransaction</code> indicates that the annotated <code class="literal">void</code> method should be executed
<span class="emphasis"><em>before</em></span> a transaction is started for test methods configured to run within a
transaction via Spring’s <code class="literal">@Transactional</code> annotation. As of Spring Framework 4.3,
<code class="literal">@BeforeTransaction</code> methods are not required to be <code class="literal">public</code> and may be declared on Java
8 based interface default methods.</p>
<pre class="programlisting"><span class="strong"><strong>@BeforeTransaction</strong></span>
<span class="hl-keyword">void</span> beforeTransaction() {
    <span class="hl-comment">// logic to be executed before a transaction is started</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__aftertransaction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__aftertransaction"></a>@AfterTransaction</h4></div></div></div>

<p><code class="literal">@AfterTransaction</code> indicates that the annotated <code class="literal">void</code> method should be executed
<span class="emphasis"><em>after</em></span> a transaction is ended for test methods configured to run within a transaction
via Spring’s <code class="literal">@Transactional</code> annotation. As of Spring Framework 4.3, <code class="literal">@AfterTransaction</code>
methods are not required to be <code class="literal">public</code> and may be declared on Java 8 based interface
default methods.</p>
<pre class="programlisting"><span class="strong"><strong>@AfterTransaction</strong></span>
<span class="hl-keyword">void</span> afterTransaction() {
    <span class="hl-comment">// logic to be executed after a transaction has ended</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__sql" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__sql"></a>@Sql</h4></div></div></div>

<p><code class="literal">@Sql</code> is used to annotate a test class or test method to configure SQL scripts to be
executed against a given database during integration tests.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="strong"><strong>@Sql</strong></span>({<span class="hl-string">"/test-schema.sql"</span>, <span class="hl-string">"/test-user-data.sql"</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> userTest {
    <span class="hl-comment">// execute code that relies on the test schema and test data</span>
}</pre>
<p>See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql-declaratively" title="Executing SQL scripts declaratively with @Sql">the section called “Executing SQL scripts declaratively with @Sql”</a> for further details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__sqlconfig" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__sqlconfig"></a>@SqlConfig</h4></div></div></div>

<p><code class="literal">@SqlConfig</code> defines metadata that is used to determine how to parse and execute SQL
scripts configured via the <code class="literal">@Sql</code> annotation.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Test</span></em>
@Sql(
    scripts = <span class="hl-string">"/test-user-data.sql"</span>,
    config = <span class="strong"><strong>@SqlConfig</strong></span>(commentPrefix = <span class="hl-string">"`"</span>, separator = <span class="hl-string">"@@"</span>)
)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> userTest {
    <span class="hl-comment">// execute code that relies on the test data</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__sqlgroup" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__sqlgroup"></a>@SqlGroup</h4></div></div></div>

<p><code class="literal">@SqlGroup</code> is a container annotation that aggregates several <code class="literal">@Sql</code> annotations.
<code class="literal">@SqlGroup</code> can be used natively, declaring several nested <code class="literal">@Sql</code> annotations, or it can
be used in conjunction with Java 8’s support for repeatable annotations, where <code class="literal">@Sql</code> can
simply be declared several times on the same class or method, implicitly generating this
container annotation.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="strong"><strong>@SqlGroup</strong></span>({
    <em><span class="hl-annotation" style="color: gray">@Sql(scripts = "/test-schema.sql", config = @SqlConfig(commentPrefix = "`")),</span></em>
    <em><span class="hl-annotation" style="color: gray">@Sql("/test-user-data.sql")</span></em>
)}
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> userTest {
    <span class="hl-comment">// execute code that uses the test schema and test data</span>
}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="integration-testing-annotations-standard" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-standard"></a>15.4.2&nbsp;Standard Annotation Support</h3></div></div></div>

<p>The following annotations are supported with standard semantics for all configurations
of the Spring TestContext Framework. Note that these annotations are not specific to
tests and can be used anywhere in the Spring Framework.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">@Autowired</code>
</li><li class="listitem">
<code class="literal">@Qualifier</code>
</li><li class="listitem">
<code class="literal">@Resource</code> (javax.annotation) <span class="emphasis"><em>if JSR-250 is present</em></span>
</li><li class="listitem">
<code class="literal">@ManagedBean</code> (javax.annotation) <span class="emphasis"><em>if JSR-250 is present</em></span>
</li><li class="listitem">
<code class="literal">@Inject</code> (javax.inject) <span class="emphasis"><em>if JSR-330 is present</em></span>
</li><li class="listitem">
<code class="literal">@Named</code> (javax.inject) <span class="emphasis"><em>if JSR-330 is present</em></span>
</li><li class="listitem">
<code class="literal">@PersistenceContext</code> (javax.persistence) <span class="emphasis"><em>if JPA is present</em></span>
</li><li class="listitem">
<code class="literal">@PersistenceUnit</code> (javax.persistence) <span class="emphasis"><em>if JPA is present</em></span>
</li><li class="listitem">
<code class="literal">@Required</code>
</li><li class="listitem">
<code class="literal">@Transactional</code>
</li></ul></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: JSR-250 Lifecycle Annotations"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">JSR-250 Lifecycle Annotations</th></tr><tr><td align="left" valign="top">

<p>In the Spring TestContext Framework <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> may be used with
standard semantics on any application components configured in the <code class="literal">ApplicationContext</code>;
however, these lifecycle annotations have limited usage within an actual test class.</p>
<p>If a method within a test class is annotated with <code class="literal">@PostConstruct</code>, that method will be
executed before any <span class="emphasis"><em>before</em></span> methods of the underlying test framework (e.g., methods
annotated with JUnit 4’s <code class="literal">@Before</code>), and that will apply for every test method in the test
class. On the other hand, if a method within a test class is annotated with
<code class="literal">@PreDestroy</code>, that method will <span class="emphasis"><em>never</em></span> be executed. Within a test class it is
therefore recommended to use test lifecycle callbacks from the underlying test framework
instead of <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code>.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="integration-testing-annotations-junit" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-junit"></a>15.4.3&nbsp;Spring JUnit 4 Testing Annotations</h3></div></div></div>

<p>The following annotations are <span class="emphasis"><em>only</em></span> supported when used in conjunction with the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-junit4-runner" title="Spring JUnit 4 Runner">SpringRunner</a>, <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-junit4-rules" title="Spring JUnit 4 Rules">Spring’s JUnit
rules</a>, or <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-junit4" title="JUnit 4 support classes">Spring’s JUnit 4 support classes</a>.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__ifprofilevalue" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__ifprofilevalue"></a>@IfProfileValue</h4></div></div></div>

<p><code class="literal">@IfProfileValue</code> indicates that the annotated test is enabled for a specific testing
environment. If the configured <code class="literal">ProfileValueSource</code> returns a matching <code class="literal">value</code> for the
provided <code class="literal">name</code>, the test is enabled. Otherwise, the test will be disabled and
effectively <span class="emphasis"><em>ignored</em></span>.</p>
<p><code class="literal">@IfProfileValue</code> can be applied at the class level, the method level, or both.
Class-level usage of <code class="literal">@IfProfileValue</code> takes precedence over method-level usage for any
methods within that class or its subclasses. Specifically, a test is enabled if it is
enabled both at the class level <span class="emphasis"><em>and</em></span> at the method level; the absence of
<code class="literal">@IfProfileValue</code> means the test is implicitly enabled. This is analogous to the
semantics of JUnit 4’s <code class="literal">@Ignore</code> annotation, except that the presence of <code class="literal">@Ignore</code> always
disables a test.</p>
<pre class="programlisting"><span class="strong"><strong>@IfProfileValue</strong></span>(<span class="strong"><strong>name</strong></span>=<span class="hl-string">"java.vendor"</span>, <span class="strong"><strong>value</strong></span>=<span class="hl-string">"Oracle Corporation"</span>)
<em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichRunsOnlyOnOracleJvm() {
    <span class="hl-comment">// some logic that should run only on Java VMs from Oracle Corporation</span>
}</pre>
<p>Alternatively, you can configure <code class="literal">@IfProfileValue</code> with a list of <code class="literal">values</code> (with <span class="emphasis"><em>OR</em></span>
semantics) to achieve TestNG-like support for <span class="emphasis"><em>test groups</em></span> in a JUnit 4 environment.
Consider the following example:</p>
<pre class="programlisting"><span class="strong"><strong>@IfProfileValue</strong></span>(<span class="strong"><strong>name</strong></span>=<span class="hl-string">"test-groups"</span>, <span class="strong"><strong>values</strong></span>={<span class="hl-string">"unit-tests"</span>, <span class="hl-string">"integration-tests"</span>})
<em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichRunsForUnitOrIntegrationTestGroups() {
    <span class="hl-comment">// some logic that should run only for unit and integration test groups</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__profilevaluesourceconfiguration" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__profilevaluesourceconfiguration"></a>@ProfileValueSourceConfiguration</h4></div></div></div>

<p><code class="literal">@ProfileValueSourceConfiguration</code> is a class-level annotation that specifies what type
of <code class="literal">ProfileValueSource</code> to use when retrieving <span class="emphasis"><em>profile values</em></span> configured through the
<code class="literal">@IfProfileValue</code> annotation. If <code class="literal">@ProfileValueSourceConfiguration</code> is not declared for a
test, <code class="literal">SystemProfileValueSource</code> is used by default.</p>
<pre class="programlisting"><span class="strong"><strong>@ProfileValueSourceConfiguration</strong></span>(CustomProfileValueSource.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomProfileValueSourceTests {
    <span class="hl-comment">// class body...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__timed" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__timed"></a>@Timed</h4></div></div></div>

<p><code class="literal">@Timed</code> indicates that the annotated test method must finish execution in a specified
time period (in milliseconds). If the text execution time exceeds the specified time
period, the test fails.</p>
<p>The time period includes execution of the test method itself, any repetitions of the
test (see <code class="literal">@Repeat</code>), as well as any <span class="emphasis"><em>set up</em></span> or <span class="emphasis"><em>tear down</em></span> of the test fixture.</p>
<pre class="programlisting"><span class="strong"><strong>@Timed</strong></span>(millis=<span class="hl-number">1000</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWithOneSecondTimeout() {
    <span class="hl-comment">// some logic that should not take longer than 1 second to execute</span>
}</pre>
<p>Spring’s <code class="literal">@Timed</code> annotation has different semantics than JUnit 4’s <code class="literal">@Test(timeout=…&#8203;)</code>
support. Specifically, due to the manner in which JUnit 4 handles test execution timeouts
(that is, by executing the test method in a separate <code class="literal">Thread</code>), <code class="literal">@Test(timeout=…&#8203;)</code>
preemptively fails the test if the test takes too long. Spring’s <code class="literal">@Timed</code>, on the other
hand, does not preemptively fail the test but rather waits for the test to complete
before failing.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="__repeat" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#__repeat"></a>@Repeat</h4></div></div></div>

<p><code class="literal">@Repeat</code> indicates that the annotated test method must be executed repeatedly. The
number of times that the test method is to be executed is specified in the annotation.</p>
<p>The scope of execution to be repeated includes execution of the test method itself as
well as any <span class="emphasis"><em>set up</em></span> or <span class="emphasis"><em>tear down</em></span> of the test fixture.</p>
<pre class="programlisting"><span class="strong"><strong>@Repeat</strong></span>(<span class="hl-number">10</span>)
<em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessRepeatedly() {
    <span class="hl-comment">// ...</span>
}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="integration-testing-annotations-meta" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-meta"></a>15.4.4&nbsp;Meta-Annotation Support for Testing</h3></div></div></div>

<p>It is possible to use most test-related annotations as
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-meta-annotations" title="7.10.2 Meta-annotations">meta-annotations</a> in order to create custom <span class="emphasis"><em>composed
annotations</em></span> and reduce configuration duplication across a test suite.</p>
<p>Each of the following may be used as meta-annotations in conjunction with the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-framework" title="15.5 Spring TestContext Framework">TestContext framework</a>.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">@BootstrapWith</code>
</li><li class="listitem">
<code class="literal">@ContextConfiguration</code>
</li><li class="listitem">
<code class="literal">@ContextHierarchy</code>
</li><li class="listitem">
<code class="literal">@ActiveProfiles</code>
</li><li class="listitem">
<code class="literal">@TestPropertySource</code>
</li><li class="listitem">
<code class="literal">@DirtiesContext</code>
</li><li class="listitem">
<code class="literal">@WebAppConfiguration</code>
</li><li class="listitem">
<code class="literal">@TestExecutionListeners</code>
</li><li class="listitem">
<code class="literal">@Transactional</code>
</li><li class="listitem">
<code class="literal">@BeforeTransaction</code>
</li><li class="listitem">
<code class="literal">@AfterTransaction</code>
</li><li class="listitem">
<code class="literal">@Commit</code>
</li><li class="listitem">
<code class="literal">@Rollback</code>
</li><li class="listitem">
<code class="literal">@Sql</code>
</li><li class="listitem">
<code class="literal">@SqlConfig</code>
</li><li class="listitem">
<code class="literal">@SqlGroup</code>
</li><li class="listitem">
<code class="literal">@Repeat</code>
</li><li class="listitem">
<code class="literal">@Timed</code>
</li><li class="listitem">
<code class="literal">@IfProfileValue</code>
</li><li class="listitem">
<code class="literal">@ProfileValueSourceConfiguration</code>
</li></ul></div>
<p>For example, if we discover that we are repeating the following configuration
across our JUnit 4 based test suite…&#8203;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration({"/app-config.xml", "/test-data-access-config.xml"})</span></em>
<em><span class="hl-annotation" style="color: gray">@ActiveProfiles("dev")</span></em>
<em><span class="hl-annotation" style="color: gray">@Transactional</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OrderRepositoryTests { }

<em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration({"/app-config.xml", "/test-data-access-config.xml"})</span></em>
<em><span class="hl-annotation" style="color: gray">@ActiveProfiles("dev")</span></em>
<em><span class="hl-annotation" style="color: gray">@Transactional</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserRepositoryTests { }</pre>
<p>We can reduce the above duplication by introducing a custom <span class="emphasis"><em>composed annotation</em></span>
that centralizes the common test configuration like this:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target(ElementType.TYPE)</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration({"/app-config.xml", "/test-data-access-config.xml"})</span></em>
<em><span class="hl-annotation" style="color: gray">@ActiveProfiles("dev")</span></em>
<em><span class="hl-annotation" style="color: gray">@Transactional</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> TransactionalDevTest { }</pre>
<p>Then we can use our custom <code class="literal">@TransactionalDevTest</code> annotation to simplify the
configuration of individual test classes as follows:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@TransactionalDevTest</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OrderRepositoryTests { }

<em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@TransactionalDevTest</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserRepositoryTests { }</pre>
<p>For further details, consult the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#annotation-programming-model" title="38. Spring Annotation Programming Model">Spring Annotation Programming Model</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testcontext-framework" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-framework"></a>15.5&nbsp;Spring TestContext Framework</h2></div></div></div>

<p>The <span class="emphasis"><em>Spring TestContext Framework</em></span> (located in the
<code class="literal">org.springframework.test.context</code> package) provides generic, annotation-driven unit and
integration testing support that is agnostic of the testing framework in use. The
TestContext framework also places a great deal of importance on <span class="emphasis"><em>convention over
configuration</em></span> with reasonable defaults that can be overridden through annotation-based
configuration.</p>
<p>In addition to generic testing infrastructure, the TestContext framework provides
explicit support for JUnit 4 and TestNG in the form of <code class="literal">abstract</code> support classes. For
JUnit 4, Spring also provides a custom JUnit <code class="literal">Runner</code> and custom JUnit <code class="literal">Rules</code> that allow
one to write so-called <span class="emphasis"><em>POJO test classes</em></span>. POJO test classes are not required to
extend a particular class hierarchy.</p>
<p>The following section provides an overview of the internals of the TestContext
framework. If you are only interested in <span class="emphasis"><em>using</em></span> the framework and not necessarily
interested in <span class="emphasis"><em>extending</em></span> it with your own custom listeners or custom loaders, feel free
to go directly to the configuration (<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management" title="15.5.4 Context management">context management</a>,
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-fixture-di" title="15.5.5 Dependency injection of test fixtures">dependency injection</a>, <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx" title="15.5.7 Transaction management">transaction
management</a>), <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes" title="15.5.9 TestContext Framework support classes">support classes</a>, and
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="15.4 Annotations">annotation support</a> sections.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-key-abstractions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-key-abstractions"></a>15.5.1&nbsp;Key abstractions</h3></div></div></div>

<p>The core of the framework consists of the <code class="literal">TestContextManager</code> class and the
<code class="literal">TestContext</code>, <code class="literal">TestExecutionListener</code>, and <code class="literal">SmartContextLoader</code> interfaces. A
<code class="literal">TestContextManager</code> is created per test class (e.g., for the execution of all test
methods within a single test class in JUnit 4). The <code class="literal">TestContextManager</code> in turn manages a
<code class="literal">TestContext</code> that holds the context of the current test. The <code class="literal">TestContextManager</code> also
updates the state of the <code class="literal">TestContext</code> as the test progresses and delegates to
<code class="literal">TestExecutionListener</code> implementations, which instrument the actual test execution by
providing dependency injection, managing transactions, and so on. A <code class="literal">SmartContextLoader</code>
is responsible for loading an <code class="literal">ApplicationContext</code> for a given test class. Consult the
javadocs and the Spring test suite for further information and examples of various
implementations.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_testcontext" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testcontext"></a>TestContext</h4></div></div></div>

<p><code class="literal">TestContext</code> encapsulates the context in which a test is executed, agnostic of the
actual testing framework in use, and provides context management and caching support for
the test instance for which it is responsible. The <code class="literal">TestContext</code> also delegates to a
<code class="literal">SmartContextLoader</code> to load an <code class="literal">ApplicationContext</code> if requested.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_testcontextmanager" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testcontextmanager"></a>TestContextManager</h4></div></div></div>

<p><code class="literal">TestContextManager</code> is the main entry point into the <span class="emphasis"><em>Spring TestContext Framework</em></span>,
which manages a single <code class="literal">TestContext</code> and signals events to each registered
<code class="literal">TestExecutionListener</code> at well-defined test execution points:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
prior to any <span class="emphasis"><em>before class</em></span> or <span class="emphasis"><em>before all</em></span> methods of a particular testing framework
</li><li class="listitem">
test instance post-processing
</li><li class="listitem">
prior to any <span class="emphasis"><em>before</em></span> or <span class="emphasis"><em>before each</em></span> methods of a particular testing framework
</li><li class="listitem">
after any <span class="emphasis"><em>after</em></span> or <span class="emphasis"><em>after each</em></span> methods of a particular testing framework
</li><li class="listitem">
after any <span class="emphasis"><em>after class</em></span> or <span class="emphasis"><em>after all</em></span> methods of a particular testing framework
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_testexecutionlistener" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_testexecutionlistener"></a>TestExecutionListener</h4></div></div></div>

<p><code class="literal">TestExecutionListener</code> defines the API for reacting to test execution events published
by the <code class="literal">TestContextManager</code> with which the listener is registered. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config" title="15.5.3 TestExecutionListener configuration">Section&nbsp;15.5.3, “TestExecutionListener configuration”</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_context_loaders" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#_context_loaders"></a>Context Loaders</h4></div></div></div>

<p><code class="literal">ContextLoader</code> is a strategy interface that was introduced in Spring 2.5 for loading an
<code class="literal">ApplicationContext</code> for an integration test managed by the Spring TestContext Framework.
Implement <code class="literal">SmartContextLoader</code> instead of this interface in order to provide support for
annotated classes, active bean definition profiles, test property sources, context
hierarchies, and <code class="literal">WebApplicationContext</code> support.</p>
<p><code class="literal">SmartContextLoader</code> is an extension of the <code class="literal">ContextLoader</code> interface introduced in
Spring 3.1. The <code class="literal">SmartContextLoader</code> SPI supersedes the <code class="literal">ContextLoader</code> SPI that was
introduced in Spring 2.5. Specifically, a <code class="literal">SmartContextLoader</code> can choose to process
resource <code class="literal">locations</code>, annotated <code class="literal">classes</code>, or context <code class="literal">initializers</code>. Furthermore, a
<code class="literal">SmartContextLoader</code> can set active bean definition profiles and test property sources in
the context that it loads.</p>
<p>Spring provides the following implementations:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">DelegatingSmartContextLoader</code>: one of two default loaders which delegates internally
to an <code class="literal">AnnotationConfigContextLoader</code>, a <code class="literal">GenericXmlContextLoader</code>, or a
<code class="literal">GenericGroovyXmlContextLoader</code> depending either on the configuration declared for the
test class or on the presence of default locations or default configuration classes.
Groovy support is only enabled if Groovy is on the classpath.
</li><li class="listitem">
<code class="literal">WebDelegatingSmartContextLoader</code>: one of two default loaders which delegates
internally to an <code class="literal">AnnotationConfigWebContextLoader</code>, a <code class="literal">GenericXmlWebContextLoader</code>, or a
<code class="literal">GenericGroovyXmlWebContextLoader</code> depending either on the configuration declared for the
test class or on the presence of default locations or default configuration classes. A
web <code class="literal">ContextLoader</code> will only be used if <code class="literal">@WebAppConfiguration</code> is present on the test
class. Groovy support is only enabled if Groovy is on the classpath.
</li><li class="listitem">
<code class="literal">AnnotationConfigContextLoader</code>: loads a standard <code class="literal">ApplicationContext</code> from
<span class="emphasis"><em>annotated classes</em></span>.
</li><li class="listitem">
<code class="literal">AnnotationConfigWebContextLoader</code>: loads a <code class="literal">WebApplicationContext</code> from <span class="emphasis"><em>annotated
classes</em></span>.
</li><li class="listitem">
<code class="literal">GenericGroovyXmlContextLoader</code>: loads a standard <code class="literal">ApplicationContext</code> from <span class="emphasis"><em>resource
locations</em></span> that are either Groovy scripts or XML configuration files.
</li><li class="listitem">
<code class="literal">GenericGroovyXmlWebContextLoader</code>: loads a <code class="literal">WebApplicationContext</code> from <span class="emphasis"><em>resource
locations</em></span> that are either Groovy scripts or XML configuration files.
</li><li class="listitem">
<code class="literal">GenericXmlContextLoader</code>: loads a standard <code class="literal">ApplicationContext</code> from XML <span class="emphasis"><em>resource
locations</em></span>.
</li><li class="listitem">
<code class="literal">GenericXmlWebContextLoader</code>: loads a <code class="literal">WebApplicationContext</code> from XML <span class="emphasis"><em>resource
locations</em></span>.
</li><li class="listitem">
<code class="literal">GenericPropertiesContextLoader</code>: loads a standard <code class="literal">ApplicationContext</code> from Java
Properties files.
</li></ul></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-bootstrapping" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-bootstrapping"></a>15.5.2&nbsp;Bootstrapping the TestContext framework</h3></div></div></div>

<p>The default configuration for the internals of the Spring TestContext Framework is
sufficient for all common use cases. However, there are times when a development team or
third party framework would like to change the default <code class="literal">ContextLoader</code>, implement a
custom <code class="literal">TestContext</code> or <code class="literal">ContextCache</code>, augment the default sets of
<code class="literal">ContextCustomizerFactory</code> and <code class="literal">TestExecutionListener</code> implementations, etc. For such low
level control over how the TestContext framework operates, Spring provides a
bootstrapping strategy.</p>
<p><code class="literal">TestContextBootstrapper</code> defines the SPI for <span class="emphasis"><em>bootstrapping</em></span> the TestContext framework.
A <code class="literal">TestContextBootstrapper</code> is used by the <code class="literal">TestContextManager</code> to load the
<code class="literal">TestExecutionListener</code> implementations for the current test and to build the
<code class="literal">TestContext</code> that it manages. A custom bootstrapping strategy can be configured for a
test class (or test class hierarchy) via <code class="literal">@BootstrapWith</code>, either directly or as a
meta-annotation. If a bootstrapper is not explicitly configured via <code class="literal">@BootstrapWith</code>,
either the <code class="literal">DefaultTestContextBootstrapper</code> or the <code class="literal">WebTestContextBootstrapper</code> will be
used, depending on the presence of <code class="literal">@WebAppConfiguration</code>.</p>
<p>Since the <code class="literal">TestContextBootstrapper</code> SPI is likely to change in the future in order to
accommodate new requirements, implementers are strongly encouraged not to implement this
interface directly but rather to extend <code class="literal">AbstractTestContextBootstrapper</code> or one of its
concrete subclasses instead.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-tel-config" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config"></a>15.5.3&nbsp;TestExecutionListener configuration</h3></div></div></div>

<p>Spring provides the following <code class="literal">TestExecutionListener</code> implementations that are registered
by default, exactly in this order.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">ServletTestExecutionListener</code>: configures Servlet API mocks for a
<code class="literal">WebApplicationContext</code>
</li><li class="listitem">
<code class="literal">DirtiesContextBeforeModesTestExecutionListener</code>: handles the <code class="literal">@DirtiesContext</code> annotation for
<span class="emphasis"><em>before</em></span> modes
</li><li class="listitem">
<code class="literal">DependencyInjectionTestExecutionListener</code>: provides dependency injection for the test
instance
</li><li class="listitem">
<code class="literal">DirtiesContextTestExecutionListener</code>: handles the <code class="literal">@DirtiesContext</code> annotation for
<span class="emphasis"><em>after</em></span> modes
</li><li class="listitem">
<code class="literal">TransactionalTestExecutionListener</code>: provides transactional test execution with
default rollback semantics
</li><li class="listitem">
<code class="literal">SqlScriptsTestExecutionListener</code>: executes SQL scripts configured via the <code class="literal">@Sql</code>
annotation
</li></ul></div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tel-config-registering-tels" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-registering-tels"></a>Registering custom TestExecutionListeners</h4></div></div></div>

<p>Custom <code class="literal">TestExecutionListener</code>s can be registered for a test class and its subclasses
via the <code class="literal">@TestExecutionListeners</code> annotation. See
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="15.4 Annotations">annotation support</a> and the javadocs for
<code class="literal">@TestExecutionListeners</code> for details and examples.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tel-config-automatic-discovery" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-automatic-discovery"></a>Automatic discovery of default TestExecutionListeners</h4></div></div></div>

<p>Registering custom <code class="literal">TestExecutionListener</code>s via <code class="literal">@TestExecutionListeners</code> is suitable
for custom listeners that are used in limited testing scenarios; however, it can become
cumbersome if a custom listener needs to be used across a test suite. Since Spring
Framework 4.1, this issue is addressed via support for automatic discovery of <span class="emphasis"><em>default</em></span>
<code class="literal">TestExecutionListener</code> implementations via the <code class="literal">SpringFactoriesLoader</code> mechanism.</p>
<p>Specifically, the <code class="literal">spring-test</code> module declares all core default
<code class="literal">TestExecutionListener</code>s under the
<code class="literal">org.springframework.test.context.TestExecutionListener</code> key in its
<code class="literal">META-INF/spring.factories</code> properties file. Third-party frameworks and developers can
contribute their own <code class="literal">TestExecutionListener</code>s to the list of default listeners in the
same manner via their own <code class="literal">META-INF/spring.factories</code> properties file.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tel-config-ordering" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-ordering"></a>Ordering TestExecutionListeners</h4></div></div></div>

<p>When the TestContext framework discovers default <code class="literal">TestExecutionListener</code>s via the
aforementioned <code class="literal">SpringFactoriesLoader</code> mechanism, the instantiated listeners are sorted
using Spring’s <code class="literal">AnnotationAwareOrderComparator</code> which honors Spring’s <code class="literal">Ordered</code> interface
and <code class="literal">@Order</code> annotation for ordering. <code class="literal">AbstractTestExecutionListener</code> and all default
<code class="literal">TestExecutionListener</code>s provided by Spring implement <code class="literal">Ordered</code> with appropriate
values. Third-party frameworks and developers should therefore make sure that their
<span class="emphasis"><em>default</em></span> <code class="literal">TestExecutionListener</code>s are registered in the proper order by implementing
<code class="literal">Ordered</code> or declaring <code class="literal">@Order</code>. Consult the javadocs for the <code class="literal">getOrder()</code> methods of the
core default <code class="literal">TestExecutionListener</code>s for details on what values are assigned to each
core listener.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tel-config-merging" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-merging"></a>Merging TestExecutionListeners</h4></div></div></div>

<p>If a custom <code class="literal">TestExecutionListener</code> is registered via <code class="literal">@TestExecutionListeners</code>, the
<span class="emphasis"><em>default</em></span> listeners will not be registered. In most common testing scenarios, this
effectively forces the developer to manually declare all default listeners in addition to
any custom listeners. The following listing demonstrates this style of configuration.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@TestExecutionListeners({
    MyCustomTestExecutionListener.class,
    ServletTestExecutionListener.class,
    DirtiesContextBeforeModesTestExecutionListener.class,
    DependencyInjectionTestExecutionListener.class,
    DirtiesContextTestExecutionListener.class,
    TransactionalTestExecutionListener.class,
    SqlScriptsTestExecutionListener.class
})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>The challenge with this approach is that it requires that the developer know exactly
which listeners are registered by default. Moreover, the set of default listeners can
change from release to release&#8201;—&#8201;for example, <code class="literal">SqlScriptsTestExecutionListener</code> was
introduced in Spring Framework 4.1, and <code class="literal">DirtiesContextBeforeModesTestExecutionListener</code>
was introduced in Spring Framework 4.2. Furthermore, third-party frameworks like Spring
Security register their own default <code class="literal">TestExecutionListener</code>s via the aforementioned
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-automatic-discovery" title="Automatic discovery of default TestExecutionListeners">automatic discovery mechanism</a>.</p>
<p>To avoid having to be aware of and re-declare <span class="strong"><strong>all</strong></span> <span class="emphasis"><em>default</em></span> listeners, the
<code class="literal">mergeMode</code> attribute of <code class="literal">@TestExecutionListeners</code> can be set to
<code class="literal">MergeMode.MERGE_WITH_DEFAULTS</code>. <code class="literal">MERGE_WITH_DEFAULTS</code> indicates that locally declared
listeners should be merged with the default listeners. The merging algorithm ensures that
duplicates are removed from the list and that the resulting set of merged listeners is
sorted according to the semantics of <code class="literal">AnnotationAwareOrderComparator</code> as described in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tel-config-ordering" title="Ordering TestExecutionListeners">the section called “Ordering TestExecutionListeners”</a>. If a listener implements <code class="literal">Ordered</code> or is annotated
with <code class="literal">@Order</code> it can influence the position in which it is merged with the defaults;
otherwise, locally declared listeners will simply be appended to the list of default
listeners when merged.</p>
<p>For example, if the <code class="literal">MyCustomTestExecutionListener</code> class in the previous example
configures its <code class="literal">order</code> value (for example, <code class="literal">500</code>) to be less than the order of the
<code class="literal">ServletTestExecutionListener</code> (which happens to be <code class="literal">1000</code>), the
<code class="literal">MyCustomTestExecutionListener</code> can then be automatically merged with the list of
defaults <span class="emphasis"><em>in front of</em></span> the <code class="literal">ServletTestExecutionListener</code>, and the previous example could
be replaced with the following.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@TestExecutionListeners(
    listeners = MyCustomTestExecutionListener.class,
    mergeMode = MERGE_WITH_DEFAULTS
)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-ctx-management" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management"></a>15.5.4&nbsp;Context management</h3></div></div></div>

<p>Each <code class="literal">TestContext</code> provides context management and caching support for the test instance
it is responsible for. Test instances do not automatically receive access to the
configured <code class="literal">ApplicationContext</code>. However, if a test class implements the
<code class="literal">ApplicationContextAware</code> interface, a reference to the <code class="literal">ApplicationContext</code> is supplied
to the test instance. Note that <code class="literal">AbstractJUnit4SpringContextTests</code> and
<code class="literal">AbstractTestNGSpringContextTests</code> implement <code class="literal">ApplicationContextAware</code> and therefore
provide access to the <code class="literal">ApplicationContext</code> automatically.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: @Autowired ApplicationContext"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">@Autowired ApplicationContext</th></tr><tr><td align="left" valign="top">

<p>As an alternative to implementing the <code class="literal">ApplicationContextAware</code> interface, you can
inject the application context for your test class through the <code class="literal">@Autowired</code> annotation
on either a field or setter method. For example:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {

    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">private</span> ApplicationContext applicationContext;

    <span class="hl-comment">// class body...</span>
}</pre>
<p>Similarly, if your test is configured to load a <code class="literal">WebApplicationContext</code>, you can inject
the web application context into your test as follows:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="strong"><strong>@WebAppConfiguration</strong></span>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebAppTest {
    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-comment">// class body...</span>
}</pre>
<p>Dependency injection via <code class="literal">@Autowired</code> is provided by the
<code class="literal">DependencyInjectionTestExecutionListener</code> which is configured by default (see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-fixture-di" title="15.5.5 Dependency injection of test fixtures">Section&nbsp;15.5.5, “Dependency injection of test fixtures”</a>).</p>
</td></tr></tbody></table></div>
<p>Test classes that use the TestContext framework do not need to extend any particular
class or implement a specific interface to configure their application context. Instead,
configuration is achieved simply by declaring the <code class="literal">@ContextConfiguration</code> annotation at
the class level. If your test class does not explicitly declare application context
resource <code class="literal">locations</code> or annotated <code class="literal">classes</code>, the configured <code class="literal">ContextLoader</code> determines
how to load a context from a default location or default configuration classes. In
addition to context resource <code class="literal">locations</code> and annotated <code class="literal">classes</code>, an application context
can also be configured via application context <code class="literal">initializers</code>.</p>
<p>The following sections explain how to configure an <code class="literal">ApplicationContext</code> via XML
configuration files, Groovy scripts, annotated classes (typically <code class="literal">@Configuration</code>
classes), or context initializers using Spring’s <code class="literal">@ContextConfiguration</code> annotation.
Alternatively, you can implement and configure your own custom <code class="literal">SmartContextLoader</code> for
advanced use cases.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-xml" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-xml"></a>Context configuration with XML resources</h4></div></div></div>

<p>To load an <code class="literal">ApplicationContext</code> for your tests using XML configuration files, annotate
your test class with <code class="literal">@ContextConfiguration</code> and configure the <code class="literal">locations</code> attribute with
an array that contains the resource locations of XML configuration metadata. A plain or
relative path&#8201;—&#8201;for example <code class="literal">"context.xml"</code>&#8201;—&#8201;will be treated as a classpath resource
that is relative to the package in which the test class is defined. A path starting with
a slash is treated as an absolute classpath location, for example
<code class="literal">"/org/example/config.xml"</code>. A path which represents a resource URL (i.e., a path
prefixed with <code class="literal">classpath:</code>, <code class="literal">file:</code>, <code class="literal">http:</code>, etc.) will be used <span class="emphasis"><em>as is</em></span>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from "/app-config.xml" and</span>
<span class="hl-comment">// "/test-config.xml" in the root of the classpath</span>
<span class="strong"><strong>@ContextConfiguration(locations={"/app-config.xml", "/test-config.xml"})</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
<p><code class="literal">@ContextConfiguration</code> supports an alias for the <code class="literal">locations</code> attribute through the
standard Java <code class="literal">value</code> attribute. Thus, if you do not need to declare additional
attributes in <code class="literal">@ContextConfiguration</code>, you can omit the declaration of the <code class="literal">locations</code>
attribute name and declare the resource locations by using the shorthand format
demonstrated in the following example.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="strong"><strong>@ContextConfiguration({"/app-config.xml", "/test-config.xml"})</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>If you omit both the <code class="literal">locations</code> and <code class="literal">value</code> attributes from the <code class="literal">@ContextConfiguration</code>
annotation, the TestContext framework will attempt to detect a default XML resource
location. Specifically, <code class="literal">GenericXmlContextLoader</code> and <code class="literal">GenericXmlWebContextLoader</code> detect
a default location based on the name of the test class. If your class is named
<code class="literal">com.example.MyTest</code>, <code class="literal">GenericXmlContextLoader</code> loads your application context from
<code class="literal">"classpath:com/example/MyTest-context.xml"</code>.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> com.example;

<em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from</span>
<span class="hl-comment">// "classpath:com/example/MyTest-context.xml"</span>
<span class="strong"><strong>@ContextConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-groovy" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-groovy"></a>Context configuration with Groovy scripts</h4></div></div></div>

<p>To load an <code class="literal">ApplicationContext</code> for your tests using Groovy scripts that utilize the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#groovy-bean-definition-dsl" title="The Groovy Bean Definition DSL">Groovy Bean Definition DSL</a>, annotate your test class with
<code class="literal">@ContextConfiguration</code> and configure the <code class="literal">locations</code> or <code class="literal">value</code> attribute with an array
that contains the resource locations of Groovy scripts. Resource lookup semantics for
Groovy scripts are the same as those described for <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-xml" title="Context configuration with XML resources">XML
configuration files</a>.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Enabling Groovy script support"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Enabling Groovy script support</th></tr><tr><td align="left" valign="top">

<p>Support for using Groovy scripts to load an <code class="literal">ApplicationContext</code> in the Spring
TestContext Framework is enabled automatically if Groovy is on the classpath.</p>
</td></tr></tbody></table></div>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from "/AppConfig.groovy" and</span>
<span class="hl-comment">// "/TestConfig.groovy" in the root of the classpath</span>
<span class="strong"><strong>@ContextConfiguration({"/AppConfig.groovy", "/TestConfig.Groovy"})</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>If you omit both the <code class="literal">locations</code> and <code class="literal">value</code> attributes from the <code class="literal">@ContextConfiguration</code>
annotation, the TestContext framework will attempt to detect a default Groovy script.
Specifically, <code class="literal">GenericGroovyXmlContextLoader</code> and <code class="literal">GenericGroovyXmlWebContextLoader</code>
detect a default location based on the name of the test class. If your class is named
<code class="literal">com.example.MyTest</code>, the Groovy context loader will load your application context from
<code class="literal">"classpath:com/example/MyTestContext.groovy"</code>.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> com.example;

<em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from</span>
<span class="hl-comment">// "classpath:com/example/MyTestContext.groovy"</span>
<span class="strong"><strong>@ContextConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Declaring XML config and Groovy scripts simultaneously"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Declaring XML config and Groovy scripts simultaneously</th></tr><tr><td align="left" valign="top">

<p>Both XML configuration files and Groovy scripts can be declared simultaneously via the
<code class="literal">locations</code> or <code class="literal">value</code> attribute of <code class="literal">@ContextConfiguration</code>. If the path to a configured
resource location ends with <code class="literal">.xml</code> it will be loaded using an <code class="literal">XmlBeanDefinitionReader</code>;
otherwise it will be loaded using a <code class="literal">GroovyBeanDefinitionReader</code>.</p>
<p>The following listing demonstrates how to combine both in an integration test.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from</span>
<span class="hl-comment">// "/app-config.xml" and "/TestConfig.groovy"</span>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration({ "/app-config.xml", "/TestConfig.groovy" })</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-javaconfig" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-javaconfig"></a>Context configuration with annotated classes</h4></div></div></div>

<p>To load an <code class="literal">ApplicationContext</code> for your tests using <span class="emphasis"><em>annotated classes</em></span> (see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-java" title="7.12 Java-based container configuration">Section&nbsp;7.12, “Java-based container configuration”</a>), annotate your test class with <code class="literal">@ContextConfiguration</code> and configure the
<code class="literal">classes</code> attribute with an array that contains references to annotated classes.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from AppConfig and TestConfig</span>
<span class="strong"><strong>@ContextConfiguration(classes = {AppConfig.class, TestConfig.class})</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip: Annotated Classes"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Annotated Classes</th></tr><tr><td align="left" valign="top">

<p>The term <span class="emphasis"><em>annotated class</em></span> can refer to any of the following.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A class annotated with <code class="literal">@Configuration</code>
</li><li class="listitem">
A component (i.e., a class annotated with <code class="literal">@Component</code>, <code class="literal">@Service</code>, <code class="literal">@Repository</code>, etc.)
</li><li class="listitem">
A JSR-330 compliant class that is annotated with <code class="literal">javax.inject</code> annotations
</li><li class="listitem">
Any other class that contains <code class="literal">@Bean</code>-methods
</li></ul></div>
<p>Consult the javadocs of <code class="literal">@Configuration</code> and <code class="literal">@Bean</code> for further information regarding
the configuration and semantics of <span class="emphasis"><em>annotated classes</em></span>, paying special attention to
the discussion of <span class="emphasis"><em>`@Bean` Lite Mode</em></span>.</p>
</td></tr></tbody></table></div>
<p>If you omit the <code class="literal">classes</code> attribute from the <code class="literal">@ContextConfiguration</code> annotation, the
TestContext framework will attempt to detect the presence of default configuration
classes. Specifically, <code class="literal">AnnotationConfigContextLoader</code> and
<code class="literal">AnnotationConfigWebContextLoader</code> will detect all <code class="literal">static</code> nested classes of the test class
that meet the requirements for configuration class implementations as specified in the
<code class="literal">@Configuration</code> javadocs. In the following example, the <code class="literal">OrderServiceTest</code> class
declares a <code class="literal">static</code> nested configuration class named <code class="literal">Config</code> that will be automatically
used to load the <code class="literal">ApplicationContext</code> for the test class. Note that the name of the
configuration class is arbitrary. In addition, a test class can contain more than one
<code class="literal">static</code> nested configuration class if desired.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from the</span>
<span class="hl-comment">// static nested Config class</span>
<span class="strong"><strong>@ContextConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OrderServiceTest {

    <em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
    <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> Config {

        <span class="hl-comment">// this bean will be injected into the OrderServiceTest class</span>
        <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
        <span class="hl-keyword">public</span> OrderService orderService() {
            OrderService orderService = <span class="hl-keyword">new</span> OrderServiceImpl();
            <span class="hl-comment">// set properties, etc.</span>
            <span class="hl-keyword">return</span> orderService;
        }
    }

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> OrderService orderService;

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testOrderService() {
        <span class="hl-comment">// test the orderService</span>
    }

}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-mixed-config" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-mixed-config"></a>Mixing XML, Groovy scripts, and annotated classes</h4></div></div></div>

<p>It may sometimes be desirable to mix XML configuration files, Groovy scripts, and
annotated classes (i.e., typically <code class="literal">@Configuration</code> classes) to configure an
<code class="literal">ApplicationContext</code> for your tests. For example, if you use XML configuration in
production, you may decide that you want to use <code class="literal">@Configuration</code> classes to configure
specific Spring-managed components for your tests, or vice versa.</p>
<p>Furthermore, some third-party frameworks (like Spring Boot) provide first-class support
for loading an <code class="literal">ApplicationContext</code> from different types of resources simultaneously
(e.g., XML configuration files, Groovy scripts, and <code class="literal">@Configuration</code> classes). The Spring
Framework historically has not supported this for standard deployments. Consequently,
most of the <code class="literal">SmartContextLoader</code> implementations that the Spring Framework delivers in
the <code class="literal">spring-test</code> module support only one resource type per test context; however, this
does not mean that you cannot use both. One exception to the general rule is that the
<code class="literal">GenericGroovyXmlContextLoader</code> and <code class="literal">GenericGroovyXmlWebContextLoader</code> support both XML
configuration files and Groovy scripts simultaneously. Furthermore, third-party
frameworks may choose to support the declaration of both <code class="literal">locations</code> and <code class="literal">classes</code> via
<code class="literal">@ContextConfiguration</code>, and with the standard testing support in the TestContext
framework, you have the following options.</p>
<p>If you want to use resource locations (e.g., XML or Groovy) <span class="emphasis"><em>and</em></span> <code class="literal">@Configuration</code>
classes to configure your tests, you will have to pick one as the <span class="emphasis"><em>entry point</em></span>, and
that one will have to include or import the other. For example, in XML or Groovy scripts
you can include <code class="literal">@Configuration</code> classes via component scanning or define them as normal
Spring beans; whereas, in a <code class="literal">@Configuration</code> class you can use <code class="literal">@ImportResource</code> to
import XML configuration files or Groovy scripts. Note that this behavior is semantically
equivalent to how you configure your application in production: in production
configuration you will define either a set of XML or Groovy resource locations or a set
of <code class="literal">@Configuration</code> classes that your production <code class="literal">ApplicationContext</code> will be loaded
from, but you still have the freedom to include or import the other type of configuration.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-initializers" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-initializers"></a>Context configuration with context initializers</h4></div></div></div>

<p>To configure an <code class="literal">ApplicationContext</code> for your tests using context initializers, annotate
your test class with <code class="literal">@ContextConfiguration</code> and configure the <code class="literal">initializers</code> attribute
with an array that contains references to classes that implement
<code class="literal">ApplicationContextInitializer</code>. The declared context initializers will then be used to
initialize the <code class="literal">ConfigurableApplicationContext</code> that is loaded for your tests. Note that
the concrete <code class="literal">ConfigurableApplicationContext</code> type supported by each declared
initializer must be compatible with the type of <code class="literal">ApplicationContext</code> created by the
<code class="literal">SmartContextLoader</code> in use (i.e., typically a <code class="literal">GenericApplicationContext</code>).
Furthermore, the order in which the initializers are invoked depends on whether they
implement Spring’s <code class="literal">Ordered</code> interface or are annotated with Spring’s <code class="literal">@Order</code> annotation
or the standard <code class="literal">@Priority</code> annotation.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from TestConfig</span>
<span class="hl-comment">// and initialized by TestAppCtxInitializer</span>
<span class="strong"><strong>@ContextConfiguration(
    classes = TestConfig.class,
    initializers = TestAppCtxInitializer.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>It is also possible to omit the declaration of XML configuration files, Groovy scripts,
or annotated classes in <code class="literal">@ContextConfiguration</code> entirely and instead declare only
<code class="literal">ApplicationContextInitializer</code> classes which are then responsible for registering beans
in the context&#8201;—&#8201;for example, by programmatically loading bean definitions from XML
files or configuration classes.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be initialized by EntireAppInitializer</span>
<span class="hl-comment">// which presumably registers beans in the context</span>
<span class="strong"><strong>@ContextConfiguration(initializers = EntireAppInitializer.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-inheritance" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-inheritance"></a>Context configuration inheritance</h4></div></div></div>

<p><code class="literal">@ContextConfiguration</code> supports boolean <code class="literal">inheritLocations</code> and <code class="literal">inheritInitializers</code>
attributes that denote whether resource locations or annotated classes and context
initializers declared by superclasses should be <span class="emphasis"><em>inherited</em></span>. The default value for
both flags is <code class="literal">true</code>. This means that a test class inherits the resource locations or
annotated classes as well as the context initializers declared by any superclasses.
Specifically, the resource locations or annotated classes for a test class are appended
to the list of resource locations or annotated classes declared by superclasses.
Similarly, the initializers for a given test class will be added to the set of
initializers defined by test superclasses. Thus, subclasses have the option
of <span class="emphasis"><em>extending</em></span> the resource locations, annotated classes, or context initializers.</p>
<p>If the <code class="literal">inheritLocations</code> or <code class="literal">inheritInitializers</code> attribute in <code class="literal">@ContextConfiguration</code>
is set to <code class="literal">false</code>, the resource locations or annotated classes and the context
initializers, respectively, for the test class <span class="emphasis"><em>shadow</em></span> and effectively replace the
configuration defined by superclasses.</p>
<p>In the following example that uses XML resource locations, the <code class="literal">ApplicationContext</code> for
<code class="literal">ExtendedTest</code> will be loaded from <span class="emphasis"><em>"base-config.xml"</em></span> <span class="emphasis"><em>and</em></span>
<span class="emphasis"><em>"extended-config.xml"</em></span>, in that order. Beans defined in <span class="emphasis"><em>"extended-config.xml"</em></span> may
therefore <span class="emphasis"><em>override</em></span> (i.e., replace) those defined in <span class="emphasis"><em>"base-config.xml"</em></span>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from "/base-config.xml"</span>
<span class="hl-comment">// in the root of the classpath</span>
<span class="strong"><strong>@ContextConfiguration("/base-config.xml")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-comment">// ApplicationContext will be loaded from "/base-config.xml" and</span>
<span class="hl-comment">// "/extended-config.xml" in the root of the classpath</span>
<span class="strong"><strong>@ContextConfiguration("/extended-config.xml")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>Similarly, in the following example that uses annotated classes, the
<code class="literal">ApplicationContext</code> for <code class="literal">ExtendedTest</code> will be loaded from the <code class="literal">BaseConfig</code> <span class="emphasis"><em>and</em></span>
<code class="literal">ExtendedConfig</code> classes, in that order. Beans defined in <code class="literal">ExtendedConfig</code> may therefore
override (i.e., replace) those defined in <code class="literal">BaseConfig</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from BaseConfig</span>
<span class="strong"><strong>@ContextConfiguration(classes = BaseConfig.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-comment">// ApplicationContext will be loaded from BaseConfig and ExtendedConfig</span>
<span class="strong"><strong>@ContextConfiguration(classes = ExtendedConfig.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}</pre>
<p>In the following example that uses context initializers, the <code class="literal">ApplicationContext</code> for
<code class="literal">ExtendedTest</code> will be initialized using <code class="literal">BaseInitializer</code> <span class="emphasis"><em>and</em></span>
<code class="literal">ExtendedInitializer</code>. Note, however, that the order in which the initializers are
invoked depends on whether they implement Spring’s <code class="literal">Ordered</code> interface or are annotated
with Spring’s <code class="literal">@Order</code> annotation or the standard <code class="literal">@Priority</code> annotation.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be initialized by BaseInitializer</span>
<span class="strong"><strong>@ContextConfiguration(initializers = BaseInitializer.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-comment">// ApplicationContext will be initialized by BaseInitializer</span>
<span class="hl-comment">// and ExtendedInitializer</span>
<span class="strong"><strong>@ContextConfiguration(initializers = ExtendedInitializer.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-env-profiles" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-env-profiles"></a>Context configuration with environment profiles</h4></div></div></div>

<p>Spring 3.1 introduced first-class support in the framework for the notion of
environments and profiles (a.k.a., <span class="emphasis"><em>bean definition profiles</em></span>), and integration tests
can be configured to activate particular bean definition profiles for various testing
scenarios. This is achieved by annotating a test class with the <code class="literal">@ActiveProfiles</code>
annotation and supplying a list of profiles that should be activated when loading the
<code class="literal">ApplicationContext</code> for the test.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">@ActiveProfiles</code> may be used with any implementation of the new <code class="literal">SmartContextLoader</code>
SPI, but <code class="literal">@ActiveProfiles</code> is not supported with implementations of the older
<code class="literal">ContextLoader</code> SPI.</p>
</td></tr></tbody></table></div>
<p>Let’s take a look at some examples with XML configuration and <code class="literal">@Configuration</code> classes.</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- app-config.xml --&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:jdbc</span>=<span class="hl-value">"http://www.springframework.org/schema/jdbc"</span>
    <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://www.springframework.org/schema/jee"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"..."</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transferService"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"com.bank.service.internal.DefaultTransferService"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"accountRepository"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"feePolicy"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountRepository"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"com.bank.repository.internal.JdbcAccountRepository"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"feePolicy"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"com.bank.service.internal.ZeroFeePolicy"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"dev"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;jdbc:embedded-database</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;jdbc:script</span>
                <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/bank/config/sql/schema.sql"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;jdbc:script</span>
                <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/bank/config/sql/test-data.sql"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/jdbc:embedded-database&gt;</span>
    <span class="hl-tag">&lt;/beans&gt;</span>

    <span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"production"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"java:comp/env/jdbc/datasource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/beans&gt;</span>

    <span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">"default"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;jdbc:embedded-database</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;jdbc:script</span>
                <span class="hl-attribute">location</span>=<span class="hl-value">"classpath:com/bank/config/sql/schema.sql"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/jdbc:embedded-database&gt;</span>
    <span class="hl-tag">&lt;/beans&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// ApplicationContext will be loaded from "classpath:/app-config.xml"</span>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration("/app-config.xml")</span></em>
<em><span class="hl-annotation" style="color: gray">@ActiveProfiles("dev")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> TransferService transferService;

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testTransferService() {
        <span class="hl-comment">// test the transferService</span>
    }
}</pre>
<p>When <code class="literal">TransferServiceTest</code> is run, its <code class="literal">ApplicationContext</code> will be loaded from the
<code class="literal">app-config.xml</code> configuration file in the root of the classpath. If you inspect
<code class="literal">app-config.xml</code> you’ll notice that the <code class="literal">accountRepository</code> bean has a dependency on a
<code class="literal">dataSource</code> bean; however, <code class="literal">dataSource</code> is not defined as a top-level bean. Instead,
<code class="literal">dataSource</code> is defined three times: in the <span class="emphasis"><em>production</em></span> profile, the
<span class="emphasis"><em>dev</em></span> profile, and the <span class="emphasis"><em>default</em></span> profile.</p>
<p>By annotating <code class="literal">TransferServiceTest</code> with <code class="literal">@ActiveProfiles("dev")</code> we instruct the Spring
TestContext Framework to load the <code class="literal">ApplicationContext</code> with the active profiles set to
<code class="literal">{"dev"}</code>. As a result, an embedded database will be created and populated with test data,
and the <code class="literal">accountRepository</code> bean will be wired with a reference to the development
<code class="literal">DataSource</code>. And that’s likely what we want in an integration test.</p>
<p>It is sometimes useful to assign beans to a <code class="literal">default</code> profile. Beans within the default profile
are only included when no other profile is specifically activated. This can be used to define
<span class="emphasis"><em>fallback</em></span> beans to be used in the application’s default state. For example, you may
explicitly provide a data source for <code class="literal">dev</code> and <code class="literal">production</code> profiles, but define an in-memory
data source as a default when neither of these is active.</p>
<p>The following code listings demonstrate how to implement the same configuration and
integration test but using <code class="literal">@Configuration</code> classes instead of XML.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@Profile("dev")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> StandaloneDataConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/schema.sql"</span>)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/test-data.sql"</span>)
            .build();
    }
}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@Profile("production")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JndiDataConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean(destroyMethod="")</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() <span class="hl-keyword">throws</span> Exception {
        Context ctx = <span class="hl-keyword">new</span> InitialContext();
        <span class="hl-keyword">return</span> (DataSource) ctx.lookup(<span class="hl-string">"java:comp/env/jdbc/datasource"</span>);
    }
}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<em><span class="hl-annotation" style="color: gray">@Profile("default")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultDataConfig {

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="hl-string">"classpath:com/bank/config/sql/schema.sql"</span>)
            .build();
    }
}</pre>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Configuration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceConfig {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em> DataSource dataSource;

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DefaultTransferService(accountRepository(), feePolicy());
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> AccountRepository accountRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
    }

    <em><span class="hl-annotation" style="color: gray">@Bean</span></em>
    <span class="hl-keyword">public</span> FeePolicy feePolicy() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ZeroFeePolicy();
    }

}</pre>
<pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration(classes = {
        TransferServiceConfig.class,
        StandaloneDataConfig.class,
        JndiDataConfig.class,
        DefaultDataConfig.class})</span></em>
<em><span class="hl-annotation" style="color: gray">@ActiveProfiles("dev")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> TransferService transferService;

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testTransferService() {
        <span class="hl-comment">// test the transferService</span>
    }
}</pre>
<p>In this variation, we have split the XML configuration into four independent
<code class="literal">@Configuration</code> classes:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">TransferServiceConfig</code>: acquires a <code class="literal">dataSource</code> via dependency injection using
<code class="literal">@Autowired</code>
</li><li class="listitem">
<code class="literal">StandaloneDataConfig</code>: defines a <code class="literal">dataSource</code> for an embedded database suitable for
developer tests
</li><li class="listitem">
<code class="literal">JndiDataConfig</code>: defines a <code class="literal">dataSource</code> that is retrieved from JNDI in a production
environment
</li><li class="listitem">
<code class="literal">DefaultDataConfig</code>: defines a <code class="literal">dataSource</code> for a default embedded database in case
no profile is active
</li></ul></div>
<p>As with the XML-based configuration example, we still annotate <code class="literal">TransferServiceTest</code>
with <code class="literal">@ActiveProfiles("dev")</code>, but this time we specify all four configuration classes
via the <code class="literal">@ContextConfiguration</code> annotation. The body of the test class itself remains
completely unchanged.</p>
<p>It is often the case that a single set of profiles is used across multiple test classes
within a given project. Thus, to avoid duplicate declarations of the <code class="literal">@ActiveProfiles</code>
annotation it is possible to declare <code class="literal">@ActiveProfiles</code> once on a base class, and
subclasses will automatically inherit the <code class="literal">@ActiveProfiles</code> configuration from the base
class. In the following example, the declaration of <code class="literal">@ActiveProfiles</code> (as well as other
annotations) has been moved to an abstract superclass, <code class="literal">AbstractIntegrationTest</code>.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration(classes = {
        TransferServiceConfig.class,
        StandaloneDataConfig.class,
        JndiDataConfig.class,
        DefaultDataConfig.class})</span></em>
<em><span class="hl-annotation" style="color: gray">@ActiveProfiles("dev")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> AbstractIntegrationTest {
}</pre>
<pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<span class="hl-comment">// "dev" profile inherited from superclass</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest <span class="hl-keyword">extends</span> AbstractIntegrationTest {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> TransferService transferService;

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testTransferService() {
        <span class="hl-comment">// test the transferService</span>
    }
}</pre>
<p><code class="literal">@ActiveProfiles</code> also supports an <code class="literal">inheritProfiles</code> attribute that can be used to
disable the inheritance of active profiles.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<span class="hl-comment">// "dev" profile overridden with "production"</span>
<em><span class="hl-annotation" style="color: gray">@ActiveProfiles(profiles = "production", inheritProfiles = false)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductionTransferServiceTest <span class="hl-keyword">extends</span> AbstractIntegrationTest {
    <span class="hl-comment">// test body</span>
}</pre>
<p><a name="testcontext-ctx-management-env-profiles-ActiveProfilesResolver" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-env-profiles-ActiveProfilesResolver"></a>Furthermore, it is sometimes necessary to resolve active profiles for tests
<span class="emphasis"><em>programmatically</em></span> instead of declaratively&#8201;—&#8201;for example, based on:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
the current operating system
</li><li class="listitem">
whether tests are being executed on a continuous integration build server
</li><li class="listitem">
the presence of certain environment variables
</li><li class="listitem">
the presence of custom class-level annotations
</li><li class="listitem">
etc.
</li></ul></div>
<p>To resolve active bean definition profiles programmatically, simply implement a custom
<code class="literal">ActiveProfilesResolver</code> and register it via the <code class="literal">resolver</code> attribute of
<code class="literal">@ActiveProfiles</code>. The following example demonstrates how to implement and register a
custom <code class="literal">OperatingSystemActiveProfilesResolver</code>. For further information, refer to the
corresponding javadocs.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<span class="hl-comment">// "dev" profile overridden programmatically via a custom resolver</span>
<em><span class="hl-annotation" style="color: gray">@ActiveProfiles(
    resolver = OperatingSystemActiveProfilesResolver.class,
    inheritProfiles = false)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest <span class="hl-keyword">extends</span> AbstractIntegrationTest {
    <span class="hl-comment">// test body</span>
}</pre>
<pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service.test;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OperatingSystemActiveProfilesResolver <span class="hl-keyword">implements</span> ActiveProfilesResolver {

    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    String[] resolve(Class&lt;?&gt; testClass) {
        String profile = ...;
        <span class="hl-comment">// determine the value of profile based on the operating system</span>
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> String[] {profile};
    }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-property-sources" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-property-sources"></a>Context configuration with test property sources</h4></div></div></div>

<p>Spring 3.1 introduced first-class support in the framework for the notion of an
environment with a hierarchy of <span class="emphasis"><em>property sources</em></span>, and since Spring 4.1 integration
tests can be configured with test-specific property sources. In contrast to the
<code class="literal">@PropertySource</code> annotation used on <code class="literal">@Configuration</code> classes, the <code class="literal">@TestPropertySource</code>
annotation can be declared on a test class to declare resource locations for test
properties files or <span class="emphasis"><em>inlined</em></span> properties. These test property sources will be added to
the set of <code class="literal">PropertySources</code> in the <code class="literal">Environment</code> for the <code class="literal">ApplicationContext</code> loaded
for the annotated integration test.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">@TestPropertySource</code> may be used with any implementation of the <code class="literal">SmartContextLoader</code>
SPI, but <code class="literal">@TestPropertySource</code> is not supported with implementations of the older
<code class="literal">ContextLoader</code> SPI.</p>
<p>Implementations of <code class="literal">SmartContextLoader</code> gain access to merged test property source values
via the <code class="literal">getPropertySourceLocations()</code> and <code class="literal">getPropertySourceProperties()</code> methods in
<code class="literal">MergedContextConfiguration</code>.</p>
</td></tr></tbody></table></div>
<p><span class="strong"><strong>Declaring test property sources</strong></span></p>
<p>Test properties files can be configured via the <code class="literal">locations</code> or <code class="literal">value</code> attribute of
<code class="literal">@TestPropertySource</code> as shown in the following example.</p>
<p>Both traditional and XML-based properties file formats are supported&#8201;—&#8201;for example,
<code class="literal">"classpath:/com/example/test.properties"</code> or <code class="literal">"file:///path/to/file.xml"</code>.</p>
<p>Each path will be interpreted as a Spring <code class="literal">Resource</code>. A plain path&#8201;—&#8201;for example,
<code class="literal">"test.properties"</code>&#8201;—&#8201;will be treated as a classpath resource that is <span class="emphasis"><em>relative</em></span> to the
package in which the test class is defined. A path starting with a slash will be treated
as an <span class="emphasis"><em>absolute</em></span> classpath resource, for example: <code class="literal">"/org/example/test.xml"</code>. A path which
references a URL (e.g., a path prefixed with <code class="literal">classpath:</code>, <code class="literal">file:</code>, <code class="literal">http:</code>, etc.) will
be loaded using the specified resource protocol. Resource location wildcards (e.g.
<code class="literal"><span class="strong"><strong>*/</strong></span>.properties</code>) are not permitted: each location must evaluate to exactly one
<code class="literal">.properties</code> or <code class="literal">.xml</code> resource.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@TestPropertySource("/test.properties")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p><span class="emphasis"><em>Inlined</em></span> properties in the form of key-value pairs can be configured via the
<code class="literal">properties</code> attribute of <code class="literal">@TestPropertySource</code> as shown in the following example. All
key-value pairs will be added to the enclosing <code class="literal">Environment</code> as a single test
<code class="literal">PropertySource</code> with the highest precedence.</p>
<p>The supported syntax for key-value pairs is the same as the syntax defined for entries in
a Java properties file:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">"key=value"</code>
</li><li class="listitem">
<code class="literal">"key:value"</code>
</li><li class="listitem">
<code class="literal">"key value"</code>
</li></ul></div>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@TestPropertySource(properties = {"timezone = GMT", "port: 4242"})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p><span class="strong"><strong>Default properties file detection</strong></span></p>
<p>If <code class="literal">@TestPropertySource</code> is declared as an empty annotation (i.e., without explicit
values for the <code class="literal">locations</code> or <code class="literal">properties</code> attributes), an attempt will be made to detect
a <span class="emphasis"><em>default</em></span> properties file relative to the class that declared the annotation. For
example, if the annotated test class is <code class="literal">com.example.MyTest</code>, the corresponding default
properties file is <code class="literal">"classpath:com/example/MyTest.properties"</code>. If the default cannot be
detected, an <code class="literal">IllegalStateException</code> will be thrown.</p>
<p><span class="strong"><strong>Precedence</strong></span></p>
<p>Test property sources have higher precedence than those loaded from the operating
system’s environment or Java system properties as well as property sources added by the
application declaratively via <code class="literal">@PropertySource</code> or programmatically. Thus, test property
sources can be used to selectively override properties defined in system and application
property sources. Furthermore, inlined properties have higher precedence than properties
loaded from resource locations.</p>
<p>In the following example, the <code class="literal">timezone</code> and <code class="literal">port</code> properties as well as any properties
defined in <code class="literal">"/test.properties"</code> will override any properties of the same name that are
defined in system and application property sources. Furthermore, if the
<code class="literal">"/test.properties"</code> file defines entries for the <code class="literal">timezone</code> and <code class="literal">port</code> properties those
will be overridden by the <span class="emphasis"><em>inlined</em></span> properties declared via the <code class="literal">properties</code> attribute.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@TestPropertySource(
    locations = "/test.properties",
    properties = {"timezone = GMT", "port: 4242"}
)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre>
<p><span class="strong"><strong>Inheriting and overriding test property sources</strong></span></p>
<p><code class="literal">@TestPropertySource</code> supports boolean <code class="literal">inheritLocations</code> and <code class="literal">inheritProperties</code>
attributes that denote whether resource locations for properties files and inlined
properties declared by superclasses should be <span class="emphasis"><em>inherited</em></span>. The default value for both
flags is <code class="literal">true</code>. This means that a test class inherits the locations and inlined
properties declared by any superclasses. Specifically, the locations and inlined
properties for a test class are appended to the locations and inlined properties declared
by superclasses. Thus, subclasses have the option of <span class="emphasis"><em>extending</em></span> the locations and
inlined properties. Note that properties that appear later will <span class="emphasis"><em>shadow</em></span> (i.e..,
override) properties of the same name that appear earlier. In addition, the
aforementioned precedence rules apply for inherited test property sources as well.</p>
<p>If the <code class="literal">inheritLocations</code> or <code class="literal">inheritProperties</code> attribute in <code class="literal">@TestPropertySource</code> is set
to <code class="literal">false</code>, the locations or inlined properties, respectively, for the test class <span class="emphasis"><em>shadow</em></span>
and effectively replace the configuration defined by superclasses.</p>
<p>In the following example, the <code class="literal">ApplicationContext</code> for <code class="literal">BaseTest</code> will be loaded using
only the <code class="literal">"base.properties"</code> file as a test property source. In contrast, the
<code class="literal">ApplicationContext</code> for <code class="literal">ExtendedTest</code> will be loaded using the <code class="literal">"base.properties"</code>
<span class="strong"><strong>and</strong></span> <code class="literal">"extended.properties"</code> files as test property source locations.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@TestPropertySource("base.properties")</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// ...</span>
}

<em><span class="hl-annotation" style="color: gray">@TestPropertySource("extended.properties")</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// ...</span>
}</pre>
<p>In the following example, the <code class="literal">ApplicationContext</code> for <code class="literal">BaseTest</code> will be loaded using only
the <span class="emphasis"><em>inlined</em></span> <code class="literal">key1</code> property. In contrast, the <code class="literal">ApplicationContext</code> for <code class="literal">ExtendedTest</code> will be
loaded using the <span class="emphasis"><em>inlined</em></span> <code class="literal">key1</code> and <code class="literal">key2</code> properties.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@TestPropertySource(properties = "key1 = value1")</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// ...</span>
}

<em><span class="hl-annotation" style="color: gray">@TestPropertySource(properties = "key2 = value2")</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// ...</span>
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-web" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-web"></a>Loading a WebApplicationContext</h4></div></div></div>

<p>Spring 3.2 introduced support for loading a <code class="literal">WebApplicationContext</code> in integration
tests. To instruct the TestContext framework to load a <code class="literal">WebApplicationContext</code> instead
of a standard <code class="literal">ApplicationContext</code>, simply annotate the respective test class with
<code class="literal">@WebAppConfiguration</code>.</p>
<p>The presence of <code class="literal">@WebAppConfiguration</code> on your test class instructs the TestContext
framework (TCF) that a <code class="literal">WebApplicationContext</code> (WAC) should be loaded for your
integration tests. In the background the TCF makes sure that a <code class="literal">MockServletContext</code> is
created and supplied to your test’s WAC. By default the base resource path for your
<code class="literal">MockServletContext</code> will be set to <span class="emphasis"><em>"src/main/webapp"</em></span>. This is interpreted as a path
relative to the root of your JVM (i.e., normally the path to your project). If you’re
familiar with the directory structure of a web application in a Maven project, you’ll
know that <span class="emphasis"><em>"src/main/webapp"</em></span> is the default location for the root of your WAR. If you
need to override this default, simply provide an alternate path to the
<code class="literal">@WebAppConfiguration</code> annotation (e.g., <code class="literal">@WebAppConfiguration("src/test/webapp")</code>). If
you wish to reference a base resource path from the classpath instead of the file
system, just use Spring’s <span class="emphasis"><em>classpath:</em></span> prefix.</p>
<p>Please note that Spring’s testing support for <code class="literal">WebApplicationContexts</code> is on par with its
support for standard <code class="literal">ApplicationContexts</code>. When testing with a <code class="literal">WebApplicationContext</code>
you are free to declare XML configuration files, Groovy scripts, or <code class="literal">@Configuration</code>
classes via <code class="literal">@ContextConfiguration</code>. You are of course also free to use any other test
annotations such as <code class="literal">@ActiveProfiles</code>, <code class="literal">@TestExecutionListeners</code>, <code class="literal">@Sql</code>, <code class="literal">@Rollback</code>,
etc.</p>
<p>The following examples demonstrate some of the various configuration options for loading
a <code class="literal">WebApplicationContext</code>.</p>
<p>
<b>Conventions.&nbsp;</b>

</p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>

<span class="hl-comment">// defaults to "file:src/main/webapp"</span>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>

<span class="hl-comment">// detects "WacTests-context.xml" in same package</span>
<span class="hl-comment">// or static nested @Configuration class</span>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WacTests {
    <span class="hl-comment">//...</span>
}</pre><p>

</p>
<p>The above example demonstrates the TestContext framework’s support for <span class="emphasis"><em>convention over
configuration</em></span>. If you annotate a test class with <code class="literal">@WebAppConfiguration</code> without
specifying a resource base path, the resource path will effectively default
to <span class="emphasis"><em>"file:src/main/webapp"</em></span>. Similarly, if you declare <code class="literal">@ContextConfiguration</code> without
specifying resource <code class="literal">locations</code>, annotated <code class="literal">classes</code>, or context <code class="literal">initializers</code>, Spring
will attempt to detect the presence of your configuration using conventions
(i.e., <span class="emphasis"><em>"WacTests-context.xml"</em></span> in the same package as the <code class="literal">WacTests</code> class or static
nested <code class="literal">@Configuration</code> classes).</p>
<p>
<b>Default resource semantics.&nbsp;</b>

</p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>

<span class="hl-comment">// file system resource</span>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration("webapp")</span></em>

<span class="hl-comment">// classpath resource</span>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration("/spring/test-servlet-config.xml")</span></em>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WacTests {
    <span class="hl-comment">//...</span>
}</pre><p>

</p>
<p>This example demonstrates how to explicitly declare a resource base path with
<code class="literal">@WebAppConfiguration</code> and an XML resource location with <code class="literal">@ContextConfiguration</code>. The
important thing to note here is the different semantics for paths with these two
annotations. By default, <code class="literal">@WebAppConfiguration</code> resource paths are file system based;
whereas, <code class="literal">@ContextConfiguration</code> resource locations are classpath based.</p>
<p>
<b>Explicit resource semantics.&nbsp;</b>

</p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>

<span class="hl-comment">// classpath resource</span>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration("classpath:test-web-resources")</span></em>

<span class="hl-comment">// file system resource</span>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration("file:src/main/webapp/WEB-INF/servlet-config.xml")</span></em>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WacTests {
    <span class="hl-comment">//...</span>
}</pre><p>

</p>
<p>In this third example, we see that we can override the default resource semantics for
both annotations by specifying a Spring resource prefix. Contrast the comments in this
example with the previous example.</p>
<p>To provide comprehensive web testing support, Spring 3.2 introduced a
<code class="literal">ServletTestExecutionListener</code> that is enabled by default. When testing against a
<code class="literal">WebApplicationContext</code> this <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-key-abstractions" title="15.5.1 Key abstractions">TestExecutionListener</a> sets
up default thread-local state via Spring Web’s <code class="literal">RequestContextHolder</code> before each test
method and creates a <code class="literal">MockHttpServletRequest</code>, <code class="literal">MockHttpServletResponse</code>, and
<code class="literal">ServletWebRequest</code> based on the base resource path configured via
<code class="literal">@WebAppConfiguration</code>. <code class="literal">ServletTestExecutionListener</code> also ensures that the
<code class="literal">MockHttpServletResponse</code> and <code class="literal">ServletWebRequest</code> can be injected into the test
instance, and once the test is complete it cleans up thread-local state.</p>
<p>Once you have a <code class="literal">WebApplicationContext</code> loaded for your test you might find that you
need to interact with the web mocks&#8201;—&#8201;for example, to set up your test fixture or to
perform assertions after invoking your web component. The following example demonstrates
which mocks can be autowired into your test instance. Note that the
<code class="literal">WebApplicationContext</code> and <code class="literal">MockServletContext</code> are both cached across the test suite;
whereas, the other mocks are managed per test method by the
<code class="literal">ServletTestExecutionListener</code>.</p>
<p>
<b>Injecting mocks.&nbsp;</b>

</p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WacTests {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    WebApplicationContext wac; <span class="hl-comment">// cached</span>

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    MockServletContext servletContext; <span class="hl-comment">// cached</span>

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    MockHttpSession session;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    MockHttpServletRequest request;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    MockHttpServletResponse response;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    ServletWebRequest webRequest;

    <span class="hl-comment">//...</span>
}</pre><p>

</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-caching" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-caching"></a>Context caching</h4></div></div></div>

<p>Once the TestContext framework loads an <code class="literal">ApplicationContext</code> (or <code class="literal">WebApplicationContext</code>)
for a test, that context will be cached and reused for <span class="emphasis"><em>all</em></span> subsequent tests that
declare the same unique context configuration within the same test suite. To understand
how caching works, it is important to understand what is meant by <span class="emphasis"><em>unique</em></span> and <span class="emphasis"><em>test
suite</em></span>.</p>
<p>An <code class="literal">ApplicationContext</code> can be <span class="emphasis"><em>uniquely</em></span> identified by the combination of
configuration parameters that are used to load it. Consequently, the unique combination
of configuration parameters are used to generate a <span class="emphasis"><em>key</em></span> under which the context is
cached. The TestContext framework uses the following configuration parameters to build
the context cache key:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">locations</code> <span class="emphasis"><em>(from @ContextConfiguration)</em></span>
</li><li class="listitem">
<code class="literal">classes</code> <span class="emphasis"><em>(from @ContextConfiguration)</em></span>
</li><li class="listitem">
<code class="literal">contextInitializerClasses</code> <span class="emphasis"><em>(from @ContextConfiguration)</em></span>
</li><li class="listitem">
<code class="literal">contextCustomizers</code> <span class="emphasis"><em>(from ContextCustomizerFactory)</em></span>
</li><li class="listitem">
<code class="literal">contextLoader</code> <span class="emphasis"><em>(from @ContextConfiguration)</em></span>
</li><li class="listitem">
<code class="literal">parent</code> <span class="emphasis"><em>(from @ContextHierarchy)</em></span>
</li><li class="listitem">
<code class="literal">activeProfiles</code> <span class="emphasis"><em>(from @ActiveProfiles)</em></span>
</li><li class="listitem">
<code class="literal">propertySourceLocations</code> <span class="emphasis"><em>(from @TestPropertySource)</em></span>
</li><li class="listitem">
<code class="literal">propertySourceProperties</code> <span class="emphasis"><em>(from @TestPropertySource)</em></span>
</li><li class="listitem">
<code class="literal">resourceBasePath</code> <span class="emphasis"><em>(from @WebAppConfiguration)</em></span>
</li></ul></div>
<p>For example, if <code class="literal">TestClassA</code> specifies <code class="literal">{"app-config.xml", "test-config.xml"}</code> for the
<code class="literal">locations</code> (or <code class="literal">value</code>) attribute of <code class="literal">@ContextConfiguration</code>, the TestContext framework
will load the corresponding <code class="literal">ApplicationContext</code> and store it in a <code class="literal">static</code> context cache
under a key that is based solely on those locations. So if <code class="literal">TestClassB</code> also defines
<code class="literal">{"app-config.xml", "test-config.xml"}</code> for its locations (either explicitly or
implicitly through inheritance) but does not define <code class="literal">@WebAppConfiguration</code>, a different
<code class="literal">ContextLoader</code>, different active profiles, different context initializers, different
test property sources, or a different parent context, then the same <code class="literal">ApplicationContext</code>
will be shared by both test classes. This means that the setup cost for loading an
application context is incurred only once (per test suite), and subsequent test execution
is much faster.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Test suites and forked processes"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Test suites and forked processes</th></tr><tr><td align="left" valign="top">

<p>The Spring TestContext framework stores application contexts in a <span class="emphasis"><em>static</em></span> cache. This
means that the context is literally stored in a <code class="literal">static</code> variable. In other words, if
tests execute in separate processes the static cache will be cleared between each test
execution, and this will effectively disable the caching mechanism.</p>
<p>To benefit from the caching mechanism, all tests must run within the same process or
test suite. This can be achieved by executing all tests as a group within an IDE.
Similarly, when executing tests with a build framework such as Ant, Maven, or Gradle it
is important to make sure that the build framework does not <span class="emphasis"><em>fork</em></span> between tests. For
example, if the
<a class="ulink" href="https://maven.apache.org/plugins/maven-surefire-plugin/test-mojo.html#forkMode" target="_top">forkMode</a>
for the Maven Surefire plug-in is set to <code class="literal">always</code> or <code class="literal">pertest</code>, the TestContext
framework will not be able to cache application contexts between test classes and the
build process will run significantly slower as a result.</p>
</td></tr></tbody></table></div>
<p>Since Spring Framework 4.3, the size of the context cache is bounded with a default
maximum size of 32. Whenever the maximum size is reached, a <span class="emphasis"><em>least recently used</em></span> (LRU)
eviction policy is used to evict and close stale contexts. The maximum size can be
configured from the command line or a build script by setting a JVM system property named
<code class="literal">spring.test.context.cache.maxSize</code>. As an alternative, the same property can be set
programmatically via the <code class="literal">SpringProperties</code> API.</p>
<p>Since having a large number of application contexts loaded within a given test suite can
cause the suite to take an unnecessarily long time to execute, it is often beneficial to
know exactly how many contexts have been loaded and cached. To view the statistics for
the underlying context cache, simply set the log level for the
<code class="literal">org.springframework.test.context.cache</code> logging category to <code class="literal">DEBUG</code>.</p>
<p>In the unlikely case that a test corrupts the application context and requires reloading&#8201;—&#8201;for example, by modifying a bean definition or the state of an application object&#8201;—&#8201;you can annotate your test class or test method with <code class="literal">@DirtiesContext</code> (see the
discussion of <code class="literal">@DirtiesContext</code> in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-spring" title="15.4.1 Spring Testing Annotations">Section&nbsp;15.4.1, “Spring Testing Annotations”</a>). This
instructs Spring to remove the context from the cache and rebuild the application
context before executing the next test. Note that support for the <code class="literal">@DirtiesContext</code>
annotation is provided by the <code class="literal">DirtiesContextBeforeModesTestExecutionListener</code> and the
<code class="literal">DirtiesContextTestExecutionListener</code> which are enabled by default.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-ctx-management-ctx-hierarchies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-ctx-management-ctx-hierarchies"></a>Context hierarchies</h4></div></div></div>

<p>When writing integration tests that rely on a loaded Spring <code class="literal">ApplicationContext</code>, it is
often sufficient to test against a single context; however, there are times when it is
beneficial or even necessary to test against a hierarchy of <code class="literal">ApplicationContext</code>s. For
example, if you are developing a Spring MVC web application you will typically have a
root <code class="literal">WebApplicationContext</code> loaded via Spring’s <code class="literal">ContextLoaderListener</code> and a child
<code class="literal">WebApplicationContext</code> loaded via Spring’s <code class="literal">DispatcherServlet</code>. This results in a
parent-child context hierarchy where shared components and infrastructure configuration
are declared in the root context and consumed in the child context by web-specific
components. Another use case can be found in Spring Batch applications where you often
have a parent context that provides configuration for shared batch infrastructure and a
child context for the configuration of a specific batch job.</p>
<p>Since Spring Framework 3.2.2, it is possible to write integration tests that use context
hierarchies by declaring context configuration via the <code class="literal">@ContextHierarchy</code> annotation,
either on an individual test class or within a test class hierarchy. If a context
hierarchy is declared on multiple classes within a test class hierarchy it is also
possible to merge or override the context configuration for a specific, named level in
the context hierarchy. When merging configuration for a given level in the hierarchy the
configuration resource type (i.e., XML configuration files or annotated classes) must be
consistent; otherwise, it is perfectly acceptable to have different levels in a context
hierarchy configured using different resource types.</p>
<p>The following JUnit 4 based examples demonstrate common configuration scenarios for
integration tests that require the use of context hierarchies.</p>
<p><code class="literal">ControllerIntegrationTests</code> represents a typical integration testing scenario for a
Spring MVC web application by declaring a context hierarchy consisting of two levels,
one for the <span class="emphasis"><em>root</em></span> WebApplicationContext (loaded using the <code class="literal">TestAppConfig</code>
<code class="literal">@Configuration</code> class) and one for the <span class="emphasis"><em>dispatcher servlet</em></span> <code class="literal">WebApplicationContext</code>
(loaded using the <code class="literal">WebConfig</code> <code class="literal">@Configuration</code> class). The <code class="literal">WebApplicationContext</code> that
is <span class="emphasis"><em>autowired</em></span> into the test instance is the one for the child context (i.e., the
lowest context in the hierarchy).</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextHierarchy({
    @ContextConfiguration(classes = TestAppConfig.class),
    @ContextConfiguration(classes = WebConfig.class)
})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ControllerIntegrationTests {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-comment">// ...</span>
}</pre>
<p>The following test classes define a context hierarchy within a test class hierarchy.
<code class="literal">AbstractWebTests</code> declares the configuration for a root <code class="literal">WebApplicationContext</code> in a
Spring-powered web application. Note, however, that <code class="literal">AbstractWebTests</code> does not declare
<code class="literal">@ContextHierarchy</code>; consequently, subclasses of <code class="literal">AbstractWebTests</code> can optionally
participate in a context hierarchy or simply follow the standard semantics for
<code class="literal">@ContextConfiguration</code>. <code class="literal">SoapWebServiceTests</code> and <code class="literal">RestWebServiceTests</code> both extend
<code class="literal">AbstractWebTests</code> and define a context hierarchy via <code class="literal">@ContextHierarchy</code>. The result is
that three application contexts will be loaded (one for each declaration of
<code class="literal">@ContextConfiguration</code>), and the application context loaded based on the configuration
in <code class="literal">AbstractWebTests</code> will be set as the parent context for each of the contexts loaded
for the concrete subclasses.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration("file:src/main/webapp/WEB-INF/applicationContext.xml")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> AbstractWebTests {}

@ContextHierarchy(<em><span class="hl-annotation" style="color: gray">@ContextConfiguration("/spring/soap-ws-config.xml")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SoapWebServiceTests <span class="hl-keyword">extends</span> AbstractWebTests {}

@ContextHierarchy(<em><span class="hl-annotation" style="color: gray">@ContextConfiguration("/spring/rest-ws-config.xml")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RestWebServiceTests <span class="hl-keyword">extends</span> AbstractWebTests {}</pre>
<p>The following classes demonstrate the use of <span class="emphasis"><em>named</em></span> hierarchy levels in order to
<span class="emphasis"><em>merge</em></span> the configuration for specific levels in a context hierarchy. <code class="literal">BaseTests</code>
defines two levels in the hierarchy, <code class="literal">parent</code> and <code class="literal">child</code>. <code class="literal">ExtendedTests</code> extends
<code class="literal">BaseTests</code> and instructs the Spring TestContext Framework to merge the context
configuration for the <code class="literal">child</code> hierarchy level, simply by ensuring that the names
declared via the <code class="literal">name</code> attribute in <code class="literal">@ContextConfiguration</code> are both <code class="literal">"child"</code>. The
result is that three application contexts will be loaded: one for <code class="literal">"/app-config.xml"</code>,
one for <code class="literal">"/user-config.xml"</code>, and one for <code class="literal">{"/user-config.xml", "/order-config.xml"}</code>.
As with the previous example, the application context loaded from <code class="literal">"/app-config.xml"</code>
will be set as the parent context for the contexts loaded from <code class="literal">"/user-config.xml"</code>
and <code class="literal">{"/user-config.xml", "/order-config.xml"}</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextHierarchy({
    @ContextConfiguration(name = "parent", locations = "/app-config.xml"),
    @ContextConfiguration(name = "child", locations = "/user-config.xml")
})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTests {}

<em><span class="hl-annotation" style="color: gray">@ContextHierarchy(
    @ContextConfiguration(name = "child", locations = "/order-config.xml")
)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTests <span class="hl-keyword">extends</span> BaseTests {}</pre>
<p>In contrast to the previous example, this example demonstrates how to <span class="emphasis"><em>override</em></span> the
configuration for a given named level in a context hierarchy by setting the
<code class="literal">inheritLocations</code> flag in <code class="literal">@ContextConfiguration</code> to <code class="literal">false</code>. Consequently, the
application context for <code class="literal">ExtendedTests</code> will be loaded only from
<code class="literal">"/test-user-config.xml"</code> and will have its parent set to the context loaded from
<code class="literal">"/app-config.xml"</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextHierarchy({
    @ContextConfiguration(name = "parent", locations = "/app-config.xml"),
    @ContextConfiguration(name = "child", locations = "/user-config.xml")
})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTests {}

<em><span class="hl-annotation" style="color: gray">@ContextHierarchy(
    @ContextConfiguration(
        name = "child",
        locations = "/test-user-config.xml",
        inheritLocations = false
))</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTests <span class="hl-keyword">extends</span> BaseTests {}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Dirtying a context within a context hierarchy"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Dirtying a context within a context hierarchy</th></tr><tr><td align="left" valign="top">

<p>If <code class="literal">@DirtiesContext</code> is used in a test whose context is configured as part of a context
hierarchy, the <code class="literal">hierarchyMode</code> flag can be used to control how the context cache is
cleared. For further details consult the discussion of <code class="literal">@DirtiesContext</code> in
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations-spring" title="15.4.1 Spring Testing Annotations">Spring Testing Annotations</a> and the
<code class="literal">@DirtiesContext</code> javadocs.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-fixture-di" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-fixture-di"></a>15.5.5&nbsp;Dependency injection of test fixtures</h3></div></div></div>

<p>When you use the <code class="literal">DependencyInjectionTestExecutionListener</code>&#8201;—&#8201;which is configured by
default&#8201;—&#8201;the dependencies of your test instances are <span class="emphasis"><em>injected</em></span> from beans in the
application context that you configured with <code class="literal">@ContextConfiguration</code>. You may use setter
injection, field injection, or both, depending on which annotations you choose and
whether you place them on setter methods or fields. For consistency with the annotation
support introduced in Spring 2.5 and 3.0, you can use Spring’s <code class="literal">@Autowired</code> annotation
or the <code class="literal">@Inject</code> annotation from JSR 330.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>The TestContext framework does not instrument the manner in which a test instance is
instantiated. Thus the use of <code class="literal">@Autowired</code> or <code class="literal">@Inject</code> for constructors has no effect
for test classes.</p>
</td></tr></tbody></table></div>
<p>Because <code class="literal">@Autowired</code> is used to perform <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="7.4.5 Autowiring collaborators"><span class="emphasis"><em>autowiring by type</em></span></a>, if you have multiple bean definitions of the same type, you cannot rely on this
approach for those particular beans. In that case, you can use <code class="literal">@Autowired</code> in
conjunction with <code class="literal">@Qualifier</code>. As of Spring 3.0 you may also choose to use <code class="literal">@Inject</code> in
conjunction with <code class="literal">@Named</code>. Alternatively, if your test class has access to its
<code class="literal">ApplicationContext</code>, you can perform an explicit lookup by using (for example) a call
to <code class="literal">applicationContext.getBean("titleRepository")</code>.</p>
<p>If you do not want dependency injection applied to your test instances, simply do not
annotate fields or setter methods with <code class="literal">@Autowired</code> or <code class="literal">@Inject</code>. Alternatively, you can
disable dependency injection altogether by explicitly configuring your class with
<code class="literal">@TestExecutionListeners</code> and omitting <code class="literal">DependencyInjectionTestExecutionListener.class</code>
from the list of listeners.</p>
<p>Consider the scenario of testing a <code class="literal">HibernateTitleRepository</code> class, as outlined in the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-goals" title="15.2 Goals of Integration Testing">Goals</a> section. The next two code listings demonstrate the
use of <code class="literal">@Autowired</code> on fields and setter methods. The application context configuration
is presented after all sample code listings.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The dependency injection behavior in the following code listings is not specific to
JUnit 4. The same DI techniques can be used in conjunction with any testing framework.</p>
<p>The following examples make calls to static assertion methods such as <code class="literal">assertNotNull()</code>
but without prepending the call with <code class="literal">Assert</code>. In such cases, assume that the method was
properly imported through an <code class="literal">import static</code> declaration that is not shown in the
example.</p>
</td></tr></tbody></table></div>
<p>The first code listing shows a JUnit 4 based implementation of the test class that uses
<code class="literal">@Autowired</code> for field injection.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// specifies the Spring configuration to load for this test fixture</span>
<span class="strong"><strong>@ContextConfiguration("repository-config.xml")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateTitleRepositoryTests {

    <span class="hl-comment">// this instance will be dependency injected by type</span>
    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">private</span> HibernateTitleRepository titleRepository;

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findById() {
        Title title = titleRepository.findById(<span class="hl-keyword">new</span> Long(<span class="hl-number">10</span>));
        assertNotNull(title);
    }
}</pre>
<p>Alternatively, you can configure the class to use <code class="literal">@Autowired</code> for setter injection as
seen below.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<span class="hl-comment">// specifies the Spring configuration to load for this test fixture</span>
<span class="strong"><strong>@ContextConfiguration("repository-config.xml")</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateTitleRepositoryTests {

    <span class="hl-comment">// this instance will be dependency injected by type</span>
    <span class="hl-keyword">private</span> HibernateTitleRepository titleRepository;

    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setTitleRepository(HibernateTitleRepository titleRepository) {
        <span class="hl-keyword">this</span>.titleRepository = titleRepository;
    }

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findById() {
        Title title = titleRepository.findById(<span class="hl-keyword">new</span> Long(<span class="hl-number">10</span>));
        assertNotNull(title);
    }
}</pre>
<p>The preceding code listings use the same XML context file referenced by the
<code class="literal">@ContextConfiguration</code> annotation (that is, <code class="literal">repository-config.xml</code>), which looks like
this:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- this bean will be injected into the HibernateTitleRepositoryTests class --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"</span><span class="strong"><strong>titleRepository</strong></span>" class="<span class="strong"><strong>com.foo.repository.hibernate.HibernateTitleRepository</strong></span>"&gt;
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"sessionFactory"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate5.LocalSessionFactoryBean"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- configuration elided for brevity --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If you are extending from a Spring-provided test base class that happens to use
<code class="literal">@Autowired</code> on one of its setter methods, you might have multiple beans of the affected
type defined in your application context: for example, multiple <code class="literal">DataSource</code> beans. In
such a case, you can override the setter method and use the <code class="literal">@Qualifier</code> annotation to
indicate a specific target bean as follows, but make sure to delegate to the overridden
method in the superclass as well.</p>
<pre class="programlisting"><span class="hl-comment">// ...</span>

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <em><span class="hl-annotation" style="color: gray">@Override</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(<span class="strong"><strong>@Qualifier("myDataSource")</strong></span> DataSource dataSource) {
        <span class="strong"><strong>super</strong></span>.setDataSource(dataSource);
    }

<span class="hl-comment">// ...</span></pre>
<p>The specified qualifier value indicates the specific <code class="literal">DataSource</code> bean to inject,
narrowing the set of type matches to a specific bean. Its value is matched against
<code class="literal">&lt;qualifier&gt;</code> declarations within the corresponding <code class="literal">&lt;bean&gt;</code> definitions. The bean name
is used as a fallback qualifier value, so you may effectively also point to a specific
bean by name there (as shown above, assuming that "myDataSource" is the bean id).</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-web-scoped-beans" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-web-scoped-beans"></a>15.5.6&nbsp;Testing request and session scoped beans</h3></div></div></div>

<p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-factory-scopes-other" title="7.5.4 Request, session, global session, application, and WebSocket scopes">Request and session scoped beans</a> have been supported by
Spring since the early years, and since Spring 3.2 it’s a breeze to test your
request-scoped and session-scoped beans by following these steps.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Ensure that a <code class="literal">WebApplicationContext</code> is loaded for your test by annotating your test
class with <code class="literal">@WebAppConfiguration</code>.
</li><li class="listitem">
Inject the mock request or session into your test instance and prepare your test
fixture as appropriate.
</li><li class="listitem">
Invoke your web component that you retrieved from the configured
<code class="literal">WebApplicationContext</code> (i.e., via dependency injection).
</li><li class="listitem">
Perform assertions against the mocks.
</li></ul></div>
<p>The following code snippet displays the XML configuration for a login use case. Note
that the <code class="literal">userService</code> bean has a dependency on a request-scoped <code class="literal">loginAction</code> bean.
Also, the <code class="literal">LoginAction</code> is instantiated using <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#expressions" title="10. Spring Expression Language (SpEL)">SpEL expressions</a> that
retrieve the username and password from the current HTTP request. In our test, we will
want to configure these request parameters via the mock managed by the TestContext
framework.</p>
<p>
<b>Request-scoped bean configuration.&nbsp;</b>

</p><pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userService"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.SimpleUserService"</span>
            <span class="hl-attribute">c:loginAction-ref</span>=<span class="hl-value">"loginAction"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"loginAction"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.LoginAction"</span>
            <span class="hl-attribute">c:username</span>=<span class="hl-value">"</span><span class="marked">{request.getParameter('user')}"
            c:password="</span>{request.getParameter('pswd')}"
            scope="request"&gt;
        <span class="hl-tag">&lt;aop:scoped-proxy /&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre><p>

</p>
<p>In <code class="literal">RequestScopedBeanTests</code> we inject both the <code class="literal">UserService</code> (i.e., the subject under
test) and the <code class="literal">MockHttpServletRequest</code> into our test instance. Within our
<code class="literal">requestScope()</code> test method we set up our test fixture by setting request parameters in
the provided <code class="literal">MockHttpServletRequest</code>. When the <code class="literal">loginUser()</code> method is invoked on our
<code class="literal">userService</code> we are assured that the user service has access to the request-scoped
<code class="literal">loginAction</code> for the current <code class="literal">MockHttpServletRequest</code> (i.e., the one we just set
parameters in). We can then perform assertions against the results based on the known
inputs for the username and password.</p>
<p>
<b>Request-scoped bean test.&nbsp;</b>

</p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RequestScopedBeanTests {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em> UserService userService;
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em> MockHttpServletRequest request;

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> requestScope() {

        request.setParameter(<span class="hl-string">"user"</span>, <span class="hl-string">"enigma"</span>);
        request.setParameter(<span class="hl-string">"pswd"</span>, <span class="hl-string">"$pr!ng"</span>);

        LoginResults results = userService.loginUser();

        <span class="hl-comment">// assert results</span>
    }
}</pre><p>

</p>
<p>The following code snippet is similar to the one we saw above for a request-scoped bean;
however, this time the <code class="literal">userService</code> bean has a dependency on a session-scoped
<code class="literal">userPreferences</code> bean. Note that the <code class="literal">UserPreferences</code> bean is instantiated using a
SpEL expression that retrieves the <span class="emphasis"><em>theme</em></span> from the current HTTP session. In our test,
we will need to configure a theme in the mock session managed by the TestContext
framework.</p>
<p>
<b>Session-scoped bean configuration.&nbsp;</b>

</p><pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userService"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.SimpleUserService"</span>
            <span class="hl-attribute">c:userPreferences-ref</span>=<span class="hl-value">"userPreferences"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"userPreferences"</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.UserPreferences"</span>
            <span class="hl-attribute">c:theme</span>=<span class="hl-value">"#{session.getAttribute('theme')}"</span>
            <span class="hl-attribute">scope</span>=<span class="hl-value">"session"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;aop:scoped-proxy /&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre><p>

</p>
<p>In <code class="literal">SessionScopedBeanTests</code> we inject the <code class="literal">UserService</code> and the <code class="literal">MockHttpSession</code> into
our test instance. Within our <code class="literal">sessionScope()</code> test method we set up our test fixture by
setting the expected "theme" attribute in the provided <code class="literal">MockHttpSession</code>. When the
<code class="literal">processUserPreferences()</code> method is invoked on our <code class="literal">userService</code> we are assured that
the user service has access to the session-scoped <code class="literal">userPreferences</code> for the current
<code class="literal">MockHttpSession</code>, and we can perform assertions against the results based on the
configured theme.</p>
<p>
<b>Session-scoped bean test.&nbsp;</b>

</p><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SessionScopedBeanTests {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em> UserService userService;
    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em> MockHttpSession session;

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> sessionScope() <span class="hl-keyword">throws</span> Exception {

        session.setAttribute(<span class="hl-string">"theme"</span>, <span class="hl-string">"blue"</span>);

        Results results = userService.processUserPreferences();

        <span class="hl-comment">// assert results</span>
    }
}</pre><p>

</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-tx" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx"></a>15.5.7&nbsp;Transaction management</h3></div></div></div>

<p>In the TestContext framework, transactions are managed by the
<code class="literal">TransactionalTestExecutionListener</code> which is configured by default, even if you do not
explicitly declare <code class="literal">@TestExecutionListeners</code> on your test class. To enable support for
transactions, however, you must configure a <code class="literal">PlatformTransactionManager</code> bean in the
<code class="literal">ApplicationContext</code> that is loaded via <code class="literal">@ContextConfiguration</code> semantics (further
details are provided below). In addition, you must declare Spring’s <code class="literal">@Transactional</code>
annotation either at the class or method level for your tests.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tx-test-managed-transactions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-test-managed-transactions"></a>Test-managed transactions</h4></div></div></div>

<p><span class="emphasis"><em>Test-managed transactions</em></span> are transactions that are managed <span class="emphasis"><em>declaratively</em></span> via the
<code class="literal">TransactionalTestExecutionListener</code> or <span class="emphasis"><em>programmatically</em></span> via <code class="literal">TestTransaction</code> (see
below). Such transactions should not be confused with <span class="emphasis"><em>Spring-managed transactions</em></span>
(i.e., those managed directly by Spring within the <code class="literal">ApplicationContext</code> loaded for tests)
or <span class="emphasis"><em>application-managed transactions</em></span> (i.e., those managed programmatically within
application code that is invoked via tests). Spring-managed and application-managed
transactions will typically participate in test-managed transactions; however, caution
should be taken if Spring-managed or application-managed transactions are configured with
any <span class="emphasis"><em>propagation</em></span> type other than <code class="literal">REQUIRED</code> or <code class="literal">SUPPORTS</code> (see the discussion on
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation" title="17.5.7 Transaction propagation">transaction propagation</a> for details).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tx-enabling-transactions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-enabling-transactions"></a>Enabling and disabling transactions</h4></div></div></div>

<p>Annotating a test method with <code class="literal">@Transactional</code> causes the test to be run within a
transaction that will, by default, be automatically rolled back after completion of the
test. If a test class is annotated with <code class="literal">@Transactional</code>, each test method within that
class hierarchy will be run within a transaction. Test methods that are not annotated
with <code class="literal">@Transactional</code> (at the class or method level) will not be run within a
transaction. Furthermore, tests that are annotated with <code class="literal">@Transactional</code> but have the
<code class="literal">propagation</code> type set to <code class="literal">NOT_SUPPORTED</code> will not be run within a transaction.</p>
<p><span class="emphasis"><em>Note that <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-junit4" title="JUnit 4 support classes"><code class="literal">AbstractTransactionalJUnit4SpringContextTests</code></a> and
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-testng" title="TestNG support classes"><code class="literal">AbstractTransactionalTestNGSpringContextTests</code></a>
are preconfigured for transactional support at the class level.</em></span></p>
<p>The following example demonstrates a common scenario for writing an integration test for
a Hibernate-based <code class="literal">UserRepository</code>. As explained in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-rollback-and-commit-behavior" title="Transaction rollback and commit behavior">the section called “Transaction rollback and commit behavior”</a>, there is no need to clean up the
database after the <code class="literal">createUser()</code> method is executed since any changes made to the
database will be automatically rolled back by the <code class="literal">TransactionalTestExecutionListener</code>.
See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-examples-petclinic" title="15.7 PetClinic Example">Section&nbsp;15.7, “PetClinic Example”</a> for an additional example.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration(classes = TestConfig.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@Transactional</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateUserRepositoryTests {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    HibernateUserRepository repository;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    SessionFactory sessionFactory;

    JdbcTemplate jdbcTemplate;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> createUser() {
        <span class="hl-comment">// track initial state in test database:</span>
        <span class="hl-keyword">final</span> <span class="hl-keyword">int</span> count = countRowsInTable(<span class="hl-string">"user"</span>);

        User user = <span class="hl-keyword">new</span> User(...);
        repository.save(user);

        <span class="hl-comment">// Manual flush is required to avoid false positive in test</span>
        sessionFactory.getCurrentSession().flush();
        assertNumUsers(count + <span class="hl-number">1</span>);
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">int</span> countRowsInTable(String tableName) {
        <span class="hl-keyword">return</span> JdbcTestUtils.countRowsInTable(<span class="hl-keyword">this</span>.jdbcTemplate, tableName);
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> assertNumUsers(<span class="hl-keyword">int</span> expected) {
        assertEquals(<span class="hl-string">"Number of rows in the [user] table."</span>, expected, countRowsInTable(<span class="hl-string">"user"</span>));
    }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tx-rollback-and-commit-behavior" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-rollback-and-commit-behavior"></a>Transaction rollback and commit behavior</h4></div></div></div>

<p>By default, test transactions will be automatically rolled back after completion of the
test; however, transactional commit and rollback behavior can be configured declaratively
via the <code class="literal">@Commit</code> and <code class="literal">@Rollback</code> annotations. See the corresponding entries in the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="15.4 Annotations">annotation support</a> section for further details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tx-programmatic-tx-mgt" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-programmatic-tx-mgt"></a>Programmatic transaction management</h4></div></div></div>

<p>Since Spring Framework 4.1, it is possible to interact with test-managed transactions
<span class="emphasis"><em>programmatically</em></span> via the static methods in <code class="literal">TestTransaction</code>. For example,
<code class="literal">TestTransaction</code> may be used within <span class="emphasis"><em>test</em></span> methods, <span class="emphasis"><em>before</em></span> methods, and <span class="emphasis"><em>after</em></span>
methods to start or end the current test-managed transaction or to configure the current
test-managed transaction for rollback or commit. Support for <code class="literal">TestTransaction</code> is
automatically available whenever the <code class="literal">TransactionalTestExecutionListener</code> is enabled.</p>
<p>The following example demonstrates some of the features of <code class="literal">TestTransaction</code>. Consult the
javadocs for <code class="literal">TestTransaction</code> for further details.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ContextConfiguration(classes = TestConfig.class)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProgrammaticTransactionManagementTests <span class="hl-keyword">extends</span>
        AbstractTransactionalJUnit4SpringContextTests {

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> transactionalTest() {
        <span class="hl-comment">// assert initial state in test database:</span>
        assertNumUsers(<span class="hl-number">2</span>);

        deleteFromTables(<span class="hl-string">"user"</span>);

        <span class="hl-comment">// changes to the database will be committed!</span>
        TestTransaction.flagForCommit();
        TestTransaction.end();
        assertFalse(TestTransaction.isActive());
        assertNumUsers(<span class="hl-number">0</span>);

        TestTransaction.start();
        <span class="hl-comment">// perform other actions against the database that will</span>
        <span class="hl-comment">// be automatically rolled back after the test completes...</span>
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> assertNumUsers(<span class="hl-keyword">int</span> expected) {
        assertEquals(<span class="hl-string">"Number of rows in the [user] table."</span>, expected, countRowsInTable(<span class="hl-string">"user"</span>));
    }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tx-before-and-after-tx" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-before-and-after-tx"></a>Executing code outside of a transaction</h4></div></div></div>

<p>Occasionally you need to execute certain code before or after a transactional test method
but outside the transactional context&#8201;—&#8201;for example, to verify the initial database state
prior to execution of your test or to verify expected transactional commit behavior after
test execution (if the test was configured to commit the transaction).
<code class="literal">TransactionalTestExecutionListener</code> supports the <code class="literal">@BeforeTransaction</code> and
<code class="literal">@AfterTransaction</code> annotations exactly for such scenarios. Simply annotate any <code class="literal">void</code>
method in a test class or any <code class="literal">void</code> default method in a test interface with one of these
annotations, and the <code class="literal">TransactionalTestExecutionListener</code> ensures that your <span class="emphasis"><em>before
transaction method</em></span> or <span class="emphasis"><em>after transaction method</em></span> is executed at the appropriate time.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Any <span class="emphasis"><em>before methods</em></span> (such as methods annotated with JUnit 4’s <code class="literal">@Before</code>) and any <span class="emphasis"><em>after
methods</em></span> (such as methods annotated with JUnit 4’s <code class="literal">@After</code>) are executed <span class="emphasis"><em>within</em></span> a
transaction. In addition, methods annotated with <code class="literal">@BeforeTransaction</code> or
<code class="literal">@AfterTransaction</code> are naturally not executed for test methods that are not configured
to run within a transaction.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tx-mgr-config" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-mgr-config"></a>Configuring a transaction manager</h4></div></div></div>

<p><code class="literal">TransactionalTestExecutionListener</code> expects a <code class="literal">PlatformTransactionManager</code> bean to be
defined in the Spring <code class="literal">ApplicationContext</code> for the test. In case there are multiple
instances of <code class="literal">PlatformTransactionManager</code> within the test’s <code class="literal">ApplicationContext</code>, a
<span class="emphasis"><em>qualifier</em></span> may be declared via <code class="literal">@Transactional("myTxMgr")</code> or
<code class="literal">@Transactional(transactionManager = "myTxMgr")</code>, or <code class="literal">TransactionManagementConfigurer</code>
can be implemented by an <code class="literal">@Configuration</code> class. Consult the javadocs for
<code class="literal">TestContextTransactionUtils.retrieveTransactionManager()</code> for details on the algorithm
used to look up a transaction manager in the test’s <code class="literal">ApplicationContext</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-tx-annotation-demo" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-annotation-demo"></a>Demonstration of all transaction-related annotations</h4></div></div></div>

<p>The following JUnit 4 based example displays a fictitious integration testing scenario
highlighting all transaction-related annotations. The example is <span class="strong"><strong>not</strong></span> intended to
demonstrate best practices but rather to demonstrate how these annotations can be used.
Consult the <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="15.4 Annotations">annotation support</a> section for further
information and configuration examples. <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql-declaratively-tx">Transaction management for <code class="literal">@Sql</code></a> contains an additional example using <code class="literal">@Sql</code> for
declarative SQL script execution with default transaction rollback semantics.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="strong"><strong>@Transactional(transactionManager = "txMgr")</strong></span>
<span class="strong"><strong>@Commit</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FictitiousTransactionalTest {

    <span class="strong"><strong>@BeforeTransaction</strong></span>
    <span class="hl-keyword">void</span> verifyInitialDatabaseState() {
        <span class="hl-comment">// logic to verify the initial state before a transaction is started</span>
    }

    <em><span class="hl-annotation" style="color: gray">@Before</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setUpTestDataWithinTransaction() {
        <span class="hl-comment">// set up test data within the transaction</span>
    }

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-comment">// overrides the class-level @Commit setting</span>
    <span class="strong"><strong>@Rollback</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> modifyDatabaseWithinTransaction() {
        <span class="hl-comment">// logic which uses the test data and modifies database state</span>
    }

    <em><span class="hl-annotation" style="color: gray">@After</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> tearDownWithinTransaction() {
        <span class="hl-comment">// execute "tear down" logic within the transaction</span>
    }

    <span class="strong"><strong>@AfterTransaction</strong></span>
    <span class="hl-keyword">void</span> verifyFinalDatabaseState() {
        <span class="hl-comment">// logic to verify the final state after transaction has rolled back</span>
    }

}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: Avoid false positives when testing ORM code"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left"><a name="testcontext-tx-false-positives" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-false-positives"></a>Avoid false positives when testing ORM code</th></tr><tr><td align="left" valign="top">

<p>When you test application code that manipulates the state of a Hibernate session or JPA
persistence context, make sure to <span class="emphasis"><em>flush</em></span> the underlying unit of work within test
methods that execute that code. Failing to flush the underlying unit of work can produce
<span class="emphasis"><em>false positives</em></span>: your test may pass, but the same code throws an exception in a live,
production environment. In the following Hibernate-based example test case, one method
demonstrates a false positive, and the other method correctly exposes the results of
flushing the session. Note that this applies to any ORM frameworks that maintain an
in-memory <span class="emphasis"><em>unit of work</em></span>.</p>
<pre class="programlisting"><span class="hl-comment">// ...</span>

<em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
SessionFactory sessionFactory;

<em><span class="hl-annotation" style="color: gray">@Transactional</span></em>
<em><span class="hl-annotation" style="color: gray">@Test</span></em> <span class="hl-comment">// no expected exception!</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> falsePositive() {
    updateEntityInHibernateSession();
    <span class="hl-comment">// False positive: an exception will be thrown once the Hibernate</span>
    <span class="hl-comment">// Session is finally flushed (i.e., in production code)</span>
}

<em><span class="hl-annotation" style="color: gray">@Transactional</span></em>
<em><span class="hl-annotation" style="color: gray">@Test(expected = ...)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateWithSessionFlush() {
    updateEntityInHibernateSession();
    <span class="hl-comment">// Manual flush is required to avoid false positive in test</span>
    sessionFactory.getCurrentSession().flush();
}

<span class="hl-comment">// ...</span></pre>
<p>Or for JPA:</p>
<pre class="programlisting"><span class="hl-comment">// ...</span>

<em><span class="hl-annotation" style="color: gray">@PersistenceContext</span></em>
EntityManager entityManager;

<em><span class="hl-annotation" style="color: gray">@Transactional</span></em>
<em><span class="hl-annotation" style="color: gray">@Test</span></em> <span class="hl-comment">// no expected exception!</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> falsePositive() {
    updateEntityInJpaPersistenceContext();
    <span class="hl-comment">// False positive: an exception will be thrown once the JPA</span>
    <span class="hl-comment">// EntityManager is finally flushed (i.e., in production code)</span>
}

<em><span class="hl-annotation" style="color: gray">@Transactional</span></em>
<em><span class="hl-annotation" style="color: gray">@Test(expected = ...)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateWithEntityManagerFlush() {
    updateEntityInJpaPersistenceContext();
    <span class="hl-comment">// Manual flush is required to avoid false positive in test</span>
    entityManager.flush();
}

<span class="hl-comment">// ...</span></pre>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-executing-sql" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql"></a>15.5.8&nbsp;Executing SQL scripts</h3></div></div></div>

<p>When writing integration tests against a relational database, it is often beneficial
to execute SQL scripts to modify the database schema or insert test data into tables.
The <code class="literal">spring-jdbc</code> module provides support for <span class="emphasis"><em>initializing</em></span> an embedded or existing
database by executing SQL scripts when the Spring <code class="literal">ApplicationContext</code> is loaded. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-support" title="19.8 Embedded database support">Section&nbsp;19.8, “Embedded database support”</a> and <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-dao-testing" title="19.8.5 Testing data access logic with an embedded database">Section&nbsp;19.8.5, “Testing data access logic with an embedded database”</a> for
details.</p>
<p>Although it is very useful to initialize a database for testing <span class="emphasis"><em>once</em></span> when the
<code class="literal">ApplicationContext</code> is loaded, sometimes it is essential to be able to modify the
database <span class="emphasis"><em>during</em></span> integration tests. The following sections explain how to execute SQL
scripts programmatically and declaratively during integration tests.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-executing-sql-programmatically" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql-programmatically"></a>Executing SQL scripts programmatically</h4></div></div></div>

<p>Spring provides the following options for executing SQL scripts programmatically within
integration test methods.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">org.springframework.jdbc.datasource.init.ScriptUtils</code>
</li><li class="listitem">
<code class="literal">org.springframework.jdbc.datasource.init.ResourceDatabasePopulator</code>
</li><li class="listitem">
<code class="literal">org.springframework.test.context.junit4.AbstractTransactionalJUnit4SpringContextTests</code>
</li><li class="listitem">
<code class="literal">org.springframework.test.context.testng.AbstractTransactionalTestNGSpringContextTests</code>
</li></ul></div>
<p><code class="literal">ScriptUtils</code> provides a collection of static utility methods for working with SQL scripts
and is mainly intended for internal use within the framework. However, if you require
full control over how SQL scripts are parsed and executed, <code class="literal">ScriptUtils</code> may suit your
needs better than some of the other alternatives described below. Consult the javadocs for
individual methods in <code class="literal">ScriptUtils</code> for further details.</p>
<p><code class="literal">ResourceDatabasePopulator</code> provides a simple object-based API for programmatically
populating, initializing, or cleaning up a database using SQL scripts defined in
external resources. <code class="literal">ResourceDatabasePopulator</code> provides options for configuring the
character encoding, statement separator, comment delimiters, and error handling flags
used when parsing and executing the scripts, and each of the configuration options has
a reasonable default value. Consult the javadocs for details on default values. To
execute the scripts configured in a <code class="literal">ResourceDatabasePopulator</code>, you can invoke either
the <code class="literal">populate(Connection)</code> method to execute the populator against a
<code class="literal">java.sql.Connection</code> or the <code class="literal">execute(DataSource)</code> method to execute the populator
against a <code class="literal">javax.sql.DataSource</code>. The following example specifies SQL scripts for a test
schema and test data, sets the statement separator to <code class="literal">"@@"</code>, and then executes the
scripts against a <code class="literal">DataSource</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Test</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> databaseTest {
    ResourceDatabasePopulator populator = <span class="hl-keyword">new</span> ResourceDatabasePopulator();
    populator.addScripts(
        <span class="hl-keyword">new</span> ClassPathResource(<span class="hl-string">"test-schema.sql"</span>),
        <span class="hl-keyword">new</span> ClassPathResource(<span class="hl-string">"test-data.sql"</span>));
    populator.setSeparator(<span class="hl-string">"@@"</span>);
    populator.execute(<span class="hl-keyword">this</span>.dataSource);
    <span class="hl-comment">// execute code that uses the test schema and data</span>
}</pre>
<p>Note that <code class="literal">ResourceDatabasePopulator</code> internally delegates to <code class="literal">ScriptUtils</code> for parsing
and executing SQL scripts. Similarly, the <code class="literal">executeSqlScript(..)</code> methods in
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-junit4" title="JUnit 4 support classes"><code class="literal">AbstractTransactionalJUnit4SpringContextTests</code></a> and
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-testng" title="TestNG support classes"><code class="literal">AbstractTransactionalTestNGSpringContextTests</code></a>
internally use a <code class="literal">ResourceDatabasePopulator</code> for executing SQL scripts. Consult the javadocs
for the various <code class="literal">executeSqlScript(..)</code> methods for further details.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-executing-sql-declaratively" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql-declaratively"></a>Executing SQL scripts declaratively with @Sql</h4></div></div></div>

<p>In addition to the aforementioned mechanisms for executing SQL scripts
<span class="emphasis"><em>programmatically</em></span>, SQL scripts can also be configured <span class="emphasis"><em>declaratively</em></span> in the Spring
TestContext Framework. Specifically, the <code class="literal">@Sql</code> annotation can be declared on a test
class or test method to configure the resource paths to SQL scripts that should be
executed against a given database either before or after an integration test method. Note
that method-level declarations override class-level declarations and that support for
<code class="literal">@Sql</code> is provided by the <code class="literal">SqlScriptsTestExecutionListener</code> which is enabled by default.</p>
<p><span class="strong"><strong>Path resource semantics</strong></span></p>
<p>Each path will be interpreted as a Spring <code class="literal">Resource</code>. A plain path&#8201;—&#8201;for example,
<code class="literal">"schema.sql"</code>&#8201;—&#8201;will be treated as a classpath resource that is <span class="emphasis"><em>relative</em></span> to the
package in which the test class is defined. A path starting with a slash will be treated
as an <span class="emphasis"><em>absolute</em></span> classpath resource, for example: <code class="literal">"/org/example/schema.sql"</code>. A path
which references a URL (e.g., a path prefixed with <code class="literal">classpath:</code>, <code class="literal">file:</code>, <code class="literal">http:</code>, etc.)
will be loaded using the specified resource protocol.</p>
<p>The following example demonstrates how to use <code class="literal">@Sql</code> at the class level and at the method
level within a JUnit 4 based integration test class.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@Sql("/test-schema.sql")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DatabaseTests {

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> emptySchemaTest {
        <span class="hl-comment">// execute code that uses the test schema without any test data</span>
    }

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <em><span class="hl-annotation" style="color: gray">@Sql({"/test-schema.sql", "/test-user-data.sql"})</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> userTest {
        <span class="hl-comment">// execute code that uses the test schema and test data</span>
    }
}</pre>
<p><span class="strong"><strong>Default script detection</strong></span></p>
<p>If no SQL scripts are specified, an attempt will be made to detect a <code class="literal">default</code> script
depending on where <code class="literal">@Sql</code> is declared. If a default cannot be detected, an
<code class="literal">IllegalStateException</code> will be thrown.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>class-level declaration</em></span>: if the annotated test class is <code class="literal">com.example.MyTest</code>, the
corresponding default script is <code class="literal">"classpath:com/example/MyTest.sql"</code>.
</li><li class="listitem">
<span class="emphasis"><em>method-level declaration</em></span>: if the annotated test method is named <code class="literal">testMethod()</code> and is
defined in the class <code class="literal">com.example.MyTest</code>, the corresponding default script is
<code class="literal">"classpath:com/example/MyTest.testMethod.sql"</code>.
</li></ul></div>
<p><span class="strong"><strong>Declaring multiple <code class="literal">@Sql</code> sets</strong></span></p>
<p>If multiple sets of SQL scripts need to be configured for a given test class or test
method but with different syntax configuration, different error handling rules, or
different execution phases per set, it is possible to declare multiple instances of
<code class="literal">@Sql</code>. With Java 8, <code class="literal">@Sql</code> can be used as a <span class="emphasis"><em>repeatable</em></span> annotation. Otherwise, the
<code class="literal">@SqlGroup</code> annotation can be used as an explicit container for declaring multiple
instances of <code class="literal">@Sql</code>.</p>
<p>The following example demonstrates the use of <code class="literal">@Sql</code> as a repeatable annotation using
Java 8. In this scenario the <code class="literal">test-schema.sql</code> script uses a different syntax for
single-line comments.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Test</span></em>
<em><span class="hl-annotation" style="color: gray">@Sql(scripts = "/test-schema.sql", config = @SqlConfig(commentPrefix = "`"))</span></em>
<em><span class="hl-annotation" style="color: gray">@Sql("/test-user-data.sql")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> userTest {
    <span class="hl-comment">// execute code that uses the test schema and test data</span>
}</pre>
<p>The following example is identical to the above except that the <code class="literal">@Sql</code> declarations are
grouped together within <code class="literal">@SqlGroup</code> for compatibility with Java 6 and Java 7.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Test</span></em>
<em><span class="hl-annotation" style="color: gray">@SqlGroup({
    @Sql(scripts = "/test-schema.sql", config = @SqlConfig(commentPrefix = "`")),
    @Sql("/test-user-data.sql")
)}</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> userTest {
    <span class="hl-comment">// execute code that uses the test schema and test data</span>
}</pre>
<p><span class="strong"><strong>Script execution phases</strong></span></p>
<p>By default, SQL scripts will be executed <span class="emphasis"><em>before</em></span> the corresponding test method. However,
if a particular set of scripts needs to be executed <span class="emphasis"><em>after</em></span> the test method&#8201;—&#8201;for
example, to clean up database state&#8201;—&#8201;the <code class="literal">executionPhase</code> attribute in <code class="literal">@Sql</code> can be
used as seen in the following example. Note that <code class="literal">ISOLATED</code> and <code class="literal">AFTER_TEST_METHOD</code> are
statically imported from <code class="literal">Sql.TransactionMode</code> and <code class="literal">Sql.ExecutionPhase</code> respectively.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Test</span></em>
<em><span class="hl-annotation" style="color: gray">@Sql(
    scripts = "create-test-data.sql",
    config = @SqlConfig(transactionMode = ISOLATED)
)</span></em>
<em><span class="hl-annotation" style="color: gray">@Sql(
    scripts = "delete-test-data.sql",
    config = @SqlConfig(transactionMode = ISOLATED),
    executionPhase = AFTER_TEST_METHOD
)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> userTest {
    <span class="hl-comment">// execute code that needs the test data to be committed</span>
    <span class="hl-comment">// to the database outside of the test's transaction</span>
}</pre>
<p><span class="strong"><strong>Script configuration with <code class="literal">@SqlConfig</code></strong></span></p>
<p>Configuration for script parsing and error handling can be configured via the
<code class="literal">@SqlConfig</code> annotation. When declared as a class-level annotation on an integration test
class, <code class="literal">@SqlConfig</code> serves as <span class="emphasis"><em>global</em></span> configuration for all SQL scripts within the test
class hierarchy. When declared directly via the <code class="literal">config</code> attribute of the <code class="literal">@Sql</code>
annotation, <code class="literal">@SqlConfig</code> serves as <span class="emphasis"><em>local</em></span> configuration for the SQL scripts declared
within the enclosing <code class="literal">@Sql</code> annotation. Every attribute in <code class="literal">@SqlConfig</code> has an implicit
default value which is documented in the javadocs of the corresponding attribute. Due to
the rules defined for annotation attributes in the Java Language Specification, it is
unfortunately not possible to assign a value of <code class="literal">null</code> to an annotation attribute. Thus,
in order to support overrides of inherited global configuration, <code class="literal">@SqlConfig</code> attributes
have an explicit default value of either <code class="literal">""</code> for Strings or <code class="literal">DEFAULT</code> for Enums. This
approach allows local declarations of <code class="literal">@SqlConfig</code> to selectively override individual
attributes from global declarations of <code class="literal">@SqlConfig</code> by providing a value other than <code class="literal">""</code>
or <code class="literal">DEFAULT</code>. Global <code class="literal">@SqlConfig</code> attributes are inherited whenever local <code class="literal">@SqlConfig</code>
attributes do not supply an explicit value other than <code class="literal">""</code> or <code class="literal">DEFAULT</code>. Explicit <span class="emphasis"><em>local</em></span>
configuration therefore overrides <span class="emphasis"><em>global</em></span> configuration.</p>
<p>The configuration options provided by <code class="literal">@Sql</code> and <code class="literal">@SqlConfig</code> are equivalent to those
supported by <code class="literal">ScriptUtils</code> and <code class="literal">ResourceDatabasePopulator</code> but are a superset of those
provided by the <code class="literal">&lt;jdbc:initialize-database/&gt;</code> XML namespace element. Consult the javadocs
of individual attributes in <code class="literal">@Sql</code> and <code class="literal">@SqlConfig</code> for details.</p>
<p><a name="testcontext-executing-sql-declaratively-tx" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-executing-sql-declaratively-tx"></a><span class="strong"><strong>Transaction management for <code class="literal">@Sql</code></strong></span></p>
<p>By default, the <code class="literal">SqlScriptsTestExecutionListener</code> will infer the desired transaction
semantics for scripts configured via <code class="literal">@Sql</code>. Specifically, SQL scripts will be executed
without a transaction, within an existing Spring-managed transaction&#8201;—&#8201;for example, a
transaction managed by the <code class="literal">TransactionalTestExecutionListener</code> for a test annotated with
<code class="literal">@Transactional</code>&#8201;—&#8201;or within an isolated transaction, depending on the configured value
of the <code class="literal">transactionMode</code> attribute in <code class="literal">@SqlConfig</code> and the presence of a
<code class="literal">PlatformTransactionManager</code> in the test’s <code class="literal">ApplicationContext</code>. As a bare minimum
however, a <code class="literal">javax.sql.DataSource</code> must be present in the test’s <code class="literal">ApplicationContext</code>.</p>
<p>If the algorithms used by <code class="literal">SqlScriptsTestExecutionListener</code> to detect a <code class="literal">DataSource</code> and
<code class="literal">PlatformTransactionManager</code> and infer the transaction semantics do not suit your needs,
you may specify explicit names via the <code class="literal">dataSource</code> and <code class="literal">transactionManager</code> attributes
of <code class="literal">@SqlConfig</code>. Furthermore, the transaction propagation behavior can be controlled via
the <code class="literal">transactionMode</code> attribute of <code class="literal">@SqlConfig</code>&#8201;—&#8201;for example, if scripts should be
executed in an isolated transaction. Although a thorough discussion of all supported
options for transaction management with <code class="literal">@Sql</code> is beyond the scope of this reference
manual, the javadocs for <code class="literal">@SqlConfig</code> and <code class="literal">SqlScriptsTestExecutionListener</code> provide
detailed information, and the following example demonstrates a typical testing scenario
using JUnit 4 and transactional tests with <code class="literal">@Sql</code>. Note that there is no need to clean up
the database after the <code class="literal">usersTest()</code> method is executed since any changes made to the
database (either within the test method or within the <code class="literal">/test-data.sql</code> script) will
be automatically rolled back by the <code class="literal">TransactionalTestExecutionListener</code> (see
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx" title="15.5.7 Transaction management">transaction management</a> for details).</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration(classes = TestDatabaseConfig.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@Transactional</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransactionalSqlScriptsTests {

    <span class="hl-keyword">protected</span> JdbcTemplate jdbcTemplate;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <em><span class="hl-annotation" style="color: gray">@Sql("/test-data.sql")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> usersTest() {
        <span class="hl-comment">// verify state in test database:</span>
        assertNumUsers(<span class="hl-number">2</span>);
        <span class="hl-comment">// execute code that uses the test data...</span>
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">int</span> countRowsInTable(String tableName) {
        <span class="hl-keyword">return</span> JdbcTestUtils.countRowsInTable(<span class="hl-keyword">this</span>.jdbcTemplate, tableName);
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> assertNumUsers(<span class="hl-keyword">int</span> expected) {
        assertEquals(<span class="hl-string">"Number of rows in the [user] table."</span>, expected, countRowsInTable(<span class="hl-string">"user"</span>));
    }
}</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="testcontext-support-classes" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes"></a>15.5.9&nbsp;TestContext Framework support classes</h3></div></div></div>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-junit4-runner" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-junit4-runner"></a>Spring JUnit 4 Runner</h4></div></div></div>

<p>The <span class="emphasis"><em>Spring TestContext Framework</em></span> offers full integration with JUnit 4 through a
custom runner (supported on JUnit 4.12 or higher). By annotating test classes with
<code class="literal">@RunWith(SpringJUnit4ClassRunner.class)</code> or the shorter <code class="literal">@RunWith(SpringRunner.class)</code>
variant, developers can implement standard JUnit 4 based unit and integration tests and
simultaneously reap the benefits of the TestContext framework such as support for loading
application contexts, dependency injection of test instances, transactional test method
execution, and so on. If you would like to use the Spring TestContext Framework with an
alternative runner such as JUnit 4’s <code class="literal">Parameterized</code> or third-party runners such as the
<code class="literal">MockitoJUnitRunner</code>, you may optionally use <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-junit4-rules" title="Spring JUnit 4 Rules">Spring’s support
for JUnit rules</a> instead.</p>
<p>The following code listing displays the minimal requirements for configuring a test class
to run with the custom Spring <code class="literal">Runner</code>. <code class="literal">@TestExecutionListeners</code> is configured with an
empty list in order to disable the default listeners, which otherwise would require an
<code class="literal">ApplicationContext</code> to be configured through <code class="literal">@ContextConfiguration</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@TestExecutionListeners({})</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleTest {

   <em><span class="hl-annotation" style="color: gray">@Test</span></em>
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testMethod() {
      <span class="hl-comment">// execute test logic...</span>
   }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-junit4-rules" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-junit4-rules"></a>Spring JUnit 4 Rules</h4></div></div></div>

<p>The <code class="literal">org.springframework.test.context.junit4.rules</code> package provides the following JUnit
4 rules (supported on JUnit 4.12 or higher).</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">SpringClassRule</code>
</li><li class="listitem">
<code class="literal">SpringMethodRule</code>
</li></ul></div>
<p><code class="literal">SpringClassRule</code> is a JUnit <code class="literal">TestRule</code> that supports <span class="emphasis"><em>class-level</em></span> features of the
<span class="emphasis"><em>Spring TestContext Framework</em></span>; whereas, <code class="literal">SpringMethodRule</code> is a JUnit <code class="literal">MethodRule</code> that
supports instance-level and method-level features of the <span class="emphasis"><em>Spring TestContext Framework</em></span>.</p>
<p>In contrast to the <code class="literal">SpringRunner</code>, Spring’s rule-based JUnit support has the advantage
that it is independent of any <code class="literal">org.junit.runner.Runner</code> implementation and can therefore
be combined with existing alternative runners like JUnit 4’s <code class="literal">Parameterized</code> or third-party
runners such as the <code class="literal">MockitoJUnitRunner</code>.</p>
<p>In order to support the full functionality of the TestContext framework, a
<code class="literal">SpringClassRule</code> must be combined with a <code class="literal">SpringMethodRule</code>. The following example
demonstrates the proper way to declare these rules in an integration test.</p>
<pre class="programlisting"><span class="hl-comment">// Optionally specify a non-Spring Runner via @RunWith(...)</span>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> IntegrationTest {

   <em><span class="hl-annotation" style="color: gray">@ClassRule</span></em>
   <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> SpringClassRule SPRING_CLASS_RULE = <span class="hl-keyword">new</span> SpringClassRule();

   <em><span class="hl-annotation" style="color: gray">@Rule</span></em>
   <span class="hl-keyword">public</span> <span class="hl-keyword">final</span> SpringMethodRule springMethodRule = <span class="hl-keyword">new</span> SpringMethodRule();

   <em><span class="hl-annotation" style="color: gray">@Test</span></em>
   <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testMethod() {
      <span class="hl-comment">// execute test logic...</span>
   }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-support-classes-junit4" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-junit4"></a>JUnit 4 support classes</h4></div></div></div>

<p>The <code class="literal">org.springframework.test.context.junit4</code> package provides the following support
classes for JUnit 4 based test cases (supported on JUnit 4.12 or higher).</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">AbstractJUnit4SpringContextTests</code>
</li><li class="listitem">
<code class="literal">AbstractTransactionalJUnit4SpringContextTests</code>
</li></ul></div>
<p><code class="literal">AbstractJUnit4SpringContextTests</code> is an abstract base test class that integrates the
<span class="emphasis"><em>Spring TestContext Framework</em></span> with explicit <code class="literal">ApplicationContext</code> testing support in
a JUnit 4 environment. When you extend <code class="literal">AbstractJUnit4SpringContextTests</code>, you can
access a <code class="literal">protected</code> <code class="literal">applicationContext</code> instance variable that can be used to perform
explicit bean lookups or to test the state of the context as a whole.</p>
<p><code class="literal">AbstractTransactionalJUnit4SpringContextTests</code> is an abstract <span class="emphasis"><em>transactional</em></span> extension
of <code class="literal">AbstractJUnit4SpringContextTests</code> that adds some convenience functionality for JDBC
access. This class expects a <code class="literal">javax.sql.DataSource</code> bean and a <code class="literal">PlatformTransactionManager</code>
bean to be defined in the <code class="literal">ApplicationContext</code>. When you extend
<code class="literal">AbstractTransactionalJUnit4SpringContextTests</code> you can access a <code class="literal">protected</code> <code class="literal">jdbcTemplate</code>
instance variable that can be used to execute SQL statements to query the database. Such
queries can be used to confirm database state both <span class="emphasis"><em>prior to</em></span> and <span class="emphasis"><em>after</em></span> execution of
database-related application code, and Spring ensures that such queries run in the scope of
the same transaction as the application code. When used in conjunction with an ORM tool,
be sure to avoid <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-false-positives" title="Avoid false positives when testing ORM code">false positives</a>. As mentioned in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-support-jdbc" title="15.3 JDBC Testing Support">Section&nbsp;15.3, “JDBC Testing Support”</a>, <code class="literal">AbstractTransactionalJUnit4SpringContextTests</code>
also provides convenience methods which delegate to methods in <code class="literal">JdbcTestUtils</code> using the
aforementioned <code class="literal">jdbcTemplate</code>. Furthermore, <code class="literal">AbstractTransactionalJUnit4SpringContextTests</code>
provides an <code class="literal">executeSqlScript(..)</code> method for executing SQL scripts against the configured
<code class="literal">DataSource</code>.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>These classes are a convenience for extension. If you do not want your test classes to be
tied to a Spring-specific class hierarchy, you can configure your own custom test classes
by using <code class="literal">@RunWith(SpringRunner.class)</code> or <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-junit4-rules" title="Spring JUnit 4 Rules">Spring’s
JUnit rules</a>.</p>
</td></tr></tbody></table></div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="testcontext-support-classes-testng" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-support-classes-testng"></a>TestNG support classes</h4></div></div></div>

<p>The <code class="literal">org.springframework.test.context.testng</code> package provides the following support
classes for TestNG based test cases.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">AbstractTestNGSpringContextTests</code>
</li><li class="listitem">
<code class="literal">AbstractTransactionalTestNGSpringContextTests</code>
</li></ul></div>
<p><code class="literal">AbstractTestNGSpringContextTests</code> is an abstract base test class that integrates the
<span class="emphasis"><em>Spring TestContext Framework</em></span> with explicit <code class="literal">ApplicationContext</code> testing support in
a TestNG environment. When you extend <code class="literal">AbstractTestNGSpringContextTests</code>, you can
access a <code class="literal">protected</code> <code class="literal">applicationContext</code> instance variable that can be used to perform
explicit bean lookups or to test the state of the context as a whole.</p>
<p><code class="literal">AbstractTransactionalTestNGSpringContextTests</code> is an abstract <span class="emphasis"><em>transactional</em></span> extension
of <code class="literal">AbstractTestNGSpringContextTests</code> that adds some convenience functionality for JDBC
access. This class expects a <code class="literal">javax.sql.DataSource</code> bean and a <code class="literal">PlatformTransactionManager</code>
bean to be defined in the <code class="literal">ApplicationContext</code>. When you extend
<code class="literal">AbstractTransactionalTestNGSpringContextTests</code> you can access a <code class="literal">protected</code> <code class="literal">jdbcTemplate</code>
instance variable that can be used to execute SQL statements to query the database. Such
queries can be used to confirm database state both <span class="emphasis"><em>prior to</em></span> and <span class="emphasis"><em>after</em></span> execution of
database-related application code, and Spring ensures that such queries run in the scope of
the same transaction as the application code. When used in conjunction with an ORM tool,
be sure to avoid <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testcontext-tx-false-positives" title="Avoid false positives when testing ORM code">false positives</a>. As mentioned in
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#integration-testing-support-jdbc" title="15.3 JDBC Testing Support">Section&nbsp;15.3, “JDBC Testing Support”</a>, <code class="literal">AbstractTransactionalTestNGSpringContextTests</code>
also provides convenience methods which delegate to methods in <code class="literal">JdbcTestUtils</code> using the
aforementioned <code class="literal">jdbcTemplate</code>. Furthermore, <code class="literal">AbstractTransactionalTestNGSpringContextTests</code>
provides an <code class="literal">executeSqlScript(..)</code> method for executing SQL scripts against the configured
<code class="literal">DataSource</code>.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>These classes are a convenience for extension. If you do not want your test classes to be
tied to a Spring-specific class hierarchy, you can configure your own custom test classes
by using <code class="literal">@ContextConfiguration</code>, <code class="literal">@TestExecutionListeners</code>, and so on, and by manually
instrumenting your test class with a <code class="literal">TestContextManager</code>. See the source code of
<code class="literal">AbstractTestNGSpringContextTests</code> for an example of how to instrument your test class.</p>
</td></tr></tbody></table></div>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-test-framework" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-framework"></a>15.6&nbsp;Spring MVC Test Framework</h2></div></div></div>

<p>The <span class="emphasis"><em>Spring MVC Test framework</em></span> provides first class support for testing Spring MVC
code using a fluent API that can be used with JUnit, TestNG, or any other testing
framework. It’s built on the
<a class="ulink" href="http://docs.spring.io/spring-framework/docs/4.3.8.RELEASE/javadoc-api/org/springframework/mock/web/package-summary.html" target="_top">Servlet API mock objects</a>
from the <code class="literal">spring-test</code> module and hence does <span class="emphasis"><em>not</em></span> use a running Servlet container. It
uses the <code class="literal">DispatcherServlet</code> to provide full Spring MVC runtime behavior and provides support
for loading actual Spring configuration with the <span class="emphasis"><em>TestContext framework</em></span> in addition to a
standalone mode in which controllers may be instantiated manually and tested one at a time.</p>
<p><span class="emphasis"><em>Spring MVC Test</em></span> also provides client-side support for testing code that uses
the <code class="literal">RestTemplate</code>. Client-side tests mock the server responses and also do <span class="emphasis"><em>not</em></span>
use a running server.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Spring Boot provides an option to write full, end-to-end integration tests that include
a running server. If this is your goal please have a look at the
<a class="ulink" href="http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html#boot-features-testing-spring-boot-applications" target="_top">Spring Boot reference page</a>.
For more information on the differences between out-of-container and end-to-end
integration tests, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-vs-end-to-end-integration-tests" title="Differences between Out-of-Container and End-to-End Integration Tests">the section called “Differences between Out-of-Container and End-to-End Integration Tests”</a>.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-test-server" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server"></a>15.6.1&nbsp;Server-Side Tests</h3></div></div></div>

<p>It’s easy to write a plain unit test for a Spring MVC controller using JUnit or TestNG:
simply instantiate the controller, inject it with mocked or stubbed dependencies, and call
its methods passing <code class="literal">MockHttpServletRequest</code>, <code class="literal">MockHttpServletResponse</code>, etc., as necessary.
However, when writing such a unit test, much remains untested: for example, request
mappings, data binding, type conversion, validation, and much more. Furthermore, other
controller methods such as <code class="literal">@InitBinder</code>, <code class="literal">@ModelAttribute</code>, and <code class="literal">@ExceptionHandler</code> may
also be invoked as part of the request processing lifecycle.</p>
<p>The goal of <span class="emphasis"><em>Spring MVC Test</em></span> is to provide an effective way for testing controllers
by performing requests and generating responses through the actual <code class="literal">DispatcherServlet</code>.</p>
<p><span class="emphasis"><em>Spring MVC Test</em></span> builds on the familiar <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mock-objects-servlet" title="14.1.3 Servlet API">"mock" implementations
of the Servlet API</a> available in the <code class="literal">spring-test</code> module. This allows performing
requests and generating responses without the need for running in a Servlet container.
For the most part everything should work as it does at runtime with a few notable
exceptions as explained in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-vs-end-to-end-integration-tests" title="Differences between Out-of-Container and End-to-End Integration Tests">the section called “Differences between Out-of-Container and End-to-End Integration Tests”</a>. Here is a
JUnit 4 based example of using Spring MVC Test:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> <span class="hl-keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
<span class="hl-keyword">import</span> <span class="hl-keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

<em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration("test-servlet-context.xml")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleTests {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <em><span class="hl-annotation" style="color: gray">@Before</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
        <span class="hl-keyword">this</span>.mockMvc = MockMvcBuilders.webAppContextSetup(<span class="hl-keyword">this</span>.wac).build();
    }

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> getAccount() <span class="hl-keyword">throws</span> Exception {
        <span class="hl-keyword">this</span>.mockMvc.perform(get(<span class="hl-string">"/accounts/1"</span>).accept(MediaType.parseMediaType(<span class="hl-string">"application/json;charset=UTF-8"</span>)))
            .andExpect(status().isOk())
            .andExpect(content().contentType(<span class="hl-string">"application/json"</span>))
            .andExpect(jsonPath(<span class="hl-string">"$.name"</span>).value(<span class="hl-string">"Lee"</span>));
    }

}</pre>
<p>The above test relies on the <code class="literal">WebApplicationContext</code> support of the <span class="emphasis"><em>TestContext framework</em></span>
for loading Spring configuration from an XML configuration file located in the same package
as the test class, but Java-based and Groovy-based configuration are also supported. See these
<a class="ulink" href="https://github.com/spring-projects/spring-framework/tree/master/spring-test/src/test/java/org/springframework/test/web/servlet/samples/context" target="_top">sample tests</a>.</p>
<p>The <code class="literal">MockMvc</code> instance is used to perform a <code class="literal">GET</code> request to <code class="literal">"/accounts/1"</code> and verify
that the resulting response has status 200, the content type is <code class="literal">"application/json"</code>, and the
response body has a JSON property called "name" with the value "Lee". The <code class="literal">jsonPath</code>
syntax is supported through the Jayway <a class="ulink" href="https://github.com/jayway/JsonPath" target="_top">JsonPath
project</a>. There are lots of other options for verifying the result of the performed
request that will be discussed below.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-static-imports" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-static-imports"></a>Static Imports</h4></div></div></div>

<p>The fluent API in the example above requires a few static imports such as
<code class="literal">MockMvcRequestBuilders.*</code>, <code class="literal">MockMvcResultMatchers.*</code>,
and <code class="literal">MockMvcBuilders.*</code>. An easy way to find these classes is to search for
types matching <span class="emphasis"><em>"MockMvc*"</em></span>. If using Eclipse, be sure to add them as
"favorite static members" in the Eclipse preferences under
<span class="emphasis"><em>Java &#8594; Editor &#8594; Content Assist &#8594; Favorites</em></span>. That will allow use of content
assist after typing the first character of the static method name. Other IDEs (e.g.
IntelliJ) may not require any additional configuration. Just check the support for code
completion on static members.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-setup-options" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-setup-options"></a>Setup Options</h4></div></div></div>

<p>There are two main options for creating an instance of <code class="literal">MockMvc</code>.
The first is to load Spring MVC configuration through the <span class="emphasis"><em>TestContext
framework</em></span>, which loads the Spring configuration and injects a <code class="literal">WebApplicationContext</code>
into the test to use to build a <code class="literal">MockMvc</code> instance:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration("my-servlet-context.xml")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebTests {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <em><span class="hl-annotation" style="color: gray">@Before</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
        <span class="hl-keyword">this</span>.mockMvc = MockMvcBuilders.webAppContextSetup(<span class="hl-keyword">this</span>.wac).build();
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>The second is to simply create a controller instance manually without loading Spring
configuration. Instead basic default configuration, roughly comparable to that of
the MVC JavaConfig or the MVC namespace, is automatically created and can be customized
to a degree:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebTests {

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <em><span class="hl-annotation" style="color: gray">@Before</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
        <span class="hl-keyword">this</span>.mockMvc = MockMvcBuilders.standaloneSetup(<span class="hl-keyword">new</span> AccountController()).build();
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>Which setup option should you use?</p>
<p>The <span class="emphasis"><em>"webAppContextSetup"</em></span> loads your actual Spring MVC configuration resulting in a
more complete integration test. Since the <span class="emphasis"><em>TestContext framework</em></span> caches the loaded
Spring configuration, it helps keep tests running fast, even as you introduce more tests
in your test suite. Furthermore, you can inject mock services into controllers through
Spring configuration in order to remain focused on testing the web layer. Here is an
example of declaring a mock service with Mockito:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"accountService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.mockito.Mockito"</span> <span class="hl-attribute">factory-method</span>=<span class="hl-value">"mock"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.example.AccountService"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>You can then inject the mock service into the test in order set up and verify
expectations:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@RunWith(SpringRunner.class)</span></em>
<em><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></em>
<em><span class="hl-annotation" style="color: gray">@ContextConfiguration("test-servlet-context.xml")</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountTests {

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">private</span> AccountService accountService;

    <span class="hl-comment">// ...</span>

}</pre>
<p>The <span class="emphasis"><em>"standaloneSetup"</em></span> on the other hand is a little closer to a unit test. It tests
one controller at a time: the controller can be injected with mock dependencies manually,
and it doesn’t involve loading Spring configuration. Such tests are more focused on style
and make it easier to see which controller is being tested, whether any specific Spring
MVC configuration is required to work, and so on. The "standaloneSetup" is also a very
convenient way to write ad-hoc tests to verify specific behavior or to debug an issue.</p>
<p>Just like with any "integration vs. unit testing" debate, there is no right or wrong
answer. However, using the "standaloneSetup" does imply the need for additional
"webAppContextSetup" tests in order to verify your Spring MVC configuration.
Alternatively, you may choose to write all tests with "webAppContextSetup" in order to
always test against your actual Spring MVC configuration.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-performing-requests" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-performing-requests"></a>Performing Requests</h4></div></div></div>

<p>It’s easy to perform requests using any HTTP method:</p>
<pre class="programlisting">mockMvc.perform(post(<span class="hl-string">"/hotels/{id}"</span>, <span class="hl-number">42</span>).accept(MediaType.APPLICATION_JSON));</pre>
<p>You can also perform file upload requests that internally use
<code class="literal">MockMultipartHttpServletRequest</code> so that there is no actual parsing of a multipart
request but rather you have to set it up:</p>
<pre class="programlisting">mockMvc.perform(fileUpload(<span class="hl-string">"/doc"</span>).file(<span class="hl-string">"a1"</span>, <span class="hl-string">"ABC"</span>.getBytes(<span class="hl-string">"UTF-8"</span>)));</pre>
<p>You can specify query parameters in URI template style:</p>
<pre class="programlisting">mockMvc.perform(get(<span class="hl-string">"/hotels?foo={foo}"</span>, <span class="hl-string">"bar"</span>));</pre>
<p>Or you can add Servlet request parameters representing either query of form parameters:</p>
<pre class="programlisting">mockMvc.perform(get(<span class="hl-string">"/hotels"</span>).param(<span class="hl-string">"foo"</span>, <span class="hl-string">"bar"</span>));</pre>
<p>If application code relies on Servlet request parameters and doesn’t check the query
string explicitly (as is most often the case) then it doesn’t matter which option you use.
Keep in mind however that query params provided with the URI template will be decoded while
request parameters provided through the <code class="literal">param(…&#8203;)</code> method are expected to already be decoded.</p>
<p>In most cases it’s preferable to leave out the context path and the Servlet path from
the request URI. If you must test with the full request URI, be sure to set the
<code class="literal">contextPath</code> and <code class="literal">servletPath</code> accordingly so that request mappings will work:</p>
<pre class="programlisting">mockMvc.perform(get(<span class="hl-string">"/app/main/hotels/{id}"</span>).contextPath(<span class="hl-string">"/app"</span>).servletPath(<span class="hl-string">"/main"</span>))</pre>
<p>Looking at the above example, it would be cumbersome to set the contextPath and
servletPath with every performed request. Instead you can set up default request
properties:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebTests {

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <em><span class="hl-annotation" style="color: gray">@Before</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
        mockMvc = standaloneSetup(<span class="hl-keyword">new</span> AccountController())
            .defaultRequest(get(<span class="hl-string">"/"</span>)
            .contextPath(<span class="hl-string">"/app"</span>).servletPath(<span class="hl-string">"/main"</span>)
            .accept(MediaType.APPLICATION_JSON).build();
    }</pre>
<p>The above properties will affect every request performed through the <code class="literal">MockMvc</code> instance.
If the same property is also specified on a given request, it overrides the default value.
That is why the HTTP method and URI in the default request don’t matter since they must be
specified on every request.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-defining-expectations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-defining-expectations"></a>Defining Expectations</h4></div></div></div>

<p>Expectations can be defined by appending one or more <code class="literal">.andExpect(..)</code> calls after
performing a request:</p>
<pre class="programlisting">mockMvc.perform(get(<span class="hl-string">"/accounts/1"</span>)).andExpect(status().isOk());</pre>
<p><code class="literal">MockMvcResultMatchers.*</code> provides a number of expectations, some of which are further
nested with more detailed expectations.</p>
<p>Expectations fall in two general categories. The first category of assertions verifies
properties of the response: for example, the response status, headers, and content. These
are the most important results to assert.</p>
<p>The second category of assertions goes beyond the response. These assertions allow
one to inspect Spring MVC specific aspects such as which controller method processed
the request, whether an exception was raised and handled, what the content of the model
is, what view was selected, what flash attributes were added, and so on. They also allow
one to inspect Servlet specific aspects such as request and session attributes.</p>
<p>The following test asserts that binding or validation failed:</p>
<pre class="programlisting">mockMvc.perform(post(<span class="hl-string">"/persons"</span>))
    .andExpect(status().isOk())
    .andExpect(model().attributeHasErrors(<span class="hl-string">"person"</span>));</pre>
<p>Many times when writing tests, it’s useful to <span class="emphasis"><em>dump</em></span> the results of the performed request.
This can be done as follows, where <code class="literal">print()</code> is a static import from
<code class="literal">MockMvcResultHandlers</code>:</p>
<pre class="programlisting">mockMvc.perform(post(<span class="hl-string">"/persons"</span>))
    .andDo(print())
    .andExpect(status().isOk())
    .andExpect(model().attributeHasErrors(<span class="hl-string">"person"</span>));</pre>
<p>As long as request processing does not cause an unhandled exception, the <code class="literal">print()</code> method
will print all the available result data to <code class="literal">System.out</code>. Spring Framework 4.2 introduced
a <code class="literal">log()</code> method and two additional variants of the <code class="literal">print()</code> method, one that accepts
an <code class="literal">OutputStream</code> and one that accepts a <code class="literal">Writer</code>. For example, invoking
<code class="literal">print(System.err)</code> will print the result data to <code class="literal">System.err</code>; while invoking
<code class="literal">print(myWriter)</code> will print the result data to a custom writer. If you would like to
have the result data <span class="emphasis"><em>logged</em></span> instead of printed, simply invoke the <code class="literal">log()</code> method which
will log the result data as a single <code class="literal">DEBUG</code> message under the
<code class="literal">org.springframework.test.web.servlet.result</code> logging category.</p>
<p>In some cases, you may want to get direct access to the result and verify something that
cannot be verified otherwise. This can be achieved by appending <code class="literal">.andReturn()</code> after all
other expectations:</p>
<pre class="programlisting">MvcResult mvcResult = mockMvc.perform(post(<span class="hl-string">"/persons"</span>)).andExpect(status().isOk()).andReturn();
<span class="hl-comment">// ...</span></pre>
<p>If all tests repeat the same expectations you can set up common expectations once
when building the <code class="literal">MockMvc</code> instance:</p>
<pre class="programlisting">standaloneSetup(<span class="hl-keyword">new</span> SimpleController())
    .alwaysExpect(status().isOk())
    .alwaysExpect(content().contentType(<span class="hl-string">"application/json;charset=UTF-8"</span>))
    .build()</pre>
<p>Note that common expectations are <span class="emphasis"><em>always</em></span> applied and cannot be overridden without
creating a separate <code class="literal">MockMvc</code> instance.</p>
<p>When JSON response content contains hypermedia links created with
<a class="ulink" href="https://github.com/spring-projects/spring-hateoas" target="_top">Spring HATEOAS</a>, the resulting links can
be verified using JsonPath expressions:</p>
<pre class="programlisting">mockMvc.perform(get(<span class="hl-string">"/people"</span>).accept(MediaType.APPLICATION_JSON))
    .andExpect(jsonPath(<span class="hl-string">"$.links[?(@.rel == 'self')].href"</span>).value(<span class="hl-string">"http://localhost:8080/people"</span>));</pre>
<p>When XML response content contains hypermedia links created with
<a class="ulink" href="https://github.com/spring-projects/spring-hateoas" target="_top">Spring HATEOAS</a>, the resulting links can
be verified using XPath expressions:</p>
<pre class="programlisting">Map&lt;String, String&gt; ns = Collections.singletonMap(<span class="hl-string">"ns"</span>, <span class="hl-string">"http://www.w3.org/2005/Atom"</span>);
mockMvc.perform(get(<span class="hl-string">"/handle"</span>).accept(MediaType.APPLICATION_XML))
    .andExpect(xpath(<span class="hl-string">"/person/ns:link[@rel='self']/@href"</span>, ns).string(<span class="hl-string">"http://localhost:8080/people"</span>));</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-filters" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-filters"></a>Filter Registrations</h4></div></div></div>

<p>When setting up a <code class="literal">MockMvc</code> instance, you can register one or more Servlet <code class="literal">Filter</code> instances:</p>
<pre class="programlisting">mockMvc = standaloneSetup(<span class="hl-keyword">new</span> PersonController()).addFilters(<span class="hl-keyword">new</span> CharacterEncodingFilter()).build();</pre>
<p>Registered filters will be invoked through via the <code class="literal">MockFilterChain</code> from <code class="literal">spring-test</code>, and the
last filter will delegate to the <code class="literal">DispatcherServlet</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-vs-end-to-end-integration-tests" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-vs-end-to-end-integration-tests"></a>Differences between Out-of-Container and End-to-End Integration Tests</h4></div></div></div>

<p>As mentioned earlier <span class="emphasis"><em>Spring MVC Test</em></span> is built on the Servlet API mock objects from
the <code class="literal">spring-test</code> module and does not use a running Servlet container. Therefore
there are some important differences compared to full end-to-end integration tests
with an actual client and server running.</p>
<p>The easiest way to think about this is starting with a blank <code class="literal">MockHttpServletRequest</code>.
Whatever you add to it is what the request will be. Things that may catch you by surprise
are that there is no context path by default, no <code class="literal">jsessionid</code> cookie, no forwarding, error,
or async dispatches, and therefore no actual JSP rendering. Instead, "forwarded" and
"redirected" URLs are saved in the <code class="literal">MockHttpServletResponse</code> and can be asserted with
expectations.</p>
<p>This means if you are using JSPs you can verify the JSP page to which the request was
forwarded, but there won’t be any HTML rendered. In other words, the JSP will not be
<span class="emphasis"><em>invoked</em></span>. Note however that all other rendering technologies which don’t rely on
forwarding such as Thymeleaf, Freemarker, and Velocity will render HTML to the response
body as expected. The same is true for rendering JSON, XML, and other formats via
<code class="literal">@ResponseBody</code> methods.</p>
<p>Alternatively you may consider the full end-to-end integration testing support from
Spring Boot via <code class="literal">@WebIntegrationTest</code>. See the
<a class="ulink" href="http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html#boot-features-testing-spring-boot-applications" target="_top">Spring Boot reference</a>.</p>
<p>There are pros and cons for each approach. The options provided in <span class="emphasis"><em>Spring MVC Test</em></span>
are different stops on the scale from classic unit testing to full integration testing.
To be certain, none of the options in Spring MVC Test fall under the category of classic
unit testing, but they <span class="emphasis"><em>are</em></span> a little closer to it. For example, you can isolate the web
layer by injecting mocked services into controllers, in which case you’re testing the web
layer only through the <code class="literal">DispatcherServlet</code> but with actual Spring configuration, just
like you might test the data access layer in isolation from the layers above. Or you
can use the standalone setup focusing on one controller at a time and manually providing
the configuration required to make it work.</p>
<p>Another important distinction when using <span class="emphasis"><em>Spring MVC Test</em></span> is that conceptually such
tests are on the <span class="emphasis"><em>inside</em></span> of the server-side so you can check what handler was used,
if an exception was handled with a HandlerExceptionResolver, what the content of the
model is, what binding errors there were, etc. That means it’s easier to write
expectations since the server is not a black box as it is when testing it through
an actual HTTP client. This is generally an advantage of classic unit testing, that it’s
easier to write, reason about, and debug but does not replace the need for full
integration tests. At the same time it’s important not to lose sight of the fact that
the response is the most important thing to check. In short, there is room here for
multiple styles and strategies of testing even within the same project.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-resources" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-resources"></a>Further Server-Side Test Examples</h4></div></div></div>

<p>The framework’s own tests include
<a class="ulink" href="https://github.com/spring-projects/spring-framework/tree/master/spring-test/src/test/java/org/springframework/test/web/servlet/samples" target="_top">many
sample tests</a> intended to demonstrate how to use Spring MVC Test. Browse these examples
for further ideas. Also the
<a class="ulink" href="https://github.com/spring-projects/spring-mvc-showcase" target="_top">spring-mvc-showcase</a> has full test
coverage based on Spring MVC Test.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-test-server-htmlunit" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit"></a>15.6.2&nbsp;HtmlUnit Integration</h3></div></div></div>

<p>Spring provides integration between <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server" title="15.6.1 Server-Side Tests">MockMvc</a> and
<a class="ulink" href="http://htmlunit.sourceforge.net/" target="_top">HtmlUnit</a>. This simplifies performing end-to-end testing
when using HTML based views. This integration enables developers to:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Easily test HTML pages using tools such as <a class="ulink" href="http://htmlunit.sourceforge.net/" target="_top">HtmlUnit</a>,
<a class="ulink" href="http://seleniumhq.org/projects/webdriver/" target="_top">WebDriver</a>, &amp;
<a class="ulink" href="http://www.gebish.org/manual/current/testing.html#spock_junit__testng" target="_top">Geb</a> without the
need to deploy to a Servlet container
</li><li class="listitem">
Test JavaScript within pages
</li><li class="listitem">
Optionally test using mock services to speed up testing
</li><li class="listitem">
Share logic between in-container end-to-end tests and out-of-container integration tests
</li></ul></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">MockMvc</code> works with templating technologies that do not rely on a Servlet Container (e.g.,
Thymeleaf, Freemarker, Velocity, etc.), but it does not work with JSPs since they rely on
the Servlet Container.</p>
</td></tr></tbody></table></div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-htmlunit-why" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-why"></a>Why HtmlUnit Integration?</h4></div></div></div>

<p>The most obvious question that comes to mind is, "Why do I need this?". The answer is best
found by exploring a very basic sample application. Assume you have a Spring MVC web
application that supports CRUD operations on a <code class="literal">Message</code> object. The application also supports
paging through all messages. How would you go about testing it?</p>
<p>With Spring MVC Test, we can easily test if we are able to create a <code class="literal">Message</code>.</p>
<pre class="programlisting">MockHttpServletRequestBuilder createMessage = post(<span class="hl-string">"/messages/"</span>)
	.param(<span class="hl-string">"summary"</span>, <span class="hl-string">"Spring Rocks"</span>)
	.param(<span class="hl-string">"text"</span>, <span class="hl-string">"In case you didn't know, Spring Rocks!"</span>);

mockMvc.perform(createMessage)
	.andExpect(status().is3xxRedirection())
	.andExpect(redirectedUrl(<span class="hl-string">"/messages/123"</span>));</pre>
<p>What if we want to test our form view that allows us to create the message? For example,
assume our form looks like the following snippet:</p>
<pre class="programlisting"><span class="hl-tag">&lt;form</span> <span class="hl-attribute">id</span>=<span class="hl-value">"messageForm"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"/messages/"</span> <span class="hl-attribute">method</span>=<span class="hl-value">"post"</span><span class="hl-tag">&gt;</span>
  <span class="hl-tag">&lt;div</span> <span class="hl-attribute">class</span>=<span class="hl-value">"pull-right"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;a</span> <span class="hl-attribute">href</span>=<span class="hl-value">"/messages/"</span><span class="hl-tag">&gt;</span>Messages<span class="hl-tag">&lt;/a&gt;</span><span class="hl-tag">&lt;/div&gt;</span>

  <span class="hl-tag">&lt;label</span> <span class="hl-attribute">for</span>=<span class="hl-value">"summary"</span><span class="hl-tag">&gt;</span>Summary<span class="hl-tag">&lt;/label&gt;</span>
  <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"required"</span> <span class="hl-attribute">id</span>=<span class="hl-value">"summary"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"summary"</span> <span class="hl-attribute">value</span>=<span class="hl-value">""</span><span class="hl-tag"> /&gt;</span>

  <span class="hl-tag">&lt;label</span> <span class="hl-attribute">for</span>=<span class="hl-value">"text"</span><span class="hl-tag">&gt;</span>Message<span class="hl-tag">&lt;/label&gt;</span>
  <span class="hl-tag">&lt;textarea</span> <span class="hl-attribute">id</span>=<span class="hl-value">"text"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"text"</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;/textarea&gt;</span>

  <span class="hl-tag">&lt;div</span> <span class="hl-attribute">class</span>=<span class="hl-value">"form-actions"</span><span class="hl-tag">&gt;</span>
	<span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Create"</span><span class="hl-tag"> /&gt;</span>
  <span class="hl-tag">&lt;/div&gt;</span>
<span class="hl-tag">&lt;/form&gt;</span></pre>
<p>How do we ensure that our form will produce the correct request to create a new message? A
naive attempt would look like this:</p>
<pre class="programlisting">mockMvc.perform(get(<span class="hl-string">"/messages/form"</span>))
	.andExpect(xpath(<span class="hl-string">"//input[@name='summary']"</span>).exists())
	.andExpect(xpath(<span class="hl-string">"//textarea[@name='text']"</span>).exists());</pre>
<p>This test has some obvious drawbacks. If we update our controller to use the parameter
<code class="literal">message</code> instead of <code class="literal">text</code>, our form test would continue to pass even though the HTML
form is out of synch with the controller. To resolve this we can combine our two tests.</p>
<a name="spring-mvc-test-server-htmlunit-mock-mvc-test" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mock-mvc-test"></a><pre class="programlisting">String summaryParamName = <span class="hl-string">"summary"</span>;
String textParamName = <span class="hl-string">"text"</span>;
mockMvc.perform(get(<span class="hl-string">"/messages/form"</span>))
		.andExpect(xpath(<span class="hl-string">"//input[@name='"</span> + summaryParamName + <span class="hl-string">"']"</span>).exists())
		.andExpect(xpath(<span class="hl-string">"//textarea[@name='"</span> + textParamName + <span class="hl-string">"']"</span>).exists());

MockHttpServletRequestBuilder createMessage = post(<span class="hl-string">"/messages/"</span>)
		.param(summaryParamName, <span class="hl-string">"Spring Rocks"</span>)
		.param(textParamName, <span class="hl-string">"In case you didn't know, Spring Rocks!"</span>);

mockMvc.perform(createMessage)
		.andExpect(status().is3xxRedirection())
		.andExpect(redirectedUrl(<span class="hl-string">"/messages/123"</span>));</pre>
<p>This would reduce the risk of our test incorrectly passing, but there are still some
problems.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
What if we have multiple forms on our page? Admittedly we could update our xpath
expressions, but they get more complicated the more factors we take into account (Are the
fields the correct type? Are the fields enabled? etc.).
</li><li class="listitem">
Another issue is that we are doing double the work we would expect.
We must first verify the view, and then we submit the view with the same parameters we just
verified. Ideally this could be done all at once.
</li><li class="listitem">
Finally, there are some things that we still cannot account for. For example, what if the
form has JavaScript validation that we wish to test as well?
</li></ul></div>
<p>The overall problem is that testing a web page does not involve a single interaction.
Instead, it is a combination of how the user interacts with a web page and how that web
page interacts with other resources. For example, the result of a form view is used as
the input to a user for creating a message. In addition, our form view may potentially
utilize additional resources which impact the behavior of the page, such as JavaScript
validation.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-why-integration" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-why-integration"></a>Integration testing to the rescue?</h5></div></div></div>

<p>To resolve the issues above we could perform end-to-end integration testing, but this has
some obvious drawbacks. Consider testing the view that allows us to page through the messages.
We might need the following tests.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Does our page display a notification to the user indicating that no results are available
when the messages are empty?
</li><li class="listitem">
Does our page properly display a single message?
</li><li class="listitem">
Does our page properly support paging?
</li></ul></div>
<p>To set up these tests, we would need to ensure our database contained the proper messages
in it. This leads to a number of additional challenges.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Ensuring the proper messages are in the database can be tedious; consider foreign key
constraints.
</li><li class="listitem">
Testing can become slow since each test would need to ensure that the database is in the
correct state.
</li><li class="listitem">
Since our database needs to be in a specific state, we cannot run tests in parallel.
</li><li class="listitem">
Performing assertions on things like auto-generated ids, timestamps, etc. can be difficult.
</li></ul></div>
<p>These challenges do not mean that we should abandon end-to-end integration testing
altogether. Instead, we can reduce the number of end-to-end integration tests by
refactoring our detailed tests to use mock services which will execute much faster, more
reliably, and without side effects. We can then implement a small number of <span class="emphasis"><em>true</em></span>
end-to-end integration tests that validate simple workflows to ensure that everything
works together properly.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-why-mockmvc" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-why-mockmvc"></a>Enter HtmlUnit Integration</h5></div></div></div>

<p>So how can we achieve a balance between testing the interactions of our pages and still
retain good performance within our test suite? The answer is: "By integrating MockMvc
with HtmlUnit."</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-options" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-options"></a>HtmlUnit Integration Options</h5></div></div></div>

<p>There are a number of ways to integrate <code class="literal">MockMvc</code> with HtmlUnit.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah" title="MockMvc and HtmlUnit">MockMvc and HtmlUnit</a>: Use this option if you
want to use the raw HtmlUnit libraries.
</li><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver" title="MockMvc and WebDriver">MockMvc and WebDriver</a>: Use this option to
ease development and reuse code between integration and end-to-end testing.
</li><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-geb" title="MockMvc and Geb">MockMvc and Geb</a>: Use this option if you would
like to use Groovy for testing, ease development, and reuse code between integration and
end-to-end testing.
</li></ul></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-htmlunit-mah" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah"></a>MockMvc and HtmlUnit</h4></div></div></div>

<p>This section describes how to integrate <code class="literal">MockMvc</code> and HtmlUnit. Use this option if you
want to use the raw HtmlUnit libraries.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-mah-setup" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah-setup"></a>MockMvc and HtmlUnit Setup</h5></div></div></div>

<p>First, make sure that you have included a test dependency on <code class="literal">net.sourceforge.htmlunit:htmlunit</code>.
In order to use HtmlUnit with Apache HttpComponents 4.5+, you will need to use HtmlUnit
2.18 or higher.</p>
<p>We can easily create an HtmlUnit <code class="literal">WebClient</code> that integrates with <code class="literal">MockMvc</code> using the
<code class="literal">MockMvcWebClientBuilder</code> as follows.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
WebApplicationContext context;

WebClient webClient;

<em><span class="hl-annotation" style="color: gray">@Before</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
	webClient = MockMvcWebClientBuilder
		.webAppContextSetup(context)
		.build();
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>This is a simple example of using <code class="literal">MockMvcWebClientBuilder</code>. For advanced usage see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah-advanced-builder" title="Advanced MockMvcWebClientBuilder">the section called “Advanced MockMvcWebClientBuilder”</a></p>
</td></tr></tbody></table></div>
<p>This will ensure that any URL referencing <code class="literal">localhost</code> as the server will be directed to
our <code class="literal">MockMvc</code> instance without the need for a real HTTP connection. Any other URL will be
requested using a network connection as normal. This allows us to easily test the use of
CDNs.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-mah-usage" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah-usage"></a>MockMvc and HtmlUnit Usage</h5></div></div></div>

<p>Now we can use HtmlUnit as we normally would, but without the need to deploy our
application to a Servlet container. For example, we can request the view to create
a message with the following.</p>
<pre class="programlisting">HtmlPage createMsgFormPage = webClient.getPage(<span class="hl-string">"http://localhost/messages/form"</span>);</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The default context path is <code class="literal">""</code>. Alternatively, we can specify the context path as
illustrated in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah-advanced-builder" title="Advanced MockMvcWebClientBuilder">the section called “Advanced MockMvcWebClientBuilder”</a>.</p>
</td></tr></tbody></table></div>
<p>Once we have a reference to the <code class="literal">HtmlPage</code>, we can then fill out the form and submit
it to create a message.</p>
<pre class="programlisting">HtmlForm form = createMsgFormPage.getHtmlElementById(<span class="hl-string">"messageForm"</span>);
HtmlTextInput summaryInput = createMsgFormPage.getHtmlElementById(<span class="hl-string">"summary"</span>);
summaryInput.setValueAttribute(<span class="hl-string">"Spring Rocks"</span>);
HtmlTextArea textInput = createMsgFormPage.getHtmlElementById(<span class="hl-string">"text"</span>);
textInput.setText(<span class="hl-string">"In case you didn't know, Spring Rocks!"</span>);
HtmlSubmitInput submit = form.getOneHtmlElementByAttribute(<span class="hl-string">"input"</span>, <span class="hl-string">"type"</span>, <span class="hl-string">"submit"</span>);
HtmlPage newMessagePage = submit.click();</pre>
<p>Finally, we can verify that a new message was created successfully. The following
assertions use the <a class="ulink" href="https://joel-costigliola.github.io/assertj/" target="_top">AssertJ</a> library.</p>
<pre class="programlisting">assertThat(newMessagePage.getUrl().toString()).endsWith(<span class="hl-string">"/messages/123"</span>);
String id = newMessagePage.getHtmlElementById(<span class="hl-string">"id"</span>).getTextContent();
assertThat(id).isEqualTo(<span class="hl-string">"123"</span>);
String summary = newMessagePage.getHtmlElementById(<span class="hl-string">"summary"</span>).getTextContent();
assertThat(summary).isEqualTo(<span class="hl-string">"Spring Rocks"</span>);
String text = newMessagePage.getHtmlElementById(<span class="hl-string">"text"</span>).getTextContent();
assertThat(text).isEqualTo(<span class="hl-string">"In case you didn't know, Spring Rocks!"</span>);</pre>
<p>This improves on our <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mock-mvc-test">MockMvc test</a> in a
number of ways. First we no longer have to explicitly verify our form and then create a
request that looks like the form. Instead, we request the form, fill it out, and submit
it, thereby significantly reducing the overhead.</p>
<p>Another important factor is that <a class="ulink" href="http://htmlunit.sourceforge.net/javascript.html" target="_top">HtmlUnit
uses the Mozilla Rhino engine</a> to evaluate JavaScript. This means that we can test the
behavior of JavaScript within our pages as well!</p>
<p>Refer to the <a class="ulink" href="http://htmlunit.sourceforge.net/gettingStarted.html" target="_top">HtmlUnit documentation</a>
for additional information about using HtmlUnit.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-mah-advanced-builder" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah-advanced-builder"></a>Advanced MockMvcWebClientBuilder</h5></div></div></div>

<p>In the examples so far, we have used <code class="literal">MockMvcWebClientBuilder</code> in the simplest way possible,
by building a <code class="literal">WebClient</code> based on the <code class="literal">WebApplicationContext</code> loaded for us by the Spring
TestContext Framework. This approach is repeated here.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
WebApplicationContext context;

WebClient webClient;

<em><span class="hl-annotation" style="color: gray">@Before</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
	webClient = MockMvcWebClientBuilder
		.webAppContextSetup(context)
		.build();
}</pre>
<p>We can also specify additional configuration options.</p>
<pre class="programlisting">WebClient webClient;

<em><span class="hl-annotation" style="color: gray">@Before</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
	webClient = MockMvcWebClientBuilder
		<span class="hl-comment">// demonstrates applying a MockMvcConfigurer (Spring Security)</span>
		.webAppContextSetup(context, springSecurity())
		<span class="hl-comment">// for illustration only - defaults to ""</span>
		.contextPath(<span class="hl-string">""</span>)
		<span class="hl-comment">// By default MockMvc is used for localhost only;</span>
		<span class="hl-comment">// the following will use MockMvc for example.com and example.org as well</span>
		.useMockMvcForHosts(<span class="hl-string">"example.com"</span>,<span class="hl-string">"example.org"</span>)
		.build();
}</pre>
<p>As an alternative, we can perform the exact same setup by configuring the <code class="literal">MockMvc</code>
instance separately and supplying it to the <code class="literal">MockMvcWebClientBuilder</code> as follows.</p>
<pre class="programlisting">MockMvc mockMvc = MockMvcBuilders
		.webAppContextSetup(context)
		.apply(springSecurity())
		.build();

webClient = MockMvcWebClientBuilder
		.mockMvcSetup(mockMvc)
		<span class="hl-comment">// for illustration only - defaults to ""</span>
		.contextPath(<span class="hl-string">""</span>)
		<span class="hl-comment">// By default MockMvc is used for localhost only;</span>
		<span class="hl-comment">// the following will use MockMvc for example.com and example.org as well</span>
		.useMockMvcForHosts(<span class="hl-string">"example.com"</span>,<span class="hl-string">"example.org"</span>)
		.build();</pre>
<p>This is more verbose, but by building the <code class="literal">WebClient</code> with a <code class="literal">MockMvc</code> instance we have
the full power of <code class="literal">MockMvc</code> at our fingertips.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>For additional information on creating a <code class="literal">MockMvc</code> instance refer to
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-setup-options" title="Setup Options">the section called “Setup Options”</a>.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-htmlunit-webdriver" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver"></a>MockMvc and WebDriver</h4></div></div></div>

<p>In the previous sections, we have seen how to use <code class="literal">MockMvc</code> in conjunction with the raw
HtmlUnit APIs. In this section, we will leverage additional abstractions within the Selenium
<a class="ulink" href="http://docs.seleniumhq.org/projects/webdriver/" target="_top">WebDriver</a> to make things even easier.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-webdriver-why" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver-why"></a>Why WebDriver and MockMvc?</h5></div></div></div>

<p>We can already use HtmlUnit and <code class="literal">MockMvc</code>, so why would we want to use <code class="literal">WebDriver</code>? The
Selenium <code class="literal">WebDriver</code> provides a very elegant API that allows us to easily organize our code.
To better understand, let’s explore an example.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Despite being a part of <a class="ulink" href="http://docs.seleniumhq.org/" target="_top">Selenium</a>, WebDriver does not require
a Selenium Server to run your tests.</p>
</td></tr></tbody></table></div>
<p>Suppose we need to ensure that a message is created properly. The tests involve finding
the HTML form input elements, filling them out, and making various assertions.</p>
<p>This approach results in numerous, separate tests because we want to test error
conditions as well. For example, we want to ensure that we get an error if we fill out
only part of the form. If we fill out the entire form, the newly created message should
be displayed afterwards.</p>
<p>If one of the fields were named "summary", then we might have something like the
following repeated in multiple places within our tests.</p>
<pre class="programlisting">HtmlTextInput summaryInput = currentPage.getHtmlElementById(<span class="hl-string">"summary"</span>);
summaryInput.setValueAttribute(summary);</pre>
<p>So what happens if we change the <code class="literal">id</code> to "smmry"? Doing so would force us to update all
of our tests to incorporate this change! Of course, this violates the <span class="emphasis"><em>DRY Principle</em></span>; so
we should ideally extract this code into its own method as follows.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> HtmlPage createMessage(HtmlPage currentPage, String summary, String text) {
	setSummary(currentPage, summary);
	<span class="hl-comment">// ...</span>
}

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSummary(HtmlPage currentPage, String summary) {
	HtmlTextInput summaryInput = currentPage.getHtmlElementById(<span class="hl-string">"summary"</span>);
	summaryInput.setValueAttribute(summary);
}</pre>
<p>This ensures that we do not have to update all of our tests if we change the UI.</p>
<p>We might even take this a step further and place this logic within an Object that
represents the <code class="literal">HtmlPage</code> we are currently on.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CreateMessagePage {

	<span class="hl-keyword">final</span> HtmlPage currentPage;

	<span class="hl-keyword">final</span> HtmlTextInput summaryInput;

	<span class="hl-keyword">final</span> HtmlSubmitInput submit;

	<span class="hl-keyword">public</span> CreateMessagePage(HtmlPage currentPage) {
		<span class="hl-keyword">this</span>.currentPage = currentPage;
		<span class="hl-keyword">this</span>.summaryInput = currentPage.getHtmlElementById(<span class="hl-string">"summary"</span>);
		<span class="hl-keyword">this</span>.submit = currentPage.getHtmlElementById(<span class="hl-string">"submit"</span>);
	}

	<span class="hl-keyword">public</span> &lt;T&gt; T createMessage(String summary, String text) <span class="hl-keyword">throws</span> Exception {
		setSummary(summary);

		HtmlPage result = submit.click();
		<span class="hl-keyword">boolean</span> error = CreateMessagePage.at(result);

		<span class="hl-keyword">return</span> (T) (error ? <span class="hl-keyword">new</span> CreateMessagePage(result) : <span class="hl-keyword">new</span> ViewMessagePage(result));
	}

	<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSummary(String summary) <span class="hl-keyword">throws</span> Exception {
		summaryInput.setValueAttribute(summary);
	}

	<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">boolean</span> at(HtmlPage page) {
		<span class="hl-keyword">return</span> <span class="hl-string">"Create Message"</span>.equals(page.getTitleText());
	}
}</pre>
<p>Formerly, this pattern is known as the
<a class="ulink" href="https://code.google.com/p/selenium/wiki/PageObjects" target="_top">Page Object Pattern</a>. While we can
certainly do this with HtmlUnit, WebDriver provides some tools that we will explore in the
following sections to make this pattern much easier to implement.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-webdriver-setup" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver-setup"></a>MockMvc and WebDriver Setup</h5></div></div></div>

<p>To use Selenium WebDriver with the Spring MVC Test framework, make sure that your project
includes a test dependency on <code class="literal">org.seleniumhq.selenium:selenium-htmlunit-driver</code>.</p>
<p>We can easily create a Selenium <code class="literal">WebDriver</code> that integrates with <code class="literal">MockMvc</code> using the
<code class="literal">MockMvcHtmlUnitDriverBuilder</code> as follows.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
WebApplicationContext context;

WebDriver driver;

<em><span class="hl-annotation" style="color: gray">@Before</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
	driver = MockMvcHtmlUnitDriverBuilder
		.webAppContextSetup(context)
		.build();
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>This is a simple example of using <code class="literal">MockMvcHtmlUnitDriverBuilder</code>.
For more advanced usage, refer to <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver-advanced-builder" title="Advanced MockMvcHtmlUnitDriverBuilder">the section called “Advanced MockMvcHtmlUnitDriverBuilder”</a></p>
</td></tr></tbody></table></div>
<p>This will ensure that any URL referencing <code class="literal">localhost</code> as the server will be directed to
our <code class="literal">MockMvc</code> instance without the need for a real HTTP connection. Any other URL will be
requested using a network connection as normal. This allows us to easily test the use of
CDNs.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-webdriver-usage" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver-usage"></a>MockMvc and WebDriver Usage</h5></div></div></div>

<p>Now we can use WebDriver as we normally would, but without the need to deploy our
application to a Servlet container. For example, we can request the view to create
a message with the following.</p>
<pre class="programlisting">CreateMessagePage page = CreateMessagePage.to(driver);</pre>
<p>We can then fill out the form and submit it to create a message.</p>
<pre class="programlisting">ViewMessagePage viewMessagePage =
	page.createMessage(ViewMessagePage.<span class="hl-keyword">class</span>, expectedSummary, expectedText);</pre>
<p>This improves on the design of our
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah-usage" title="MockMvc and HtmlUnit Usage">HtmlUnit test</a> by leveraging the <span class="emphasis"><em>Page Object
Pattern</em></span>. As we mentioned in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver-why" title="Why WebDriver and MockMvc?">the section called “Why WebDriver and MockMvc?”</a>, we can
use the Page Object Pattern with HtmlUnit, but it is much easier with WebDriver. Let’s
take a look at our new <code class="literal">CreateMessagePage</code> implementation.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CreateMessagePage
		<span class="hl-keyword">extends</span> AbstractPage { <a name="CO1-1" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#CO1-1"></a><span><img src="./Spring Framework Reference Documentation_files/1.png.pagespeed.ce.D2eEK4zAWR.png" alt="1" border="0"></span>

	<a name="CO1-2" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#CO1-2"></a><span><img src="./Spring Framework Reference Documentation_files/2.png.pagespeed.ce.eC-Zi6tZ0C.png" alt="2" border="0"></span>
	<span class="hl-keyword">private</span> WebElement summary;
	<span class="hl-keyword">private</span> WebElement text;

	<a name="CO1-3" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#CO1-3"></a><span><img src="./Spring Framework Reference Documentation_files/3.png.pagespeed.ce.Ndzx3SmoAg.png" alt="3" border="0"></span>
	<em><span class="hl-annotation" style="color: gray">@FindBy(css = "input[type=submit]")</span></em>
	<span class="hl-keyword">private</span> WebElement submit;

	<span class="hl-keyword">public</span> CreateMessagePage(WebDriver driver) {
		<span class="hl-keyword">super</span>(driver);
	}

	<span class="hl-keyword">public</span> &lt;T&gt; T createMessage(Class&lt;T&gt; resultPage, String summary, String details) {
		<span class="hl-keyword">this</span>.summary.sendKeys(summary);
		<span class="hl-keyword">this</span>.text.sendKeys(details);
		<span class="hl-keyword">this</span>.submit.click();
		<span class="hl-keyword">return</span> PageFactory.initElements(driver, resultPage);
	}

	<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> CreateMessagePage to(WebDriver driver) {
		driver.get(<span class="hl-string">"http://localhost:9990/mail/messages/form"</span>);
		<span class="hl-keyword">return</span> PageFactory.initElements(driver, CreateMessagePage.<span class="hl-keyword">class</span>);
	}
}</pre>
<div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#CO1-1"><span><img src="./Spring Framework Reference Documentation_files/1.png.pagespeed.ce.D2eEK4zAWR.png" alt="1" border="0"></span></a> </p></td><td valign="top" align="left">
<p>The first thing you will notice is that <code class="literal">CreateMessagePage</code> extends the
<code class="literal">AbstractPage</code>. We won’t go over the details of <code class="literal">AbstractPage</code>, but in summary it
contains common functionality for all of our pages. For example, if our application has
a navigational bar, global error messages, etc., this logic can be placed in a shared
location.</p>
</td></tr><tr><td width="5%" valign="top" align="left"><p><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#CO1-2"><span><img src="./Spring Framework Reference Documentation_files/2.png.pagespeed.ce.eC-Zi6tZ0C.png" alt="2" border="0"></span></a> </p></td><td valign="top" align="left">
<p>The next thing you will notice is that we have a member variable for each of the
parts of the HTML page that we are interested in. These are of type <code class="literal">WebElement</code>.
<code class="literal">WebDriver</code>'s <a class="ulink" href="https://code.google.com/p/selenium/wiki/PageFactory" target="_top">PageFactory</a> allows
us to remove a lot of code from the HtmlUnit version of <code class="literal">CreateMessagePage</code> by
automatically resolving each <code class="literal">WebElement</code>. The
<a class="ulink" href="https://selenium.googlecode.com/git/docs/api/java/org/openqa/selenium/support/PageFactory.html#initElements-org.openqa.selenium.WebDriver-java.lang.Class-" target="_top">PageFactory#initElements(WebDriver,Class&lt;T&gt;)</a>
method will automatically resolve each <code class="literal">WebElement</code> by using the field name and looking it
up by the <code class="literal">id</code> or <code class="literal">name</code> of the element within the HTML page.</p>
</td></tr><tr><td width="5%" valign="top" align="left"><p><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#CO1-3"><span><img src="./Spring Framework Reference Documentation_files/3.png.pagespeed.ce.Ndzx3SmoAg.png" alt="3" border="0"></span></a> </p></td><td valign="top" align="left">
<p>We can use the
<a class="ulink" href="https://code.google.com/p/selenium/wiki/PageFactory#Making_the_Example_Work_Using_Annotations" target="_top">@FindBy annotation</a>
to override the default lookup behavior. Our example demonstrates how to use the <code class="literal">@FindBy</code>
annotation to look up our submit button using a css selector, <span class="strong"><strong>input[type=submit]</strong></span>.</p>
</td></tr></tbody></table></div>
<p>Finally, we can verify that a new message was created successfully. The following
assertions use the <a class="ulink" href="https://code.google.com/p/fest/" target="_top">FEST assertion library</a>.</p>
<pre class="programlisting">assertThat(viewMessagePage.getMessage()).isEqualTo(expectedMessage);
assertThat(viewMessagePage.getSuccess()).isEqualTo(<span class="hl-string">"Successfully created a new message"</span>);</pre>
<p>We can see that our <code class="literal">ViewMessagePage</code> allows us to interact with our custom domain
model. For example, it exposes a method that returns a <code class="literal">Message</code> object.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> Message getMessage() <span class="hl-keyword">throws</span> ParseException {
	Message message = <span class="hl-keyword">new</span> Message();
	message.setId(getId());
	message.setCreated(getCreated());
	message.setSummary(getSummary());
	message.setText(getText());
	<span class="hl-keyword">return</span> message;
}</pre>
<p>We can then leverage the rich domain objects in our assertions.</p>
<p>Lastly, don’t forget to <span class="emphasis"><em>close</em></span> the <code class="literal">WebDriver</code> instance when the test is complete.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@After</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> destroy() {
	<span class="hl-keyword">if</span> (driver != null) {
		driver.close();
	}
}</pre>
<p>For additional information on using WebDriver, refer to the Selenium
<a class="ulink" href="https://code.google.com/p/selenium/wiki/GettingStarted" target="_top">WebDriver documentation</a>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-webdriver-advanced-builder" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver-advanced-builder"></a>Advanced MockMvcHtmlUnitDriverBuilder</h5></div></div></div>

<p>In the examples so far, we have used <code class="literal">MockMvcHtmlUnitDriverBuilder</code> in the simplest way
possible, by building a <code class="literal">WebDriver</code> based on the <code class="literal">WebApplicationContext</code> loaded for us by
the Spring TestContext Framework. This approach is repeated here.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
WebApplicationContext context;

WebDriver driver;

<em><span class="hl-annotation" style="color: gray">@Before</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
	driver = MockMvcHtmlUnitDriverBuilder
		.webAppContextSetup(context)
		.build();
}</pre>
<p>We can also specify additional configuration options.</p>
<pre class="programlisting">WebDriver driver;

<em><span class="hl-annotation" style="color: gray">@Before</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
	driver = MockMvcHtmlUnitDriverBuilder
		<span class="hl-comment">// demonstrates applying a MockMvcConfigurer (Spring Security)</span>
		.webAppContextSetup(context, springSecurity())
		<span class="hl-comment">// for illustration only - defaults to ""</span>
		.contextPath(<span class="hl-string">""</span>)
		<span class="hl-comment">// By default MockMvc is used for localhost only;</span>
		<span class="hl-comment">// the following will use MockMvc for example.com and example.org as well</span>
		.useMockMvcForHosts(<span class="hl-string">"example.com"</span>,<span class="hl-string">"example.org"</span>)
		.build();
}</pre>
<p>As an alternative, we can perform the exact same setup by configuring the <code class="literal">MockMvc</code>
instance separately and supplying it to the <code class="literal">MockMvcHtmlUnitDriverBuilder</code> as follows.</p>
<pre class="programlisting">MockMvc mockMvc = MockMvcBuilders
		.webAppContextSetup(context)
		.apply(springSecurity())
		.build();

driver = MockMvcHtmlUnitDriverBuilder
		.mockMvcSetup(mockMvc)
		<span class="hl-comment">// for illustration only - defaults to ""</span>
		.contextPath(<span class="hl-string">""</span>)
		<span class="hl-comment">// By default MockMvc is used for localhost only;</span>
		<span class="hl-comment">// the following will use MockMvc for example.com and example.org as well</span>
		.useMockMvcForHosts(<span class="hl-string">"example.com"</span>,<span class="hl-string">"example.org"</span>)
		.build();</pre>
<p>This is more verbose, but by building the <code class="literal">WebDriver</code> with a <code class="literal">MockMvc</code> instance we have
the full power of <code class="literal">MockMvc</code> at our fingertips.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>For additional information on creating a <code class="literal">MockMvc</code> instance refer to
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-setup-options" title="Setup Options">the section called “Setup Options”</a>.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-server-htmlunit-geb" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-geb"></a>MockMvc and Geb</h4></div></div></div>

<p>In the previous section, we saw how to use <code class="literal">MockMvc</code> with <code class="literal">WebDriver</code>. In this section,
we will use <a class="ulink" href="http://www.gebish.org/" target="_top">Geb</a> to make our tests even Groovy-er.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-geb-why" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-geb-why"></a>Why Geb and MockMvc?</h5></div></div></div>

<p>Geb is backed by WebDriver, so it offers many of the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver-why" title="Why WebDriver and MockMvc?">same benefits</a> that we get from
WebDriver. However, Geb makes things even easier by taking care of some of the
boilerplate code for us.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-geb-setup" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-geb-setup"></a>MockMvc and Geb Setup</h5></div></div></div>

<p>We can easily initialize a Geb <code class="literal">Browser</code> with a Selenium <code class="literal">WebDriver</code> that uses <code class="literal">MockMvc</code>
as follows.</p>
<pre class="programlisting">def setup() {
	browser.driver = MockMvcHtmlUnitDriverBuilder
		.webAppContextSetup(context)
		.build()
}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>This is a simple example of using <code class="literal">MockMvcHtmlUnitDriverBuilder</code>.
For more advanced usage, refer to <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-webdriver-advanced-builder" title="Advanced MockMvcHtmlUnitDriverBuilder">the section called “Advanced MockMvcHtmlUnitDriverBuilder”</a></p>
</td></tr></tbody></table></div>
<p>This will ensure that any URL referencing <code class="literal">localhost</code> as the server will be directed to
our <code class="literal">MockMvc</code> instance without the need for a real HTTP connection. Any other URL will be
requested using a network connection as normal. This allows us to easily test the use of
CDNs.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="spring-mvc-test-server-htmlunit-geb-usage" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-geb-usage"></a>MockMvc and Geb Usage</h5></div></div></div>

<p>Now we can use Geb as we normally would, but without the need to deploy our
application to a Servlet container. For example, we can request the view to create
a message with the following:</p>
<pre class="programlisting">to CreateMessagePage</pre>
<p>We can then fill out the form and submit it to create a message.</p>
<pre class="programlisting">when:
form.summary = expectedSummary
form.text = expectedMessage
submit.click(ViewMessagePage)</pre>
<p>Any unrecognized method calls or property accesses/references that are not found will be
forwarded to the current page object. This removes a lot of the boilerplate code we needed
when using WebDriver directly.</p>
<p>As with direct WebDriver usage, this improves on the design of our
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-server-htmlunit-mah-usage" title="MockMvc and HtmlUnit Usage">HtmlUnit test</a> by leveraging the <span class="emphasis"><em>Page Object
Pattern</em></span>. As mentioned previously, we can use the Page Object Pattern with HtmlUnit and
WebDriver, but it is even easier with Geb. Let’s take a look at our new Groovy-based
<code class="literal">CreateMessagePage</code> implementation.</p>
<pre class="programlisting"><span class="hl-keyword">class</span> CreateMessagePage <span class="hl-keyword">extends</span> Page {
	<span class="hl-keyword">static</span> url = <span class="hl-string">'messages/form'</span>
	<span class="hl-keyword">static</span> at = { assert title == <span class="hl-string">'Messages : Create'</span>; true }
	<span class="hl-keyword">static</span> content =  {
		submit { $(<span class="hl-string">'input[type=submit]'</span>) }
		form { $(<span class="hl-string">'form'</span>) }
		errors(required:false) { $(<span class="hl-string">'label.error, .alert-error'</span>)?.text() }
	}
}</pre>
<p>The first thing you will notice is that our <code class="literal">CreateMessagePage</code> extends <code class="literal">Page</code>. We won’t
go over the details of <code class="literal">Page</code>, but in summary it contains common functionality for all of
our pages. The next thing you will notice is that we define a URL in which this page can
be found. This allows us to navigate to the page as follows.</p>
<pre class="programlisting">to CreateMessagePage</pre>
<p>We also have an <code class="literal">at</code> closure that determines if we are at the specified page. It should return
<code class="literal">true</code> if we are on the correct page. This is why we can assert that we are on the correct
page as follows.</p>
<pre class="programlisting">then:
at CreateMessagePage
errors.contains(<span class="hl-string">'This field is required.'</span>)</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>We use an assertion in the closure, so that we can determine where things went wrong if
we were at the wrong page.</p>
</td></tr></tbody></table></div>
<p>Next we create a <code class="literal">content</code> closure that specifies all the areas of interest within the page.
We can use a
<a class="ulink" href="http://www.gebish.org/manual/current/intro.html#the_jquery_ish_navigator_api" target="_top">jQuery-ish Navigator API</a>
to select the content we are interested in.</p>
<p>Finally, we can verify that a new message was created successfully.</p>
<pre class="programlisting">then:
at ViewMessagePage
success == <span class="hl-string">'Successfully created a new message'</span>
id
date
summary == expectedSummary
message == expectedMessage</pre>
<p>For further details on how to get the most out of Geb, consult
<a class="ulink" href="http://www.gebish.org/manual/current/" target="_top">The Book of Geb</a> user’s manual.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-test-client" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-client"></a>15.6.3&nbsp;Client-Side REST Tests</h3></div></div></div>

<p>Client-side tests can be used to test code that internally uses the <code class="literal">RestTemplate</code>.
The idea is to declare expected requests and to provide "stub" responses so that
you can focus on testing the code in isolation, i.e. without running a server.
Here is an example:</p>
<pre class="programlisting">RestTemplate restTemplate = <span class="hl-keyword">new</span> RestTemplate();

MockRestServiceServer mockServer = MockRestServiceServer.bindTo(restTemplate).build();
mockServer.expect(requestTo(<span class="hl-string">"/greeting"</span>)).andRespond(withSuccess());

<span class="hl-comment">// Test code that uses the above RestTemplate ...</span>

mockServer.verify();</pre>
<p>In the above example, <code class="literal">MockRestServiceServer</code>, the central class for client-side REST
tests, configures the <code class="literal">RestTemplate</code> with a custom <code class="literal">ClientHttpRequestFactory</code> that
asserts actual requests against expectations and returns "stub" responses. In this case
we expect a request to "/greeting" and want to return a 200 response with
"text/plain" content. We could define as additional expected requests and stub responses as
needed. When expected requests and stub responses are defined, the <code class="literal">RestTemplate</code> can be
used in client-side code as usual. At the end of testing <code class="literal">mockServer.verify()</code> can be
used to verify that all expectations have been satisfied.</p>
<p>By default requests are expected in the order in which expectations were declared.
You can set the <code class="literal">ignoreExpectOrder</code> option when building the server in which case
all expectations are checked (in order) to find a match for a given request. That
means requests are allowed to come in any order. Here is an example:</p>
<pre class="programlisting">server = MockRestServiceServer.bindTo(restTemplate).ignoreExpectOrder(true).build();</pre>
<p>Even with unordered requests by default each request is allowed to execute once only.
The <code class="literal">expect</code> method provides an overloaded variant that accepts an <code class="literal">ExpectedCount</code>
argument that specifies a count range, e.g. <code class="literal">once</code>, <code class="literal">manyTimes</code>, <code class="literal">max</code>, <code class="literal">min</code>,
<code class="literal">between</code>, and so on. Here is an example:</p>
<pre class="programlisting">RestTemplate restTemplate = <span class="hl-keyword">new</span> RestTemplate();

MockRestServiceServer mockServer = MockRestServiceServer.bindTo(restTemplate).build();
mockServer.expect(times(<span class="hl-number">2</span>), requestTo(<span class="hl-string">"/foo"</span>)).andRespond(withSuccess());
mockServer.expect(times(<span class="hl-number">3</span>), requestTo(<span class="hl-string">"/bar"</span>)).andRespond(withSuccess());

<span class="hl-comment">// ...</span>

mockServer.verify();</pre>
<p>Note that when <code class="literal">ignoreExpectOrder</code> is not set (the default), and therefore requests
are expected in order of declaration, then that order only applies to the first of
any expected request. For example if "/foo" is expected 2 times followed by "/bar"
3 times, then there should be a request to "/foo" before there is a request to "/bar"
but aside from that subsequent "/foo" and "/bar" requests can come at any time.</p>
<p>As an alternative to all of the above the client-side test support also provides a
<code class="literal">ClientHttpRequestFactory</code> implementation that can be configured into a <code class="literal">RestTemplate</code>
to bind it to a <code class="literal">MockMvc</code> instance. That allows processing requests using actual
server-side logic but without running a server. Here is an example:</p>
<pre class="programlisting">MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(<span class="hl-keyword">this</span>.wac).build();
<span class="hl-keyword">this</span>.restTemplate = <span class="hl-keyword">new</span> RestTemplate(<span class="hl-keyword">new</span> MockMvcClientHttpRequestFactory(mockMvc));

<span class="hl-comment">// Test code that uses the above RestTemplate ...</span>

mockServer.verify();</pre>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-client-static-imports" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-client-static-imports"></a>Static Imports</h4></div></div></div>

<p>Just like with server-side tests, the fluent API for client-side tests requires a few
static imports. Those are easy to find by searching <span class="emphasis"><em>"MockRest*"</em></span>. Eclipse users
should add <code class="literal">"MockRestRequestMatchers.*"</code> and <code class="literal">"MockRestResponseCreators.*"</code>
as "favorite static members" in the Eclipse preferences under
<span class="emphasis"><em>Java &#8594; Editor &#8594; Content Assist &#8594; Favorites</em></span>.
That allows using content assist after typing the first character of the
static method name. Other IDEs (e.g. IntelliJ) may not require any additional
configuration. Just check the support for code completion on static members.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="spring-mvc-test-client-resources" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-mvc-test-client-resources"></a>Further Examples of Client-side REST Tests</h4></div></div></div>

<p>Spring MVC Test’s own tests include
<a class="ulink" href="https://github.com/spring-projects/spring-framework/tree/master/spring-test/src/test/java/org/springframework/test/web/client/samples" target="_top">example
tests</a> of client-side REST tests.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-examples-petclinic" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-examples-petclinic"></a>15.7&nbsp;PetClinic Example</h2></div></div></div>

<p>The PetClinic application, available on
<a class="ulink" href="https://github.com/spring-projects/spring-petclinic" target="_top">GitHub</a>, illustrates several features
of the <span class="emphasis"><em>Spring TestContext Framework</em></span> in a JUnit 4 environment. Most test functionality
is included in the <code class="literal">AbstractClinicTests</code>, for which a partial listing is shown below:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> <span class="hl-keyword">static</span> org.junit.Assert.assertEquals;
<span class="hl-comment">// import ...</span>

<span class="strong"><strong>@ContextConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> AbstractClinicTests <span class="strong"><strong>extends AbstractTransactionalJUnit4SpringContextTests</strong></span> {

    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">protected</span> Clinic clinic;

    <em><span class="hl-annotation" style="color: gray">@Test</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> getVets() {
        Collection&lt;Vet&gt; vets = <span class="hl-keyword">this</span>.clinic.getVets();
        assertEquals(<span class="hl-string">"JDBC query must show the same number of vets"</span>,
            <span class="strong"><strong>super.countRowsInTable("VETS")</strong></span>, vets.size());
        Vet v1 = EntityUtils.getById(vets, Vet.<span class="hl-keyword">class</span>, <span class="hl-number">2</span>);
        assertEquals(<span class="hl-string">"Leary"</span>, v1.getLastName());
        assertEquals(<span class="hl-number">1</span>, v1.getNrOfSpecialties());
        assertEquals(<span class="hl-string">"radiology"</span>, (v1.getSpecialties().get(<span class="hl-number">0</span>)).getName());
        <span class="hl-comment">// ...</span>
    }

    <span class="hl-comment">// ...</span>
}</pre>
<p>Notes:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
This test case extends the <code class="literal">AbstractTransactionalJUnit4SpringContextTests</code> class, from
which it inherits configuration for Dependency Injection (through the
<code class="literal">DependencyInjectionTestExecutionListener</code>) and transactional behavior (through the
<code class="literal">TransactionalTestExecutionListener</code>).
</li><li class="listitem">
The <code class="literal">clinic</code> instance variable&#8201;—&#8201;the application object being tested&#8201;—&#8201;is set by
Dependency Injection through <code class="literal">@Autowired</code> semantics.
</li><li class="listitem">
The <code class="literal">getVets()</code> method illustrates how you can use the inherited <code class="literal">countRowsInTable()</code>
method to easily verify the number of rows in a given table, thus verifying correct
behavior of the application code being tested. This allows for stronger tests and
lessens dependency on the exact test data. For example, you can add additional rows in
the database without breaking tests.
</li><li class="listitem">
Like many integration tests that use a database, most of the tests in
<code class="literal">AbstractClinicTests</code> depend on a minimum amount of data already in the database before
the test cases run. Alternatively, you might choose to populate the database within the
test fixture set up of your test cases&#8201;—&#8201;again, within the same transaction as the
tests.
</li></ul></div>
<p>The PetClinic application supports three data access technologies: JDBC, Hibernate, and
JPA. By declaring <code class="literal">@ContextConfiguration</code> without any specific resource locations, the
<code class="literal">AbstractClinicTests</code> class will have its application context loaded from the default
location, <code class="literal">AbstractClinicTests-context.xml</code>, which declares a common <code class="literal">DataSource</code>.
Subclasses specify additional context locations that must declare a
<code class="literal">PlatformTransactionManager</code> and a concrete implementation of <code class="literal">Clinic</code>.</p>
<p>For example, the Hibernate implementation of the PetClinic tests contains the following
implementation. For this example, <code class="literal">HibernateClinicTests</code> does not contain a single line
of code: we only need to declare <code class="literal">@ContextConfiguration</code>, and the tests are inherited
from <code class="literal">AbstractClinicTests</code>. Because <code class="literal">@ContextConfiguration</code> is declared without any
specific resource locations, the <span class="emphasis"><em>Spring TestContext Framework</em></span> loads an application
context from all the beans defined in <code class="literal">AbstractClinicTests-context.xml</code> (i.e., the
inherited locations) and <code class="literal">HibernateClinicTests-context.xml</code>, with
<code class="literal">HibernateClinicTests-context.xml</code> possibly overriding beans defined in
<code class="literal">AbstractClinicTests-context.xml</code>.</p>
<pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateClinicTests <span class="hl-keyword">extends</span> AbstractClinicTests { }</pre>
<p>In a large-scale application, the Spring configuration is often split across multiple
files. Consequently, configuration locations are typically specified in a common base
class for all application-specific integration tests. Such a base class may also add
useful instance variables&#8201;—&#8201;populated by Dependency Injection, naturally&#8201;—&#8201;such as a
<code class="literal">SessionFactory</code> in the case of an application using Hibernate.</p>
<p>As far as possible, you should have exactly the same Spring configuration files in your
integration tests as in the deployed environment. One likely point of difference
concerns database connection pooling and transaction infrastructure. If you are
deploying to a full-blown application server, you will probably use its connection pool
(available through JNDI) and JTA implementation. Thus in production you will use a
<code class="literal">JndiObjectFactoryBean</code> or <code class="literal">&lt;jee:jndi-lookup&gt;</code> for the <code class="literal">DataSource</code> and
<code class="literal">JtaTransactionManager</code>. JNDI and JTA will not be available in out-of-container
integration tests, so you should use a combination like the Commons DBCP
<code class="literal">BasicDataSource</code> and <code class="literal">DataSourceTransactionManager</code> or <code class="literal">HibernateTransactionManager</code>
for them. You can factor out this variant behavior into a single XML file, having the
choice between application server and a 'local' configuration separated from all other
configuration, which will not vary between the test and production environments. In
addition, it is advisable to use properties files for connection settings. See the
PetClinic application for an example.</p>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="testing-resources" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#testing-resources"></a>16.&nbsp;Further Resources</h2></div></div></div>

<p>Consult the following resources for more information about testing:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="http://www.junit.org/" target="_top">JUnit</a>: "<span class="emphasis"><em>A programmer-oriented testing framework for Java</em></span>".
Used by the Spring Framework in its test suite.
</li><li class="listitem">
<a class="ulink" href="http://testng.org/" target="_top">TestNG</a>: A testing framework inspired by JUnit with added support
for annotations, test groups, data-driven testing, distributed testing, etc.
</li><li class="listitem">
<a class="ulink" href="https://joel-costigliola.github.io/assertj/" target="_top">AssertJ</a>: "<span class="emphasis"><em>Fluent assertions for Java</em></span>"
including support for Java 8 lambdas, streams, etc.
</li><li class="listitem">
<a class="ulink" href="https://en.wikipedia.org/wiki/Mock_Object" target="_top">Mock Objects</a>: Article in Wikipedia.
</li><li class="listitem">
<a class="ulink" href="http://www.mockobjects.com/" target="_top">MockObjects.com</a>: Web site dedicated to mock objects, a
technique for improving the design of code within test-driven development.
</li><li class="listitem">
<a class="ulink" href="http://mockito.org/" target="_top">Mockito</a>: Java mock library based on the
<a class="ulink" href="http://xunitpatterns.com/Test%20Spy.html" target="_top">test spy</a> pattern.
</li><li class="listitem">
<a class="ulink" href="http://www.easymock.org/" target="_top">EasyMock</a>: Java library "<span class="emphasis"><em>that provides Mock Objects for
interfaces (and objects through the class extension) by generating them on the fly
using Java’s proxy mechanism.</em></span>" Used by the Spring Framework in its test suite.
</li><li class="listitem">
<a class="ulink" href="http://www.jmock.org/" target="_top">JMock</a>: Library that supports test-driven development of Java
code with mock objects.
</li><li class="listitem">
<a class="ulink" href="http://dbunit.sourceforge.net/" target="_top">DbUnit</a>: JUnit extension (also usable with Ant and
Maven) targeted for database-driven projects that, among other things, puts your
database into a known state between test runs.
</li><li class="listitem">
<a class="ulink" href="http://grinder.sourceforge.net/" target="_top">The Grinder</a>: Java load testing framework.
</li></ul></div>
</div>
</div>
<div class="part"><div class="titlepage"><div><div><h1 class="title"><a name="spring-data-tier" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#spring-data-tier"></a>Part&nbsp;V.&nbsp;Data Access</h1></div></div></div>

<div class="partintro"><div></div>
<p>This part of the reference documentation is concerned with data access and the
interaction between the data access layer and the business or service layer.</p>
<p>Spring’s comprehensive transaction management support is covered in some detail,
followed by thorough coverage of the various data access frameworks and technologies
that the Spring Framework integrates with.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction" title="17. Transaction Management">Chapter&nbsp;17, <i>Transaction Management</i></a>
</li><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dao" title="18. DAO support">Chapter&nbsp;18, <i>DAO support</i></a>
</li><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc" title="19. Data access with JDBC">Chapter&nbsp;19, <i>Data access with JDBC</i></a>
</li><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#orm" title="20. Object Relational Mapping (ORM) Data Access">Chapter&nbsp;20, <i>Object Relational Mapping (ORM) Data Access</i></a>
</li><li class="listitem">
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#oxm" title="21. Marshalling XML using O/X Mappers">Chapter&nbsp;21, <i>Marshalling XML using O/X Mappers</i></a>
</li></ul></div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="transaction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction"></a>17.&nbsp;Transaction Management</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-intro" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-intro"></a>17.1&nbsp;Introduction to Spring Framework transaction management</h2></div></div></div>

<p>Comprehensive transaction support is among the most compelling reasons to use the Spring
Framework. The Spring Framework provides a consistent abstraction for transaction
management that delivers the following benefits:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Consistent programming model across different transaction APIs such as Java
Transaction API (JTA), JDBC, Hibernate, Java Persistence API (JPA), and Java Data
Objects (JDO).
</li><li class="listitem">
Support for <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative" title="17.5 Declarative transaction management">declarative transaction management</a>.
</li><li class="listitem">
Simpler API for <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-programmatic" title="17.6 Programmatic transaction management">programmatic</a> transaction management than
complex transaction APIs such as JTA.
</li><li class="listitem">
Excellent integration with Spring’s data access abstractions.
</li></ul></div>
<p>The following sections describe the Spring Framework’s transaction value-adds and
technologies. (The chapter also includes discussions of best practices, application
server integration, and solutions to common problems.)</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-motivation" title="17.2 Advantages of the Spring Framework’s transaction support model">Advantages of the Spring Framework’s transaction support
model</a> describes <span class="emphasis"><em>why</em></span> you would use the Spring Framework’s transaction abstraction
instead of EJB Container-Managed Transactions (CMT) or choosing to drive local
transactions through a proprietary API such as Hibernate.
</li><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-strategies" title="17.3 Understanding the Spring Framework transaction abstraction">Understanding the Spring Framework transaction abstraction</a>
outlines the core classes and describes how to configure and obtain <code class="literal">DataSource</code>
instances from a variety of sources.
</li><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-resource-synchronization" title="17.4 Synchronizing resources with transactions">Synchronizing resources with transactions</a>describes
how the application code ensures that resources are created, reused, and cleaned up
properly.
</li><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative" title="17.5 Declarative transaction management">Declarative transaction management</a> describes support for
declarative transaction management.
</li><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-programmatic" title="17.6 Programmatic transaction management">Programmatic transaction management</a> covers support for
programmatic (that is, explicitly coded) transaction management.
</li><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-event" title="17.8 Transaction bound event">Transaction bound event</a> describes how you could use application
events within a transaction.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-motivation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-motivation"></a>17.2&nbsp;Advantages of the Spring Framework’s transaction support model</h2></div></div></div>

<p>Traditionally, Java EE developers have had two choices for transaction management:
<span class="emphasis"><em>global</em></span> or <span class="emphasis"><em>local</em></span> transactions, both of which have profound limitations. Global
and local transaction management is reviewed in the next two sections, followed by a
discussion of how the Spring Framework’s transaction management support addresses the
limitations of the global and local transaction models.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-global" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-global"></a>17.2.1&nbsp;Global transactions</h3></div></div></div>

<p>Global transactions enable you to work with multiple transactional resources, typically
relational databases and message queues. The application server manages global
transactions through the JTA, which is a cumbersome API to use (partly due to its
exception model). Furthermore, a JTA <code class="literal">UserTransaction</code> normally needs to be sourced from
JNDI, meaning that you <span class="emphasis"><em>also</em></span> need to use JNDI in order to use JTA. Obviously the use
of global transactions would limit any potential reuse of application code, as JTA is
normally only available in an application server environment.</p>
<p>Previously, the preferred way to use global transactions was via EJB <span class="emphasis"><em>CMT</em></span>
(<span class="emphasis"><em>Container Managed Transaction</em></span>): CMT is a form of <span class="emphasis"><em>declarative transaction
management</em></span> (as distinguished from <span class="emphasis"><em>programmatic transaction management</em></span>). EJB CMT
removes the need for transaction-related JNDI lookups, although of course the use of EJB
itself necessitates the use of JNDI. It removes most but not all of the need to write
Java code to control transactions. The significant downside is that CMT is tied to JTA
and an application server environment. Also, it is only available if one chooses to
implement business logic in EJBs, or at least behind a transactional EJB facade. The
negatives of EJB in general are so great that this is not an attractive proposition,
especially in the face of compelling alternatives for declarative transaction management.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-local" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-local"></a>17.2.2&nbsp;Local transactions</h3></div></div></div>

<p>Local transactions are resource-specific, such as a transaction associated with a JDBC
connection. Local transactions may be easier to use, but have significant disadvantages:
they cannot work across multiple transactional resources. For example, code that manages
transactions using a JDBC connection cannot run within a global JTA transaction. Because
the application server is not involved in transaction management, it cannot help ensure
correctness across multiple resources. (It is worth noting that most applications use a
single transaction resource.) Another downside is that local transactions are invasive
to the programming model.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-programming-model" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-programming-model"></a>17.2.3&nbsp;Spring Framework’s consistent programming model</h3></div></div></div>

<p>Spring resolves the disadvantages of global and local transactions. It enables
application developers to use a <span class="emphasis"><em>consistent</em></span> programming model <span class="emphasis"><em>in any environment</em></span>.
You write your code once, and it can benefit from different transaction management
strategies in different environments. The Spring Framework provides both declarative and
programmatic transaction management. Most users prefer declarative transaction
management, which is recommended in most cases.</p>
<p>With programmatic transaction management, developers work with the Spring Framework
transaction abstraction, which can run over any underlying transaction infrastructure.
With the preferred declarative model, developers typically write little or no code
related to transaction management, and hence do not depend on the Spring Framework
transaction API, or any other transaction API.</p>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Do you need an application server for transaction management?</b></p></div></div></div>

<p>The Spring Framework’s transaction management support changes traditional rules as to
when an enterprise Java application requires an application server.</p>
<p>In particular, you do not need an application server simply for declarative transactions
through EJBs. In fact, even if your application server has powerful JTA capabilities,
you may decide that the Spring Framework’s declarative transactions offer more power and
a more productive programming model than EJB CMT.</p>
<p>Typically you need an application server’s JTA capability only if your application needs
to handle transactions across multiple resources, which is not a requirement for many
applications. Many high-end applications use a single, highly scalable database (such as
Oracle RAC) instead. Standalone transaction managers such as
<a class="ulink" href="http://www.atomikos.com/" target="_top">Atomikos Transactions</a> and <a class="ulink" href="http://jotm.objectweb.org/" target="_top">JOTM</a>
are other options. Of course, you may need other application server capabilities such as
Java Message Service (JMS) and Java EE Connector Architecture (JCA).</p>
<p>The Spring Framework <span class="emphasis"><em>gives you the choice of when to scale your application to a fully
loaded application server</em></span>. Gone are the days when the only alternative to using EJB
CMT or JTA was to write code with local transactions such as those on JDBC connections,
and face a hefty rework if you need that code to run within global, container-managed
transactions. With the Spring Framework, only some of the bean definitions in your
configuration file, rather than your code, need to change.</p>
</div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-strategies" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-strategies"></a>17.3&nbsp;Understanding the Spring Framework transaction abstraction</h2></div></div></div>

<p>The key to the Spring transaction abstraction is the notion of a <span class="emphasis"><em>transaction
strategy</em></span>. A transaction strategy is defined by the
<code class="literal">org.springframework.transaction.PlatformTransactionManager</code> interface:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> PlatformTransactionManager {

    TransactionStatus getTransaction(
            TransactionDefinition definition) <span class="hl-keyword">throws</span> TransactionException;

    <span class="hl-keyword">void</span> commit(TransactionStatus status) <span class="hl-keyword">throws</span> TransactionException;

    <span class="hl-keyword">void</span> rollback(TransactionStatus status) <span class="hl-keyword">throws</span> TransactionException;
}</pre>
<p>This is primarily a service provider interface (SPI), although it can be used
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-programmatic-ptm" title="17.6.2 Using the PlatformTransactionManager">programmatically</a> from your application code. Because
<code class="literal">PlatformTransactionManager</code> is an <span class="emphasis"><em>interface</em></span>, it can be easily mocked or stubbed as
necessary. It is not tied to a lookup strategy such as JNDI.
<code class="literal">PlatformTransactionManager</code> implementations are defined like any other object (or bean)
in the Spring Framework IoC container. This benefit alone makes Spring Framework
transactions a worthwhile abstraction even when you work with JTA. Transactional code
can be tested much more easily than if it used JTA directly.</p>
<p>Again in keeping with Spring’s philosophy, the <code class="literal">TransactionException</code> that can be thrown
by any of the <code class="literal">PlatformTransactionManager</code> interface’s methods is <span class="emphasis"><em>unchecked</em></span> (that
is, it extends the <code class="literal">java.lang.RuntimeException</code> class). Transaction infrastructure
failures are almost invariably fatal. In rare cases where application code can actually
recover from a transaction failure, the application developer can still choose to catch
and handle <code class="literal">TransactionException</code>. The salient point is that developers are not
<span class="emphasis"><em>forced</em></span> to do so.</p>
<p>The <code class="literal">getTransaction(..)</code> method returns a <code class="literal">TransactionStatus</code> object, depending on a
<code class="literal">TransactionDefinition</code> parameter. The returned <code class="literal">TransactionStatus</code> might represent a
new transaction, or can represent an existing transaction if a matching transaction
exists in the current call stack. The implication in this latter case is that, as with
Java EE transaction contexts, a <code class="literal">TransactionStatus</code> is associated with a <span class="emphasis"><em>thread</em></span> of
execution.</p>
<p>The <code class="literal">TransactionDefinition</code> interface specifies:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>Isolation</em></span>: The degree to which this transaction is isolated from the work of other
transactions. For example, can this transaction see uncommitted writes from other
transactions?
</li><li class="listitem">
<span class="emphasis"><em>Propagation</em></span>: Typically, all code executed within a transaction scope will run in
that transaction. However, you have the option of specifying the behavior in the event
that a transactional method is executed when a transaction context already exists. For
example, code can continue running in the existing transaction (the common case); or
the existing transaction can be suspended and a new transaction created. <span class="emphasis"><em>Spring
offers all of the transaction propagation options familiar from EJB CMT</em></span>. To read
about the semantics of transaction propagation in Spring, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation" title="17.5.7 Transaction propagation">Section&nbsp;17.5.7, “Transaction propagation”</a>.
</li><li class="listitem">
<span class="emphasis"><em>Timeout</em></span>: How long this transaction runs before timing out and being rolled back
automatically by the underlying transaction infrastructure.
</li><li class="listitem">
<span class="emphasis"><em>Read-only status</em></span>: A read-only transaction can be used when your code reads but
does not modify data. Read-only transactions can be a useful optimization in some
cases, such as when you are using Hibernate.
</li></ul></div>
<p>These settings reflect standard transactional concepts. If necessary, refer to resources
that discuss transaction isolation levels and other core transaction concepts.
Understanding these concepts is essential to using the Spring Framework or any
transaction management solution.</p>
<p>The <code class="literal">TransactionStatus</code> interface provides a simple way for transactional code to
control transaction execution and query transaction status. The concepts should be
familiar, as they are common to all transaction APIs:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> TransactionStatus <span class="hl-keyword">extends</span> SavepointManager {

    <span class="hl-keyword">boolean</span> isNewTransaction();

    <span class="hl-keyword">boolean</span> hasSavepoint();

    <span class="hl-keyword">void</span> setRollbackOnly();

    <span class="hl-keyword">boolean</span> isRollbackOnly();

    <span class="hl-keyword">void</span> flush();

    <span class="hl-keyword">boolean</span> isCompleted();

}</pre>
<p>Regardless of whether you opt for declarative or programmatic transaction management in
Spring, defining the correct <code class="literal">PlatformTransactionManager</code> implementation is absolutely
essential. You typically define this implementation through dependency injection.</p>
<p><code class="literal">PlatformTransactionManager</code> implementations normally require knowledge of the
environment in which they work: JDBC, JTA, Hibernate, and so on. The following examples
show how you can define a local <code class="literal">PlatformTransactionManager</code> implementation. (This
example works with plain JDBC.)</p>
<p>You define a JDBC <code class="literal">DataSource</code></p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>The related <code class="literal">PlatformTransactionManager</code> bean definition will then have a reference to
the <code class="literal">DataSource</code> definition. It will look like this:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>If you use JTA in a Java EE container then you use a container <code class="literal">DataSource</code>, obtained
through JNDI, in conjunction with Spring’s <code class="literal">JtaTransactionManager</code>. This is what the JTA
and JNDI lookup version would look like:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://www.springframework.org/schema/jee"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/jee
        http://www.springframework.org/schema/jee/spring-jee.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"jdbc/jpetstore"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-comment">&lt;!-- other &lt;bean/&gt; definitions here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The <code class="literal">JtaTransactionManager</code> does not need to know about the <code class="literal">DataSource</code>, or any other
specific resources, because it uses the container’s global transaction management
infrastructure.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The above definition of the <code class="literal">dataSource</code> bean uses the <code class="literal">&lt;jndi-lookup/&gt;</code> tag from the
<code class="literal">jee</code> namespace. For more information on schema-based configuration, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-configuration" title="41. XML Schema-based configuration">Chapter&nbsp;41, <i>XML Schema-based configuration</i></a>,
and for more information on the <code class="literal">&lt;jee/&gt;</code> tags see the section entitled
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-jee" title="41.2.3 the jee schema">Section&nbsp;41.2.3, “the jee schema”</a>.</p>
</td></tr></tbody></table></div>
<p>You can also use Hibernate local transactions easily, as shown in the following
examples. In this case, you need to define a Hibernate <code class="literal">LocalSessionFactoryBean</code>, which
your application code will use to obtain Hibernate <code class="literal">Session</code> instances.</p>
<p>The <code class="literal">DataSource</code> bean definition will be similar to the local JDBC example shown
previously and thus is not shown in the following example.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If the <code class="literal">DataSource</code>, used by any non-JTA transaction manager, is looked up via JNDI and
managed by a Java EE container, then it should be non-transactional because the Spring
Framework, rather than the Java EE container, will manage the transactions.</p>
</td></tr></tbody></table></div>
<p>The <code class="literal">txManager</code> bean in this case is of the <code class="literal">HibernateTransactionManager</code> type. In the
same way as the <code class="literal">DataSourceTransactionManager</code> needs a reference to the <code class="literal">DataSource</code>,
the <code class="literal">HibernateTransactionManager</code> needs a reference to the <code class="literal">SessionFactory</code>.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate5.LocalSessionFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappingResources"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>org/springframework/samples/petclinic/hibernate/petclinic.hbm.xml<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hibernateProperties"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>
            hibernate.dialect=${hibernate.dialect}
        <span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate5.HibernateTransactionManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"sessionFactory"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>If you are using Hibernate and Java EE container-managed JTA transactions, then you
should simply use the same <code class="literal">JtaTransactionManager</code> as in the previous JTA example for
JDBC.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span><span class="hl-tag">/&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>If you use JTA , then your transaction manager definition will look the same regardless
of what data access technology you use, be it JDBC, Hibernate JPA or any other supported
technology. This is due to the fact that JTA transactions are global transactions, which
can enlist any transactional resource.</p>
</td></tr></tbody></table></div>
<p>In all these cases, application code does not need to change. You can change how
transactions are managed merely by changing configuration, even if that change means
moving from local to global transactions or vice versa.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-resource-synchronization" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-resource-synchronization"></a>17.4&nbsp;Synchronizing resources with transactions</h2></div></div></div>

<p>It should now be clear how you create different transaction managers, and how they are
linked to related resources that need to be synchronized to transactions (for example
<code class="literal">DataSourceTransactionManager</code> to a JDBC <code class="literal">DataSource</code>, <code class="literal">HibernateTransactionManager</code> to
a Hibernate <code class="literal">SessionFactory</code>, and so forth). This section describes how the application
code, directly or indirectly using a persistence API such as JDBC, Hibernate, or JDO,
ensures that these resources are created, reused, and cleaned up properly. The section
also discusses how transaction synchronization is triggered (optionally) through the
relevant <code class="literal">PlatformTransactionManager</code>.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-high" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-resource-synchronization-high"></a>17.4.1&nbsp;High-level synchronization approach</h3></div></div></div>

<p>The preferred approach is to use Spring’s highest level template based persistence
integration APIs or to use native ORM APIs with transaction- aware factory beans or
proxies for managing the native resource factories. These transaction-aware solutions
internally handle resource creation and reuse, cleanup, optional transaction
synchronization of the resources, and exception mapping. Thus user data access code does
not have to address these tasks, but can be focused purely on non-boilerplate
persistence logic. Generally, you use the native ORM API or take a <span class="emphasis"><em>template</em></span> approach
for JDBC access by using the <code class="literal">JdbcTemplate</code>. These solutions are detailed in subsequent
chapters of this reference documentation.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-low" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-resource-synchronization-low"></a>17.4.2&nbsp;Low-level synchronization approach</h3></div></div></div>

<p>Classes such as <code class="literal">DataSourceUtils</code> (for JDBC), <code class="literal">EntityManagerFactoryUtils</code> (for JPA),
<code class="literal">SessionFactoryUtils</code> (for Hibernate), <code class="literal">PersistenceManagerFactoryUtils</code> (for JDO), and
so on exist at a lower level. When you want the application code to deal directly with
the resource types of the native persistence APIs, you use these classes to ensure that
proper Spring Framework-managed instances are obtained, transactions are (optionally)
synchronized, and exceptions that occur in the process are properly mapped to a
consistent API.</p>
<p>For example, in the case of JDBC, instead of the traditional JDBC approach of calling
the <code class="literal">getConnection()</code> method on the <code class="literal">DataSource</code>, you instead use Spring’s
<code class="literal">org.springframework.jdbc.datasource.DataSourceUtils</code> class as follows:</p>
<pre class="programlisting">Connection conn = DataSourceUtils.getConnection(dataSource);</pre>
<p>If an existing transaction already has a connection synchronized (linked) to it, that
instance is returned. Otherwise, the method call triggers the creation of a new
connection, which is (optionally) synchronized to any existing transaction, and made
available for subsequent reuse in that same transaction. As mentioned, any
<code class="literal">SQLException</code> is wrapped in a Spring Framework <code class="literal">CannotGetJdbcConnectionException</code>, one
of the Spring Framework’s hierarchy of unchecked DataAccessExceptions. This approach
gives you more information than can be obtained easily from the <code class="literal">SQLException</code>, and
ensures portability across databases, even across different persistence technologies.</p>
<p>This approach also works without Spring transaction management (transaction
synchronization is optional), so you can use it whether or not you are using Spring for
transaction management.</p>
<p>Of course, once you have used Spring’s JDBC support, JPA support or Hibernate support,
you will generally prefer not to use <code class="literal">DataSourceUtils</code> or the other helper classes,
because you will be much happier working through the Spring abstraction than directly
with the relevant APIs. For example, if you use the Spring <code class="literal">JdbcTemplate</code> or
<code class="literal">jdbc.object</code> package to simplify your use of JDBC, correct connection retrieval occurs
behind the scenes and you won’t need to write any special code.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-tadsp" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-resource-synchronization-tadsp"></a>17.4.3&nbsp;TransactionAwareDataSourceProxy</h3></div></div></div>

<p>At the very lowest level exists the <code class="literal">TransactionAwareDataSourceProxy</code> class. This is a
proxy for a target <code class="literal">DataSource</code>, which wraps the target <code class="literal">DataSource</code> to add awareness of
Spring-managed transactions. In this respect, it is similar to a transactional JNDI
<code class="literal">DataSource</code> as provided by a Java EE server.</p>
<p>It should almost never be necessary or desirable to use this class, except when existing
code must be called and passed a standard JDBC <code class="literal">DataSource</code> interface implementation. In
that case, it is possible that this code is usable, but participating in Spring managed
transactions. It is preferable to write your new code by using the higher level
abstractions mentioned above.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-declarative" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative"></a>17.5&nbsp;Declarative transaction management</h2></div></div></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Most Spring Framework users choose declarative transaction management. This option has
the least impact on application code, and hence is most consistent with the ideals of a
<span class="emphasis"><em>non-invasive</em></span> lightweight container.</p>
</td></tr></tbody></table></div>
<p>The Spring Framework’s declarative transaction management is made possible with Spring
aspect-oriented programming (AOP), although, as the transactional aspects code comes
with the Spring Framework distribution and may be used in a boilerplate fashion, AOP
concepts do not generally have to be understood to make effective use of this code.</p>
<p>The Spring Framework’s declarative transaction management is similar to EJB CMT in that
you can specify transaction behavior (or lack of it) down to individual method level. It
is possible to make a <code class="literal">setRollbackOnly()</code> call within a transaction context if
necessary. The differences between the two types of transaction management are:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Unlike EJB CMT, which is tied to JTA, the Spring Framework’s declarative transaction
management works in any environment. It can work with JTA transactions or local
transactions using JDBC, JPA, Hibernate or JDO by simply adjusting the configuration
files.
</li><li class="listitem">
You can apply the Spring Framework declarative transaction management to any class,
not merely special classes such as EJBs.
</li><li class="listitem">
The Spring Framework offers declarative
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-rolling-back" title="17.5.3 Rolling back a declarative transaction"><span class="emphasis"><em>rollback rules</em></span>,</a>a feature with no EJB
equivalent. Both programmatic and declarative support for rollback rules is provided.
</li><li class="listitem">
The Spring Framework enables you to customize transactional behavior, by using AOP.
For example, you can insert custom behavior in the case of transaction rollback. You
can also add arbitrary advice, along with the transactional advice. With EJB CMT, you
cannot influence the container’s transaction management except with
<code class="literal">setRollbackOnly()</code>.
</li><li class="listitem">
The Spring Framework does not support propagation of transaction contexts across
remote calls, as do high-end application servers. If you need this feature, we
recommend that you use EJB. However, consider carefully before using such a feature,
because normally, one does not want transactions to span remote calls.
</li></ul></div>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Where is TransactionProxyFactoryBean?</b></p></div></div></div>

<p>Declarative transaction configuration in versions of Spring 2.0 and above differs
considerably from previous versions of Spring. The main difference is that there is no
longer any need to configure <code class="literal">TransactionProxyFactoryBean</code> beans.</p>
<p>The pre-Spring 2.0 configuration style is still 100% valid configuration; think of the
new <code class="literal">&lt;tx:tags/&gt;</code> as simply defining <code class="literal">TransactionProxyFactoryBean</code> beans on your behalf.</p>
</div>
<p>The concept of rollback rules is important: they enable you to specify which exceptions
(and throwables) should cause automatic rollback. You specify this declaratively, in
configuration, not in Java code. So, although you can still call <code class="literal">setRollbackOnly()</code> on
the <code class="literal">TransactionStatus</code> object to roll back the current transaction back, most often you
can specify a rule that <code class="literal">MyApplicationException</code> must always result in rollback. The
significant advantage to this option is that business objects do not depend on the
transaction infrastructure. For example, they typically do not need to import Spring
transaction APIs or other Spring APIs.</p>
<p>Although EJB container default behavior automatically rolls back the transaction on a
<span class="emphasis"><em>system exception</em></span> (usually a runtime exception), EJB CMT does not roll back the
transaction automatically on an<span class="emphasis"><em>application exception</em></span> (that is, a checked exception
other than <code class="literal">java.rmi.RemoteException</code>). While the Spring default behavior for
declarative transaction management follows EJB convention (roll back is automatic only
on unchecked exceptions), it is often useful to customize this behavior.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-decl-explained" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-decl-explained"></a>17.5.1&nbsp;Understanding the Spring Framework’s declarative transaction implementation</h3></div></div></div>

<p>It is not sufficient to tell you simply to annotate your classes with the
<code class="literal">@Transactional</code> annotation, add <code class="literal">@EnableTransactionManagement</code> to your configuration,
and then expect you to understand how it all works. This section explains the inner
workings of the Spring Framework’s declarative transaction infrastructure in the event
of transaction-related issues.</p>
<p>The most important concepts to grasp with regard to the Spring Framework’s declarative
transaction support are that this support is enabled
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-understanding-aop-proxies" title="11.6.1 Understanding AOP proxies"><span class="emphasis"><em>via AOP proxies</em></span></a>, and that the transactional advice
is driven by <span class="emphasis"><em>metadata</em></span> (currently XML- or annotation-based). The combination of AOP
with transactional metadata yields an AOP proxy that uses a <code class="literal">TransactionInterceptor</code> in
conjunction with an appropriate <code class="literal">PlatformTransactionManager</code> implementation to drive
transactions <span class="emphasis"><em>around method invocations</em></span>.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Spring AOP is covered in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop" title="11. Aspect Oriented Programming with Spring">Chapter&nbsp;11, <i>Aspect Oriented Programming with Spring</i></a>.</p>
</td></tr></tbody></table></div>
<p>Conceptually, calling a method on a transactional proxy looks like this…&#8203;</p>
<div class="informalfigure">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/tx.png.pagespeed.ce.FxwdOUVtVX.png" alt="tx"></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-first-example" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-first-example"></a>17.5.2&nbsp;Example of declarative transaction implementation</h3></div></div></div>

<p>Consider the following interface, and its attendant implementation. This example uses
<code class="literal">Foo</code> and <code class="literal">Bar</code> classes as placeholders so that you can concentrate on the transaction
usage without focusing on a particular domain model. For the purposes of this example,
the fact that the <code class="literal">DefaultFooService</code> class throws <code class="literal">UnsupportedOperationException</code>
instances in the body of each implemented method is good; it allows you to see
transactions created and then rolled back in response to the
<code class="literal">UnsupportedOperationException</code> instance.</p>
<pre class="programlisting"><span class="hl-comment">// the service interface that we want to make transactional</span>

<span class="hl-keyword">package</span> x.y.service;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FooService {

    Foo getFoo(String fooName);

    Foo getFoo(String fooName, String barName);

    <span class="hl-keyword">void</span> insertFoo(Foo foo);

    <span class="hl-keyword">void</span> updateFoo(Foo foo);

}</pre>
<pre class="programlisting"><span class="hl-comment">// an implementation of the above interface</span>

<span class="hl-keyword">package</span> x.y.service;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

    <span class="hl-keyword">public</span> Foo getFoo(String fooName) {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
    }

    <span class="hl-keyword">public</span> Foo getFoo(String fooName, String barName) {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertFoo(Foo foo) {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateFoo(Foo foo) {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
    }

}</pre>
<p>Assume that the first two methods of the <code class="literal">FooService</code> interface, <code class="literal">getFoo(String)</code> and
<code class="literal">getFoo(String, String)</code>, must execute in the context of a transaction with read-only
semantics, and that the other methods, <code class="literal">insertFoo(Foo)</code> and <code class="literal">updateFoo(Foo)</code>, must
execute in the context of a transaction with read-write semantics. The following
configuration is explained in detail in the next few paragraphs.</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- from the file 'context.xml' --&gt;</span>
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- this is the service object that we want to make transactional --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- the transactional advice (what 'happens'; see the &lt;aop:advisor/&gt; bean below) --&gt;</span>
    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- the transactional semantics... --&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-comment">&lt;!-- all methods starting with 'get' are read-only --&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-comment">&lt;!-- other methods use the default transaction settings (see below) --&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-comment">&lt;!-- ensure that the above transactional advice runs for any execution
        of an operation defined by the FooService interface --&gt;</span>
    <span class="hl-tag">&lt;aop:config&gt;</span>
        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooServiceOperation"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.FooService.*(..))"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"fooServiceOperation"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-comment">&lt;!-- don't forget the DataSource --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"oracle.jdbc.driver.OracleDriver"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:oracle:thin:@rj-t42:1521:elvis"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"scott"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tiger"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- similarly, don't forget the PlatformTransactionManager --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- other &lt;bean/&gt; definitions here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>Examine the preceding configuration. You want to make a service object, the <code class="literal">fooService</code>
bean, transactional. The transaction semantics to apply are encapsulated in the
<code class="literal">&lt;tx:advice/&gt;</code> definition. The <code class="literal">&lt;tx:advice/&gt;</code> definition reads as "<span class="emphasis"><em>…&#8203; all methods on
starting with <code class="literal">'get'</code> are to execute in the context of a read-only transaction, and all
other methods are to execute with the default transaction semantics</em></span>". The
<code class="literal">transaction-manager</code> attribute of the <code class="literal">&lt;tx:advice/&gt;</code> tag is set to the name of the
<code class="literal">PlatformTransactionManager</code> bean that is going to <span class="emphasis"><em>drive</em></span> the transactions, in this
case, the <code class="literal">txManager</code> bean.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>You can omit the <code class="literal">transaction-manager</code> attribute in the transactional advice
(<code class="literal">&lt;tx:advice/&gt;</code>) if the bean name of the <code class="literal">PlatformTransactionManager</code> that you want to
wire in has the name <code class="literal">transactionManager</code>. If the <code class="literal">PlatformTransactionManager</code> bean that
you want to wire in has any other name, then you must use the <code class="literal">transaction-manager</code>
attribute explicitly, as in the preceding example.</p>
</td></tr></tbody></table></div>
<p>The <code class="literal">&lt;aop:config/&gt;</code> definition ensures that the transactional advice defined by the
<code class="literal">txAdvice</code> bean executes at the appropriate points in the program. First you define a
pointcut that matches the execution of any operation defined in the <code class="literal">FooService</code>
interface ( <code class="literal">fooServiceOperation</code>). Then you associate the pointcut with the <code class="literal">txAdvice</code>
using an advisor. The result indicates that at the execution of a <code class="literal">fooServiceOperation</code>,
the advice defined by <code class="literal">txAdvice</code> will be run.</p>
<p>The expression defined within the <code class="literal">&lt;aop:pointcut/&gt;</code> element is an AspectJ pointcut
expression; see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop" title="11. Aspect Oriented Programming with Spring">Chapter&nbsp;11, <i>Aspect Oriented Programming with Spring</i></a> for more details on pointcut expressions in Spring.</p>
<p>A common requirement is to make an entire service layer transactional. The best way to
do this is simply to change the pointcut expression to match any operation in your
service layer. For example:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>
    <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooServiceMethods"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.*.*(..))"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"fooServiceMethods"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span></pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><span class="emphasis"><em>In this example it is assumed that all your service interfaces are defined in the
<code class="literal">x.y.service</code> package; see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop" title="11. Aspect Oriented Programming with Spring">Chapter&nbsp;11, <i>Aspect Oriented Programming with Spring</i></a> for more details.</em></span></p>
</td></tr></tbody></table></div>
<p>Now that we’ve analyzed the configuration, you may be asking yourself, "<span class="emphasis"><em>Okay…&#8203; but
what does all this configuration actually do?</em></span>".</p>
<p>The above configuration will be used to create a transactional proxy around the object
that is created from the <code class="literal">fooService</code> bean definition. The proxy will be configured with
the transactional advice, so that when an appropriate method is invoked <span class="emphasis"><em>on the
proxy</em></span>, a transaction is started, suspended, marked as read-only, and so on, depending
on the transaction configuration associated with that method. Consider the following
program that test drives the above configuration:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"context.xml"</span>, Boot.<span class="hl-keyword">class</span>);
        FooService fooService = (FooService) ctx.getBean(<span class="hl-string">"fooService"</span>);
        fooService.insertFoo (<span class="hl-keyword">new</span> Foo());
    }
}</pre>
<p>The output from running the preceding program will resemble the following. (The Log4J
output and the stack trace from the UnsupportedOperationException thrown by the
insertFoo(..) method of the DefaultFooService class have been truncated for clarity.)</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- the Spring container is starting up... --&gt;</span>
[AspectJInvocationContextExposingAdvisorAutoProxyCreator] - Creating implicit proxy for bean 'fooService' with 0 common interceptors and 1 specific interceptors

<span class="hl-comment">&lt;!-- the DefaultFooService is actually proxied --&gt;</span>
[JdkDynamicAopProxy] - Creating JDK dynamic proxy for [x.y.service.DefaultFooService]

<span class="hl-comment">&lt;!-- ... the insertFoo(..) method is now being invoked on the proxy --&gt;</span>
[TransactionInterceptor] - Getting transaction for x.y.service.FooService.insertFoo

<span class="hl-comment">&lt;!-- the transactional advice kicks in here... --&gt;</span>
[DataSourceTransactionManager] - Creating new transaction with name [x.y.service.FooService.insertFoo]
[DataSourceTransactionManager] - Acquired Connection [org.apache.commons.dbcp.PoolableConnection@a53de4] for JDBC transaction

<span class="hl-comment">&lt;!-- the insertFoo(..) method from DefaultFooService throws an exception... --&gt;</span>
[RuleBasedTransactionAttribute] - Applying rules to determine whether transaction should rollback on java.lang.UnsupportedOperationException
[TransactionInterceptor] - Invoking rollback for transaction on x.y.service.FooService.insertFoo due to throwable [java.lang.UnsupportedOperationException]

<span class="hl-comment">&lt;!-- and the transaction is rolled back (by default, RuntimeException instances cause rollback) --&gt;</span>
[DataSourceTransactionManager] - Rolling back JDBC transaction on Connection [org.apache.commons.dbcp.PoolableConnection@a53de4]
[DataSourceTransactionManager] - Releasing JDBC Connection after transaction
[DataSourceUtils] - Returning JDBC Connection to DataSource

Exception in thread "main" java.lang.UnsupportedOperationException at x.y.service.DefaultFooService.insertFoo(DefaultFooService.java:14)
<span class="hl-comment">&lt;!-- AOP infrastructure stack trace elements removed for clarity --&gt;</span>
at $Proxy0.insertFoo(Unknown Source)
at Boot.main(Boot.java:11)</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-rolling-back" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-rolling-back"></a>17.5.3&nbsp;Rolling back a declarative transaction</h3></div></div></div>

<p>The previous section outlined the basics of how to specify transactional settings for
classes, typically service layer classes, declaratively in your application. This
section describes how you can control the rollback of transactions in a simple
declarative fashion.</p>
<p>The recommended way to indicate to the Spring Framework’s transaction infrastructure
that a transaction’s work is to be rolled back is to throw an <code class="literal">Exception</code> from code that
is currently executing in the context of a transaction. The Spring Framework’s
transaction infrastructure code will catch any unhandled <code class="literal">Exception</code> as it bubbles up
the call stack, and make a determination whether to mark the transaction for rollback.</p>
<p>In its default configuration, the Spring Framework’s transaction infrastructure code
<span class="emphasis"><em>only</em></span> marks a transaction for rollback in the case of runtime, unchecked exceptions;
that is, when the thrown exception is an instance or subclass of <code class="literal">RuntimeException</code>. (
<code class="literal">Error</code>s will also - by default - result in a rollback). Checked exceptions that are
thrown from a transactional method do <span class="emphasis"><em>not</em></span> result in rollback in the default
configuration.</p>
<p>You can configure exactly which <code class="literal">Exception</code> types mark a transaction for rollback,
including checked exceptions. The following XML snippet demonstrates how you configure
rollback for a checked, application-specific <code class="literal">Exception</code> type.</p>
<pre class="programlisting"><span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">rollback-for</span>=<span class="hl-value">"NoProductInStockException"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre>
<p>You can also specify 'no rollback rules', if you do <span class="emphasis"><em>not</em></span> want a transaction rolled
back when an exception is thrown. The following example tells the Spring Framework’s
transaction infrastructure to commit the attendant transaction even in the face of an
unhandled <code class="literal">InstrumentNotFoundException</code>.</p>
<pre class="programlisting"><span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"updateStock"</span> <span class="hl-attribute">no-rollback-for</span>=<span class="hl-value">"InstrumentNotFoundException"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre>
<p>When the Spring Framework’s transaction infrastructure catches an exception and is
consults configured rollback rules to determine whether to mark the transaction for
rollback, the <span class="emphasis"><em>strongest</em></span> matching rule wins. So in the case of the following
configuration, any exception other than an <code class="literal">InstrumentNotFoundException</code> results in a
rollback of the attendant transaction.</p>
<pre class="programlisting"><span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">rollback-for</span>=<span class="hl-value">"Throwable"</span> <span class="hl-attribute">no-rollback-for</span>=<span class="hl-value">"InstrumentNotFoundException"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre>
<p>You can also indicate a required rollback <span class="emphasis"><em>programmatically</em></span>. Although very simple,
this process is quite invasive, and tightly couples your code to the Spring Framework’s
transaction infrastructure:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> resolvePosition() {
    <span class="hl-keyword">try</span> {
        <span class="hl-comment">// some business logic...</span>
    } <span class="hl-keyword">catch</span> (NoProductInStockException ex) {
        <span class="hl-comment">// trigger rollback programmatically</span>
        TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
    }
}</pre>
<p>You are strongly encouraged to use the declarative approach to rollback if at all
possible. Programmatic rollback is available should you absolutely need it, but its
usage flies in the face of achieving a clean POJO-based architecture.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-diff-tx" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-diff-tx"></a>17.5.4&nbsp;Configuring different transactional semantics for different beans</h3></div></div></div>

<p>Consider the scenario where you have a number of service layer objects, and you want to
apply a <span class="emphasis"><em>totally different</em></span> transactional configuration to each of them. You do this
by defining distinct <code class="literal">&lt;aop:advisor/&gt;</code> elements with differing <code class="literal">pointcut</code> and
<code class="literal">advice-ref</code> attribute values.</p>
<p>As a point of comparison, first assume that all of your service layer classes are
defined in a root <code class="literal">x.y.service</code> package. To make all beans that are instances of classes
defined in that package (or in subpackages) and that have names ending in <code class="literal">Service</code> have
the default transactional configuration, you would write the following:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:config&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceOperation"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service..*Service.*(..))"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"serviceOperation"</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-comment">&lt;!-- these two beans will be transactional... --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"barService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.extras.SimpleBarService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- ... and these two beans won't --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.xyz.SomeService"</span><span class="hl-tag">/&gt;</span> <span class="hl-comment">&lt;!-- (not in the right package) --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"barManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.SimpleBarManager"</span><span class="hl-tag">/&gt;</span> <span class="hl-comment">&lt;!-- (doesn't end in 'Service') --&gt;</span>

    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-comment">&lt;!-- other transaction infrastructure beans such as a PlatformTransactionManager omitted... --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The following example shows how to configure two distinct beans with totally different
transactional settings.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:config&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"defaultServiceOperation"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.*Service.*(..))"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"noTxServiceOperation"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.ddl.DefaultDdlManager.*(..))"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"defaultServiceOperation"</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"defaultTxAdvice"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"noTxServiceOperation"</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"noTxAdvice"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-comment">&lt;!-- this bean will be transactional (see the 'defaultServiceOperation' pointcut) --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- this bean will also be transactional, but with totally different transactional settings --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherFooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.ddl.DefaultDdlManager"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"defaultTxAdvice"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"noTxAdvice"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"NEVER"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-comment">&lt;!-- other transaction infrastructure beans such as a PlatformTransactionManager omitted... --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-txadvice-settings" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-txadvice-settings"></a>17.5.5&nbsp;&lt;tx:advice/&gt; settings</h3></div></div></div>

<p>This section summarizes the various transactional settings that can be specified using
the <code class="literal">&lt;tx:advice/&gt;</code> tag. The default <code class="literal">&lt;tx:advice/&gt;</code> settings are:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation" title="17.5.7 Transaction propagation">Propagation setting</a> is <code class="literal">REQUIRED.</code>
</li><li class="listitem">
Isolation level is <code class="literal">DEFAULT.</code>
</li><li class="listitem">
Transaction is read/write.
</li><li class="listitem">
Transaction timeout defaults to the default timeout of the underlying transaction
system, or none if timeouts are not supported.
</li><li class="listitem">
Any <code class="literal">RuntimeException</code> triggers rollback, and any checked <code class="literal">Exception</code> does not.
</li></ul></div>
<p>You can change these default settings; the various attributes of the <code class="literal">&lt;tx:method/&gt;</code> tags
that are nested within <code class="literal">&lt;tx:advice/&gt;</code> and <code class="literal">&lt;tx:attributes/&gt;</code> tags are summarized below:</p>
<div class="table"><a name="tx-method-settings" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-method-settings"></a><p class="title"><b>Table&nbsp;17.1.&nbsp;&lt;tx:method/&gt; settings</b></p><div class="table-contents">

<table summary="&lt;tx:method/&gt; settings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Attribute</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Required?</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Default</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">name</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Method name(s) with which the transaction attributes are to be associated. The
  wildcard (*) character can be used to associate the same transaction attribute
  settings with a number of methods; for example, <code class="literal">get*</code>, <code class="literal">handle*</code>, <code class="literal">on*Event</code>, and so
  forth.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">propagation</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>REQUIRED</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Transaction propagation behavior.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">isolation</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>DEFAULT</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Transaction isolation level.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">timeout</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>-1</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Transaction timeout value (in seconds).</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">read-only</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>false</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Is this transaction read-only?</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">rollback-for</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">Exception(s)</code> that trigger rollback; comma-delimited. For example,
  <code class="literal">com.foo.MyBusinessException,ServletException.</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">no-rollback-for</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>No</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="" align="left" valign="top"><p><code class="literal">Exception(s)</code> that do <span class="emphasis"><em>not</em></span> trigger rollback; comma-delimited. For example,
  <code class="literal">com.foo.MyBusinessException,ServletException.</code></p></td></tr></tbody></table>
</div></div><br class="table-break">
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-annotations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-annotations"></a>17.5.6&nbsp;Using @Transactional</h3></div></div></div>

<p>In addition to the XML-based declarative approach to transaction configuration, you can
use an annotation-based approach. Declaring transaction semantics directly in the Java
source code puts the declarations much closer to the affected code. There is not much
danger of undue coupling, because code that is meant to be used transactionally is
almost always deployed that way anyway.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The standard <code class="literal">javax.transaction.Transactional</code> annotation is also supported as a drop-in
replacement to Spring’s own annotation. Please refer to JTA 1.2 documentation for more
details.</p>
</td></tr></tbody></table></div>
<p>The ease-of-use afforded by the use of the <code class="literal">@Transactional</code> annotation is best
illustrated with an example, which is explained in the text that follows. Consider the
following class definition:</p>
<pre class="programlisting"><span class="hl-comment">// the service class that we want to make transactional</span>
<span class="strong"><strong>@Transactional</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

    Foo getFoo(String fooName);

    Foo getFoo(String fooName, String barName);

    <span class="hl-keyword">void</span> insertFoo(Foo foo);

    <span class="hl-keyword">void</span> updateFoo(Foo foo);
}</pre>
<p>When the above POJO is defined as a bean in a Spring IoC container, the bean instance
can be made transactional by adding merely <span class="emphasis"><em>one</em></span> line of XML configuration:</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- from the file 'context.xml' --&gt;</span>
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- this is the service object that we want to make transactional --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- enable the configuration of transactional behavior based on annotations --&gt;</span>
    <span class="emphasis"><em>&lt;tx:annotation-driven transaction-manager="txManager"/&gt;</em></span><span class="hl-comment">&lt;!-- a PlatformTransactionManager is still required --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- (this dependency is defined somewhere else) --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- other &lt;bean/&gt; definitions here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>You can omit the <code class="literal">transaction-manager</code> attribute in the <code class="literal">&lt;tx:annotation-driven/&gt;</code> tag if
the bean name of the <code class="literal">PlatformTransactionManager</code> that you want to wire in has the name
<code class="literal">transactionManager</code>. If the <code class="literal">PlatformTransactionManager</code> bean that you want to
dependency-inject has any other name, then you have to use the <code class="literal">transaction-manager</code>
attribute explicitly, as in the preceding example.</p>
</td></tr></tbody></table></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">@EnableTransactionManagement</code> annotation provides equivalent support if you are
using Java based configuration. Simply add the annotation to a <code class="literal">@Configuration</code> class.
See the javadocs for full details.</p>
</td></tr></tbody></table></div>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>Method visibility and @Transactional</b></p></div></div></div>

<p>When using proxies, you should apply the <code class="literal">@Transactional</code> annotation only to methods
with <span class="emphasis"><em>public</em></span> visibility. If you do annotate protected, private or package-visible
methods with the <code class="literal">@Transactional</code> annotation, no error is raised, but the annotated
method does not exhibit the configured transactional settings. Consider the use of
AspectJ (see below) if you need to annotate non-public methods.</p>
</div>
<p>You can place the <code class="literal">@Transactional</code> annotation before an interface definition, a method
on an interface, a class definition, or a <span class="emphasis"><em>public</em></span> method on a class. However, the
mere presence of the <code class="literal">@Transactional</code> annotation is not enough to activate the
transactional behavior. The <code class="literal">@Transactional</code> annotation is simply metadata that can be
consumed by some runtime infrastructure that is <code class="literal">@Transactional</code>-aware and that can use
the metadata to configure the appropriate beans with transactional behavior. In the
preceding example, the <code class="literal">&lt;tx:annotation-driven/&gt;</code> element <span class="emphasis"><em>switches on</em></span> the
transactional behavior.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png.pagespeed.ce.w22Wv-tZ37.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Spring recommends that you only annotate concrete classes (and methods of concrete
classes) with the <code class="literal">@Transactional</code> annotation, as opposed to annotating interfaces. You
certainly can place the <code class="literal">@Transactional</code> annotation on an interface (or an interface
method), but this works only as you would expect it to if you are using interface-based
proxies. The fact that Java annotations are <span class="emphasis"><em>not inherited from interfaces</em></span> means that
if you are using class-based proxies ( <code class="literal">proxy-target-class="true"</code>) or the weaving-based
aspect ( <code class="literal">mode="aspectj"</code>), then the transaction settings are not recognized by the
proxying and weaving infrastructure, and the object will not be wrapped in a
transactional proxy, which would be decidedly <span class="emphasis"><em>bad</em></span>.</p>
</td></tr></tbody></table></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>In proxy mode (which is the default), only external method calls coming in through the
proxy are intercepted. This means that self-invocation, in effect, a method within the
target object calling another method of the target object, will not lead to an actual
transaction at runtime even if the invoked method is marked with <code class="literal">@Transactional</code>. Also,
the proxy must be fully initialized to provide the expected behaviour so you should not
rely on this feature in your initialization code, i.e. <code class="literal">@PostConstruct</code>.</p>
</td></tr></tbody></table></div>
<p>Consider the use of AspectJ mode (see mode attribute in table below) if you expect
self-invocations to be wrapped with transactions as well. In this case, there will not
be a proxy in the first place; instead, the target class will be weaved (that is, its
byte code will be modified) in order to turn <code class="literal">@Transactional</code> into runtime behavior on
any kind of method.</p>
<div class="table"><a name="tx-annotation-driven-settings" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-annotation-driven-settings"></a><p class="title"><b>Table&nbsp;17.2.&nbsp;Annotation driven transaction settings</b></p><div class="table-contents">

<table summary="Annotation driven transaction settings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">XML Attribute</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Annotation Attribute</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Default</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">transaction-manager</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>N/A (See <code class="literal">TransactionManagementConfigurer</code> javadocs)</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>transactionManager</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of transaction manager to use. Only required if the name of the transaction
  manager is not <code class="literal">transactionManager</code>, as in the example above.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">mode</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">mode</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>proxy</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The default mode "proxy" processes annotated beans to be proxied using Spring’s AOP
  framework (following proxy semantics, as discussed above, applying to method calls
  coming in through the proxy only). The alternative mode "aspectj" instead weaves the
  affected classes with Spring’s AspectJ transaction aspect, modifying the target class
  byte code to apply to any kind of method call. AspectJ weaving requires
  spring-aspects.jar in the classpath as well as load-time weaving (or compile-time
  weaving) enabled. (See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw-spring" title="Spring configuration">the section called “Spring configuration”</a> for details on how to set up load-time
  weaving.)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">proxy-target-class</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">proxyTargetClass</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>false</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Applies to proxy mode only. Controls what type of transactional proxies are created
  for classes annotated with the <code class="literal">@Transactional</code> annotation. If the
  <code class="literal">proxy-target-class</code> attribute is set to <code class="literal">true</code>, then class-based proxies are created.
  If <code class="literal">proxy-target-class</code> is <code class="literal">false</code> or if the attribute is omitted, then standard JDK
  interface-based proxies are created. (See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-proxying" title="11.6 Proxying mechanisms">Section&nbsp;11.6, “Proxying mechanisms”</a> for a detailed examination
  of the different proxy types.)</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">order</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">order</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Ordered.LOWEST_PRECEDENCE</p></td><td style="" align="left" valign="top"><p>Defines the order of the transaction advice that is applied to beans annotated with
  <code class="literal">@Transactional</code>. (For more information about the rules related to ordering of AOP
  advice, see <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-ordering" title="Advice ordering">the section called “Advice ordering”</a>.) No specified ordering means that the
  AOP subsystem determines the order of the advice.</p></td></tr></tbody></table>
</div></div><br class="table-break">
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">proxy-target-class</code> attribute controls what type of transactional proxies are
created for classes annotated with the <code class="literal">@Transactional</code> annotation. If
<code class="literal">proxy-target-class</code> is set to <code class="literal">true</code>, class-based proxies are created. If
<code class="literal">proxy-target-class</code> is <code class="literal">false</code> or if the attribute is omitted, standard JDK
interface-based proxies are created. (See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-proxying" title="11.6 Proxying mechanisms">Section&nbsp;11.6, “Proxying mechanisms”</a> for a discussion of the
different proxy types.)</p>
</td></tr></tbody></table></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">@EnableTransactionManagement</code> and <code class="literal">&lt;tx:annotation-driven/&gt;</code> only looks for
<code class="literal">@Transactional</code> on beans in the same application context they are defined in. This
means that, if you put annotation driven configuration in a <code class="literal">WebApplicationContext</code> for
a <code class="literal">DispatcherServlet</code>, it only checks for <code class="literal">@Transactional</code> beans in your controllers,
and not your services. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#mvc-servlet" title="22.2 The DispatcherServlet">Section&nbsp;22.2, “The DispatcherServlet”</a> for more information.</p>
</td></tr></tbody></table></div>
<p>The most derived location takes precedence when evaluating the transactional settings
for a method. In the case of the following example, the <code class="literal">DefaultFooService</code> class is
annotated at the class level with the settings for a read-only transaction, but the
<code class="literal">@Transactional</code> annotation on the <code class="literal">updateFoo(Foo)</code> method in the same class takes
precedence over the transactional settings defined at the class level.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Transactional(readOnly = true)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

    <span class="hl-keyword">public</span> Foo getFoo(String fooName) {
        <span class="hl-comment">// do something</span>
    }

    <span class="hl-comment">// these settings have precedence for this method</span>
    <em><span class="hl-annotation" style="color: gray">@Transactional(readOnly = false, propagation = Propagation.REQUIRES_NEW)</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateFoo(Foo foo) {
        <span class="hl-comment">// do something</span>
    }
}</pre>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="transaction-declarative-attransactional-settings" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-attransactional-settings"></a>@Transactional settings</h4></div></div></div>

<p>The <code class="literal">@Transactional</code> annotation is metadata that specifies that an interface, class, or
method must have transactional semantics; for example, "<span class="emphasis"><em>start a brand new read-only
transaction when this method is invoked, suspending any existing transaction</em></span>". The
default <code class="literal">@Transactional</code> settings are as follows:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Propagation setting is <code class="literal">PROPAGATION_REQUIRED.</code>
</li><li class="listitem">
Isolation level is <code class="literal">ISOLATION_DEFAULT.</code>
</li><li class="listitem">
Transaction is read/write.
</li><li class="listitem">
Transaction timeout defaults to the default timeout of the underlying transaction
system, or to none if timeouts are not supported.
</li><li class="listitem">
Any <code class="literal">RuntimeException</code> triggers rollback, and any checked <code class="literal">Exception</code> does not.
</li></ul></div>
<p>These default settings can be changed; the various properties of the <code class="literal">@Transactional</code>
annotation are summarized in the following table:</p>
<div class="table"><a name="tx-attransactional-properties" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-attransactional-properties"></a><p class="title"><b>Table&nbsp;17.3.&nbsp;@Transactional Settings</b></p><div class="table-contents">

<table summary="@Transactional Settings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Type</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-multiple-tx-mgrs-with-attransactional" title="Multiple Transaction Managers with @Transactional">value</a></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>String</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Optional qualifier specifying the transaction manager to be used.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation" title="17.5.7 Transaction propagation">propagation</a></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>enum: <code class="literal">Propagation</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Optional propagation setting.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">isolation</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>enum: <code class="literal">Isolation</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Optional isolation level.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">readOnly</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>boolean</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Read/write vs. read-only transaction</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">timeout</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>int (in seconds granularity)</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Transaction timeout.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">rollbackFor</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Array of <code class="literal">Class</code> objects, which must be derived from <code class="literal">Throwable.</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Optional array of exception classes that <span class="emphasis"><em>must</em></span> cause rollback.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">rollbackForClassName</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Array of class names. Classes must be derived from <code class="literal">Throwable.</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Optional array of names of exception classes that <span class="emphasis"><em>must</em></span> cause rollback.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">noRollbackFor</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Array of <code class="literal">Class</code> objects, which must be derived from <code class="literal">Throwable.</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Optional array of exception classes that <span class="emphasis"><em>must not</em></span> cause rollback.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">noRollbackForClassName</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Array of <code class="literal">String</code> class names, which must be derived from <code class="literal">Throwable.</code></p></td><td style="" align="left" valign="top"><p>Optional array of names of exception classes that <span class="emphasis"><em>must not</em></span> cause rollback.</p></td></tr></tbody></table>
</div></div><br class="table-break">
<p>Currently you cannot have explicit control over the name of a transaction, where 'name'
means the transaction name that will be shown in a transaction monitor, if applicable
(for example, WebLogic’s transaction monitor), and in logging output. For declarative
transactions, the transaction name is always the fully-qualified class name + "."
+ method name of the transactionally-advised class. For example, if the
<code class="literal">handlePayment(..)</code> method of the <code class="literal">BusinessService</code> class started a transaction, the
name of the transaction would be: <code class="literal">com.foo.BusinessService.handlePayment</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-multiple-tx-mgrs-with-attransactional" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-multiple-tx-mgrs-with-attransactional"></a>Multiple Transaction Managers with @Transactional</h4></div></div></div>

<p>Most Spring applications only need a single transaction manager, but there may be
situations where you want multiple independent transaction managers in a single
application. The value attribute of the <code class="literal">@Transactional</code> annotation can be used to
optionally specify the identity of the <code class="literal">PlatformTransactionManager</code> to be used. This can
either be the bean name or the qualifier value of the transaction manager bean. For
example, using the qualifier notation, the following Java code</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransactionalService {

    <em><span class="hl-annotation" style="color: gray">@Transactional("order")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSomething(String name) { ... }

    <em><span class="hl-annotation" style="color: gray">@Transactional("account")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() { ... }
}</pre>
<p>could be combined with the following transaction manager bean declarations in the
application context.</p>
<pre class="programlisting"><span class="hl-tag">&lt;tx:annotation-driven/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        ...
        <span class="hl-tag">&lt;qualifier</span> <span class="hl-attribute">value</span>=<span class="hl-value">"order"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        ...
        <span class="hl-tag">&lt;qualifier</span> <span class="hl-attribute">value</span>=<span class="hl-value">"account"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span></pre>
<p>In this case, the two methods on <code class="literal">TransactionalService</code> will run under separate
transaction managers, differentiated by the "order" and "account" qualifiers. The
default <code class="literal">&lt;tx:annotation-driven&gt;</code> target bean name <code class="literal">transactionManager</code> will still be
used if no specifically qualified PlatformTransactionManager bean is found.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-custom-attributes" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-custom-attributes"></a>Custom shortcut annotations</h4></div></div></div>

<p>If you find you are repeatedly using the same attributes with <code class="literal">@Transactional</code> on many
different methods, then <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#beans-meta-annotations" title="7.10.2 Meta-annotations">Spring’s meta-annotation support</a> allows
you to define custom shortcut annotations for your specific use cases. For example,
defining the following annotations</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD, ElementType.TYPE})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Transactional("order")</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> OrderTx {
}

<em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD, ElementType.TYPE})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Transactional("account")</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> AccountTx {
}</pre>
<p>allows us to write the example from the previous section as</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransactionalService {

    <em><span class="hl-annotation" style="color: gray">@OrderTx</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSomething(String name) { ... }

    <em><span class="hl-annotation" style="color: gray">@AccountTx</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() { ... }
}</pre>
<p>Here we have used the syntax to define the transaction manager qualifier, but could also
have included propagation behavior, rollback rules, timeouts etc.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-propagation" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation"></a>17.5.7&nbsp;Transaction propagation</h3></div></div></div>

<p>This section describes some semantics of transaction propagation in Spring. Please note
that this section is not an introduction to transaction propagation proper; rather it
details some of the semantics regarding transaction propagation in Spring.</p>
<p>In Spring-managed transactions, be aware of the difference between <span class="emphasis"><em>physical</em></span> and
<span class="emphasis"><em>logical</em></span> transactions, and how the propagation setting applies to this difference.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-required" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation-required"></a>Required</h4></div></div></div>

<div class="informalfigure">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/tx_prop_required.png.pagespeed.ce.uQXwKjy4bd.png" alt="tx prop required"></div>
</div>
<p>PROPAGATION_REQUIRED</p>
<p>When the propagation setting is <code class="literal">PROPAGATION_REQUIRED</code>, a <span class="emphasis"><em>logical</em></span> transaction scope
is created for each method upon which the setting is applied. Each such logical
transaction scope can determine rollback-only status individually, with an outer
transaction scope being logically independent from the inner transaction scope. Of
course, in case of standard <code class="literal">PROPAGATION_REQUIRED</code> behavior, all these scopes will be
mapped to the same physical transaction. So a rollback-only marker set in the inner
transaction scope does affect the outer transaction’s chance to actually commit (as you
would expect it to).</p>
<p>However, in the case where an inner transaction scope sets the rollback-only marker, the
outer transaction has not decided on the rollback itself, and so the rollback (silently
triggered by the inner transaction scope) is unexpected. A corresponding
<code class="literal">UnexpectedRollbackException</code> is thrown at that point. This is <span class="emphasis"><em>expected behavior</em></span> so
that the caller of a transaction can never be misled to assume that a commit was
performed when it really was not. So if an inner transaction (of which the outer caller
is not aware) silently marks a transaction as rollback-only, the outer caller still
calls commit. The outer caller needs to receive an <code class="literal">UnexpectedRollbackException</code> to
indicate clearly that a rollback was performed instead.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-requires_new" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation-requires_new"></a>RequiresNew</h4></div></div></div>

<div class="informalfigure">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/tx_prop_requires_new.png.pagespeed.ce.iS9IQ4bj8A.png" alt="tx prop requires new"></div>
</div>
<p>PROPAGATION_REQUIRES_NEW</p>
<p><code class="literal">PROPAGATION_REQUIRES_NEW</code>, in contrast to <code class="literal">PROPAGATION_REQUIRED</code>, uses a <span class="emphasis"><em>completely</em></span>
independent transaction for each affected transaction scope. In that case, the
underlying physical transactions are different and hence can commit or roll back
independently, with an outer transaction not affected by an inner transaction’s rollback
status.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-nested" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-propagation-nested"></a>Nested</h4></div></div></div>

<p><code class="literal">PROPAGATION_NESTED</code> uses a <span class="emphasis"><em>single</em></span> physical transaction with multiple savepoints
that it can roll back to. Such partial rollbacks allow an inner transaction scope to
trigger a rollback <span class="emphasis"><em>for its scope</em></span>, with the outer transaction being able to continue
the physical transaction despite some operations having been rolled back. This setting
is typically mapped onto JDBC savepoints, so will only work with JDBC resource
transactions. See Spring’s <code class="literal">DataSourceTransactionManager</code>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-applying-more-than-just-tx-advice" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-applying-more-than-just-tx-advice"></a>17.5.8&nbsp;Advising transactional operations</h3></div></div></div>

<p>Suppose you want to execute <span class="emphasis"><em>both</em></span> transactional <span class="emphasis"><em>and</em></span> some basic profiling advice.
How do you effect this in the context of <code class="literal">&lt;tx:annotation-driven/&gt;</code>?</p>
<p>When you invoke the <code class="literal">updateFoo(Foo)</code> method, you want to see the following actions:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Configured profiling aspect starts up.
</li><li class="listitem">
Transactional advice executes.
</li><li class="listitem">
Method on the advised object executes.
</li><li class="listitem">
Transaction commits.
</li><li class="listitem">
Profiling aspect reports exact duration of the whole transactional method invocation.
</li></ul></div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>This chapter is not concerned with explaining AOP in any great detail (except as it
applies to transactions). See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop" title="11. Aspect Oriented Programming with Spring">Chapter&nbsp;11, <i>Aspect Oriented Programming with Spring</i></a> for detailed coverage of the following AOP
configuration and AOP in general.</p>
</td></tr></tbody></table></div>
<p>Here is the code for a simple profiling aspect discussed above. The ordering of advice
is controlled through the <code class="literal">Ordered</code> interface. For full details on advice ordering, see
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-ordering" title="Advice ordering">the section called “Advice ordering”</a>.
.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> x.y;

<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hl-keyword">import</span> org.springframework.util.StopWatch;
<span class="hl-keyword">import</span> org.springframework.core.Ordered;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleProfiler <span class="hl-keyword">implements</span> Ordered {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> order;

    <span class="hl-comment">// allows us to control the ordering of advice</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getOrder() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.order;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOrder(<span class="hl-keyword">int</span> order) {
        <span class="hl-keyword">this</span>.order = order;
    }

    <span class="hl-comment">// this method </span><span class="strong"><strong>is</strong></span> the around advice
    <span class="hl-keyword">public</span> Object profile(ProceedingJoinPoint call) <span class="hl-keyword">throws</span> Throwable {
        Object returnValue;
        StopWatch clock = <span class="hl-keyword">new</span> StopWatch(getClass().getName());
        <span class="hl-keyword">try</span> {
            clock.start(call.toShortString());
            returnValue = call.proceed();
        } <span class="hl-keyword">finally</span> {
            clock.stop();
            System.out.println(clock.prettyPrint());
        }
        <span class="hl-keyword">return</span> returnValue;
    }
}</pre>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- this is the aspect --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.SimpleProfiler"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- execute before the transactional advice (hence the lower order number) --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">__value</span>=<span class="hl-value">"1"</span><span class="hl-attribute">__/&gt;</span>
    <span class="hl-attribute">&lt;/bean&gt;</span>

    <span class="hl-attribute">&lt;tx:annotation-driven</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">__order</span>=<span class="hl-value">"200"</span><span class="hl-attribute">__/&gt;</span>

    <span class="hl-attribute">&lt;aop:config&gt;</span>
            <span class="hl-attribute">&lt;!--</span> <span class="hl-attribute">this</span> <span class="hl-attribute">advice</span> <span class="hl-attribute">will</span> <span class="hl-attribute">execute</span> <span class="hl-attribute">around</span> <span class="hl-attribute">the</span> <span class="hl-attribute">transactional</span> <span class="hl-attribute">advice</span> <span class="hl-attribute">--&gt;</span>
            <span class="hl-attribute">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profilingAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"profiler"</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span>
                        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(!void x.y..*Service.*(..))"</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;aop:around</span> <span class="hl-attribute">method</span>=<span class="hl-value">"profile"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/aop:aspect&gt;</span>
    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"oracle.jdbc.driver.OracleDriver"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:oracle:thin:@rj-t42:1521:elvis"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"scott"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tiger"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The result of the above configuration is a <code class="literal">fooService</code> bean that has profiling and
transactional aspects applied to it <span class="emphasis"><em>in the desired order</em></span>. You configure any number
of additional aspects in similar fashion.</p>
<p>The following example effects the same setup as above, but uses the purely XML
declarative approach.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- the profiling advice --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.SimpleProfiler"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- execute before the transactional advice (hence the lower order number) --&gt;</span>
        __<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1__"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;aop:config&gt;</span>
        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"entryPointMethod"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y..*Service.*(..))"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- will execute after the profiling advice (c.f. the order attribute) --&gt;</span>

        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"entryPointMethod"</span> <span class="hl-attribute">__order</span>=<span class="hl-value">"2__"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- order value is higher than the profiling aspect --&gt;</span>

        <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profilingAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"profiler"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span>
                    <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(!void x.y..*Service.*(..))"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;aop:around</span> <span class="hl-attribute">method</span>=<span class="hl-value">"profile"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/aop:aspect&gt;</span>

    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-comment">&lt;!-- other &lt;bean/&gt; definitions such as a DataSource and a PlatformTransactionManager here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>The result of the above configuration will be a <code class="literal">fooService</code> bean that has profiling and
transactional aspects applied to it <span class="emphasis"><em>in that order</em></span>. If you want the profiling advice
to execute <span class="emphasis"><em>after</em></span> the transactional advice on the way in, and <span class="emphasis"><em>before</em></span> the
transactional advice on the way out, then you simply swap the value of the profiling
aspect bean’s <code class="literal">order</code> property so that it is higher than the transactional advice’s
order value.</p>
<p>You configure additional aspects in similar fashion.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-aspectj" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-aspectj"></a>17.5.9&nbsp;Using @Transactional with AspectJ</h3></div></div></div>

<p>It is also possible to use the Spring Framework’s <code class="literal">@Transactional</code> support outside of a
Spring container by means of an AspectJ aspect. To do so, you first annotate your
classes (and optionally your classes' methods) with the <code class="literal">@Transactional</code> annotation, and
then you link (weave) your application with the
<code class="literal">org.springframework.transaction.aspectj.AnnotationTransactionAspect</code> defined in the
<code class="literal">spring-aspects.jar</code> file. The aspect must also be configured with a transaction
manager. You can of course use the Spring Framework’s IoC container to take care of
dependency-injecting the aspect. The simplest way to configure the transaction
management aspect is to use the <code class="literal">&lt;tx:annotation-driven/&gt;</code> element and specify the <code class="literal">mode</code>
attribute to <code class="literal">aspectj</code> as described in <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-annotations" title="17.5.6 Using @Transactional">Section&nbsp;17.5.6, “Using @Transactional”</a>. Because
we’re focusing here on applications running outside of a Spring container, we’ll show
you how to do it programmatically.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Prior to continuing, you may want to read <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-annotations" title="17.5.6 Using @Transactional">Section&nbsp;17.5.6, “Using @Transactional”</a> and
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop" title="11. Aspect Oriented Programming with Spring">Chapter&nbsp;11, <i>Aspect Oriented Programming with Spring</i></a> respectively.</p>
</td></tr></tbody></table></div>
<pre class="programlisting"><span class="hl-comment">// construct an appropriate transaction manager</span>
DataSourceTransactionManager txManager = <span class="hl-keyword">new</span> DataSourceTransactionManager(getDataSource());

<span class="hl-comment">// configure the AnnotationTransactionAspect to use it; this must be done before executing any transactional methods</span>
AnnotationTransactionAspect.aspectOf().setTransactionManager(txManager);</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>When using this aspect, you must annotate the <span class="emphasis"><em>implementation</em></span> class (and/or methods
within that class), <span class="emphasis"><em>not</em></span> the interface (if any) that the class implements. AspectJ
follows Java’s rule that annotations on interfaces are <span class="emphasis"><em>not inherited</em></span>.</p>
</td></tr></tbody></table></div>
<p>The <code class="literal">@Transactional</code> annotation on a class specifies the default transaction semantics
for the execution of any method in the class.</p>
<p>The <code class="literal">@Transactional</code> annotation on a method within the class overrides the default
transaction semantics given by the class annotation (if present). Any method may be
annotated, regardless of visibility.</p>
<p>To weave your applications with the <code class="literal">AnnotationTransactionAspect</code> you must either build
your application with AspectJ (see the
<a class="ulink" href="https://www.eclipse.org/aspectj/doc/released/devguide/index.html" target="_top">AspectJ Development
Guide</a>) or use load-time weaving. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="11.8.4 Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;11.8.4, “Load-time weaving with AspectJ in the Spring Framework”</a> for a discussion of load-time
weaving with AspectJ.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-programmatic" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-programmatic"></a>17.6&nbsp;Programmatic transaction management</h2></div></div></div>

<p>The Spring Framework provides two means of programmatic transaction management:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Using the <code class="literal">TransactionTemplate</code>.
</li><li class="listitem">
Using a <code class="literal">PlatformTransactionManager</code> implementation directly.
</li></ul></div>
<p>The Spring team generally recommends the <code class="literal">TransactionTemplate</code> for programmatic
transaction management. The second approach is similar to using the JTA
<code class="literal">UserTransaction</code> API, although exception handling is less cumbersome.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-prog-template" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-prog-template"></a>17.6.1&nbsp;Using the TransactionTemplate</h3></div></div></div>

<p>The <code class="literal">TransactionTemplate</code> adopts the same approach as other Spring <span class="emphasis"><em>templates</em></span> such as
the <code class="literal">JdbcTemplate</code>. It uses a callback approach, to free application code from having to
do the boilerplate acquisition and release of transactional resources, and results in
code that is intention driven, in that the code that is written focuses solely on what
the developer wants to do.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>As you will see in the examples that follow, using the <code class="literal">TransactionTemplate</code> absolutely
couples you to Spring’s transaction infrastructure and APIs. Whether or not programmatic
transaction management is suitable for your development needs is a decision that you
will have to make yourself.</p>
</td></tr></tbody></table></div>
<p>Application code that must execute in a transactional context, and that will use the
<code class="literal">TransactionTemplate</code> explicitly, looks like the following. You, as an application
developer, write a <code class="literal">TransactionCallback</code> implementation (typically expressed as an
anonymous inner class) that contains the code that you need to execute in the context of
a transaction. You then pass an instance of your custom <code class="literal">TransactionCallback</code> to the
<code class="literal">execute(..)</code> method exposed on the <code class="literal">TransactionTemplate</code>.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleService <span class="hl-keyword">implements</span> Service {

    <span class="hl-comment">// single TransactionTemplate shared amongst all methods in this instance</span>
    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> TransactionTemplate transactionTemplate;

    <span class="hl-comment">// use constructor-injection to supply the PlatformTransactionManager</span>
    <span class="hl-keyword">public</span> SimpleService(PlatformTransactionManager transactionManager) {
        Assert.notNull(transactionManager, <span class="hl-string">"The 'transactionManager' argument must not be null."</span>);
        <span class="hl-keyword">this</span>.transactionTemplate = <span class="hl-keyword">new</span> TransactionTemplate(transactionManager);
    }

    <span class="hl-keyword">public</span> Object someServiceMethod() {
        <span class="hl-keyword">return</span> transactionTemplate.execute(<span class="hl-keyword">new</span> TransactionCallback() {
            <span class="hl-comment">// the code in this method executes in a transactional context</span>
            <span class="hl-keyword">public</span> Object doInTransaction(TransactionStatus status) {
                updateOperation1();
                <span class="hl-keyword">return</span> resultOfUpdateOperation2();
            }
        });
    }
}</pre>
<p>If there is no return value, use the convenient <code class="literal">TransactionCallbackWithoutResult</code> class
with an anonymous class as follows:</p>
<pre class="programlisting">transactionTemplate.execute(<span class="hl-keyword">new</span> <span class="strong"><strong>TransactionCallbackWithoutResult</strong></span>() {
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> doInTransactionWithoutResult(TransactionStatus status) {
        updateOperation1();
        updateOperation2();
    }
});</pre>
<p>Code within the callback can roll the transaction back by calling the
<code class="literal">setRollbackOnly()</code> method on the supplied <code class="literal">TransactionStatus</code> object:</p>
<pre class="programlisting">transactionTemplate.execute(<span class="hl-keyword">new</span> TransactionCallbackWithoutResult() {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> doInTransactionWithoutResult(TransactionStatus status) {
        <span class="hl-keyword">try</span> {
            updateOperation1();
            updateOperation2();
        } <span class="hl-keyword">catch</span> (SomeBusinessExeption ex) {
            <span class="strong"><strong>status.setRollbackOnly();</strong></span>
        }
    }
});</pre>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-prog-template-settings" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-prog-template-settings"></a>Specifying transaction settings</h4></div></div></div>

<p>You can specify transaction settings such as the propagation mode, the isolation level,
the timeout, and so forth on the <code class="literal">TransactionTemplate</code> either programmatically or in
configuration. <code class="literal">TransactionTemplate</code> instances by default have the
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-declarative-txadvice-settings" title="17.5.5 &lt;tx:advice/&gt; settings">default transactional settings</a>. The
following example shows the programmatic customization of the transactional settings for
a specific <code class="literal">TransactionTemplate:</code></p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleService <span class="hl-keyword">implements</span> Service {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> TransactionTemplate transactionTemplate;

    <span class="hl-keyword">public</span> SimpleService(PlatformTransactionManager transactionManager) {
        Assert.notNull(transactionManager, <span class="hl-string">"The 'transactionManager' argument must not be null."</span>);
        <span class="hl-keyword">this</span>.transactionTemplate = <span class="hl-keyword">new</span> TransactionTemplate(transactionManager);

        <span class="hl-comment">// the transaction settings can be set here explicitly if so desired</span>
        <span class="hl-keyword">this</span>.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED);
        <span class="hl-keyword">this</span>.transactionTemplate.setTimeout(<span class="hl-number">30</span>); <span class="hl-comment">// 30 seconds</span>
        <span class="hl-comment">// and so forth...</span>
    }
}</pre>
<p>The following example defines a <code class="literal">TransactionTemplate</code> with some custom transactional
settings, using Spring XML configuration. The <code class="literal">sharedTransactionTemplate</code> can then be
injected into as many services as are required.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sharedTransactionTemplate"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.support.TransactionTemplate"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"isolationLevelName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ISOLATION_READ_UNCOMMITTED"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"timeout"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"30"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>"</pre>
<p>Finally, instances of the <code class="literal">TransactionTemplate</code> class are threadsafe, in that instances
do not maintain any conversational state. <code class="literal">TransactionTemplate</code> instances <span class="emphasis"><em>do</em></span> however
maintain configuration state, so while a number of classes may share a single instance
of a <code class="literal">TransactionTemplate</code>, if a class needs to use a <code class="literal">TransactionTemplate</code> with
different settings (for example, a different isolation level), then you need to create
two distinct <code class="literal">TransactionTemplate</code> instances.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-programmatic-ptm" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-programmatic-ptm"></a>17.6.2&nbsp;Using the PlatformTransactionManager</h3></div></div></div>

<p>You can also use the <code class="literal">org.springframework.transaction.PlatformTransactionManager</code>
directly to manage your transaction. Simply pass the implementation of the
<code class="literal">PlatformTransactionManager</code> you are using to your bean through a bean reference. Then,
using the <code class="literal">TransactionDefinition</code> and <code class="literal">TransactionStatus</code> objects you can initiate
transactions, roll back, and commit.</p>
<pre class="programlisting">DefaultTransactionDefinition def = <span class="hl-keyword">new</span> DefaultTransactionDefinition();
<span class="hl-comment">// explicitly setting the transaction name is something that can only be done programmatically</span>
def.setName(<span class="hl-string">"SomeTxName"</span>);
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = txManager.getTransaction(def);
<span class="hl-keyword">try</span> {
    <span class="hl-comment">// execute your business logic here</span>
}
<span class="hl-keyword">catch</span> (MyException ex) {
    txManager.rollback(status);
    <span class="hl-keyword">throw</span> ex;
}
txManager.commit(status);</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-decl-vs-prog" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#tx-decl-vs-prog"></a>17.7&nbsp;Choosing between programmatic and declarative transaction management</h2></div></div></div>

<p>Programmatic transaction management is usually a good idea only if you have a small
number of transactional operations. For example, if you have a web application that
require transactions only for certain update operations, you may not want to set up
transactional proxies using Spring or any other technology. In this case, using the
<code class="literal">TransactionTemplate</code> <span class="emphasis"><em>may</em></span> be a good approach. Being able to set the transaction name
explicitly is also something that can only be done using the programmatic approach to
transaction management.</p>
<p>On the other hand, if your application has numerous transactional operations,
declarative transaction management is usually worthwhile. It keeps transaction
management out of business logic, and is not difficult to configure. When using the
Spring Framework, rather than EJB CMT, the configuration cost of declarative transaction
management is greatly reduced.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-event" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-event"></a>17.8&nbsp;Transaction bound event</h2></div></div></div>

<p>As of Spring 4.2, the listener of an event can be bound to a phase of the transaction. The
typical example is to handle the event when the transaction has completed successfully: this
allows events to be used with more flexibility when the outcome of the current transaction
actually matters to the listener.</p>
<p>Registering a regular event listener is done via the <code class="literal">@EventListener</code> annotation. If you need
to bind it to the transaction use <code class="literal">@TransactionalEventListener</code>. When you do so, the listener
will be bound to the commit phase of the transaction by default.</p>
<p>Let’s take an example to illustrate this concept. Assume that a component publish an order
created event and we want to define a listener that should only handle that event once the
transaction in which it has been published as committed successfully:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Component</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyComponent {

    <em><span class="hl-annotation" style="color: gray">@TransactionalEventListener</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handleOrderCreatedEvent(CreationEvent&lt;Order&gt; creationEvent) {
          ...
    }
}</pre>
<p>The <code class="literal">TransactionalEventListener</code> annotation exposes a <code class="literal">phase</code> attribute  that allows to customize
to which phase of the transaction the listener should be bound to. The valid phases are <code class="literal">BEFORE_COMMIT</code>,
<code class="literal">AFTER_COMMIT</code> (default), <code class="literal">AFTER_ROLLBACK</code> and <code class="literal">AFTER_COMPLETION</code> that aggregates the transaction
completion (be it a commit or a rollback).</p>
<p>If no transaction is running, the listener is not invoked at all since we can’t honor the required
semantics. It is however possible to override that behaviour by setting the <code class="literal">fallbackExecution</code> attribute
of the annotation to <code class="literal">true</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-application-server-integration" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-application-server-integration"></a>17.9&nbsp;Application server-specific integration</h2></div></div></div>

<p>Spring’s transaction abstraction generally is application server agnostic. Additionally,
Spring’s <code class="literal">JtaTransactionManager</code> class, which can optionally perform a JNDI lookup for
the JTA <code class="literal">UserTransaction</code> and <code class="literal">TransactionManager</code> objects, autodetects the location for
the latter object, which varies by application server. Having access to the JTA
<code class="literal">TransactionManager</code> allows for enhanced transaction semantics, in particular supporting
transaction suspension. See the <code class="literal">JtaTransactionManager</code> javadocs for details.</p>
<p>Spring’s <code class="literal">JtaTransactionManager</code> is the standard choice to run on Java EE application
servers, and is known to work on all common servers. Advanced functionality such as
transaction suspension works on many servers as well&#8201;—&#8201;including GlassFish, JBoss and
Geronimo&#8201;—&#8201;without any special configuration required. However, for fully supported
transaction suspension and further advanced integration, Spring ships special adapters
for WebLogic Server and WebSphere. These adapters are discussed in the following
sections.</p>
<p><span class="emphasis"><em>For standard scenarios, including WebLogic Server and WebSphere, consider using the
convenient <code class="literal">&lt;tx:jta-transaction-manager/&gt;</code> configuration element.</em></span> When configured,
this element automatically detects the underlying server and chooses the best
transaction manager available for the platform. This means that you won’t have to
configure server-specific adapter classes (as discussed in the following sections)
explicitly; rather, they are chosen automatically, with the standard
<code class="literal">JtaTransactionManager</code> as default fallback.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-websphere" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-application-server-integration-websphere"></a>17.9.1&nbsp;IBM WebSphere</h3></div></div></div>

<p>On WebSphere 6.1.0.9 and above, the recommended Spring JTA transaction manager to use is
<code class="literal">WebSphereUowTransactionManager</code>. This special adapter leverages IBM’s <code class="literal">UOWManager</code> API,
which is available in WebSphere Application Server 6.1.0.9 and later. With this adapter,
Spring-driven transaction suspension (suspend/resume as initiated by
<code class="literal">PROPAGATION_REQUIRES_NEW</code>) is officially supported by IBM.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-weblogic" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-application-server-integration-weblogic"></a>17.9.2&nbsp;Oracle WebLogic Server</h3></div></div></div>

<p>On WebLogic Server 9.0 or above, you typically would use the
<code class="literal">WebLogicJtaTransactionManager</code> instead of the stock <code class="literal">JtaTransactionManager</code> class. This
special WebLogic-specific subclass of the normal <code class="literal">JtaTransactionManager</code> supports the
full power of Spring’s transaction definitions in a WebLogic-managed transaction
environment, beyond standard JTA semantics: Features include transaction names,
per-transaction isolation levels, and proper resuming of transactions in all cases.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-solutions-to-common-problems" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-solutions-to-common-problems"></a>17.10&nbsp;Solutions to common problems</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-solutions-to-common-problems-wrong-ptm" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-solutions-to-common-problems-wrong-ptm"></a>17.10.1&nbsp;Use of the wrong transaction manager for a specific DataSource</h3></div></div></div>

<p>Use the <span class="emphasis"><em>correct</em></span> <code class="literal">PlatformTransactionManager</code> implementation based on your choice of
transactional technologies and requirements. Used properly, the Spring Framework merely
provides a straightforward and portable abstraction. If you are using global
transactions, you <span class="emphasis"><em>must</em></span> use the
<code class="literal">org.springframework.transaction.jta.JtaTransactionManager</code> class (or an
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-application-server-integration" title="17.9 Application server-specific integration">application server-specific subclass</a> of
it) for all your transactional operations. Otherwise the transaction infrastructure
attempts to perform local transactions on resources such as container <code class="literal">DataSource</code>
instances. Such local transactions do not make sense, and a good application server
treats them as errors.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-resources" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#transaction-resources"></a>17.11&nbsp;Further Resources</h2></div></div></div>

<p>For more information about the Spring Framework’s transaction support:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="http://www.javaworld.com/javaworld/jw-01-2009/jw-01-spring-transactions.html" target="_top">Distributed
transactions in Spring, with and without XA</a> is a JavaWorld presentation in which
Spring’s David Syer guides you through seven patterns for distributed
transactions in Spring applications, three of them with XA and four without.
</li><li class="listitem">
<a class="ulink" href="http://www.infoq.com/minibooks/JTDS" target="_top">Java Transaction Design Strategies</a> is a book
available from <a class="ulink" href="http://www.infoq.com/" target="_top">InfoQ</a> that provides a well-paced introduction
to transactions in Java. It also includes side-by-side examples of how to configure
and use transactions with both the Spring Framework and EJB3.
</li></ul></div>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="dao" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dao"></a>18.&nbsp;DAO support</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dao-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dao-introduction"></a>18.1&nbsp;Introduction</h2></div></div></div>

<p>The Data Access Object (DAO) support in Spring is aimed at making it easy to work with
data access technologies like JDBC, Hibernate, JPA or JDO in a consistent way. This
allows one to switch between the aforementioned persistence technologies fairly easily
and it also allows one to code without worrying about catching exceptions that are
specific to each technology.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dao-exceptions" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dao-exceptions"></a>18.2&nbsp;Consistent exception hierarchy</h2></div></div></div>

<p>Spring provides a convenient translation from technology-specific exceptions like
<code class="literal">SQLException</code> to its own exception class hierarchy with the <code class="literal">DataAccessException</code> as
the root exception. These exceptions wrap the original exception so there is never any
risk that one might lose any information as to what might have gone wrong.</p>
<p>In addition to JDBC exceptions, Spring can also wrap Hibernate-specific exceptions,
converting them to a set of focused runtime exceptions (the same is true for JDO and
JPA exceptions). This allows one to handle most persistence exceptions, which are
non-recoverable, only in the appropriate layers, without having annoying boilerplate
catch-and-throw blocks and exception declarations in one’s DAOs. (One can still trap
and handle exceptions anywhere one needs to though.) As mentioned above, JDBC
exceptions (including database-specific dialects) are also converted to the same
hierarchy, meaning that one can perform some operations with JDBC within a consistent
programming model.</p>
<p>The above holds true for the various template classes in Springs support for various ORM
frameworks. If one uses the interceptor-based classes then the application must care
about handling <code class="literal">HibernateExceptions</code> and <code class="literal">JDOExceptions</code> itself, preferably via
delegating to <code class="literal">SessionFactoryUtils’ `convertHibernateAccessException(..)</code> or
<code class="literal">convertJdoAccessException()</code> methods respectively. These methods convert the exceptions
to ones that are compatible with the exceptions in the <code class="literal">org.springframework.dao</code>
exception hierarchy. As <code class="literal">JDOExceptions</code> are unchecked, they can simply get thrown too,
sacrificing generic DAO abstraction in terms of exceptions though.</p>
<p>The exception hierarchy that Spring provides can be seen below. (Please note that the
class hierarchy detailed in the image shows only a subset of the entire
<code class="literal">DataAccessException</code> hierarchy.)</p>
<div class="informalfigure">
<div class="mediaobject"><img src="./Spring Framework Reference Documentation_files/DataAccessException.gif.pagespeed.ce.xHfAJntfR7.gif" alt="DataAccessException"></div>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dao-annotations" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#dao-annotations"></a>18.3&nbsp;Annotations used for configuring DAO or Repository classes</h2></div></div></div>

<p>The best way to guarantee that your Data Access Objects (DAOs) or repositories provide
exception translation is to use the <code class="literal">@Repository</code> annotation. This annotation also
allows the component scanning support to find and configure your DAOs and repositories
without having to provide XML configuration entries for them.</p>
<pre class="programlisting"><span class="strong"><strong>@Repository</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SomeMovieFinder <span class="hl-keyword">implements</span> MovieFinder {
    <span class="hl-comment">// ...</span>
}</pre>
<p>Any DAO or repository implementation will need to access to a persistence resource,
depending on the persistence technology used; for example, a JDBC-based repository will
need access to a JDBC <code class="literal">DataSource</code>; a JPA-based repository will need access to an
<code class="literal">EntityManager</code>. The easiest way to accomplish this is to have this resource dependency
injected using one of the <code class="literal">@Autowired,</code>, <code class="literal">@Inject</code>, <code class="literal">@Resource</code> or <code class="literal">@PersistenceContext</code>
annotations. Here is an example for a JPA repository:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Repository</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JpaMovieFinder <span class="hl-keyword">implements</span> MovieFinder {

    <em><span class="hl-annotation" style="color: gray">@PersistenceContext</span></em>
    <span class="hl-keyword">private</span> EntityManager entityManager;

    <span class="hl-comment">// ...</span>

}</pre>
<p>If you are using the classic Hibernate APIs than you can inject the SessionFactory:</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Repository</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateMovieFinder <span class="hl-keyword">implements</span> MovieFinder {

    <span class="hl-keyword">private</span> SessionFactory sessionFactory;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSessionFactory(SessionFactory sessionFactory) {
        <span class="hl-keyword">this</span>.sessionFactory = sessionFactory;
    }

    <span class="hl-comment">// ...</span>

}</pre>
<p>Last example we will show here is for typical JDBC support. You would have the
<code class="literal">DataSource</code> injected into an initialization method where you would create a
<code class="literal">JdbcTemplate</code> and other data access support classes like <code class="literal">SimpleJdbcCall</code> etc using
this <code class="literal">DataSource</code>.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Repository</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcMovieFinder <span class="hl-keyword">implements</span> MovieFinder {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <em><span class="hl-annotation" style="color: gray">@Autowired</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-comment">// ...</span>

}</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Please see the specific coverage of each persistence technology for details on how to
configure the application context to take advantage of these annotations.</p>
</td></tr></tbody></table></div>
</div>
</div>
<div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="jdbc" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc"></a>19.&nbsp;Data access with JDBC</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-introduction" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-introduction"></a>19.1&nbsp;Introduction to Spring Framework JDBC</h2></div></div></div>

<p>The value-add provided by the Spring Framework JDBC abstraction is perhaps best shown by
the sequence of actions outlined in the table below. The table shows what actions Spring
will take care of and which actions are the responsibility of you, the application
developer.</p>
<div class="table"><a name="jdbc-who-does-what" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-who-does-what"></a><p class="title"><b>Table&nbsp;19.1.&nbsp;Spring JDBC - who does what?</b></p><div class="table-contents">

<table summary="Spring JDBC - who does what?" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Action</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Spring</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">You</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Define connection parameters.</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>X</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Open the connection.</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>X</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Specify the SQL statement.</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>X</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Declare parameters and provide parameter values</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>X</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Prepare and execute the statement.</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>X</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Set up the loop to iterate through the results (if any).</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>X</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Do the work for each iteration.</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>X</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Process any exception.</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>X</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Handle transactions.</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>X</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Close the connection, statement and resultset.</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>X</p></td><td style="" align="left" valign="top">&nbsp;</td></tr></tbody></table>
</div></div><br class="table-break">
<p>The Spring Framework takes care of all the low-level details that can make JDBC such a
tedious API to develop with.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-choose-style" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-choose-style"></a>19.1.1&nbsp;Choosing an approach for JDBC database access</h3></div></div></div>

<p>You can choose among several approaches to form the basis for your JDBC database access.
In addition to three flavors of the JdbcTemplate, a new SimpleJdbcInsert and
SimplejdbcCall approach optimizes database metadata, and the RDBMS Object style takes a
more object-oriented approach similar to that of JDO Query design. Once you start using
one of these approaches, you can still mix and match to include a feature from a
different approach. All approaches require a JDBC 2.0-compliant driver, and some
advanced features require a JDBC 3.0 driver.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>JdbcTemplate</em></span> is the classic Spring JDBC approach and the most popular. This
"lowest level" approach and all others use a JdbcTemplate under the covers.
</li><li class="listitem">
<span class="emphasis"><em>NamedParameterJdbcTemplate</em></span> wraps a <code class="literal">JdbcTemplate</code> to provide named parameters
instead of the traditional JDBC "?" placeholders. This approach provides better
documentation and ease of use when you have multiple parameters for an SQL statement.
</li><li class="listitem">
<span class="emphasis"><em>SimpleJdbcInsert and SimpleJdbcCall</em></span> optimize database metadata to limit the amount
of necessary configuration. This approach simplifies coding so that you only need to
provide the name of the table or procedure and provide a map of parameters matching
the column names. This only works if the database provides adequate metadata. If the
database doesn’t provide this metadata, you will have to provide explicit
configuration of the parameters.
</li><li class="listitem">
<span class="emphasis"><em>RDBMS Objects including MappingSqlQuery, SqlUpdate and StoredProcedure</em></span> requires
you to create reusable and thread-safe objects during initialization of your data
access layer. This approach is modeled after JDO Query wherein you define your query
string, declare parameters, and compile the query. Once you do that, execute methods
can be called multiple times with various parameter values passed in.
</li></ul></div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-packages" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-packages"></a>19.1.2&nbsp;Package hierarchy</h3></div></div></div>

<p>The Spring Framework’s JDBC abstraction framework consists of four different packages,
namely <code class="literal">core</code>, <code class="literal">datasource</code>, <code class="literal">object</code>, and <code class="literal">support</code>.</p>
<p>The <code class="literal">org.springframework.jdbc.core</code> package contains the <code class="literal">JdbcTemplate</code> class and its
various callback interfaces, plus a variety of related classes. A subpackage named
<code class="literal">org.springframework.jdbc.core.simple</code> contains the <code class="literal">SimpleJdbcInsert</code> and
<code class="literal">SimpleJdbcCall</code> classes. Another subpackage named
<code class="literal">org.springframework.jdbc.core.namedparam</code> contains the <code class="literal">NamedParameterJdbcTemplate</code>
class and the related support classes. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-core" title="19.2 Using the JDBC core classes to control basic JDBC processing and error handling">Section&nbsp;19.2, “Using the JDBC core classes to control basic JDBC processing and error handling”</a>, <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-advanced-jdbc" title="19.4 JDBC batch operations">Section&nbsp;19.4, “JDBC batch operations”</a>, and
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-simple-jdbc" title="19.5 Simplifying JDBC operations with the SimpleJdbc classes">Section&nbsp;19.5, “Simplifying JDBC operations with the SimpleJdbc classes”</a>.</p>
<p>The <code class="literal">org.springframework.jdbc.datasource</code> package contains a utility class for easy
<code class="literal">DataSource</code> access, and various simple <code class="literal">DataSource</code> implementations that can be used for
testing and running unmodified JDBC code outside of a Java EE container. A subpackage
named <code class="literal">org.springfamework.jdbc.datasource.embedded</code> provides support for creating
embedded databases using Java database engines such as HSQL, H2, and Derby. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-connections" title="19.3 Controlling database connections">Section&nbsp;19.3, “Controlling database connections”</a> and <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-embedded-database-support" title="19.8 Embedded database support">Section&nbsp;19.8, “Embedded database support”</a>.</p>
<p>The <code class="literal">org.springframework.jdbc.object</code> package contains classes that represent RDBMS
queries, updates, and stored procedures as thread-safe, reusable objects. See
<a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-object" title="19.6 Modeling JDBC operations as Java objects">Section&nbsp;19.6, “Modeling JDBC operations as Java objects”</a>. This approach is modeled by JDO, although objects returned by queries
are naturally <span class="emphasis"><em>disconnected</em></span> from the database. This higher level of JDBC abstraction
depends on the lower-level abstraction in the <code class="literal">org.springframework.jdbc.core</code> package.</p>
<p>The <code class="literal">org.springframework.jdbc.support</code> package provides <code class="literal">SQLException</code> translation
functionality and some utility classes. Exceptions thrown during JDBC processing are
translated to exceptions defined in the <code class="literal">org.springframework.dao</code> package. This means
that code using the Spring JDBC abstraction layer does not need to implement JDBC or
RDBMS-specific error handling. All translated exceptions are unchecked, which gives you
the option of catching the exceptions from which you can recover while allowing other
exceptions to be propagated to the caller. See <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-SQLExceptionTranslator" title="19.2.3 SQLExceptionTranslator">Section&nbsp;19.2.3, “SQLExceptionTranslator”</a>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-core" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-core"></a>19.2&nbsp;Using the JDBC core classes to control basic JDBC processing and error handling</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-JdbcTemplate" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate"></a>19.2.1&nbsp;JdbcTemplate</h3></div></div></div>

<p>The <code class="literal">JdbcTemplate</code> class is the central class in the JDBC core package. It handles the
creation and release of resources, which helps you avoid common errors such as
forgetting to close the connection. It performs the basic tasks of the core JDBC
workflow such as statement creation and execution, leaving application code to provide
SQL and extract results. The <code class="literal">JdbcTemplate</code> class executes SQL queries, update
statements and stored procedure calls, performs iteration over <code class="literal">ResultSet</code>s and
extraction of returned parameter values. It also catches JDBC exceptions and translates
them to the generic, more informative, exception hierarchy defined in the
<code class="literal">org.springframework.dao</code> package.</p>
<p>When you use the <code class="literal">JdbcTemplate</code> for your code, you only need to implement callback
interfaces, giving them a clearly defined contract. The <code class="literal">PreparedStatementCreator</code>
callback interface creates a prepared statement given a <code class="literal">Connection</code> provided by this
class, providing SQL and any necessary parameters. The same is true for the
<code class="literal">CallableStatementCreator</code> interface, which creates callable statements. The
<code class="literal">RowCallbackHandler</code> interface extracts values from each row of a <code class="literal">ResultSet</code>.</p>
<p>The <code class="literal">JdbcTemplate</code> can be used within a DAO implementation through direct instantiation
with a <code class="literal">DataSource</code> reference, or be configured in a Spring IoC container and given to
DAOs as a bean reference.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">DataSource</code> should always be configured as a bean in the Spring IoC container. In
the first case the bean is given to the service directly; in the second case it is given
to the prepared template.</p>
</td></tr></tbody></table></div>
<p>All SQL issued by this class is logged at the <code class="literal">DEBUG</code> level under the category
corresponding to the fully qualified class name of the template instance (typically
<code class="literal">JdbcTemplate</code>, but it may be different if you are using a custom subclass of the
<code class="literal">JdbcTemplate</code> class).</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="jdbc-JdbcTemplate-examples" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate-examples"></a>Examples of JdbcTemplate class usage</h4></div></div></div>

<p>This section provides some examples of <code class="literal">JdbcTemplate</code> class usage. These examples are
not an exhaustive list of all of the functionality exposed by the <code class="literal">JdbcTemplate</code>; see
the attendant javadocs for that.</p>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="jdbc-JdbcTemplate-examples-query" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate-examples-query"></a>Querying (SELECT)</h5></div></div></div>

<p>Here is a simple query for getting the number of rows in a relation:</p>
<pre class="programlisting"><span class="hl-keyword">int</span> rowCount = <span class="hl-keyword">this</span>.jdbcTemplate.queryForObject(<span class="hl-string">"select count(*) from t_actor"</span>, Integer.<span class="hl-keyword">class</span>);</pre>
<p>A simple query using a bind variable:</p>
<pre class="programlisting"><span class="hl-keyword">int</span> countOfActorsNamedJoe = <span class="hl-keyword">this</span>.jdbcTemplate.queryForObject(
        <span class="hl-string">"select count(*) from t_actor where first_name = ?"</span>, Integer.<span class="hl-keyword">class</span>, <span class="hl-string">"Joe"</span>);</pre>
<p>Querying for a <code class="literal">String</code>:</p>
<pre class="programlisting">String lastName = <span class="hl-keyword">this</span>.jdbcTemplate.queryForObject(
        <span class="hl-string">"select last_name from t_actor where id = ?"</span>,
        <span class="hl-keyword">new</span> Object[]{<span class="hl-number">1212L</span>}, String.<span class="hl-keyword">class</span>);</pre>
<p>Querying and populating a <span class="emphasis"><em>single</em></span> domain object:</p>
<pre class="programlisting">Actor actor = <span class="hl-keyword">this</span>.jdbcTemplate.queryForObject(
        <span class="hl-string">"select first_name, last_name from t_actor where id = ?"</span>,
        <span class="hl-keyword">new</span> Object[]{<span class="hl-number">1212L</span>},
        <span class="hl-keyword">new</span> RowMapper&lt;Actor&gt;() {
            <span class="hl-keyword">public</span> Actor mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
                Actor actor = <span class="hl-keyword">new</span> Actor();
                actor.setFirstName(rs.getString(<span class="hl-string">"first_name"</span>));
                actor.setLastName(rs.getString(<span class="hl-string">"last_name"</span>));
                <span class="hl-keyword">return</span> actor;
            }
        });</pre>
<p>Querying and populating a number of domain objects:</p>
<pre class="programlisting">List&lt;Actor&gt; actors = <span class="hl-keyword">this</span>.jdbcTemplate.query(
        <span class="hl-string">"select first_name, last_name from t_actor"</span>,
        <span class="hl-keyword">new</span> RowMapper&lt;Actor&gt;() {
            <span class="hl-keyword">public</span> Actor mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
                Actor actor = <span class="hl-keyword">new</span> Actor();
                actor.setFirstName(rs.getString(<span class="hl-string">"first_name"</span>));
                actor.setLastName(rs.getString(<span class="hl-string">"last_name"</span>));
                <span class="hl-keyword">return</span> actor;
            }
        });</pre>
<p>If the last two snippets of code actually existed in the same application, it would make
sense to remove the duplication present in the two <code class="literal">RowMapper</code> anonymous inner classes,
and extract them out into a single class (typically a <code class="literal">static</code> nested class) that can
then be referenced by DAO methods as needed. For example, it may be better to write the
last code snippet as follows:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> List&lt;Actor&gt; findAllActors() {
    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.jdbcTemplate.query( <span class="hl-string">"select first_name, last_name from t_actor"</span>, <span class="hl-keyword">new</span> ActorMapper());
}

<span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> ActorMapper <span class="hl-keyword">implements</span> RowMapper&lt;Actor&gt; {

    <span class="hl-keyword">public</span> Actor mapRow(ResultSet rs, <span class="hl-keyword">int</span> rowNum) <span class="hl-keyword">throws</span> SQLException {
        Actor actor = <span class="hl-keyword">new</span> Actor();
        actor.setFirstName(rs.getString(<span class="hl-string">"first_name"</span>));
        actor.setLastName(rs.getString(<span class="hl-string">"last_name"</span>));
        <span class="hl-keyword">return</span> actor;
    }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="jdbc-JdbcTemplate-examples-update" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate-examples-update"></a>Updating (INSERT/UPDATE/DELETE) with jdbcTemplate</h5></div></div></div>

<p>You use the <code class="literal">update(..)</code> method to perform insert, update and delete operations.
Parameter values are usually provided as var args or alternatively as an object array.</p>
<pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.update(
        <span class="hl-string">"insert into t_actor (first_name, last_name) values (?, ?)"</span>,
        <span class="hl-string">"Leonor"</span>, <span class="hl-string">"Watling"</span>);</pre>
<pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.update(
        <span class="hl-string">"update t_actor set last_name = ? where id = ?"</span>,
        <span class="hl-string">"Banjo"</span>, <span class="hl-number">5276L</span>);</pre>
<pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.update(
        <span class="hl-string">"delete from actor where id = ?"</span>,
        Long.valueOf(actorId));</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="jdbc-JdbcTemplate-examples-other" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate-examples-other"></a>Other jdbcTemplate operations</h5></div></div></div>

<p>You can use the <code class="literal">execute(..)</code> method to execute any arbitrary SQL, and as such the
method is often used for DDL statements. It is heavily overloaded with variants taking
callback interfaces, binding variable arrays, and so on.</p>
<pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.execute(<span class="hl-string">"create table mytable (id integer, name varchar(100))"</span>);</pre>
<p>The following example invokes a simple stored procedure. More sophisticated stored
procedure support is <a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-StoredProcedure" title="19.6.4 StoredProcedure">covered later</a>.</p>
<pre class="programlisting"><span class="hl-keyword">this</span>.jdbcTemplate.update(
        <span class="hl-string">"call SUPPORT.REFRESH_ACTORS_SUMMARY(?)"</span>,
        Long.valueOf(unionId));</pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="jdbc-JdbcTemplate-idioms" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate-idioms"></a>JdbcTemplate best practices</h4></div></div></div>

<p>Instances of the <code class="literal">JdbcTemplate</code> class are <span class="emphasis"><em>threadsafe once configured</em></span>. This is
important because it means that you can configure a single instance of a <code class="literal">JdbcTemplate</code>
and then safely inject this <span class="emphasis"><em>shared</em></span> reference into multiple DAOs (or repositories).
The <code class="literal">JdbcTemplate</code> is stateful, in that it maintains a reference to a <code class="literal">DataSource</code>, but
this state is <span class="emphasis"><em>not</em></span> conversational state.</p>
<p>A common practice when using the <code class="literal">JdbcTemplate</code> class (and the associated
<a class="link" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-NamedParameterJdbcTemplate" title="19.2.2 NamedParameterJdbcTemplate"><code class="literal">NamedParameterJdbcTemplate</code></a> classes) is to
configure a <code class="literal">DataSource</code> in your Spring configuration file, and then dependency-inject
that shared <code class="literal">DataSource</code> bean into your DAO classes; the <code class="literal">JdbcTemplate</code> is created in
the setter for the <code class="literal">DataSource</code>. This leads to DAOs that look in part like the following:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcCorporateEventDao <span class="hl-keyword">implements</span> CorporateEventDao {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="strong"><strong>this.jdbcTemplate = new JdbcTemplate(dataSource);</strong></span>
    }

    <span class="hl-comment">// JDBC-backed implementations of the methods on the CorporateEventDao follow...</span>
}</pre>
<p>The corresponding configuration might look like this.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"corporateEventDao"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.example.JdbcCorporateEventDao"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"jdbc.properties"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>An alternative to explicit configuration is to use component-scanning and annotation
support for dependency injection. In this case you annotate the class with <code class="literal">@Repository</code>
(which makes it a candidate for component-scanning) and annotate the <code class="literal">DataSource</code> setter
method with <code class="literal">@Autowired</code>.</p>
<pre class="programlisting"><span class="strong"><strong>@Repository</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcCorporateEventDao <span class="hl-keyword">implements</span> CorporateEventDao {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="strong"><strong>this.jdbcTemplate = new JdbcTemplate(dataSource);</strong></span>
    }

    <span class="hl-comment">// JDBC-backed implementations of the methods on the CorporateEventDao follow...</span>
}</pre>
<p>The corresponding XML configuration file would look like the following:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">"http://www.springframework.org/schema/context"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- Scans within the base package of the application for @Component classes to configure as beans --&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">"org.springframework.docs.test"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">"jdbc.properties"</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
<p>If you are using Spring’s <code class="literal">JdbcDaoSupport</code> class, and your various JDBC-backed DAO classes
extend from it, then your sub-class inherits a <code class="literal">setDataSource(..)</code> method from the
<code class="literal">JdbcDaoSupport</code> class. You can choose whether to inherit from this class. The
<code class="literal">JdbcDaoSupport</code> class is provided as a convenience only.</p>
<p>Regardless of which of the above template initialization styles you choose to use (or
not), it is seldom necessary to create a new instance of a <code class="literal">JdbcTemplate</code> class each
time you want to execute SQL. Once configured, a <code class="literal">JdbcTemplate</code> instance is threadsafe.
You may want multiple <code class="literal">JdbcTemplate</code> instances if your application accesses multiple
databases, which requires multiple <code class="literal">DataSources</code>, and subsequently multiple differently
configured <code class="literal">JdbcTemplates</code>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-NamedParameterJdbcTemplate" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-NamedParameterJdbcTemplate"></a>19.2.2&nbsp;NamedParameterJdbcTemplate</h3></div></div></div>

<p>The <code class="literal">NamedParameterJdbcTemplate</code> class adds support for programming JDBC statements
using named parameters, as opposed to programming JDBC statements using only classic
placeholder ( <code class="literal">'?'</code>) arguments. The <code class="literal">NamedParameterJdbcTemplate</code> class wraps a
<code class="literal">JdbcTemplate</code>, and delegates to the wrapped <code class="literal">JdbcTemplate</code> to do much of its work. This
section describes only those areas of the <code class="literal">NamedParameterJdbcTemplate</code> class that differ
from the <code class="literal">JdbcTemplate</code> itself; namely, programming JDBC statements using named
parameters.</p>
<pre class="programlisting"><span class="hl-comment">// some JDBC-backed DAO class...</span>
<span class="hl-keyword">private</span> NamedParameterJdbcTemplate namedParameterJdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.namedParameterJdbcTemplate = <span class="hl-keyword">new</span> NamedParameterJdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> <span class="hl-keyword">int</span> countOfActorsByFirstName(String firstName) {

    String sql = <span class="hl-string">"select count(*) from T_ACTOR where first_name = :first_name"</span>;

    SqlParameterSource namedParameters = <span class="hl-keyword">new</span> MapSqlParameterSource(<span class="hl-string">"first_name"</span>, firstName);

    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.namedParameterJdbcTemplate.queryForObject(sql, namedParameters, Integer.<span class="hl-keyword">class</span>);
}</pre>
<p>Notice the use of the named parameter notation in the value assigned to the <code class="literal">sql</code>
variable, and the corresponding value that is plugged into the <code class="literal">namedParameters</code>
variable (of type <code class="literal">MapSqlParameterSource</code>).</p>
<p>Alternatively, you can pass along named parameters and their corresponding values to a
<code class="literal">NamedParameterJdbcTemplate</code> instance by using the <code class="literal">Map</code>-based style.The remaining
methods exposed by the <code class="literal">NamedParameterJdbcOperations</code> and implemented by the
<code class="literal">NamedParameterJdbcTemplate</code> class follow a similar pattern and are not covered here.</p>
<p>The following example shows the use of the <code class="literal">Map</code>-based style.</p>
<pre class="programlisting"><span class="hl-comment">// some JDBC-backed DAO class...</span>
<span class="hl-keyword">private</span> NamedParameterJdbcTemplate namedParameterJdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.namedParameterJdbcTemplate = <span class="hl-keyword">new</span> NamedParameterJdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> <span class="hl-keyword">int</span> countOfActorsByFirstName(String firstName) {

    String sql = <span class="hl-string">"select count(*) from T_ACTOR where first_name = :first_name"</span>;

    Map&lt;String, String&gt; namedParameters = Collections.singletonMap(<span class="hl-string">"first_name"</span>, firstName);

    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.namedParameterJdbcTemplate.queryForObject(sql, namedParameters,  Integer.<span class="hl-keyword">class</span>);
}</pre>
<p>One nice feature related to the <code class="literal">NamedParameterJdbcTemplate</code> (and existing in the same
Java package) is the <code class="literal">SqlParameterSource</code> interface. You have already seen an example of
an implementation of this interface in one of the previous code snippet (the
<code class="literal">MapSqlParameterSource</code> class). An <code class="literal">SqlParameterSource</code> is a source of named parameter
values to a <code class="literal">NamedParameterJdbcTemplate</code>. The <code class="literal">MapSqlParameterSource</code> class is a very
simple implementation that is simply an adapter around a <code class="literal">java.util.Map</code>, where the keys
are the parameter names and the values are the parameter values.</p>
<p>Another <code class="literal">SqlParameterSource</code> implementation is the <code class="literal">BeanPropertySqlParameterSource</code>
class. This class wraps an arbitrary JavaBean (that is, an instance of a class that
adheres to <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/documentation/spec-136004.html" target="_top">the
JavaBean conventions</a>), and uses the properties of the wrapped JavaBean as the source
of named parameter values.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Actor {

    <span class="hl-keyword">private</span> Long id;
    <span class="hl-keyword">private</span> String firstName;
    <span class="hl-keyword">private</span> String lastName;

    <span class="hl-keyword">public</span> String getFirstName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.firstName;
    }

    <span class="hl-keyword">public</span> String getLastName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.lastName;
    }

    <span class="hl-keyword">public</span> Long getId() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.id;
    }

    <span class="hl-comment">// setters omitted...</span>

}</pre>
<pre class="programlisting"><span class="hl-comment">// some JDBC-backed DAO class...</span>
<span class="hl-keyword">private</span> NamedParameterJdbcTemplate namedParameterJdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.namedParameterJdbcTemplate = <span class="hl-keyword">new</span> NamedParameterJdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> <span class="hl-keyword">int</span> countOfActors(Actor exampleActor) {

    <span class="hl-comment">// notice how the named parameters match the properties of the above 'Actor' class</span>
    String sql = <span class="hl-string">"select count(*) from T_ACTOR where first_name = :firstName and last_name = :lastName"</span>;

    SqlParameterSource namedParameters = <span class="hl-keyword">new</span> BeanPropertySqlParameterSource(exampleActor);

    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.namedParameterJdbcTemplate.queryForObject(sql, namedParameters, Integer.<span class="hl-keyword">class</span>);
}</pre>
<p>Remember that the <code class="literal">NamedParameterJdbcTemplate</code> class <span class="emphasis"><em>wraps</em></span> a classic <code class="literal">JdbcTemplate</code>
template; if you need access to the wrapped <code class="literal">JdbcTemplate</code> instance to access
functionality only present in the <code class="literal">JdbcTemplate</code> class, you can use the
<code class="literal">getJdbcOperations()</code> method to access the wrapped <code class="literal">JdbcTemplate</code> through the
<code class="literal">JdbcOperations</code> interface.</p>
<p>See also <a class="xref" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-JdbcTemplate-idioms" title="JdbcTemplate best practices">the section called “JdbcTemplate best practices”</a> for guidelines on using the
<code class="literal">NamedParameterJdbcTemplate</code> class in the context of an application.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SQLExceptionTranslator" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-SQLExceptionTranslator"></a>19.2.3&nbsp;SQLExceptionTranslator</h3></div></div></div>

<p><code class="literal">SQLExceptionTranslator</code> is an interface to be implemented by classes that can translate
between <code class="literal">SQLExceptions</code> and Spring’s own <code class="literal">org.springframework.dao.DataAccessException</code>,
which is agnostic in regard to data access strategy. Implementations can be generic (for
example, using SQLState codes for JDBC) or proprietary (for example, using Oracle error
codes) for greater precision.</p>
<p><code class="literal">SQLErrorCodeSQLExceptionTranslator</code> is the implementation of <code class="literal">SQLExceptionTranslator</code>
that is used by default. This implementation uses specific vendor codes. It is more
precise than the <code class="literal">SQLState</code> implementation. The error code translations are based on
codes held in a JavaBean type class called <code class="literal">SQLErrorCodes</code>. This class is created and
populated by an <code class="literal">SQLErrorCodesFactory</code> which as the name suggests is a factory for
creating <code class="literal">SQLErrorCodes</code> based on the contents of a configuration file named
<code class="literal">sql-error-codes.xml</code>. This file is populated with vendor codes and based on the
<code class="literal">DatabaseProductName</code> taken from the <code class="literal">DatabaseMetaData</code>. The codes for the actual
database you are using are used.</p>
<p>The <code class="literal">SQLErrorCodeSQLExceptionTranslator</code> applies matching rules in the following sequence:</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>The <code class="literal">SQLErrorCodesFactory</code> is used by default to define Error codes and custom exception
translations. They are looked up in a file named <code class="literal">sql-error-codes.xml</code> from the
classpath and the matching <code class="literal">SQLErrorCodes</code> instance is located based on the database
name from the database metadata of the database in use.</p>
</td></tr></tbody></table></div>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Any custom translation implemented by a subclass. Normally the provided concrete
<code class="literal">SQLErrorCodeSQLExceptionTranslator</code> is used so this rule does not apply. It only
applies if you have actually provided a subclass implementation.
</li><li class="listitem">
Any custom implementation of the <code class="literal">SQLExceptionTranslator</code> interface that is provided
as the <code class="literal">customSqlExceptionTranslator</code> property of the <code class="literal">SQLErrorCodes</code> class.
</li><li class="listitem">
The list of instances of the <code class="literal">CustomSQLErrorCodesTranslation</code> class, provided for the
<code class="literal">customTranslations</code> property of the <code class="literal">SQLErrorCodes</code> class, are searched for a match.
</li><li class="listitem">
Error code matching is applied.
</li><li class="listitem">
Use the fallback translator. <code class="literal">SQLExceptionSubclassTranslator</code> is the default fallback
translator. If this translation is not available then the next fallback translator is
the <code class="literal">SQLStateSQLExceptionTranslator</code>.
</li></ul></div>
<p>You can extend <code class="literal">SQLErrorCodeSQLExceptionTranslator:</code></p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomSQLErrorCodesTranslator <span class="hl-keyword">extends</span> SQLErrorCodeSQLExceptionTranslator {

    <span class="hl-keyword">protected</span> DataAccessException customTranslate(String task, String sql, SQLException sqlex) {
        <span class="hl-keyword">if</span> (sqlex.getErrorCode() == -<span class="hl-number">12345</span>) {
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DeadlockLoserDataAccessException(task, sqlex);
        }
        <span class="hl-keyword">return</span> null;
    }
}</pre>
<p>In this example, the specific error code <code class="literal">-12345</code> is translated and other errors are
left to be translated by the default translator implementation. To use this custom
translator, it is necessary to pass it to the <code class="literal">JdbcTemplate</code> through the method
<code class="literal">setExceptionTranslator</code> and to use this <code class="literal">JdbcTemplate</code> for all of the data access
processing where this translator is needed. Here is an example of how this custom
translator can be used:</p>
<pre class="programlisting"><span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {

    <span class="hl-comment">// create a JdbcTemplate and set data source</span>
    <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate();
    <span class="hl-keyword">this</span>.jdbcTemplate.setDataSource(dataSource);

    <span class="hl-comment">// create a custom translator and set the DataSource for the default translation lookup</span>
    CustomSQLErrorCodesTranslator tr = <span class="hl-keyword">new</span> CustomSQLErrorCodesTranslator();
    tr.setDataSource(dataSource);
    <span class="hl-keyword">this</span>.jdbcTemplate.setExceptionTranslator(tr);

}

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateShippingCharge(<span class="hl-keyword">long</span> orderId, <span class="hl-keyword">long</span> pct) {
    <span class="hl-comment">// use the prepared JdbcTemplate for this update</span>
    <span class="hl-keyword">this</span>.jdbcTemplate.update(<span class="hl-string">"update orders"</span> +
        <span class="hl-string">" set shipping_charge = shipping_charge * ? / 100"</span> +
        <span class="hl-string">" where id = ?"</span>, pct, orderId);
}</pre>
<p>The custom translator is passed a data source in order to look up the error codes in
<code class="literal">sql-error-codes.xml</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-statements-executing" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-statements-executing"></a>19.2.4&nbsp;Executing statements</h3></div></div></div>

<p>Executing an SQL statement requires very little code. You need a <code class="literal">DataSource</code> and a
<code class="literal">JdbcTemplate</code>, including the convenience methods that are provided with the
<code class="literal">JdbcTemplate</code>. The following example shows what you need to include for a minimal but
fully functional class that creates a new table:</p>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.sql.DataSource;
<span class="hl-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExecuteAStatement {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doExecute() {
        <span class="hl-keyword">this</span>.jdbcTemplate.execute(<span class="hl-string">"create table mytable (id integer, name varchar(100))"</span>);
    }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-statements-querying" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-statements-querying"></a>19.2.5&nbsp;Running queries</h3></div></div></div>

<p>Some query methods return a single value. To retrieve a count or a specific value from
one row, use <code class="literal">queryForObject(..)</code>. The latter converts the returned JDBC <code class="literal">Type</code> to the
Java class that is passed in as an argument. If the type conversion is invalid, then an
<code class="literal">InvalidDataAccessApiUsageException</code> is thrown. Here is an example that contains two
query methods, one for an <code class="literal">int</code> and one that queries for a <code class="literal">String</code>.</p>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.sql.DataSource;
<span class="hl-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RunAQuery {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.jdbcTemplate.queryForObject(<span class="hl-string">"select count(*) from mytable"</span>, Integer.<span class="hl-keyword">class</span>);
    }

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.jdbcTemplate.queryForObject(<span class="hl-string">"select name from mytable"</span>, String.<span class="hl-keyword">class</span>);
    }
}</pre>
<p>In addition to the single result query methods, several methods return a list with an
entry for each row that the query returned. The most generic method is
<code class="literal">queryForList(..)</code> which returns a <code class="literal">List</code> where each entry is a <code class="literal">Map</code> with each entry in
the map representing the column value for that row. If you add a method to the above
example to retrieve a list of all the rows, it would look like this:</p>
<pre class="programlisting"><span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
    <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
}

<span class="hl-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; getList() {
    <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.jdbcTemplate.queryForList(<span class="hl-string">"select * from mytable"</span>);
}</pre>
<p>The list returned would look something like this:</p>
<pre class="literallayout">[{name=Bob, id=1}, {name=Mary, id=2}]</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-updates" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-updates"></a>19.2.6&nbsp;Updating the database</h3></div></div></div>

<p>The following example shows a column updated for a certain primary key. In this example,
an SQL statement has placeholders for row parameters. The parameter values can be passed
in as varargs or alternatively as an array of objects. Thus primitives should be wrapped
in the primitive wrapper classes explicitly or using auto-boxing.</p>
<pre class="programlisting"><span class="hl-keyword">import</span> javax.sql.DataSource;

<span class="hl-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExecuteAnUpdate {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(<span class="hl-keyword">int</span> id, String name) {
        <span class="hl-keyword">this</span>.jdbcTemplate.update(<span class="hl-string">"update mytable set name = ? where id = ?"</span>, name, id);
    }
}</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-auto-genereted-keys" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-auto-genereted-keys"></a>19.2.7&nbsp;Retrieving auto-generated keys</h3></div></div></div>

<p>An <code class="literal">update()</code> convenience method supports the retrieval of primary keys generated by the
database. This support is part of the JDBC 3.0 standard; see Chapter 13.6 of the
specification for details. The method takes a <code class="literal">PreparedStatementCreator</code> as its first
argument, and this is the way the required insert statement is specified. The other
argument is a <code class="literal">KeyHolder</code>, which contains the generated key on successful return from
the update. There is not a standard single way to create an appropriate
<code class="literal">PreparedStatement</code> (which explains why the method signature is the way it is). The
following example works on Oracle but may not work on other platforms:</p>
<pre class="programlisting"><span class="hl-keyword">final</span> String INSERT_SQL = <span class="hl-string">"insert into my_test (name) values(?)"</span>;
<span class="hl-keyword">final</span> String name = <span class="hl-string">"Rob"</span>;

KeyHolder keyHolder = <span class="hl-keyword">new</span> GeneratedKeyHolder();
jdbcTemplate.update(
    <span class="hl-keyword">new</span> PreparedStatementCreator() {
        <span class="hl-keyword">public</span> PreparedStatement createPreparedStatement(Connection connection) <span class="hl-keyword">throws</span> SQLException {
            PreparedStatement ps = connection.prepareStatement(INSERT_SQL, <span class="hl-keyword">new</span> String[] {<span class="hl-string">"id"</span>});
            ps.setString(<span class="hl-number">1</span>, name);
            <span class="hl-keyword">return</span> ps;
        }
    },
    keyHolder);

<span class="hl-comment">// keyHolder.getKey() now contains the generated key</span></pre>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-connections" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-connections"></a>19.3&nbsp;Controlling database connections</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-datasource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-datasource"></a>19.3.1&nbsp;DataSource</h3></div></div></div>

<p>Spring obtains a connection to the database through a <code class="literal">DataSource</code>. A <code class="literal">DataSource</code> is
part of the JDBC specification and is a generalized connection factory. It allows a
container or a framework to hide connection pooling and transaction management issues
from the application code. As a developer, you need not know details about how to
connect to the database; that is the responsibility of the administrator that sets up
the datasource. You most likely fill both roles as you develop and test code, but you do
not necessarily have to know how the production data source is configured.</p>
<p>When using Spring’s JDBC layer, you obtain a data source from JNDI or you configure your
own with a connection pool implementation provided by a third party. Popular
implementations are Apache Jakarta Commons DBCP and C3P0. Implementations in the Spring
distribution are meant only for testing purposes and do not provide pooling.</p>
<p>This section uses Spring’s <code class="literal">DriverManagerDataSource</code> implementation, and several
additional implementations are covered later.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Only use the <code class="literal">DriverManagerDataSource</code> class should only be used for testing purposes
since it does not provide pooling and will perform poorly when multiple requests for a
connection are made.</p>
</td></tr></tbody></table></div>
<p>You obtain a connection with <code class="literal">DriverManagerDataSource</code> as you typically obtain a JDBC
connection. Specify the fully qualified classname of the JDBC driver so that the
<code class="literal">DriverManager</code> can load the driver class. Next, provide a URL that varies between JDBC
drivers. (Consult the documentation for your driver for the correct value.) Then provide
a username and a password to connect to the database. Here is an example of how to
configure a <code class="literal">DriverManagerDataSource</code> in Java code:</p>
<pre class="programlisting">DriverManagerDataSource dataSource = <span class="hl-keyword">new</span> DriverManagerDataSource();
dataSource.setDriverClassName(<span class="hl-string">"org.hsqldb.jdbcDriver"</span>);
dataSource.setUrl(<span class="hl-string">"jdbc:hsqldb:hsql://localhost:"</span>);
dataSource.setUsername(<span class="hl-string">"sa"</span>);
dataSource.setPassword(<span class="hl-string">""</span>);</pre>
<p>Here is the corresponding XML configuration:</p>
<pre class="programlisting">&lt;bean id=<span class="hl-string">"dataSource"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;
    &lt;property name=<span class="hl-string">"driverClassName"</span> value=<span class="hl-string">"${jdbc.driverClassName}"</span>/&gt;
    &lt;property name=<span class="hl-string">"url"</span> value=<span class="hl-string">"${jdbc.url}"</span>/&gt;
    &lt;property name=<span class="hl-string">"username"</span> value=<span class="hl-string">"${jdbc.username}"</span>/&gt;
    &lt;property name=<span class="hl-string">"password"</span> value=<span class="hl-string">"${jdbc.password}"</span>/&gt;
&lt;/bean&gt;

&lt;context:property-placeholder location=<span class="hl-string">"jdbc.properties"</span>/&gt;</pre>
<p>The following examples show the basic connectivity and configuration for DBCP and C3P0.
To learn about more options that help control the pooling features, see the product
documentation for the respective connection pooling implementations.</p>
<p>DBCP configuration:</p>
<pre class="programlisting">&lt;bean id=<span class="hl-string">"dataSource"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"org.apache.commons.dbcp.BasicDataSource"</span> destroy-method=<span class="hl-string">"close"</span>&gt;
    &lt;property name=<span class="hl-string">"driverClassName"</span> value=<span class="hl-string">"${jdbc.driverClassName}"</span>/&gt;
    &lt;property name=<span class="hl-string">"url"</span> value=<span class="hl-string">"${jdbc.url}"</span>/&gt;
    &lt;property name=<span class="hl-string">"username"</span> value=<span class="hl-string">"${jdbc.username}"</span>/&gt;
    &lt;property name=<span class="hl-string">"password"</span> value=<span class="hl-string">"${jdbc.password}"</span>/&gt;
&lt;/bean&gt;

&lt;context:property-placeholder location=<span class="hl-string">"jdbc.properties"</span>/&gt;</pre>
<p>C3P0 configuration:</p>
<pre class="programlisting">&lt;bean id=<span class="hl-string">"dataSource"</span> <span class="hl-keyword">class</span>=<span class="hl-string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span> destroy-method=<span class="hl-string">"close"</span>&gt;
    &lt;property name=<span class="hl-string">"driverClass"</span> value=<span class="hl-string">"${jdbc.driverClassName}"</span>/&gt;
    &lt;property name=<span class="hl-string">"jdbcUrl"</span> value=<span class="hl-string">"${jdbc.url}"</span>/&gt;
    &lt;property name=<span class="hl-string">"user"</span> value=<span class="hl-string">"${jdbc.username}"</span>/&gt;
    &lt;property name=<span class="hl-string">"password"</span> value=<span class="hl-string">"${jdbc.password}"</span>/&gt;
&lt;/bean&gt;

&lt;context:property-placeholder location=<span class="hl-string">"jdbc.properties"</span>/&gt;</pre>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DataSourceUtils" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-DataSourceUtils"></a>19.3.2&nbsp;DataSourceUtils</h3></div></div></div>

<p>The <code class="literal">DataSourceUtils</code> class is a convenient and powerful helper class that provides
<code class="literal">static</code> methods to obtain connections from JNDI and close connections if necessary. It
supports thread-bound connections with, for example, <code class="literal">DataSourceTransactionManager</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SmartDataSource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-SmartDataSource"></a>19.3.3&nbsp;SmartDataSource</h3></div></div></div>

<p>The <code class="literal">SmartDataSource</code> interface should be implemented by classes that can provide a
connection to a relational database. It extends the <code class="literal">DataSource</code> interface to allow
classes using it to query whether the connection should be closed after a given
operation. This usage is efficient when you know that you will reuse a connection.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-AbstractDataSource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-AbstractDataSource"></a>19.3.4&nbsp;AbstractDataSource</h3></div></div></div>

<p><code class="literal">AbstractDataSource</code> is an <code class="literal">abstract</code> base class for Spring’s <code class="literal">DataSource</code>
implementations that implements code that is common to all <code class="literal">DataSource</code> implementations.
You extend the <code class="literal">AbstractDataSource</code> class if you are writing your own <code class="literal">DataSource</code>
implementation.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-SingleConnectionDataSource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-SingleConnectionDataSource"></a>19.3.5&nbsp;SingleConnectionDataSource</h3></div></div></div>

<p>The <code class="literal">SingleConnectionDataSource</code> class is an implementation of the <code class="literal">SmartDataSource</code>
interface that wraps a <span class="emphasis"><em>single</em></span> <code class="literal">Connection</code> that is <span class="emphasis"><em>not</em></span> closed after each use.
Obviously, this is not multi-threading capable.</p>
<p>If any client code calls <code class="literal">close</code> in the assumption of a pooled connection, as when using
persistence tools, set the <code class="literal">suppressClose</code> property to <code class="literal">true</code>. This setting returns a
close-suppressing proxy wrapping the physical connection. Be aware that you will not be
able to cast this to a native Oracle <code class="literal">Connection</code> or the like anymore.</p>
<p>This is primarily a test class. For example, it enables easy testing of code outside an
application server, in conjunction with a simple JNDI environment. In contrast to
<code class="literal">DriverManagerDataSource</code>, it reuses the same connection all the time, avoiding
excessive creation of physical connections.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DriverManagerDataSource" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-DriverManagerDataSource"></a>19.3.6&nbsp;DriverManagerDataSource</h3></div></div></div>

<p>The <code class="literal">DriverManagerDataSource</code> class is an implementation of the standard <code class="literal">DataSource</code>
interface that configures a plain JDBC driver through bean properties, and returns a new
<code class="literal">Connection</code> every time.</p>
<p>This implementation is useful for test and stand-alone environments outside of a Java EE
container, either as a <code class="literal">DataSource</code> bean in a Spring IoC container, or in conjunction
with a simple JNDI environment. Pool-assuming <code class="literal">Connection.close()</code> calls will simply
close the connection, so any <code class="literal">DataSource</code>-aware persistence code should work. However,
using JavaBean-style connection pools such as <code class="literal">commons-dbcp</code> is so easy, even in a test
environment, that it is almost always preferable to use such a connection pool over
<code class="literal">DriverManagerDataSource</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-TransactionAwareDataSourceProxy" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-TransactionAwareDataSourceProxy"></a>19.3.7&nbsp;TransactionAwareDataSourceProxy</h3></div></div></div>

<p><code class="literal">TransactionAwareDataSourceProxy</code> is a proxy for a target <code class="literal">DataSource</code>, which wraps that
target <code class="literal">DataSource</code> to add awareness of Spring-managed transactions. In this respect, it
is similar to a transactional JNDI <code class="literal">DataSource</code> as provided by a Java EE server.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tbody><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png.pagespeed.ce.9zQ_1wVwzR.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>It is rarely desirable to use this class, except when already existing code that must be
called and passed a standard JDBC <code class="literal">DataSource</code> interface implementation. In this case,
it’s possible to still have this code be usable, and at the same time have this code
participating in Spring managed transactions. It is generally preferable to write your
own new code using the higher level abstractions for resource management, such as
<code class="literal">JdbcTemplate</code> or <code class="literal">DataSourceUtils</code>.</p>
</td></tr></tbody></table></div>
<p><span class="emphasis"><em>(See the <code class="literal">TransactionAwareDataSourceProxy</code> javadocs for more details.)</em></span></p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-DataSourceTransactionManager" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-DataSourceTransactionManager"></a>19.3.8&nbsp;DataSourceTransactionManager</h3></div></div></div>

<p>The <code class="literal">DataSourceTransactionManager</code> class is a <code class="literal">PlatformTransactionManager</code>
implementation for single JDBC datasources. It binds a JDBC connection from the
specified data source to the currently executing thread, potentially allowing for one
thread connection per data source.</p>
<p>Application code is required to retrieve the JDBC connection through
<code class="literal">DataSourceUtils.getConnection(DataSource)</code> instead of Java EE’s standard
<code class="literal">DataSource.getConnection</code>. It throws unchecked <code class="literal">org.springframework.dao</code> exceptions
instead of checked <code class="literal">SQLExceptions</code>. All framework classes like <code class="literal">JdbcTemplate</code> use this
strategy implicitly. If not used with this transaction manager, the lookup strategy
behaves exactly like the common one - it can thus be used in any case.</p>
<p>The <code class="literal">DataSourceTransactionManager</code> class supports custom isolation levels, and timeouts
that get applied as appropriate JDBC statement query timeouts. To support the latter,
application code must either use <code class="literal">JdbcTemplate</code> or call the
<code class="literal">DataSourceUtils.applyTransactionTimeout(..)</code> method for each created statement.</p>
<p>This implementation can be used instead of <code class="literal">JtaTransactionManager</code> in the single
resource case, as it does not require the container to support JTA. Switching between
both is just a matter of configuration, if you stick to the required connection lookup
pattern. JTA does not support custom isolation levels!</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-NativeJdbcExtractor" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-NativeJdbcExtractor"></a>19.3.9&nbsp;NativeJdbcExtractor</h3></div></div></div>

<p>Sometimes you need to access vendor specific JDBC methods that differ from the standard
JDBC API. This can be problematic if you are running in an application server or with a
<code class="literal">DataSource</code> that wraps the <code class="literal">Connection</code>, <code class="literal">Statement</code> and <code class="literal">ResultSet</code> objects with its
own wrapper objects. To gain access to the native objects you can configure your
<code class="literal">JdbcTemplate</code> or <code class="literal">OracleLobHandler</code> with a <code class="literal">NativeJdbcExtractor</code>.</p>
<p>The <code class="literal">NativeJdbcExtractor</code> comes in a variety of flavors to match your execution
environment:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
SimpleNativeJdbcExtractor
</li><li class="listitem">
C3P0NativeJdbcExtractor
</li><li class="listitem">
CommonsDbcpNativeJdbcExtractor
</li><li class="listitem">
JBossNativeJdbcExtractor
</li><li class="listitem">
WebLogicNativeJdbcExtractor
</li><li class="listitem">
WebSphereNativeJdbcExtractor
</li><li class="listitem">
XAPoolNativeJdbcExtractor
</li></ul></div>
<p>Usually the <code class="literal">SimpleNativeJdbcExtractor</code> is sufficient for unwrapping a <code class="literal">Connection</code>
object in most environments. See the javadocs for more details.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-advanced-jdbc" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-advanced-jdbc"></a>19.4&nbsp;JDBC batch operations</h2></div></div></div>

<p>Most JDBC drivers provide improved performance if you batch multiple calls to the same
prepared statement. By grouping updates into batches you limit the number of round trips
to the database.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-batch-classic" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-batch-classic"></a>19.4.1&nbsp;Basic batch operations with the JdbcTemplate</h3></div></div></div>

<p>You accomplish <code class="literal">JdbcTemplate</code> batch processing by implementing two methods of a special
interface, <code class="literal">BatchPreparedStatementSetter</code>, and passing that in as the second parameter
in your <code class="literal">batchUpdate</code> method call. Use the <code class="literal">getBatchSize</code> method to provide the size of
the current batch. Use the <code class="literal">setValues</code> method to set the values for the parameters of
the prepared statement. This method will be called the number of times that you
specified in the <code class="literal">getBatchSize</code> call. The following example updates the actor table
based on entries in a list. The entire list is used as the batch in this example:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span>[] batchUpdate(<span class="hl-keyword">final</span> List&lt;Actor&gt; actors) {
        <span class="hl-keyword">int</span>[] updateCounts = jdbcTemplate.batchUpdate(<span class="hl-string">"update t_actor set first_name = ?, "</span> +
                <span class="hl-string">"last_name = ? where id = ?"</span>,
            <span class="hl-keyword">new</span> BatchPreparedStatementSetter() {
                <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setValues(PreparedStatement ps, <span class="hl-keyword">int</span> i) <span class="hl-keyword">throws</span> SQLException {
                        ps.setString(<span class="hl-number">1</span>, actors.get(i).getFirstName());
                        ps.setString(<span class="hl-number">2</span>, actors.get(i).getLastName());
                        ps.setLong(<span class="hl-number">3</span>, actors.get(i).getId().longValue());
                    }

                    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getBatchSize() {
                        <span class="hl-keyword">return</span> actors.size();
                    }
                });
        <span class="hl-keyword">return</span> updateCounts;
    }

    <span class="hl-comment">// ... additional methods</span>
}</pre>
<p>If you are processing a stream of updates or reading from a file, then you might have a
preferred batch size, but the last batch might not have that number of entries. In this
case you can use the <code class="literal">InterruptibleBatchPreparedStatementSetter</code> interface, which allows
you to interrupt a batch once the input source is exhausted. The <code class="literal">isBatchExhausted</code> method
allows you to signal the end of the batch.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-batch-list" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-batch-list"></a>19.4.2&nbsp;Batch operations with a List of objects</h3></div></div></div>

<p>Both the <code class="literal">JdbcTemplate</code> and the <code class="literal">NamedParameterJdbcTemplate</code> provides an alternate way
of providing the batch update. Instead of implementing a special batch interface, you
provide all parameter values in the call as a list. The framework loops over these
values and uses an internal prepared statement setter. The API varies depending on
whether you use named parameters. For the named parameters you provide an array of
<code class="literal">SqlParameterSource</code>, one entry for each member of the batch. You can use the
<code class="literal">SqlParameterSource.createBatch</code> method to create this array, passing in either an array
of JavaBeans or an array of Maps containing the parameter values.</p>
<p>This example shows a batch update using named parameters:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {
    <span class="hl-keyword">private</span> NamedParameterTemplate namedParameterJdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.namedParameterJdbcTemplate = <span class="hl-keyword">new</span> NamedParameterJdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span>[] batchUpdate(<span class="hl-keyword">final</span> List&lt;Actor&gt; actors) {
        SqlParameterSource[] batch = SqlParameterSourceUtils.createBatch(actors.toArray());
        <span class="hl-keyword">int</span>[] updateCounts = namedParameterJdbcTemplate.batchUpdate(
                <span class="hl-string">"update t_actor set first_name = :firstName, last_name = :lastName where id = :id"</span>,
                batch);
        <span class="hl-keyword">return</span> updateCounts;
    }

    <span class="hl-comment">// ... additional methods</span>
}</pre>
<p>For an SQL statement using the classic "?" placeholders, you pass in a list containing an
object array with the update values. This object array must have one entry for each
placeholder in the SQL statement, and they must be in the same order as they are defined
in the SQL statement.</p>
<p>The same example using classic JDBC "?" placeholders:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span>[] batchUpdate(<span class="hl-keyword">final</span> List&lt;Actor&gt; actors) {
        List&lt;Object[]&gt; batch = <span class="hl-keyword">new</span> ArrayList&lt;Object[]&gt;();
        <span class="hl-keyword">for</span> (Actor actor : actors) {
            Object[] values = <span class="hl-keyword">new</span> Object[] {
                    actor.getFirstName(),
                    actor.getLastName(),
                    actor.getId()};
            batch.add(values);
        }
        <span class="hl-keyword">int</span>[] updateCounts = jdbcTemplate.batchUpdate(
                <span class="hl-string">"update t_actor set first_name = ?, last_name = ? where id = ?"</span>,
                batch);
        <span class="hl-keyword">return</span> updateCounts;
    }

    <span class="hl-comment">// ... additional methods</span>

}</pre>
<p>All of the above batch update methods return an int array containing the number of
affected rows for each batch entry. This count is reported by the JDBC driver. If the
count is not available, the JDBC driver returns a -2 value.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jdbc-batch-multi" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jdbc-batch-multi"></a>19.4.3&nbsp;Batch operations with multiple batches</h3></div></div></div>

<p>The last example of a batch update deals with batches that are so large that you want to
break them up into several smaller batches. You can of course do this with the methods
mentioned above by making multiple calls to the <code class="literal">batchUpdate</code> method, but there is now a
more convenient method. This method takes, in addition to the SQL statement, a
Collection of objects containing the parameters, the number of updates to make for each
batch and a <code class="literal">ParameterizedPreparedStatementSetter</code> to set the values for the parameters
of the prepared statement. The framework loops over the provided values and breaks the
update calls into batches of the size specified.</p>
<p>This example shows a batch update using a batch size of 100:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JdbcActorDao <span class="hl-keyword">implements</span> ActorDao {

    <span class="hl-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(DataSource dataSource) {
        <span class="hl-keyword">this</span>.jdbcTemplate = <span class="hl-keyword">new</span> JdbcTemplate(dataSource);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span>[][] batchUpdate(<span class="hl-keyword">final</span> Collection&lt;Actor&gt; actors) {
        <span class="hl-keyword">int</span>[][] updateCounts = jdbcTemplate.batchUpdate(
                <span class="hl-string">"update t_actor set first_name = ?, last_name = ? where id = ?"</span>,
                </pre></div></div></div></div></div></body></html>